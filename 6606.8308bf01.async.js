(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[6606],{1822:function(Ue,W,L){"use strict";var X=L(67294),j=L(33001),m=L(27199),J=L(30731),F=L(4874),$=function(ie,ne){var Le={};for(var Ie in ie)Object.prototype.hasOwnProperty.call(ie,Ie)&&ne.indexOf(Ie)<0&&(Le[Ie]=ie[Ie]);if(ie!=null&&typeof Object.getOwnPropertySymbols=="function")for(var He=0,Ie=Object.getOwnPropertySymbols(ie);He<Ie.length;He++)ne.indexOf(Ie[He])<0&&Object.prototype.propertyIsEnumerable.call(ie,Ie[He])&&(Le[Ie[He]]=ie[Ie[He]]);return Le},re=(0,X.forwardRef)(function(ie,ne){var Le=ie.style,Ie=Le===void 0?{height:"inherit"}:Le,He=ie.className,Rt=ie.loading,$t=ie.loadingTemplate,ht=ie.errorTemplate,Ut=$(ie,["style","className","loading","loadingTemplate","errorTemplate"]),dt=(0,m.Z)(j.aC,Ut),nt=dt.chart,rt=dt.container;return(0,X.useImperativeHandle)(ne,function(){return{getChart:function(){return nt.current}}}),X.createElement(J.Z,{errorTemplate:ht},Rt&&X.createElement(F.Z,{loadingTemplate:$t}),X.createElement("div",{className:He,style:Ie,ref:rt}))});W.Z=re},28614:function(Ue,W,L){"use strict";var X=L(67294),j=L(33001),m=L(27199),J=L(30731),F=L(4874),$=function(ie,ne){var Le={};for(var Ie in ie)Object.prototype.hasOwnProperty.call(ie,Ie)&&ne.indexOf(Ie)<0&&(Le[Ie]=ie[Ie]);if(ie!=null&&typeof Object.getOwnPropertySymbols=="function")for(var He=0,Ie=Object.getOwnPropertySymbols(ie);He<Ie.length;He++)ne.indexOf(Ie[He])<0&&Object.prototype.propertyIsEnumerable.call(ie,Ie[He])&&(Le[Ie[He]]=ie[Ie[He]]);return Le},re=(0,X.forwardRef)(function(ie,ne){var Le=ie.style,Ie=Le===void 0?{height:"inherit"}:Le,He=ie.className,Rt=ie.loading,$t=ie.loadingTemplate,ht=ie.errorTemplate,Ut=$(ie,["style","className","loading","loadingTemplate","errorTemplate"]),dt=(0,m.Z)(j.Kj,Ut),nt=dt.chart,rt=dt.container;return(0,X.useImperativeHandle)(ne,function(){return{getChart:function(){return nt.current}}}),X.createElement(J.Z,{errorTemplate:ht},Rt&&X.createElement(F.Z,{loadingTemplate:$t}),X.createElement("div",{className:He,style:Ie,ref:rt}))});W.Z=re},98093:function(Ue,W,L){"use strict";var X=L(67294),j=L(33001),m=L(27199),J=L(30731),F=L(4874),$=function(ie,ne){var Le={};for(var Ie in ie)Object.prototype.hasOwnProperty.call(ie,Ie)&&ne.indexOf(Ie)<0&&(Le[Ie]=ie[Ie]);if(ie!=null&&typeof Object.getOwnPropertySymbols=="function")for(var He=0,Ie=Object.getOwnPropertySymbols(ie);He<Ie.length;He++)ne.indexOf(Ie[He])<0&&Object.prototype.propertyIsEnumerable.call(ie,Ie[He])&&(Le[Ie[He]]=ie[Ie[He]]);return Le},re=(0,X.forwardRef)(function(ie,ne){var Le=ie.style,Ie=Le===void 0?{height:"inherit"}:Le,He=ie.className,Rt=ie.loading,$t=ie.loadingTemplate,ht=ie.errorTemplate,Ut=$(ie,["style","className","loading","loadingTemplate","errorTemplate"]),dt=(0,m.Z)(j.TZ,Ut),nt=dt.chart,rt=dt.container;return(0,X.useImperativeHandle)(ne,function(){return{getChart:function(){return nt.current}}}),X.createElement(J.Z,{errorTemplate:ht},Rt&&X.createElement(F.Z,{loadingTemplate:$t}),X.createElement("div",{className:He,style:Ie,ref:rt}))});W.Z=re},57611:function(Ue,W,L){"use strict";var X=L(67294),j=L(33001),m=L(27199),J=L(30731),F=L(4874),$=function(ie,ne){var Le={};for(var Ie in ie)Object.prototype.hasOwnProperty.call(ie,Ie)&&ne.indexOf(Ie)<0&&(Le[Ie]=ie[Ie]);if(ie!=null&&typeof Object.getOwnPropertySymbols=="function")for(var He=0,Ie=Object.getOwnPropertySymbols(ie);He<Ie.length;He++)ne.indexOf(Ie[He])<0&&Object.prototype.propertyIsEnumerable.call(ie,Ie[He])&&(Le[Ie[He]]=ie[Ie[He]]);return Le},re=(0,X.forwardRef)(function(ie,ne){var Le=ie.style,Ie=Le===void 0?{height:"inherit"}:Le,He=ie.className,Rt=ie.loading,$t=ie.loadingTemplate,ht=ie.errorTemplate,Ut=$(ie,["style","className","loading","loadingTemplate","errorTemplate"]),dt=(0,m.Z)(j.m,Ut),nt=dt.chart,rt=dt.container;return(0,X.useImperativeHandle)(ne,function(){return{getChart:function(){return nt.current}}}),X.createElement(J.Z,{errorTemplate:ht},Rt&&X.createElement(F.Z,{loadingTemplate:$t}),X.createElement("div",{className:He,style:Ie,ref:rt}))});W.Z=re},99525:function(Ue,W,L){"use strict";var X=L(67294),j=L(33001),m=L(27199),J=L(30731),F=L(4874),$=function(ie,ne){var Le={};for(var Ie in ie)Object.prototype.hasOwnProperty.call(ie,Ie)&&ne.indexOf(Ie)<0&&(Le[Ie]=ie[Ie]);if(ie!=null&&typeof Object.getOwnPropertySymbols=="function")for(var He=0,Ie=Object.getOwnPropertySymbols(ie);He<Ie.length;He++)ne.indexOf(Ie[He])<0&&Object.prototype.propertyIsEnumerable.call(ie,Ie[He])&&(Le[Ie[He]]=ie[Ie[He]]);return Le},re=(0,X.forwardRef)(function(ie,ne){var Le=ie.style,Ie=Le===void 0?{height:"inherit"}:Le,He=ie.className,Rt=ie.loading,$t=ie.loadingTemplate,ht=ie.errorTemplate,Ut=$(ie,["style","className","loading","loadingTemplate","errorTemplate"]),dt=(0,m.Z)(j.kB,Ut),nt=dt.chart,rt=dt.container;return(0,X.useImperativeHandle)(ne,function(){return{getChart:function(){return nt.current}}}),X.createElement(J.Z,{errorTemplate:ht},Rt&&X.createElement(F.Z,{loadingTemplate:$t}),X.createElement("div",{className:He,style:Ie,ref:rt}))});W.Z=re},64335:function(Ue,W,L){"use strict";var X=L(67294),j=(0,X.createContext)({});W.Z=j},21349:function(Ue,W,L){"use strict";var X=L(84305),j=L(69224),m=L(53645),J=L.n(m),F=L(67294),$=L(94184),re=L.n($),ie=L(64335),ne=function(Ie){var He=(0,F.useContext)(ie.Z),Rt=Ie.children,$t=Ie.contentWidth,ht=Ie.className,Ut=Ie.style,dt=(0,F.useContext)(j.ZP.ConfigContext),nt=dt.getPrefixCls,rt=Ie.prefixCls||nt("pro"),er=$t||He.contentWidth,K="".concat(rt,"-grid-content");return F.createElement("div",{className:re()(K,ht,{wide:er==="Fixed"}),style:Ut},F.createElement("div",{className:"".concat(rt,"-grid-content-children")},Rt))};W.Z=ne},72477:function(Ue,W,L){"use strict";L.d(W,{zP:function(){return dM},JE:function(){return gC},ns:function(){return pM}});var X={};L.r(X),L.d(X,{add:function(){return _r},adjoint:function(){return Wp},clone:function(){return $u},copy:function(){return Gp},create:function(){return _u},determinant:function(){return Jh},equals:function(){return Er},exactEquals:function(){return gr},frob:function(){return vr},fromQuat:function(){return Ul},fromQuat2:function(){return th},fromRotation:function(){return Sd},fromRotationTranslation:function(){return Xp},fromRotationTranslationScale:function(){return Ia},fromRotationTranslationScaleOrigin:function(){return rp},fromScaling:function(){return Ed},fromTranslation:function(){return Qh},fromValues:function(){return Hp},fromXRotation:function(){return wd},fromYRotation:function(){return ep},fromZRotation:function(){return Td},frustum:function(){return Tf},getRotation:function(){return rh},getScaling:function(){return tp},getTranslation:function(){return Yp},identity:function(){return jc},invert:function(){return Ju},lookAt:function(){return Mt},mul:function(){return st},multiply:function(){return xu},multiplyScalar:function(){return Ar},multiplyScalarAndAdd:function(){return Ur},ortho:function(){return It},orthoNO:function(){return Ne},orthoZO:function(){return ar},perspective:function(){return Kp},perspectiveFromFieldOfView:function(){return me},perspectiveNO:function(){return Rh},perspectiveZO:function(){return B},rotate:function(){return gc},rotateX:function(){return lo},rotateY:function(){return Rs},rotateZ:function(){return Oh},scale:function(){return ea},set:function(){return _l},str:function(){return lr},sub:function(){return Zt},subtract:function(){return wr},targetTo:function(){return Jt},translate:function(){return Hc},transpose:function(){return Gc}});var j=L(67294),m=(0,j.createContext)({});function J(){return(0,j.useContext)(m)}var F={},$={},re=function(i){return $[i]},ie=function(i,r){$[i]=r},ne=function(i){return F[i]},Le=function(i,r){F[i]=r},Ie={},He={},Rt=34,$t=10,ht=13;function Ut(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function dt(e,i){var r=Ut(e);return function(n,o){return i(r(n),o,e)}}function nt(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var o in n)o in i||r.push(i[o]=o)}),r}function rt(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function er(e){return e<0?"-"+rt(-e,6):e>9999?"+"+rt(e,6):rt(e,4)}function K(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":er(e.getUTCFullYear(),4)+"-"+rt(e.getUTCMonth()+1,2)+"-"+rt(e.getUTCDate(),2)+(o?"T"+rt(i,2)+":"+rt(r,2)+":"+rt(n,2)+"."+rt(o,3)+"Z":n?"T"+rt(i,2)+":"+rt(r,2)+":"+rt(n,2)+"Z":r||i?"T"+rt(i,2)+":"+rt(r,2)+"Z":"")}function Ht(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(I,D){var Z,te,le=o(I,function(ve,Be){if(Z)return Z(ve,Be-1);te=ve,Z=D?dt(ve,D):Ut(ve)});return le.columns=te||[],le}function o(I,D){var Z=[],te=I.length,le=0,ve=0,Be,it=te<=0,yt=!1;I.charCodeAt(te-1)===$t&&--te,I.charCodeAt(te-1)===ht&&--te;function wt(){if(it)return He;if(yt)return yt=!1,Ie;var Wt,nr=le,mr;if(I.charCodeAt(nr)===Rt){for(;le++<te&&I.charCodeAt(le)!==Rt||I.charCodeAt(++le)===Rt;);return(Wt=le)>=te?it=!0:(mr=I.charCodeAt(le++))===$t?yt=!0:mr===ht&&(yt=!0,I.charCodeAt(le)===$t&&++le),I.slice(nr+1,Wt-1).replace(/""/g,'"')}for(;le<te;){if((mr=I.charCodeAt(Wt=le++))===$t)yt=!0;else if(mr===ht)yt=!0,I.charCodeAt(le)===$t&&++le;else if(mr!==r)continue;return I.slice(nr,Wt)}return it=!0,I.slice(nr,te)}for(;(Be=wt())!==He;){for(var jt=[];Be!==Ie&&Be!==He;)jt.push(Be),Be=wt();D&&(jt=D(jt,ve++))==null||Z.push(jt)}return Z}function u(I,D){return I.map(function(Z){return D.map(function(te){return P(Z[te])}).join(e)})}function v(I,D){return D==null&&(D=nt(I)),[D.map(P).join(e)].concat(u(I,D)).join(`
`)}function y(I,D){return D==null&&(D=nt(I)),u(I,D).join(`
`)}function x(I){return I.map(E).join(`
`)}function E(I){return I.map(P).join(e)}function P(I){return I==null?"":I instanceof Date?K(I):i.test(I+="")?'"'+I.replace(/"/g,'""')+'"':I}return{parse:n,parseRows:o,format:v,formatBody:y,formatRows:x,formatRow:E,formatValue:P}}var at=Ht(","),Ye=at.parse,ut=at.parseRows,Je=at.format,Ot=at.formatBody,dr=at.formatRows,Cr=at.formatRow,jr=at.formatValue,T=L(96156),we=L(85061),De=L(6563),bt=L.n(De);function mt(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Lt(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?mt(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yt(e,i){var r=i.x,n=i.y,o=i.x1,u=i.y1,v=i.coordinates,y=[];return e.forEach(function(x,E){var P=[];if(r&&n&&(P=[parseFloat(x[r]),parseFloat(x[n])]),r&&n&&o&&u){var I=[parseFloat(x[r]),parseFloat(x[n])],D=[parseFloat(x[o]),parseFloat(x[u])];P=[I,D]}if(v){var Z="Polygon";Array.isArray(v[0])||(Z="Point"),Array.isArray(v[0])&&!Array.isArray(v[0][0])&&(Z="LineString");var te={type:Z,coordinates:(0,we.Z)(x[v])};bt()(te,!0),P=te.coordinates}var le=Lt(Lt({},x),{},{_id:E,coordinates:P});y.push(le)}),{dataArray:y}}var br=[{lng1:100,lat1:30,lng2:130,lat2:30}],Kn={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function cn(e,i){var r=Ye(e);return Yt(r,i)}var li=63710088e-1,Vn={centimeters:li*100,centimetres:li*100,degrees:li/111325,feet:li*3.28084,inches:li*39.37,kilometers:li/1e3,kilometres:li/1e3,meters:li,metres:li,miles:li/1609.344,millimeters:li*1e3,millimetres:li*1e3,nauticalmiles:li/1852,radians:1,yards:li*1.0936},ti={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/li,yards:1.0936133},ci={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Hn(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function fi(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return ua(i).geometry;case"LineString":return la(i).geometry;case"Polygon":return ki(i).geometry;case"MultiPoint":return bi(i).geometry;case"MultiLineString":return Xn(i).geometry;case"MultiPolygon":return zi(i).geometry;default:throw new Error(e+" is invalid")}}function ua(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!xn(e[0])||!xn(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Hn(n,i,r)}function Vi(e,i,r){return r===void 0&&(r={}),ma(e.map(function(n){return ua(n,i)}),r)}function ki(e,i,r){r===void 0&&(r={});for(var n=0,o=e;n<o.length;n++){var u=o[n];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var v=0;v<u[u.length-1].length;v++)if(u[u.length-1][v]!==u[0][v])throw new Error("First and last Position are not equivalent.")}var y={type:"Polygon",coordinates:e};return Hn(y,i,r)}function Ki(e,i,r){return r===void 0&&(r={}),ma(e.map(function(n){return ki(n,i)}),r)}function la(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Hn(n,i,r)}function Ai(e,i,r){return r===void 0&&(r={}),ma(e.map(function(n){return la(n,i)}),r)}function ma(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function Xn(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Hn(n,i,r)}function bi(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Hn(n,i,r)}function zi(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Hn(n,i,r)}function qi(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Hn(n,i,r)}function ko(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function de(e,i){i===void 0&&(i="kilometers");var r=Vn[i];if(!r)throw new Error(i+" units is invalid");return e*r}function Ln(e,i){i===void 0&&(i="kilometers");var r=Vn[i];if(!r)throw new Error(i+" units is invalid");return e/r}function Za(e,i){return kt(Ln(e,i))}function rs(e){var i=e%360;return i<0&&(i+=360),i}function kt(e){var i=e%(2*Math.PI);return i*180/Math.PI}function tr(e){var i=e%360;return i*Math.PI/180}function Sr(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return de(Ln(e,i),r)}function qr(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=ci[i];if(!n)throw new Error("invalid original units");var o=ci[r];if(!o)throw new Error("invalid final units");return e/n*o}function xn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function kn(e){return!!e&&e.constructor===Object}function hi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!xn(i))throw new Error("bbox must only contain numbers")})}function qn(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function an(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Di(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Oi(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Oi(e[0]);throw new Error("coordinates must only contain numbers")}function to(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function ps(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Zo(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,o=e.features;n<o.length;n++){var u=o[n];if(!u||u.type!=="Feature"||!u.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!u.geometry||u.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+u.geometry.type)}}function Na(e){return e.type==="Feature"?e.geometry:e}function xa(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function G(e,i,r){if(e!==null)for(var n,o,u,v,y,x,E,P=0,I=0,D,Z=e.type,te=Z==="FeatureCollection",le=Z==="Feature",ve=te?e.features.length:1,Be=0;Be<ve;Be++){E=te?e.features[Be].geometry:le?e.geometry:e,D=E?E.type==="GeometryCollection":!1,y=D?E.geometries.length:1;for(var it=0;it<y;it++){var yt=0,wt=0;if(v=D?E.geometries[it]:E,v!==null){x=v.coordinates;var jt=v.type;switch(P=r&&(jt==="Polygon"||jt==="MultiPolygon")?1:0,jt){case null:break;case"Point":if(i(x,I,Be,yt,wt)===!1)return!1;I++,yt++;break;case"LineString":case"MultiPoint":for(n=0;n<x.length;n++){if(i(x[n],I,Be,yt,wt)===!1)return!1;I++,jt==="MultiPoint"&&yt++}jt==="LineString"&&yt++;break;case"Polygon":case"MultiLineString":for(n=0;n<x.length;n++){for(o=0;o<x[n].length-P;o++){if(i(x[n][o],I,Be,yt,wt)===!1)return!1;I++}jt==="MultiLineString"&&yt++,jt==="Polygon"&&wt++}jt==="Polygon"&&yt++;break;case"MultiPolygon":for(n=0;n<x.length;n++){for(wt=0,o=0;o<x[n].length;o++){for(u=0;u<x[n][o].length-P;u++){if(i(x[n][o][u],I,Be,yt,wt)===!1)return!1;I++}wt++}yt++}break;case"GeometryCollection":for(n=0;n<v.geometries.length;n++)if(G(v.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Q(e,i,r,n){var o=r;return G(e,function(u,v,y,x,E){v===0&&r===void 0?o=u:o=i(o,u,v,y,x,E)},n),o}function oe(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function ge(e,i,r){var n=r;return oe(e,function(o,u){u===0&&r===void 0?n=o:n=i(n,o,u)}),n}function Pe(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Ge(e,i,r){var n=r;return Pe(e,function(o,u){u===0&&r===void 0?n=o:n=i(n,o,u)}),n}function et(e){var i=[];return G(e,function(r){i.push(r)}),i}function fe(e,i){var r,n,o,u,v,y,x,E,P,I,D=0,Z=e.type==="FeatureCollection",te=e.type==="Feature",le=Z?e.features.length:1;for(r=0;r<le;r++){for(y=Z?e.features[r].geometry:te?e.geometry:e,E=Z?e.features[r].properties:te?e.properties:{},P=Z?e.features[r].bbox:te?e.bbox:void 0,I=Z?e.features[r].id:te?e.id:void 0,x=y?y.type==="GeometryCollection":!1,v=x?y.geometries.length:1,o=0;o<v;o++){if(u=x?y.geometries[o]:y,u===null){if(i(null,D,E,P,I)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(u,D,E,P,I)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(i(u.geometries[n],D,E,P,I)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}D++}}function ke(e,i,r){var n=r;return fe(e,function(o,u,v,y,x){u===0&&r===void 0?n=o:n=i(n,o,u,v,y,x)}),n}function vt(e,i){fe(e,function(r,n,o,u,v){var y=r===null?null:r.type;switch(y){case null:case"Point":case"LineString":case"Polygon":return i(Hn(r,o,{bbox:u,id:v}),n,0)===!1?!1:void 0}var x;switch(y){case"MultiPoint":x="Point";break;case"MultiLineString":x="LineString";break;case"MultiPolygon":x="Polygon";break}for(var E=0;E<r.coordinates.length;E++){var P=r.coordinates[E],I={type:x,coordinates:P};if(i(Hn(I,o),n,E)===!1)return!1}})}function hr(e,i,r){var n=r;return vt(e,function(o,u,v){u===0&&v===0&&r===void 0?n=o:n=i(n,o,u,v)}),n}function Pt(e,i){vt(e,function(r,n,o){var u=0;if(!!r.geometry){var v=r.geometry.type;if(!(v==="Point"||v==="MultiPoint")){var y,x=0,E=0,P=0;if(G(r,function(I,D,Z,te,le){if(y===void 0||n>x||te>E||le>P){y=I,x=n,E=te,P=le,u=0;return}var ve=lineString([y,I],r.properties);if(i(ve,n,o,le,u)===!1)return!1;u++,y=I})===!1)return!1}}})}function Dt(e,i,r){var n=r,o=!1;return Pt(e,function(u,v,y,x,E){o===!1&&r===void 0?n=u:n=i(n,u,v,y,x,E),o=!0}),n}function pr(e,i){if(!e)throw new Error("geojson is required");vt(e,function(r,n,o){if(r.geometry!==null){var u=r.geometry.type,v=r.geometry.coordinates;switch(u){case"LineString":if(i(r,n,o,0,0)===!1)return!1;break;case"Polygon":for(var y=0;y<v.length;y++)if(i(lineString(v[y],r.properties),n,o,y)===!1)return!1;break}}})}function mn(e,i,r){var n=r;return pr(e,function(o,u,v,y){u===0&&r===void 0?n=o:n=i(n,o,u,v,y)}),n}function un(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,o=i.geometryIndex||0,u=i.segmentIndex||0,v=i.properties,y;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),v=v||e.features[r].properties,y=e.features[r].geometry;break;case"Feature":v=v||e.properties,y=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":y=e;break;default:throw new Error("geojson is invalid")}if(y===null)return null;var x=y.coordinates;switch(y.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=x.length+u-1),lineString([x[u],x[u+1]],v,i);case"Polygon":return o<0&&(o=x.length+o),u<0&&(u=x[o].length+u-1),lineString([x[o][u],x[o][u+1]],v,i);case"MultiLineString":return n<0&&(n=x.length+n),u<0&&(u=x[n].length+u-1),lineString([x[n][u],x[n][u+1]],v,i);case"MultiPolygon":return n<0&&(n=x.length+n),o<0&&(o=x[n].length+o),u<0&&(u=x[n][o].length-u-1),lineString([x[n][o][u],x[n][o][u+1]],v,i)}throw new Error("geojson is invalid")}function Tt(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,o=i.geometryIndex||0,u=i.coordIndex||0,v=i.properties,y;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),v=v||e.features[r].properties,y=e.features[r].geometry;break;case"Feature":v=v||e.properties,y=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":y=e;break;default:throw new Error("geojson is invalid")}if(y===null)return null;var x=y.coordinates;switch(y.type){case"Point":return point(x,v,i);case"MultiPoint":return n<0&&(n=x.length+n),point(x[n],v,i);case"LineString":return u<0&&(u=x.length+u),point(x[u],v,i);case"Polygon":return o<0&&(o=x.length+o),u<0&&(u=x[o].length+u),point(x[o][u],v,i);case"MultiLineString":return n<0&&(n=x.length+n),u<0&&(u=x[n].length+u),point(x[n][u],v,i);case"MultiPolygon":return n<0&&(n=x.length+n),o<0&&(o=x[n].length+o),u<0&&(u=x[n][o].length-u),point(x[n][o][u],v,i)}throw new Error("geojson is invalid")}function $r(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Fr(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$r(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$r(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gr(e,i){var r=[],n={};if(e.features=e.features.filter(function(u){var v=u.geometry;return u!=null&&v&&v.type&&v.coordinates&&v.coordinates.length>0}),bt()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var o=0;return vt(e,function(u,v){var y=Di(u),x=v,E=Fr(Fr({},u.properties),{},{coordinates:y,_id:x});r.push(E)}),{dataArray:r,featureKeys:n}}function vi(e){var i=131,r=137,n=0;e+="x";for(var o=Math.floor(9007199254740991/r),u=0;u<e.length;u++)n>o&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(u);return n}function Jr(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var Pn=L(28481),Wi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function pi(e){this.message=e}pi.prototype=new Error,pi.prototype.name="InvalidCharacterError";function Ci(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new pi("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,o,u,v=0;u=i.charAt(v++);~u&&(o=n%4?o*64+u:u,n++%4)?r+=String.fromCharCode(255&o>>(-2*n&6)):0)u=Wi.indexOf(u);return r}function _i(e){e=String(e);for(var i,r,n,o,u="",v=0,y=e.length%3;v<e.length;){if((r=e.charCodeAt(v++))>255||(n=e.charCodeAt(v++))>255||(o=e.charCodeAt(v++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|o,u+=Wi.charAt(i>>18&63)+Wi.charAt(i>>12&63)+Wi.charAt(i>>6&63)+Wi.charAt(i&63)}return y?u.slice(0,y-3)+"===".substring(y):u}var St=L(6610),Kt=L(5991),Ca=function(){function e(i,r){(0,St.Z)(this,e),this.buffers=i,this.type=r}return(0,Kt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,o){throw new Error("not implemented")}}]),e}(),Ei;typeof window=="undefined"?Ei={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ei=window;var Mi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Ui=Mi?my.getSystemInfoSync().pixelRatio:Ei.devicePixelRatio,Wr=L(10379),Sn=L(46070),zt=L(77608),na=function e(i,r){(0,St.Z)(this,e),(0,T.Z)(this,"cancelBubble",void 0),(0,T.Z)(this,"cancelable",void 0),(0,T.Z)(this,"target",void 0),(0,T.Z)(this,"currentTarget",void 0),(0,T.Z)(this,"preventDefault",void 0),(0,T.Z)(this,"stopPropagation",void 0),(0,T.Z)(this,"type",void 0),(0,T.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()},be=L(63349);function Ko(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Qi(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function Qi(e,i){if(!!e){if(typeof e=="string")return fu(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fu(e,i)}}function fu(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ba=new WeakMap,Ma=function(){function e(){(0,St.Z)(this,e),Ba.set(this,{})}return(0,Kt.Z)(e,[{key:"addEventListener",value:function(r,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=Ba.get(this);u||(u={}),u[r]||(u[r]=[]),u[r].push(n),Ba.set(this,u),o.capture,o.once,o.passive}},{key:"removeEventListener",value:function(r,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=Ba.get(this);if(u){var v=u[r];if(v&&v.length>0){for(var y=v.length;y--;y>0)if(v[y]===n){v.splice(y,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Ba.get(this)[r.type];if(n){var o=Ko(n),u;try{for(o.s();!(u=o.n()).done;){var v=u.value;v(r)}}catch(y){o.e(y)}finally{o.f()}}}}]),e}();function Wa(e){var i=ia();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function ia(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bo=function(e){(0,Wr.Z)(r,e);var i=Wa(r);function r(){var n;return(0,St.Z)(this,r),n=i.call(this),(0,T.Z)((0,be.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,Kt.Z)(r,[{key:"appendChild",value:function(o){this.childNodes.push(o)}},{key:"cloneNode",value:function(){var o=Object.create(this);return Object.assign(o,this),o}},{key:"removeChild",value:function(o){var u=this.childNodes.findIndex(function(v){return v===o});return u>-1?this.childNodes.splice(u,1):null}}]),r}(Ma);function Vo(e){var i=wu();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function wu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fo=function(e){(0,Wr.Z)(r,e);var i=Vo(r);function r(){var n;return(0,St.Z)(this,r),n=i.call(this),(0,T.Z)((0,be.Z)(n),"className",void 0),(0,T.Z)((0,be.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,Kt.Z)(r,[{key:"setAttribute",value:function(o,u){this[o]=u}},{key:"getAttribute",value:function(o){return this[o]}},{key:"setAttributeNS",value:function(o,u){this[o]=u}},{key:"getAttributeNS",value:function(o){return this[o]}}]),r}(bo),Do=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",aa,Xa,Fo,Ya;if(Do){var Cs=my.getSystemInfoSync();aa=Cs.screenWidth,Xa=Cs.screenHeight,Fo=Cs.windowWidth,Ya=Cs.windowHeight}else{var Sl=Ei.innerWidth,ds=Ei.innerHeight;aa=Sl,Xa=ds,Fo=Sl,Ya=ds}var ae={width:aa,height:Xa,availWidth:Fo,availHeight:Ya,availLeft:0,availTop:0},xe=ae.availWidth,qe=ae.availHeight,Ct={style:[]};function Ir(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return Ct}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return Ct}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Tn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:xe+"px",height:qe+"px",margin:"0px",padding:"0px"})}function Pi(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=xe,e.clientHeight=qe),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function ro(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=xe,e.offsetHeight=qe)}function ka(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=xe,e.scrollHeight=qe)}function za(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function jo(e){var i=vs();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function oo(){}var Eo=function(e){(0,Wr.Z)(r,e);var i=jo(r);function r(){var n,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",u=arguments.length>1?arguments[1]:void 0;return(0,St.Z)(this,r),n=i.call(this),(0,T.Z)((0,be.Z)(n),"className",void 0),(0,T.Z)((0,be.Z)(n),"children",void 0),(0,T.Z)((0,be.Z)(n),"focus",void 0),(0,T.Z)((0,be.Z)(n),"blur",void 0),(0,T.Z)((0,be.Z)(n),"insertBefore",void 0),(0,T.Z)((0,be.Z)(n),"appendChild",void 0),(0,T.Z)((0,be.Z)(n),"removeChild",void 0),(0,T.Z)((0,be.Z)(n),"remove",void 0),(0,T.Z)((0,be.Z)(n),"innerHTML",void 0),(0,T.Z)((0,be.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=oo,n.blur=oo,n.insertBefore=oo,n.appendChild=oo,n.removeChild=oo,n.remove=oo,n.innerHTML="",n.tagName=o.toUpperCase(),Ir((0,be.Z)(n),u),Tn((0,be.Z)(n)),za((0,be.Z)(n)),Pi((0,be.Z)(n)),ro((0,be.Z)(n)),ka((0,be.Z)(n)),n}return r}(fo);function ms(e){var i=Ms();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Ms(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fs=function(e){(0,Wr.Z)(r,e);var i=ms(r);function r(n){return(0,St.Z)(this,r),i.call(this,n)}return(0,Kt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Eo);function eu(e){var i=gs();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function gs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ga=function(e){(0,Wr.Z)(r,e);var i=eu(r);function r(){return(0,St.Z)(this,r),i.call(this,"video")}return r}(Fs),_a={},ns={};function ef(e,i){_a=e,_a.id=i,"tagName"in _a||(_a.tagName="CANVAS"),_a.type="canvas",Mixin.parentNode(_a),Mixin.style(_a),Mixin.classList(_a),Mixin.clientRegion(_a),Mixin.offsetRegion(_a),_a.focus=function(){},_a.blur=function(){}}function wl(e,i){var r=1024,n=1024;ns={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in ns||(ns.tagName="CANVAS"),Mixin.parentNode(ns),Mixin.style(ns),Mixin.classList(ns),Mixin.clientRegion(ns),Mixin.offsetRegion(ns),ns.getContext=function(o){if(o==="2d")return e},ns.focus=function(){},ns.blur=function(){}}function Hs(){return _a}function Jl(){return ns}var zu=function e(){(0,St.Z)(this,e);var i=Hs(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Ir(r),za(r),Object.assign(r,{addEventListener:function(o,u){r["on".concat(o)]=u.bind(r)},removeEventListener:function(o){r["on".concat(o)]=null}}),r},Ws={href:"",protocol:"",host:""};function il(e){var i=g();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A=function(e){(0,Wr.Z)(r,e);var i=il(r);function r(){return(0,St.Z)(this,r),i.call(this,"body",0)}return(0,Kt.Z)(r,[{key:"addEventListener",value:function(o,u){var v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,u,v){}},{key:"dispatchEvent",value:function(o){}}]),r}(Eo),N=function(e){(0,Wr.Z)(r,e);var i=il(r);function r(){return(0,St.Z)(this,r),i.call(this,"html",0)}return(0,Kt.Z)(r,[{key:"addEventListener",value:function(o,u){var v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,u){}},{key:"dispatchEvent",value:function(o){}}]),r}(Eo),O={},q={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Ws,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new zu:i==="video"?new ga:new Eo(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){O[i]||(O[i]=[]),O[i].push(r)},removeEventListener:function(i,r){var n=O[i];if(n&&n.length>0){for(var o=n.length;o--;o>0)if(n[o]===r){n.splice(o,1);break}}},dispatchEvent:function(i){var r=i.type,n=O[r];if(n)for(var o=0;o<n.length;o++)n[o](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new na(i)}};q.documentElement=new N,q.head=new Eo("head"),q.body=new A;var _e=Object,Xe=L(90484),ft=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"_w",void 0),(0,T.Z)(this,"_h",void 0),(0,T.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,Xe.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Kt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),pt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ir,sr,wn;if(pt){var ri=my.getSystemInfoSync();ir=ri.system,sr=ri.platform,wn=ri.language}else{var On={versions:function(){var e=Ei.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ei.navigator.browserLanguage||Ei.navigator.language).toLowerCase()};On.versions.android?sr="android":On.versions.trident?sr="IE":On.versions.presto?sr="Opera":On.versions.webKit?sr="webKit":On.versions.gecko?sr="Firefox":On.versions.mobile?sr="mobile":On.versions.ios?sr="ios":On.versions.iPhone?sr="iPhone":On.versions.iPad?sr="ipad":On.versions.webApp?sr="webApp":On.versions.weixin?sr="weixin":On.versions.qq&&(sr="qq"),ir=Ei.navigator.userAgent,wn=On.language}var Xi=ir.toLowerCase().indexOf("android")!==-1,da=Xi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",wa="Mozilla/5.0 (".concat(da,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(wn),ji={platform:sr,language:wn,appVersion:"5.0 (".concat(da,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:wa},ys={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},tu=0,Uu=0;function tf(e){var i=Date.now(),r=Math.max(tu+23,i);return Uu=setTimeout(function(){e(tu=r)},r-i),Uu}function al(e){var i=Hs();return i.requestAnimationFrame?i.requestAnimationFrame(e):tf(e)}function Cc(e){var i=Hs();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Tu=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,St.Z)(this,e),(0,T.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,Kt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],o=r.type,u=Au(n),v="data:".concat(o,";base64, ");return v+u}}]),e}();function Au(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,o=0;o<n;o++)i+=String.fromCharCode(r[o]);return _i(i)}var Cu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},so={};function kf(e){var i=Df();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Df(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qo=new Map,Mc=new Map,Mu=new Map,ru={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function rf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Tl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,rf.call(this,"readystatechange",i)}var Fi=function(e){(0,Wr.Z)(r,e);var i=kf(r);function r(){var n;return(0,St.Z)(this,r),n=i.call(this),(0,T.Z)((0,be.Z)(n),"onabort",void 0),(0,T.Z)((0,be.Z)(n),"onerror",void 0),(0,T.Z)((0,be.Z)(n),"onload",void 0),(0,T.Z)((0,be.Z)(n),"onloadstart",void 0),(0,T.Z)((0,be.Z)(n),"onprogress",void 0),(0,T.Z)((0,be.Z)(n),"ontimeout",void 0),(0,T.Z)((0,be.Z)(n),"onloadend",void 0),(0,T.Z)((0,be.Z)(n),"onreadystatechange",void 0),(0,T.Z)((0,be.Z)(n),"readyState",void 0),(0,T.Z)((0,be.Z)(n),"response",void 0),(0,T.Z)((0,be.Z)(n),"responseText",void 0),(0,T.Z)((0,be.Z)(n),"_responseType",void 0),(0,T.Z)((0,be.Z)(n),"responseXML",void 0),(0,T.Z)((0,be.Z)(n),"status",void 0),(0,T.Z)((0,be.Z)(n),"statusText",void 0),(0,T.Z)((0,be.Z)(n),"upload",void 0),(0,T.Z)((0,be.Z)(n),"withCredentials",void 0),(0,T.Z)((0,be.Z)(n),"timeout",void 0),(0,T.Z)((0,be.Z)(n),"_url",void 0),(0,T.Z)((0,be.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,qo.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Kt.Z)(r,[{key:"responseType",set:function(o){this._responseType=o}},{key:"abort",value:function(){var o=Mu.get("requestTask");o&&o.abort()}},{key:"getAllResponseHeaders",value:function(){var o=Mc.get("responseHeader");return Object.keys(o).map(function(u){return"".concat(u,": ").concat(o[u])}).join(`
`)}},{key:"getResponseHeader",value:function(o){return Mc.get("responseHeader")[o]}},{key:"open",value:function(o,u,v){this._method=o,this._url=u}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(o,u){var v=qo.get("requestHeader");v[o]=u,qo.set("requestHeader",v)}},{key:"addEventListener",value:function(o,u){var v=this;typeof u=="function"&&(this["on"+o]=function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};y.target=y.target||v,u.call(v,y)})}},{key:"removeEventListener",value:function(o,u){this["on"+o]===u&&(this["on"+o]=null)}}]),r}(Ma);(0,T.Z)(Fi,"UNSEND",void 0),(0,T.Z)(Fi,"OPENED",void 0),(0,T.Z)(Fi,"HEADERS_RECEIVED",void 0),(0,T.Z)(Fi,"LOADING",void 0),(0,T.Z)(Fi,"DONE",void 0),Fi.UNSEND=0,Fi.OPENED=1,Fi.HEADERS_RECEIVED=2,Fi.LOADING=3,Fi.DONE=4;function Al(e){var i=yh();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function yh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ol=function(e){(0,Wr.Z)(r,e);var i=Al(r);function r(n){var o;return(0,St.Z)(this,r),o=i.call(this,n),(0,T.Z)((0,be.Z)(o),"touches",void 0),(0,T.Z)((0,be.Z)(o),"targetTouches",void 0),(0,T.Z)((0,be.Z)(o),"changedTouches",void 0),o.touches=[],o.targetTouches=[],o.changedTouches=[],o.target=Hs(),o.currentTarget=Hs(),o}return r}(na);function Pc(e){var i=e||{},r=i.x,n=r===void 0?0:r,o=i.y,u=o===void 0?0:o,v=i.clientX,y=v===void 0?0:v,x=i.clientY,E=x===void 0?0:x;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=u):(e.x=y,e.y=E)}function Ff(e){return function(i){var r=new ol(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Pc(n)}),r.touches.forEach(function(n){return Pc(n)}),r.targetTouches.forEach(function(n){return Pc(n)}),q.dispatchEvent(r)}}function _h(e){return function(i){i.type=e,q.dispatchEvent(i)}}var Nf=Ff("touchstart"),Ic=Ff("touchmove"),Ql=Ff("touchend"),ec=_h("mapCameaParams");function Cl(e){var i=sl();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function sl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ml=function(e){(0,Wr.Z)(r,e);var i=Cl(r);function r(n){var o;return(0,St.Z)(this,r),o=i.call(this,n),(0,T.Z)((0,be.Z)(o),"buttons",void 0),(0,T.Z)((0,be.Z)(o),"which",void 0),(0,T.Z)((0,be.Z)(o),"pointerId",void 0),(0,T.Z)((0,be.Z)(o),"bubbles",void 0),(0,T.Z)((0,be.Z)(o),"button",void 0),(0,T.Z)((0,be.Z)(o),"width",void 0),(0,T.Z)((0,be.Z)(o),"height",void 0),(0,T.Z)((0,be.Z)(o),"pressure",void 0),(0,T.Z)((0,be.Z)(o),"isPrimary",void 0),(0,T.Z)((0,be.Z)(o),"pointerType",void 0),(0,T.Z)((0,be.Z)(o),"altKey",void 0),(0,T.Z)((0,be.Z)(o),"ctrlKey",void 0),(0,T.Z)((0,be.Z)(o),"metaKey",void 0),(0,T.Z)((0,be.Z)(o),"shiftKey",void 0),o.target=Hs(),o.currentTarget=Hs(),o}return r}(na),Zu=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Xs=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],nf="touch";function af(e,i,r){for(var n=new Ml(e),o=0;o<Zu.length;o++){var u=Zu[o];n[u]=i[u]||Xs[o]}return n.type=e,n.target=Hs(),n.currentTarget=Hs(),n.buttons=Bf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=tc(i),n.pointerType=nf,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Bf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var nu=null;function tc(e){return nu===e.identifier}function Oc(e){nu===null&&(nu=e.identifier)}function of(e){nu===e.identifier&&(nu=null)}function Pl(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var o=r[n];n===0&&e==="pointerdown"?Oc(o):(e==="pointerup"||e==="pointercancel")&&of(o);var u=af(e,o,i);q.dispatchEvent(u)}}}var Xh=Pl("pointerdown"),sf=Pl("pointermove"),Il=Pl("pointerup");function uf(e){var i=lf();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function lf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ol=function(e){(0,Wr.Z)(r,e);var i=uf(r);function r(n){return(0,St.Z)(this,r),i.call(this,n)}return r}(na);function Rc(e){return function(i){i.type=e,q.dispatchEvent(i)}}var xh=Rc("mousedown"),bh=Rc("mousemove"),rc=Rc("mouseup"),Eh=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Rl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),$i=Eh||Rl,nc={atob:Ci,btoa:_i,devicePixelRatio:Ui,Blob:Ca,document:q,Element:fo,Event:na,EventTarget:Ma,HTMLCanvasElement:_e,HTMLElement:Eo,HTMLMediaElement:Fs,HTMLVideoElement:ga,Image:zu,ImageData:ft,navigator:ji,Node:bo,requestAnimationFrame:al,cancelAnimationFrame:Cc,screen:ae,XMLHttpRequest:Fi,performance:ys,URL:Tu,WebGLRenderingContext:Cu,WebGL2RenderingContext:so,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};q.addEventListener(i,r,n)},removeEventListener:function(i,r,n){q.removeEventListener(i,r)},dispatchEvent:function(i){q.dispatchEvent(i)},innerWidth:ae.availWidth,innerHeight:ae.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ca=$i?nc:Ei,Pu=$i?Fi:Ei.XMLHttpRequest,Yi=$i?Ws:Ei.location;function Pa(e){var i=e;return typeof e=="string"&&(i=ca.document.getElementById(e)),i}function _s(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Lc(e){return _s(e).split(/\s+/)}function Vu(e){var i,r,n=ca==null||(i=ca.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var o in e)if(e[o]&&e[o]in n)return e[o];return e[0]}function Ua(e,i,r){var n=ca.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function ic(e){var i=e.parentNode;i&&i.removeChild(e)}function Ll(e,i){if(e.classList!==void 0)for(var r=Lc(i),n=0,o=r.length;n<o;n++)e.classList.add(r[n]);else if(!kc(e,i)){var u=ho(e);Iu(e,(u?u+" ":"")+i)}}function ju(e,i){e.classList!==void 0?e.classList.remove(i):Iu(e,_s((" "+ho(e)+" ").replace(" "+i+" "," ")))}function kc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=ho(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Iu(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function ho(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function kl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var ac=Vu(["transform","WebkitTransform"]);function po(e,i){e.style[ac]=i}function fn(){if(typeof Event=="function")ca.dispatchEvent(new Event("resize"));else{var e=ca.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ca,0),ca.dispatchEvent(e)}}function uo(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Gu(){var e,i=ca.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(o){var u=o.split("="),v=(0,Pn.Z)(u,2),y=v[0],x=v[1];return y==="initial-scale"});return n?n.split("=")[1]*1:1}var Da=Gu()<1?1:ca.devicePixelRatio,Ys=L(14665);function Ps(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var cf=L(51814);function zr(e,i,r){return(0,cf.Z)()?zr=Reflect.construct:zr=function(o,u,v){var y=[null];y.push.apply(y,u);var x=Function.bind.apply(o,y),E=new x;return v&&(0,Ys.Z)(E,v.prototype),E},zr.apply(null,arguments)}function oc(e){var i=typeof Map=="function"?new Map:void 0;return oc=function(n){if(n===null||!Ps(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,o)}function o(){return zr(n,arguments,(0,zt.Z)(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),(0,Ys.Z)(o,n)},oc(e)}function ff(e){var i=ul();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function ul(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ta=function(e){(0,Wr.Z)(r,e);var i=ff(r);function r(n,o,u){var v;return(0,St.Z)(this,r),v=i.call(this,n),(0,T.Z)((0,be.Z)(v),"status",void 0),(0,T.Z)((0,be.Z)(v),"url",void 0),v.status=o,v.url=u,v.name=v.constructor.name,v.message=n,v}return(0,Kt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(oc(Error));function xs(e){var i=new Pu;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var hf=function(i,r){var n=xs(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var o;try{o=JSON.parse(n.response)}catch(u){return r(u)}r(null,o)}else n.status===401?r(new Ta("".concat(n.statusText),n.status,i.url)):r(new Ta(n.statusText,n.status,i.url))},n.send(),n},Ou=function(i,r){var n=xs(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var o=n.response;if(o.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:o,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Ta(n.statusText,n.status,i.url))},n.send(),n};function Ns(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Ru="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",zf=function(i,r){return Ou(i,function(n,o){if(n)r(n);else if(o){var u=new ca.Image;u.crossOrigin="anonymous";var v=ca.URL||ca.webkitURL;u.onload=function(){r(null,u),v.revokeObjectURL(u.src)};var y=new ca.Blob([new Uint8Array(o.data)],{type:"image/png"});u.src=o.data.byteLength?v.createObjectURL(y):Ru}})},ll=2*Math.PI*6378137/2;function Uf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;pf(i,n)}),i}function pf(e,i){return Array.isArray(i[0])?i.forEach(function(r){pf(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function iu(e,i){return Is(e,i)}function Is(e,i){return Array.isArray(e[0])?e.map(function(r){return Is(r,i)}):i(e)}function wi(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=cl(e,i);var n=e[0],o=e[1],u=n*ll/180,v=Math.log(Math.tan((90+o)*Math.PI/360))/(Math.PI/180);return v=v*ll/180,r.enable&&(u=Number(u.toFixed(r.decimal)),v=Number(v.toFixed(r.decimal))),e.length===3?[u,v,e[2]]:[u,v]}function Lu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],o=r/ll*180,u=n/ll*180;return u=180/Math.PI*(2*Math.atan(Math.exp(u*Math.PI/180))-Math.PI/2),i!=null&&(o=Number(o.toFixed(i)),u=Number(u.toFixed(i))),e.length===3?[o,u,e[2]]:[o,u]}function au(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Go(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function cl(e,i){if(i===!1)return e;var r=au(e[0]),n=Go(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Bs(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,o=Math.PI/180,u=e[0]*o,v=r*o;v=Math.log(Math.tan(Math.PI/4+v/2));var y=.5/Math.PI,x=.5,E=-.5/Math.PI;return o=.5,u=n*(y*u+x),v=n*(E*v+o),[Math.floor(u),Math.floor(v)]}function Ks(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,o=.5,u=256<<20,v=_slicedToArray(e,2),y=v[0],x=v[1];y=(y/u-r)/i,x=(x/u-o)/n,x=(Math.atan(Math.pow(Math.E,x))-Math.PI/4)*2,o=Math.PI/180;var E=x/o,P=y/o;return[P,E]}function bs(e,i,r){var n=tr(i[1]-e[1]),o=tr(i[0]-e[0]),u=tr(e[1]),v=tr(i[1]),y=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(u)*Math.cos(v);return de(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),r="meters")}function hu(e){var i=Math.PI/180,r=85.0511287798,n=6378137,o=Math.max(Math.min(r,e[1]),-r),u=Math.sin(o*i),v=n*e[0]*i,y=n*Math.log((1+u)/(1-u))/2;return[v,y]}function Cn(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function bn(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Dc(e){return[[e[0],e[1]],[e[2],e[3]]]}var is=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,St.Z)(this,e),(0,T.Z)(this,"limit",void 0),(0,T.Z)(this,"cache",void 0),(0,T.Z)(this,"destroy",void 0),(0,T.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Kt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(o){return o===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function as(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var No=L(2650);function Fa(e){var i=No.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Hu(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],o=i+r*256+n*65536-1;return o}function Wu(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function oa(e){var i=ca.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),o=null,u=e.positions[0],v=e.positions[e.positions.length-1],y=0;y<e.colors.length;++y){var x=(e.positions[y]-u)/(v-u);n.addColorStop(x,e.colors[y])}return r.fillStyle=n,r.fillRect(0,0,256,1),o=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),$i?{data:o,width:256,height:1}:new ImageData(o,256,1)}var ba;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(ba||(ba={}));var sc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function fl(e,i,r){var n=e.classList;for(var o in sc)sc.hasOwnProperty(o)&&n.remove("l7-".concat(r,"-anchor-").concat(o));n.add("l7-".concat(r,"-anchor-").concat(i))}function pu(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function du(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function So(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function Xu(e){if(e.length===0)throw new Error("mean requires at least one data point");return So(e)/e.length}function vu(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,o=1,u=1;u<e.length+1;u++)e[u]!==i?(o>n&&(n=o,r=i),o=1,i=e[u]):o++;return r*1}var Dl={min:du,max:pu,mean:Xu,sum:So,mode:vu};function Yu(e,i){return e.map(function(r){return r[i]})}function uc(e,i){return Dl[e](i)}function Fc(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,o=new Promise(function(v){lc(e,function(y){v(y)})}),u={originData:e,images:o,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return u}function lc(e,i){var r=e,n=[];if(typeof r=="string")zf({url:r},function(v,y){n.push(y),i(n)});else{var o=r.length,u=0;r.forEach(function(v){zf({url:v},function(y,x){u++,n.push(x),u===o&&i(n)})})}return Fc}function Fl(e,i){var r=i.extent,n=i.width,o=i.height,u=i.min,v=i.max,y={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:o,min:u,max:v,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return y}var Zf=L(30236),hl=L.n(Zf),pl=L(47037),zs=L.n(pl),dl=L(23560),Ho=L.n(dl),df=L(50361),Nl=L.n(df),Nc=L(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function cc(e,i,r,n){function o(u){return u instanceof r?u:new r(function(v){v(u)})}return new(r||(r=Promise))(function(u,v){function y(P){try{E(n.next(P))}catch(I){v(I)}}function x(P){try{E(n.throw(P))}catch(I){v(I)}}function E(P){P.done?u(P.value):o(P.value).then(y,x)}E((n=n.apply(e,i||[])).next())})}function l(e,i){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,o,u,v;return v={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function y(E){return function(P){return x([E,P])}}function x(E){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(u=E[0]&2?o.return:E[0]?o.throw||((u=o.return)&&u.call(o),0):o.next)&&!(u=u.call(o,E[1])).done)return u;switch(o=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,o=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){r.label=E[1];break}if(E[0]===6&&r.label<u[1]){r.label=u[1],u=E;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(E);break}u[2]&&r.ops.pop(),r.trys.pop();continue}E=i.call(e,r)}catch(P){E=[6,P],o=0}finally{n=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function f(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,u=[],v;try{for(;(i===void 0||i-- >0)&&!(o=n.next()).done;)u.push(o.value)}catch(y){v={error:y}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(v)throw v.error}}return u}function c(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(f(arguments[i]));return e}function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function b(e,i){return i={exports:{}},e(i,i.exports),i.exports}var w=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});p(w);var C=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];var u=n.pop();return r.call(this,n,u)}},e.exports=i.default});p(C);var R=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=o,i.wrap=u;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof Nc=="object"&&typeof Nc.nextTick=="function";function o(y){setTimeout(y,0)}function u(y){return function(x){for(var E=[],P=arguments.length-1;P-- >0;)E[P]=arguments[P+1];return y(function(){return x.apply(void 0,E)})}}var v;r?v=setImmediate:n?v=Nc.nextTick:v=o,i.default=u(v)});p(R);var U=R.fallback,Y=R.wrap,ce=R.hasSetImmediate,he=R.hasNextTick,pe=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=u;var r=o(C),n=o(R);function o(x){return x&&x.__esModule?x:{default:x}}function u(x){return(0,Ae.isAsync)(x)?function(){for(var E=[],P=arguments.length;P--;)E[P]=arguments[P];var I=E.pop(),D=x.apply(this,E);return v(D,I)}:(0,r.default)(function(E,P){var I;try{I=x.apply(this,E)}catch(D){return P(D)}if(I&&typeof I.then=="function")return v(I,P);P(null,I)})}function v(x,E){return x.then(function(P){y(E,null,P)},function(P){y(E,P&&P.message?P:new Error(P))})}function y(x,E,P){try{x(E,P)}catch(I){(0,n.default)(function(D){throw D},I)}}e.exports=i.default});p(pe);var Ae=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(pe);function n(x){return x&&x.__esModule?x:{default:x}}function o(x){return x[Symbol.toStringTag]==="AsyncFunction"}function u(x){return x[Symbol.toStringTag]==="AsyncGenerator"}function v(x){return typeof x[Symbol.asyncIterator]=="function"}function y(x){if(typeof x!="function")throw new Error("expected a function");return o(x)?(0,r.default)(x):x}i.default=y,i.isAsync=o,i.isAsyncGenerator=u,i.isAsyncIterable=v});p(Ae);var Re=Ae.isAsyncIterable,We=Ae.isAsyncGenerator,Te=Ae.isAsync,Ve=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,o){if(o===void 0&&(o=n.length),!o)throw new Error("arity is undefined");function u(){for(var v=this,y=[],x=arguments.length;x--;)y[x]=arguments[x];return typeof y[o-1]=="function"?n.apply(this,y):new Promise(function(E,P){y[o-1]=function(I){for(var D=[],Z=arguments.length-1;Z-- >0;)D[Z]=arguments[Z+1];if(I)return P(I);E(D.length>1?D:D[0])},n.apply(v,y)})}return Object.defineProperty(u,"name",{configurable:!0,value:"awaitable("+n.name+")"}),u}e.exports=i.default});p(Ve);var Qe=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=u(w),n=u(Ae),o=u(Ve);function u(v){return v&&v.__esModule?v:{default:v}}i.default=(0,o.default)(function(v,y,x){var E=(0,r.default)(y)?[]:{};v(y,function(P,I,D){(0,n.default)(P)(function(Z){for(var te,le=[],ve=arguments.length-1;ve-- >0;)le[ve]=arguments[ve+1];le.length<2&&(te=le,le=te[0]),E[I]=le,D(Z)})},function(P){return x(P,E)})},3),e.exports=i.default});p(Qe);var gt=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function o(){for(var u=[],v=arguments.length;v--;)u[v]=arguments[v];if(n!==null){var y=n;n=null,y.apply(this,u)}}return Object.assign(o,n),o}e.exports=i.default});p(gt);var Gt=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});p(Gt);var Ft=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=x;var r=o(w),n=o(Gt);function o(E){return E&&E.__esModule?E:{default:E}}function u(E){var P=-1,I=E.length;return function(){return++P<I?{value:E[P],key:P}:null}}function v(E){var P=-1;return function(){var D=E.next();return D.done?null:(P++,{value:D.value,key:P})}}function y(E){var P=E?Object.keys(E):[],I=-1,D=P.length;return function(){var te=P[++I];return I<D?{value:E[te],key:te}:null}}function x(E){if((0,r.default)(E))return u(E);var P=(0,n.default)(E);return P?v(P):y(E)}e.exports=i.default});p(Ft);var Xt=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n===null)throw new Error("Callback was already called.");var v=n;n=null,v.apply(this,o)}}e.exports=i.default});p(Xt);var cr=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});p(cr);var Rr=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var r=n(cr);function n(u){return u&&u.__esModule?u:{default:u}}function o(u,v,y,x){var E=!1,P=!1,I=!1,D=0,Z=0;function te(){D>=v||I||E||(I=!0,u.next().then(function(Be){var it=Be.value,yt=Be.done;if(!(P||E)){if(I=!1,yt){E=!0,D<=0&&x(null);return}D++,y(it,Z,le),Z++,te()}}).catch(ve))}function le(Be,it){if(D-=1,!P){if(Be)return ve(Be);if(Be===!1){E=!0,P=!0;return}if(it===r.default||E&&D<=0)return E=!0,x(null);te()}}function ve(Be){P||(I=!1,E=!0,x(Be))}te()}e.exports=i.default});p(Rr);var Or=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=y(gt),n=y(Ft),o=y(Xt),u=y(Rr),v=y(cr);function y(x){return x&&x.__esModule?x:{default:x}}i.default=function(x){return function(E,P,I){if(I=(0,r.default)(I),x<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!E)return I(null);if((0,Ae.isAsyncGenerator)(E))return(0,u.default)(E,x,P,I);if((0,Ae.isAsyncIterable)(E))return(0,u.default)(E[Symbol.asyncIterator](),x,P,I);var D=(0,n.default)(E),Z=!1,te=!1,le=0,ve=!1;function Be(yt,wt){if(!te)if(le-=1,yt)Z=!0,I(yt);else if(yt===!1)Z=!0,te=!0;else{if(wt===v.default||Z&&le<=0)return Z=!0,I(null);ve||it()}}function it(){for(ve=!0;le<x&&!Z;){var yt=D();if(yt===null){Z=!0,le<=0&&I(null);return}le+=1,P(yt.value,yt.key,(0,o.default)(Be))}ve=!1}it()}},e.exports=i.default});p(Or);var Qr=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=u(Or),n=u(Ae),o=u(Ve);function u(y){return y&&y.__esModule?y:{default:y}}function v(y,x,E,P){return(0,r.default)(x)(y,(0,n.default)(E),P)}i.default=(0,o.default)(v,4),e.exports=i.default});p(Qr);var Dn=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=o(Qr),n=o(Ve);function o(v){return v&&v.__esModule?v:{default:v}}function u(v,y,x){return(0,r.default)(v,1,y,x)}i.default=(0,n.default)(u,3),e.exports=i.default});p(Dn);var Bn=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=u;var r=o(Qe),n=o(Dn);function o(v){return v&&v.__esModule?v:{default:v}}function u(v,y){return(0,r.default)(n.default,v,y)}e.exports=i.default}),Un=p(Bn),di=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Un(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(o){r.apply(void 0,c(n.args)),o(null,i)})},e}(),nn=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=E(w),n=E(cr),o=E(Qr),u=E(gt),v=E(Xt),y=E(Ae),x=E(Ve);function E(Z){return Z&&Z.__esModule?Z:{default:Z}}function P(Z,te,le){le=(0,u.default)(le);var ve=0,Be=0,it=Z.length,yt=!1;it===0&&le(null);function wt(jt,Wt){jt===!1&&(yt=!0),yt!==!0&&(jt?le(jt):(++Be===it||Wt===n.default)&&le(null))}for(;ve<it;ve++)te(Z[ve],ve,(0,v.default)(wt))}function I(Z,te,le){return(0,o.default)(Z,Infinity,te,le)}function D(Z,te,le){var ve=(0,r.default)(Z)?P:I;return ve(Z,(0,y.default)(te),le)}i.default=(0,x.default)(D,3),e.exports=i.default});p(nn);var ai=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=u;var r=o(nn),n=o(Qe);function o(v){return v&&v.__esModule?v:{default:v}}function u(v,y){return(0,n.default)(r.default,v,y)}e.exports=i.default}),si=p(ai),ei=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return si(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(o){return cc(n,void 0,void 0,function(){return l(this,function(u){switch(u.label){case 0:return[4,r()];case 1:return u.sent(),o(null,i),[2]}})})})},e}(),Wn=b(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(gt),n=v(Xt),o=v(Ae),u=v(Ve);function v(x){return x&&x.__esModule?x:{default:x}}function y(x,E){if(E=(0,r.default)(E),!Array.isArray(x))return E(new Error("First argument to waterfall must be an array of functions"));if(!x.length)return E();var P=0;function I(Z){var te=(0,o.default)(x[P++]);te.apply(void 0,Z.concat([(0,n.default)(D)]))}function D(Z){for(var te=[],le=arguments.length-1;le-- >0;)te[le]=arguments[le+1];if(Z!==!1){if(Z||P===x.length)return E.apply(void 0,[Z].concat(te));I(te)}}I([])}i.default=(0,u.default)(y),e.exports=i.default}),mi=p(Wn),$n=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return mi(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var o=r();n(o?null:!1,o)}):this.tasks.push(function(n,o){var u=r();o(u?null:!1,i)})},e}(),jn=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Un(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var o=r();n(o,i)})},e}(),Ea=L(26729),Ka=L.n(Ea),Bo=L(69848),wo=L.n(Bo);function Va(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function no(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Va(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Va(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Es(e,i){var r=i.radius,n=r===void 0?40:r,o=i.maxZoom,u=o===void 0?18:o,v=i.minZoom,y=v===void 0?0:v,x=i.zoom,E=x===void 0?2:x;if(e.pointIndex){var P=e.pointIndex.getClusters(e.extent,Math.floor(E));return e.dataArray=os(P),e}var I=new(wo())({radius:n,minZoom:y,maxZoom:u}),D={type:"FeatureCollection",features:[]};return D.features=e.dataArray.map(function(Z){return{type:"Feature",geometry:{type:"Point",coordinates:Z.coordinates},properties:no({},Z)}}),I.load(D.features),I}function os(e){return e.map(function(i,r){return no({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function ku(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function ss(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function qs(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,o=1;o<e.length;o++)n=i+e[o]*1,Math.abs(i)>=Math.abs(e[o])?r+=i-n+e[o]:r+=e[o]-n+i,i=n;return i+r*1}function $s(e){if(e.length===0)throw new Error("mean requires at least one data point");return qs(e)/e.length}var fc={min:ss,max:ku,mean:$s,sum:qs};function Bl(e,i){return e.map(function(r){return r[i]*1})}function mu(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function vl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?mu(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mu(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hc(e){var i=ou();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function ou(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function zl(e,i){if(Array.isArray(i))return i}var gu=function(e){(0,Wr.Z)(r,e);var i=hc(r);function r(n,o){var u;return(0,St.Z)(this,r),u=i.call(this),(0,T.Z)((0,be.Z)(u),"data",void 0),(0,T.Z)((0,be.Z)(u),"extent",void 0),(0,T.Z)((0,be.Z)(u),"hooks",{init:new di}),(0,T.Z)((0,be.Z)(u),"parser",{type:"geojson"}),(0,T.Z)((0,be.Z)(u),"transforms",[]),(0,T.Z)((0,be.Z)(u),"cluster",!1),(0,T.Z)((0,be.Z)(u),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,T.Z)((0,be.Z)(u),"mapService",void 0),(0,T.Z)((0,be.Z)(u),"invalidExtent",!1),(0,T.Z)((0,be.Z)(u),"originData",void 0),(0,T.Z)((0,be.Z)(u),"rawData",void 0),(0,T.Z)((0,be.Z)(u),"cfg",{}),(0,T.Z)((0,be.Z)(u),"clusterIndex",void 0),u.originData=n,u.initCfg(o),u.hooks.init.tap("parser",function(){u.excuteParser()}),u.hooks.init.tap("cluster",function(){u.initCluster()}),u.hooks.init.tap("transform",function(){u.executeTrans()}),u.init(),u}return(0,Kt.Z)(r,[{key:"setData",value:function(o,u){this.rawData=o,this.originData=o,this.initCfg(u),this.init(),this.emit("update")}},{key:"getClusters",value:function(o){return this.clusterIndex.getClusters(this.caculClusterExtent(2),o)}},{key:"getClustersLeaves",value:function(o){return this.clusterIndex.getLeaves(o,Infinity)}},{key:"updateClusterData",value:function(o){var u=this,v=this.clusterOptions,y=v.method,x=y===void 0?"sum":y,E=v.field,P=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(o));this.clusterOptions.zoom=o,P.forEach(function(I){I.id||(I.properties.point_count=1)}),(E||Ho()(x))&&(P=P.map(function(I){var D=I.id;if(D){var Z=u.clusterIndex.getLeaves(D,Infinity),te=Z.map(function(Be){return Be.properties}),le;if(zs()(x)&&E){var ve=Bl(te,E);le=fc[x](ve)}Ho()(x)&&(le=x(te)),I.properties.stat=le}else I.properties.point_count=1;return I})),this.data=re("geojson")({type:"FeatureCollection",features:P}),this.executeTrans()}},{key:"getFeatureById",value:function(o){var u=this.parser.type,v=u===void 0?"geojson":u;if(v==="geojson"&&!this.cluster){var y=o<this.originData.features.length?this.originData.features[o]:"null",x=Nl()(y);if(this.transforms.length!==0){var E=this.data.dataArray.find(function(P){return P._id===o});x.properties=E}return x}else return o<this.data.dataArray.length?this.data.dataArray[o]:"null"}},{key:"getFeatureId",value:function(o,u){var v=this.data.dataArray.find(function(y){return y[o]===name});return v==null?void 0:v._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(o){var u=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(u=Cn(Dc(this.extent),o)),u[0].concat(u[1])}},{key:"initCfg",value:function(o){this.cfg=hl()(this.cfg,o,zl);var u=this.cfg;u&&(u.parser&&(this.parser=u.parser),u.transforms&&(this.transforms=u.transforms),this.cluster=u.cluster||!1,u.clusterOptions&&(this.cluster=!0,this.clusterOptions=vl(vl({},this.clusterOptions),u.clusterOptions)))}},{key:"excuteParser",value:function(){var o=this.parser,u=o.type||"geojson";if(u==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var v=re(u);this.data=v(this.originData,o),this.extent=Uf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var o=this,u=this.transforms;u.forEach(function(v){var y=v.type,x=ne(y)(o.data,v);Object.assign(o.data,x)})}},{key:"initCluster",value:function(){if(!!this.cluster){var o=this.clusterOptions||{};this.clusterIndex=Es(this.data,o)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(Ea.EventEmitter);function yo(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function yu(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ku(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function Ku(e,i){if(!!e){if(typeof e=="string")return Du(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Du(e,i)}}function Du(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ji=6378e3;function Us(e,i){var r=e.dataArray,n=i.size,o=n===void 0?10:n,u=o/(2*Math.PI*Ji)*(256<<20)/2,v=us(r,o),y=v.gridHash,x=v.gridOffset,E=vf(y,x,i);return{yOffset:u,xOffset:u,radius:u,type:"grid",dataArray:E}}function us(e,i){var r=Infinity,n=-Infinity,o,u=yu(e),v;try{for(u.s();!(v=u.n()).done;){var y=v.value;o=y.coordinates[1],Number.isFinite(o)&&(r=o<r?o:r,n=o>n?o:n)}}catch(yt){u.e(yt)}finally{u.f()}var x=(r+n)/2,E=qu(i,x);if(E.xOffset<=0||E.yOffset<=0)return{gridHash:{},gridOffset:E};var P={},I=yu(e),D;try{for(I.s();!(D=I.n()).done;){var Z=D.value,te=Z.coordinates[1],le=Z.coordinates[0];if(Number.isFinite(te)&&Number.isFinite(le)){var ve=Math.floor((te+90)/E.yOffset),Be=Math.floor((le+180)/E.xOffset),it="".concat(ve,"-").concat(Be);P[it]=P[it]||{count:0,points:[]},P[it].count+=1,P[it].points.push(Z)}}}catch(yt){I.e(yt)}finally{I.f()}return{gridHash:P,gridOffset:E}}function qu(e,i){var r=Bc(e),n=zc(i,e);return{yOffset:r,xOffset:n}}function Bc(e){return e/Ji*(180/Math.PI)}function zc(e,i){return i/Ji*(180/Math.PI)/Math.cos(e*Math.PI/180)}function vf(e,i,r){return Object.keys(e).reduce(function(n,o,u){var v=o.split("-"),y=parseInt(v[0],10),x=parseInt(v[1],10),E={};if(r.field&&r.method){var P=Yu(e[o].points,r.field);E[r.method]=Dl[r.method](P)}return Object.assign(E,{_id:u,coordinates:Bs([-180+i.xOffset*(x+.5),-90+i.yOffset*(y+.5)]),rawData:e[o].points,count:e[o].count}),n.push(E),n},[])}var $o=Math.PI/3,pc=[0,$o,2*$o,3*$o,4*$o,5*$o];function su(e){return e[0]}function ml(e){return e[1]}function Uc(){var e=0,i=0,r=1,n=1,o=su,u=ml,v,y,x;function E(I){var D={},Z=[],te,le=I.length;for(te=0;te<le;++te)if(!(isNaN(Be=+o.call(null,ve=I[te],te,I))||isNaN(it=+u.call(null,ve,te,I)))){var ve,Be,it,yt=Math.round(it=it/x),wt=Math.round(Be=Be/y-(yt&1)/2),jt=it-yt;if(Math.abs(jt)*3>1){var Wt=Be-wt,nr=wt+(Be<wt?-1:1)/2,mr=yt+(it<yt?-1:1),tn=Be-nr,vn=it-mr;Wt*Wt+jt*jt>tn*tn+vn*vn&&(wt=nr+(yt&1?1:-1)/2,yt=mr)}var Pr=wt+"-"+yt,In=D[Pr];In?In.push(ve):(Z.push(In=D[Pr]=[ve]),In.x=(wt+(yt&1)/2)*y,In.y=yt*x)}return Z}function P(I){var D=0,Z=0;return pc.map(function(te){var le=Math.sin(te)*I,ve=-Math.cos(te)*I,Be=le-D,it=ve-Z;return D=le,Z=ve,[Be,it]})}return E.hexagon=function(I){return"m"+P(I==null?v:+I).join("l")+"z"},E.centers=function(){for(var I=[],D=Math.round(i/x),Z=Math.round(e/y),te=D*x;te<n+v;te+=x,++D)for(var le=Z*y+(D&1)*y/2;le<r+y/2;le+=y)I.push([le,te]);return I},E.mesh=function(){var I=P(v).slice(0,4).join("l");return E.centers().map(function(D){return"M"+D+"m"+I}).join("")},E.x=function(I){return arguments.length?(o=I,E):o},E.y=function(I){return arguments.length?(u=I,E):u},E.radius=function(I){return arguments.length?(v=+I,y=v*2*Math.sin($o),x=v*1.5,E):v},E.size=function(I){return arguments.length?(e=i=0,r=+I[0],n=+I[1],E):[r-e,n-i]},E.extent=function(I){return arguments.length?(e=+I[0][0],i=+I[0][1],r=+I[1][0],n=+I[1][1],E):[[e,i],[r,n]]},E.radius(1)}function uu(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function To(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?uu(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uu(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Zc=6378e3;function Vf(e,i){var r=e.dataArray,n=i.size,o=n===void 0?10:n,u=i.method,v=u===void 0?"sum":u,y=o/(2*Math.PI*Zc)*(256<<20)/2,x=r.map(function(D){var Z=Bs(D.coordinates),te=(0,Pn.Z)(Z,2),le=te[0],ve=te[1];return To(To({},D),{},{coordinates:[le,ve]})}),E=Uc().radius(y).x(function(D){return D.coordinates[0]}).y(function(D){return D.coordinates[1]}),P=E(x),I={dataArray:P.map(function(D,Z){var te;if(i.field&&v){var le=Yu(D,i.field);D[v]=Dl[v](le)}return te={},(0,T.Z)(te,i.method,D[v]),(0,T.Z)(te,"count",D.length),(0,T.Z)(te,"rawData",D),(0,T.Z)(te,"coordinates",[D.x,D.y]),(0,T.Z)(te,"_id",Z),te}),radius:y,xOffset:y,yOffset:y,type:"hexagon"};return I}function jf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function mf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jf(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yh(e,i){var r=i.sourceField,n=i.targetField,o=i.data,u={};return o.forEach(function(v){u[v[r]]=v}),e.dataArray=e.dataArray.map(function(v){var y=v[n];return mf(mf({},v),u[y])}),e}function Kh(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}var dc=gu;ie("geojson",Gr),ie("image",Fc),ie("csv",cn),ie("json",Yt),ie("raster",Fl),Le("cluster",Es),Le("filter",yo),Le("join",Yh),Le("map",Kh),Le("grid",Us),Le("hexagon",Vf);var gf=br,Sh=Kn,yd=L(28660),Lr=L(86700),yf=L(84879),qt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},_d=L(31745),_f=L.n(_d);function wh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Bp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?wh(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function zp(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Up(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function Up(e,i){if(!!e){if(typeof e=="string")return Th(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Th(e,i)}}function Th(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Gf=30;function xf(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,o=e.buffer,u=e.maxCanvasWidth,v=e.mapping,y=v===void 0?{}:v,x=e.xOffset,E=x===void 0?0:x,P=e.yOffset,I=P===void 0?0:P,D=0,Z=E;Array.from(i).forEach(function(le,ve){if(!y[le]){var Be=r(le,ve);Z+Gf>u&&(Z=0,D++),y[le]={x:Z,y:I+D*Gf,width:Gf,height:Gf,advance:Be},Z+=Gf}});var te=n+o*2;return{mapping:y,xOffset:Z,yOffset:I+D*te,canvasHeight:Hf(I+(D+1)*te)}}function xd(e,i,r){var n=0,o=0,u=0,v=[],y={},x=zp(e),E;try{for(x.s();!(E=x.n()).done;){var P=E.value;if(!y[P.id]){var I=P.size;n+I+i>r&&(_o(y,v,o),n=0,o=u+o+i,u=0,v=[]),v.push({icon:P,xOffset:n}),n=n+I+i,u=Math.max(u,I)}}}catch(Z){x.e(Z)}finally{x.f()}v.length>0&&_o(y,v,o);var D=Hf(u+o+i);return{mapping:y,canvasHeight:D}}function _o(e,i,r){var n=zp(i),o;try{for(n.s();!(o=n.n()).done;){var u=o.value,v=u.icon,y=u.xOffset;e[v.id]=Bp(Bp({},v),{},{x:y,y:r,image:v.image,width:v.width,height:v.height})}}catch(x){n.e(x)}finally{n.f()}}function Hf(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var qh,Wf;function Xf(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Yf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function Yf(e,i){if(!!e){if(typeof e=="string")return Kf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kf(e,i)}}function Kf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function bf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function gl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bf(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ef=Qf(),qf="sans-serif",Ah="normal",vc=24,Ch=3,$f=.25,Mh=8,Vc=1024,Sf=1,Zs=1,Jf=3,Ph=null;function Qf(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function wf(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function eh(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var yl=(qh=(0,Lr.b2)(),qh(Wf=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"fontAtlas",void 0),(0,T.Z)(this,"iconFontMap",void 0),(0,T.Z)(this,"iconFontGlyphs",{}),(0,T.Z)(this,"fontOptions",void 0),(0,T.Z)(this,"key",void 0),(0,T.Z)(this,"cache",new is(Jf))}return(0,Kt.Z)(e,[{key:"scale",get:function(){return Zs}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:qf,fontWeight:Ah,characterSet:Ef,fontSize:vc,buffer:Ch,sdf:!0,cutoff:$f,radius:Mh,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(o){n.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=gl(gl({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&n.length===0)){var u=this.generateFontAtlas(this.key,n,o);this.fontAtlas=u,this.cache.set(this.key,u)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,o){var u=this.fontOptions,v=u.fontFamily,y=u.fontWeight,x=u.fontSize,E=u.buffer,P=u.sdf,I=u.radius,D=u.cutoff,Z=u.iconfont,te=o&&o.data;te||(te=ca.document.createElement("canvas"),te.width=Vc);var le=te.getContext("2d");wf(le,v,x,y);var ve=xf(gl({getFontWidth:function(nl){return le.measureText(nl).width},fontHeight:x*Zs,buffer:E,characterSet:n,maxCanvasWidth:Vc},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),Be=ve.mapping,it=ve.canvasHeight,yt=ve.xOffset,wt=ve.yOffset,jt=le.getImageData(0,0,te.width,te.height);if(te.height=it,le.putImageData(jt,0,0),wf(le,v,x,y),P){var Wt=new(_f())(x,E,I,D,v,y),nr=le.getImageData(0,0,Wt.size,Wt.size),mr=Xf(n),tn;try{for(mr.s();!(tn=mr.n()).done;){var vn=tn.value;if(Z){var Pr=String.fromCharCode(parseInt(vn.replace("&#x","").replace(";",""),16)),In=Wt.draw(Pr);eh(In,nr)}else eh(Wt.draw(vn),nr);le.putImageData(nr,Be[vn].x,Be[vn].y)}}catch(As){mr.e(As)}finally{mr.f()}}else{var Gn=Xf(n),yi;try{for(Gn.s();!(yi=Gn.n()).done;){var Lo=yi.value;le.fillText(Lo,Be[Lo].x,Be[Lo].y+x*Sf)}}catch(As){Gn.e(As)}finally{Gn.f()}}return{xOffset:yt,yOffset:wt,mapping:Be,data:te,width:te.width,height:te.height}}},{key:"getKey",value:function(){return"key";var r,n,o,u,v,y,x,E}},{key:"getNewChars",value:function(r,n){var o=this.cache.get(r);if(!o)return n;var u=[],v=o.mapping,y=new Set(Object.keys(v)),x=new Set(n);return x.forEach(function(E){y.has(E)||u.push(E)}),u}}]),e}())||Wf),mc,$h;function Ih(e){var i=Zp();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Zp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bd=3,Vp=1024,Os=64,jp=(mc=(0,Lr.b2)(),mc($h=function(e){(0,Wr.Z)(r,e);var i=Ih(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"canvasHeight",128),(0,T.Z)((0,be.Z)(n),"texture",void 0),(0,T.Z)((0,be.Z)(n),"canvas",void 0),(0,T.Z)((0,be.Z)(n),"iconData",void 0),(0,T.Z)((0,be.Z)(n),"iconMap",void 0),(0,T.Z)((0,be.Z)(n),"ctx",void 0),(0,T.Z)((0,be.Z)(n),"loadingImageCount",0),n}return(0,Kt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ca.document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(o,u){var v=this,y=new Image;if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:Os}),this.updateIconMap(),this.loadImage(u).then(function(x){y=x;var E=v.iconData.find(function(P){return P.id===o});E&&(E.image=y,E.width=y.width,E.height=y.height),v.update()})}},{key:"addImageMini",value:function(o,u,v){var y=this,x=v.getSceneConfig().canvas,E=x.createImage();if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:Os}),this.updateIconMap(),this.loadImageMini(u,x).then(function(P){E=P;var I=y.iconData.find(function(D){return D.id===o});I&&(I.image=E,I.width=E.width,I.height=E.height),y.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(o){return this.iconMap.hasOwnProperty(o)}},{key:"removeImage",value:function(o){this.hasImage(o)&&(this.iconData=this.iconData.filter(function(u){return u.id!==o}),delete this.iconMap[o],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var o=this;this.canvas.width=Vp,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(u){var v=o.iconMap[u],y=v.x,x=v.y,E=v.image,P=v.width,I=P===void 0?64:P,D=v.height,Z=D===void 0?64:D,te=Math.max(I,Z),le=te/Os,ve=Z/le,Be=I/le;E&&o.ctx.drawImage(E,y+(Os-Be)/2,x+(Os-ve)/2,Be,ve)})}},{key:"updateIconMap",value:function(){var o=xd(this.iconData,bd,Vp),u=o.mapping,v=o.canvasHeight;this.iconMap=u,this.canvasHeight=v}},{key:"loadImage",value:function(o){return new Promise(function(u,v){if(o instanceof HTMLImageElement){u(o);return}var y=new Image;y.crossOrigin="anonymous",y.onload=function(){u(y)},y.onerror=function(){v(new Error("Could not load image at "+o))},y.src=o instanceof File?URL.createObjectURL(o):o})}},{key:"loadImageMini",value:function(o,u){return new Promise(function(v,y){var x=u.createImage();x.crossOrigin="anonymous",x.onload=function(){v(x)},x.onerror=function(){y(new Error("Could not load image at "+o))},x.src=o})}}]),r}(Ea.EventEmitter))||$h),Aa=L(49685);function _u(){var e=new Aa.WT(16);return Aa.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function $u(e){var i=new Aa.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Gp(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Hp(e,i,r,n,o,u,v,y,x,E,P,I,D,Z,te,le){var ve=new Aa.WT(16);return ve[0]=e,ve[1]=i,ve[2]=r,ve[3]=n,ve[4]=o,ve[5]=u,ve[6]=v,ve[7]=y,ve[8]=x,ve[9]=E,ve[10]=P,ve[11]=I,ve[12]=D,ve[13]=Z,ve[14]=te,ve[15]=le,ve}function _l(e,i,r,n,o,u,v,y,x,E,P,I,D,Z,te,le,ve){return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=u,e[5]=v,e[6]=y,e[7]=x,e[8]=E,e[9]=P,e[10]=I,e[11]=D,e[12]=Z,e[13]=te,e[14]=le,e[15]=ve,e}function jc(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Gc(e,i){if(e===i){var r=i[1],n=i[2],o=i[3],u=i[6],v=i[7],y=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=u,e[11]=i[14],e[12]=o,e[13]=v,e[14]=y}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Ju(e,i){var r=i[0],n=i[1],o=i[2],u=i[3],v=i[4],y=i[5],x=i[6],E=i[7],P=i[8],I=i[9],D=i[10],Z=i[11],te=i[12],le=i[13],ve=i[14],Be=i[15],it=r*y-n*v,yt=r*x-o*v,wt=r*E-u*v,jt=n*x-o*y,Wt=n*E-u*y,nr=o*E-u*x,mr=P*le-I*te,tn=P*ve-D*te,vn=P*Be-Z*te,Pr=I*ve-D*le,In=I*Be-Z*le,Gn=D*Be-Z*ve,yi=it*Gn-yt*In+wt*Pr+jt*vn-Wt*tn+nr*mr;return yi?(yi=1/yi,e[0]=(y*Gn-x*In+E*Pr)*yi,e[1]=(o*In-n*Gn-u*Pr)*yi,e[2]=(le*nr-ve*Wt+Be*jt)*yi,e[3]=(D*Wt-I*nr-Z*jt)*yi,e[4]=(x*vn-v*Gn-E*tn)*yi,e[5]=(r*Gn-o*vn+u*tn)*yi,e[6]=(ve*wt-te*nr-Be*yt)*yi,e[7]=(P*nr-D*wt+Z*yt)*yi,e[8]=(v*In-y*vn+E*mr)*yi,e[9]=(n*vn-r*In-u*mr)*yi,e[10]=(te*Wt-le*wt+Be*it)*yi,e[11]=(I*wt-P*Wt-Z*it)*yi,e[12]=(y*tn-v*Pr-x*mr)*yi,e[13]=(r*Pr-n*tn+o*mr)*yi,e[14]=(le*yt-te*jt-ve*it)*yi,e[15]=(P*jt-I*yt+D*it)*yi,e):null}function Wp(e,i){var r=i[0],n=i[1],o=i[2],u=i[3],v=i[4],y=i[5],x=i[6],E=i[7],P=i[8],I=i[9],D=i[10],Z=i[11],te=i[12],le=i[13],ve=i[14],Be=i[15];return e[0]=y*(D*Be-Z*ve)-I*(x*Be-E*ve)+le*(x*Z-E*D),e[1]=-(n*(D*Be-Z*ve)-I*(o*Be-u*ve)+le*(o*Z-u*D)),e[2]=n*(x*Be-E*ve)-y*(o*Be-u*ve)+le*(o*E-u*x),e[3]=-(n*(x*Z-E*D)-y*(o*Z-u*D)+I*(o*E-u*x)),e[4]=-(v*(D*Be-Z*ve)-P*(x*Be-E*ve)+te*(x*Z-E*D)),e[5]=r*(D*Be-Z*ve)-P*(o*Be-u*ve)+te*(o*Z-u*D),e[6]=-(r*(x*Be-E*ve)-v*(o*Be-u*ve)+te*(o*E-u*x)),e[7]=r*(x*Z-E*D)-v*(o*Z-u*D)+P*(o*E-u*x),e[8]=v*(I*Be-Z*le)-P*(y*Be-E*le)+te*(y*Z-E*I),e[9]=-(r*(I*Be-Z*le)-P*(n*Be-u*le)+te*(n*Z-u*I)),e[10]=r*(y*Be-E*le)-v*(n*Be-u*le)+te*(n*E-u*y),e[11]=-(r*(y*Z-E*I)-v*(n*Z-u*I)+P*(n*E-u*y)),e[12]=-(v*(I*ve-D*le)-P*(y*ve-x*le)+te*(y*D-x*I)),e[13]=r*(I*ve-D*le)-P*(n*ve-o*le)+te*(n*D-o*I),e[14]=-(r*(y*ve-x*le)-v*(n*ve-o*le)+te*(n*x-o*y)),e[15]=r*(y*D-x*I)-v*(n*D-o*I)+P*(n*x-o*y),e}function Jh(e){var i=e[0],r=e[1],n=e[2],o=e[3],u=e[4],v=e[5],y=e[6],x=e[7],E=e[8],P=e[9],I=e[10],D=e[11],Z=e[12],te=e[13],le=e[14],ve=e[15],Be=i*v-r*u,it=i*y-n*u,yt=i*x-o*u,wt=r*y-n*v,jt=r*x-o*v,Wt=n*x-o*y,nr=E*te-P*Z,mr=E*le-I*Z,tn=E*ve-D*Z,vn=P*le-I*te,Pr=P*ve-D*te,In=I*ve-D*le;return Be*In-it*Pr+yt*vn+wt*tn-jt*mr+Wt*nr}function xu(e,i,r){var n=i[0],o=i[1],u=i[2],v=i[3],y=i[4],x=i[5],E=i[6],P=i[7],I=i[8],D=i[9],Z=i[10],te=i[11],le=i[12],ve=i[13],Be=i[14],it=i[15],yt=r[0],wt=r[1],jt=r[2],Wt=r[3];return e[0]=yt*n+wt*y+jt*I+Wt*le,e[1]=yt*o+wt*x+jt*D+Wt*ve,e[2]=yt*u+wt*E+jt*Z+Wt*Be,e[3]=yt*v+wt*P+jt*te+Wt*it,yt=r[4],wt=r[5],jt=r[6],Wt=r[7],e[4]=yt*n+wt*y+jt*I+Wt*le,e[5]=yt*o+wt*x+jt*D+Wt*ve,e[6]=yt*u+wt*E+jt*Z+Wt*Be,e[7]=yt*v+wt*P+jt*te+Wt*it,yt=r[8],wt=r[9],jt=r[10],Wt=r[11],e[8]=yt*n+wt*y+jt*I+Wt*le,e[9]=yt*o+wt*x+jt*D+Wt*ve,e[10]=yt*u+wt*E+jt*Z+Wt*Be,e[11]=yt*v+wt*P+jt*te+Wt*it,yt=r[12],wt=r[13],jt=r[14],Wt=r[15],e[12]=yt*n+wt*y+jt*I+Wt*le,e[13]=yt*o+wt*x+jt*D+Wt*ve,e[14]=yt*u+wt*E+jt*Z+Wt*Be,e[15]=yt*v+wt*P+jt*te+Wt*it,e}function Hc(e,i,r){var n=r[0],o=r[1],u=r[2],v,y,x,E,P,I,D,Z,te,le,ve,Be;return i===e?(e[12]=i[0]*n+i[4]*o+i[8]*u+i[12],e[13]=i[1]*n+i[5]*o+i[9]*u+i[13],e[14]=i[2]*n+i[6]*o+i[10]*u+i[14],e[15]=i[3]*n+i[7]*o+i[11]*u+i[15]):(v=i[0],y=i[1],x=i[2],E=i[3],P=i[4],I=i[5],D=i[6],Z=i[7],te=i[8],le=i[9],ve=i[10],Be=i[11],e[0]=v,e[1]=y,e[2]=x,e[3]=E,e[4]=P,e[5]=I,e[6]=D,e[7]=Z,e[8]=te,e[9]=le,e[10]=ve,e[11]=Be,e[12]=v*n+P*o+te*u+i[12],e[13]=y*n+I*o+le*u+i[13],e[14]=x*n+D*o+ve*u+i[14],e[15]=E*n+Z*o+Be*u+i[15]),e}function ea(e,i,r){var n=r[0],o=r[1],u=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*o,e[5]=i[5]*o,e[6]=i[6]*o,e[7]=i[7]*o,e[8]=i[8]*u,e[9]=i[9]*u,e[10]=i[10]*u,e[11]=i[11]*u,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function gc(e,i,r,n){var o=n[0],u=n[1],v=n[2],y=Math.hypot(o,u,v),x,E,P,I,D,Z,te,le,ve,Be,it,yt,wt,jt,Wt,nr,mr,tn,vn,Pr,In,Gn,yi,Lo;return y<Aa.Ib?null:(y=1/y,o*=y,u*=y,v*=y,x=Math.sin(r),E=Math.cos(r),P=1-E,I=i[0],D=i[1],Z=i[2],te=i[3],le=i[4],ve=i[5],Be=i[6],it=i[7],yt=i[8],wt=i[9],jt=i[10],Wt=i[11],nr=o*o*P+E,mr=u*o*P+v*x,tn=v*o*P-u*x,vn=o*u*P-v*x,Pr=u*u*P+E,In=v*u*P+o*x,Gn=o*v*P+u*x,yi=u*v*P-o*x,Lo=v*v*P+E,e[0]=I*nr+le*mr+yt*tn,e[1]=D*nr+ve*mr+wt*tn,e[2]=Z*nr+Be*mr+jt*tn,e[3]=te*nr+it*mr+Wt*tn,e[4]=I*vn+le*Pr+yt*In,e[5]=D*vn+ve*Pr+wt*In,e[6]=Z*vn+Be*Pr+jt*In,e[7]=te*vn+it*Pr+Wt*In,e[8]=I*Gn+le*yi+yt*Lo,e[9]=D*Gn+ve*yi+wt*Lo,e[10]=Z*Gn+Be*yi+jt*Lo,e[11]=te*Gn+it*yi+Wt*Lo,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function lo(e,i,r){var n=Math.sin(r),o=Math.cos(r),u=i[4],v=i[5],y=i[6],x=i[7],E=i[8],P=i[9],I=i[10],D=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=u*o+E*n,e[5]=v*o+P*n,e[6]=y*o+I*n,e[7]=x*o+D*n,e[8]=E*o-u*n,e[9]=P*o-v*n,e[10]=I*o-y*n,e[11]=D*o-x*n,e}function Rs(e,i,r){var n=Math.sin(r),o=Math.cos(r),u=i[0],v=i[1],y=i[2],x=i[3],E=i[8],P=i[9],I=i[10],D=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=u*o-E*n,e[1]=v*o-P*n,e[2]=y*o-I*n,e[3]=x*o-D*n,e[8]=u*n+E*o,e[9]=v*n+P*o,e[10]=y*n+I*o,e[11]=x*n+D*o,e}function Oh(e,i,r){var n=Math.sin(r),o=Math.cos(r),u=i[0],v=i[1],y=i[2],x=i[3],E=i[4],P=i[5],I=i[6],D=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=u*o+E*n,e[1]=v*o+P*n,e[2]=y*o+I*n,e[3]=x*o+D*n,e[4]=E*o-u*n,e[5]=P*o-v*n,e[6]=I*o-y*n,e[7]=D*o-x*n,e}function Qh(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Ed(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Sd(e,i,r){var n=r[0],o=r[1],u=r[2],v=Math.hypot(n,o,u),y,x,E;return v<Aa.Ib?null:(v=1/v,n*=v,o*=v,u*=v,y=Math.sin(i),x=Math.cos(i),E=1-x,e[0]=n*n*E+x,e[1]=o*n*E+u*y,e[2]=u*n*E-o*y,e[3]=0,e[4]=n*o*E-u*y,e[5]=o*o*E+x,e[6]=u*o*E+n*y,e[7]=0,e[8]=n*u*E+o*y,e[9]=o*u*E-n*y,e[10]=u*u*E+x,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function wd(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ep(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Td(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xp(e,i,r){var n=i[0],o=i[1],u=i[2],v=i[3],y=n+n,x=o+o,E=u+u,P=n*y,I=n*x,D=n*E,Z=o*x,te=o*E,le=u*E,ve=v*y,Be=v*x,it=v*E;return e[0]=1-(Z+le),e[1]=I+it,e[2]=D-Be,e[3]=0,e[4]=I-it,e[5]=1-(P+le),e[6]=te+ve,e[7]=0,e[8]=D+Be,e[9]=te-ve,e[10]=1-(P+Z),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function th(e,i){var r=new Aa.WT(3),n=-i[0],o=-i[1],u=-i[2],v=i[3],y=i[4],x=i[5],E=i[6],P=i[7],I=n*n+o*o+u*u+v*v;return I>0?(r[0]=(y*v+P*n+x*u-E*o)*2/I,r[1]=(x*v+P*o+E*n-y*u)*2/I,r[2]=(E*v+P*u+y*o-x*n)*2/I):(r[0]=(y*v+P*n+x*u-E*o)*2,r[1]=(x*v+P*o+E*n-y*u)*2,r[2]=(E*v+P*u+y*o-x*n)*2),Xp(e,i,r),e}function Yp(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function tp(e,i){var r=i[0],n=i[1],o=i[2],u=i[4],v=i[5],y=i[6],x=i[8],E=i[9],P=i[10];return e[0]=Math.hypot(r,n,o),e[1]=Math.hypot(u,v,y),e[2]=Math.hypot(x,E,P),e}function rh(e,i){var r=new Aa.WT(3);tp(r,i);var n=1/r[0],o=1/r[1],u=1/r[2],v=i[0]*n,y=i[1]*o,x=i[2]*u,E=i[4]*n,P=i[5]*o,I=i[6]*u,D=i[8]*n,Z=i[9]*o,te=i[10]*u,le=v+P+te,ve=0;return le>0?(ve=Math.sqrt(le+1)*2,e[3]=.25*ve,e[0]=(I-Z)/ve,e[1]=(D-x)/ve,e[2]=(y-E)/ve):v>P&&v>te?(ve=Math.sqrt(1+v-P-te)*2,e[3]=(I-Z)/ve,e[0]=.25*ve,e[1]=(y+E)/ve,e[2]=(D+x)/ve):P>te?(ve=Math.sqrt(1+P-v-te)*2,e[3]=(D-x)/ve,e[0]=(y+E)/ve,e[1]=.25*ve,e[2]=(I+Z)/ve):(ve=Math.sqrt(1+te-v-P)*2,e[3]=(y-E)/ve,e[0]=(D+x)/ve,e[1]=(I+Z)/ve,e[2]=.25*ve),e}function Ia(e,i,r,n){var o=i[0],u=i[1],v=i[2],y=i[3],x=o+o,E=u+u,P=v+v,I=o*x,D=o*E,Z=o*P,te=u*E,le=u*P,ve=v*P,Be=y*x,it=y*E,yt=y*P,wt=n[0],jt=n[1],Wt=n[2];return e[0]=(1-(te+ve))*wt,e[1]=(D+yt)*wt,e[2]=(Z-it)*wt,e[3]=0,e[4]=(D-yt)*jt,e[5]=(1-(I+ve))*jt,e[6]=(le+Be)*jt,e[7]=0,e[8]=(Z+it)*Wt,e[9]=(le-Be)*Wt,e[10]=(1-(I+te))*Wt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function rp(e,i,r,n,o){var u=i[0],v=i[1],y=i[2],x=i[3],E=u+u,P=v+v,I=y+y,D=u*E,Z=u*P,te=u*I,le=v*P,ve=v*I,Be=y*I,it=x*E,yt=x*P,wt=x*I,jt=n[0],Wt=n[1],nr=n[2],mr=o[0],tn=o[1],vn=o[2],Pr=(1-(le+Be))*jt,In=(Z+wt)*jt,Gn=(te-yt)*jt,yi=(Z-wt)*Wt,Lo=(1-(D+Be))*Wt,As=(ve+it)*Wt,nl=(te+yt)*nr,Ac=(ve-it)*nr,bl=(1-(D+le))*nr;return e[0]=Pr,e[1]=In,e[2]=Gn,e[3]=0,e[4]=yi,e[5]=Lo,e[6]=As,e[7]=0,e[8]=nl,e[9]=Ac,e[10]=bl,e[11]=0,e[12]=r[0]+mr-(Pr*mr+yi*tn+nl*vn),e[13]=r[1]+tn-(In*mr+Lo*tn+Ac*vn),e[14]=r[2]+vn-(Gn*mr+As*tn+bl*vn),e[15]=1,e}function Ul(e,i){var r=i[0],n=i[1],o=i[2],u=i[3],v=r+r,y=n+n,x=o+o,E=r*v,P=n*v,I=n*y,D=o*v,Z=o*y,te=o*x,le=u*v,ve=u*y,Be=u*x;return e[0]=1-I-te,e[1]=P+Be,e[2]=D-ve,e[3]=0,e[4]=P-Be,e[5]=1-E-te,e[6]=Z+le,e[7]=0,e[8]=D+ve,e[9]=Z-le,e[10]=1-E-I,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Tf(e,i,r,n,o,u,v){var y=1/(r-i),x=1/(o-n),E=1/(u-v);return e[0]=u*2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u*2*x,e[6]=0,e[7]=0,e[8]=(r+i)*y,e[9]=(o+n)*x,e[10]=(v+u)*E,e[11]=-1,e[12]=0,e[13]=0,e[14]=v*u*2*E,e[15]=0,e}function Rh(e,i,r,n,o){var u=1/Math.tan(i/2),v;return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(v=1/(n-o),e[10]=(o+n)*v,e[14]=2*o*n*v):(e[10]=-1,e[14]=-2*n),e}var Kp=Rh;function B(e,i,r,n,o){var u=1/Math.tan(i/2),v;return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(v=1/(n-o),e[10]=o*v,e[14]=o*n*v):(e[10]=-1,e[14]=-n),e}function me(e,i,r,n){var o=Math.tan(i.upDegrees*Math.PI/180),u=Math.tan(i.downDegrees*Math.PI/180),v=Math.tan(i.leftDegrees*Math.PI/180),y=Math.tan(i.rightDegrees*Math.PI/180),x=2/(v+y),E=2/(o+u);return e[0]=x,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=E,e[6]=0,e[7]=0,e[8]=-((v-y)*x*.5),e[9]=(o-u)*E*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Ne(e,i,r,n,o,u,v){var y=1/(i-r),x=1/(n-o),E=1/(u-v);return e[0]=-2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*E,e[11]=0,e[12]=(i+r)*y,e[13]=(o+n)*x,e[14]=(v+u)*E,e[15]=1,e}var It=Ne;function ar(e,i,r,n,o,u,v){var y=1/(i-r),x=1/(n-o),E=1/(u-v);return e[0]=-2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=E,e[11]=0,e[12]=(i+r)*y,e[13]=(o+n)*x,e[14]=u*E,e[15]=1,e}function Mt(e,i,r,n){var o,u,v,y,x,E,P,I,D,Z,te=i[0],le=i[1],ve=i[2],Be=n[0],it=n[1],yt=n[2],wt=r[0],jt=r[1],Wt=r[2];return Math.abs(te-wt)<Aa.Ib&&Math.abs(le-jt)<Aa.Ib&&Math.abs(ve-Wt)<Aa.Ib?jc(e):(P=te-wt,I=le-jt,D=ve-Wt,Z=1/Math.hypot(P,I,D),P*=Z,I*=Z,D*=Z,o=it*D-yt*I,u=yt*P-Be*D,v=Be*I-it*P,Z=Math.hypot(o,u,v),Z?(Z=1/Z,o*=Z,u*=Z,v*=Z):(o=0,u=0,v=0),y=I*v-D*u,x=D*o-P*v,E=P*u-I*o,Z=Math.hypot(y,x,E),Z?(Z=1/Z,y*=Z,x*=Z,E*=Z):(y=0,x=0,E=0),e[0]=o,e[1]=y,e[2]=P,e[3]=0,e[4]=u,e[5]=x,e[6]=I,e[7]=0,e[8]=v,e[9]=E,e[10]=D,e[11]=0,e[12]=-(o*te+u*le+v*ve),e[13]=-(y*te+x*le+E*ve),e[14]=-(P*te+I*le+D*ve),e[15]=1,e)}function Jt(e,i,r,n){var o=i[0],u=i[1],v=i[2],y=n[0],x=n[1],E=n[2],P=o-r[0],I=u-r[1],D=v-r[2],Z=P*P+I*I+D*D;Z>0&&(Z=1/Math.sqrt(Z),P*=Z,I*=Z,D*=Z);var te=x*D-E*I,le=E*P-y*D,ve=y*I-x*P;return Z=te*te+le*le+ve*ve,Z>0&&(Z=1/Math.sqrt(Z),te*=Z,le*=Z,ve*=Z),e[0]=te,e[1]=le,e[2]=ve,e[3]=0,e[4]=I*ve-D*le,e[5]=D*te-P*ve,e[6]=P*le-I*te,e[7]=0,e[8]=P,e[9]=I,e[10]=D,e[11]=0,e[12]=o,e[13]=u,e[14]=v,e[15]=1,e}function lr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function vr(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function _r(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function wr(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Ar(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Ur(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function gr(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Er(e,i){var r=e[0],n=e[1],o=e[2],u=e[3],v=e[4],y=e[5],x=e[6],E=e[7],P=e[8],I=e[9],D=e[10],Z=e[11],te=e[12],le=e[13],ve=e[14],Be=e[15],it=i[0],yt=i[1],wt=i[2],jt=i[3],Wt=i[4],nr=i[5],mr=i[6],tn=i[7],vn=i[8],Pr=i[9],In=i[10],Gn=i[11],yi=i[12],Lo=i[13],As=i[14],nl=i[15];return Math.abs(r-it)<=Aa.Ib*Math.max(1,Math.abs(r),Math.abs(it))&&Math.abs(n-yt)<=Aa.Ib*Math.max(1,Math.abs(n),Math.abs(yt))&&Math.abs(o-wt)<=Aa.Ib*Math.max(1,Math.abs(o),Math.abs(wt))&&Math.abs(u-jt)<=Aa.Ib*Math.max(1,Math.abs(u),Math.abs(jt))&&Math.abs(v-Wt)<=Aa.Ib*Math.max(1,Math.abs(v),Math.abs(Wt))&&Math.abs(y-nr)<=Aa.Ib*Math.max(1,Math.abs(y),Math.abs(nr))&&Math.abs(x-mr)<=Aa.Ib*Math.max(1,Math.abs(x),Math.abs(mr))&&Math.abs(E-tn)<=Aa.Ib*Math.max(1,Math.abs(E),Math.abs(tn))&&Math.abs(P-vn)<=Aa.Ib*Math.max(1,Math.abs(P),Math.abs(vn))&&Math.abs(I-Pr)<=Aa.Ib*Math.max(1,Math.abs(I),Math.abs(Pr))&&Math.abs(D-In)<=Aa.Ib*Math.max(1,Math.abs(D),Math.abs(In))&&Math.abs(Z-Gn)<=Aa.Ib*Math.max(1,Math.abs(Z),Math.abs(Gn))&&Math.abs(te-yi)<=Aa.Ib*Math.max(1,Math.abs(te),Math.abs(yi))&&Math.abs(le-Lo)<=Aa.Ib*Math.max(1,Math.abs(le),Math.abs(Lo))&&Math.abs(ve-As)<=Aa.Ib*Math.max(1,Math.abs(ve),Math.abs(As))&&Math.abs(Be-nl)<=Aa.Ib*Math.max(1,Math.abs(Be),Math.abs(nl))}var st=xu,Zt=wr,yr,Dr,ur=(yr=(0,Lr.b2)(),yr(Dr=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"viewport",void 0),(0,T.Z)(this,"overridedViewProjectionMatrix",void 0),(0,T.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,T.Z)(this,"jitteredProjectionMatrix",void 0),(0,T.Z)(this,"viewMatrixInverse",void 0),(0,T.Z)(this,"cameraPosition",void 0)}return(0,Kt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=_u(),Ju(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,Pn.Z)(r,2),o=n[0],u=n[1];return[o,u]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var o=Qh(_u(),[r,n,0]);this.jitteredProjectionMatrix=xu(_u(),o,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=xu(_u(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Dr),Mr,Xr;function zn(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Qt(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function Qt(e,i){if(!!e){if(typeof e=="string")return rr(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rr(e,i)}}function rr(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var gn=(Mr=(0,Lr.b2)(),Mr(Xr=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"container",void 0),(0,T.Z)(this,"controlCorners",void 0),(0,T.Z)(this,"controlContainer",void 0),(0,T.Z)(this,"scene",void 0),(0,T.Z)(this,"mapsService",void 0),(0,T.Z)(this,"controls",[]),(0,T.Z)(this,"unAddControls",[])}return(0,Kt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(qt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var o=n.get(qt.IMapService);o.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=zn(this.controls),n;try{for(r.s();!(n=r.n()).done;){var o=n.value;o.remove()}}catch(u){r.e(u)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",o=this.controlContainer=Ua("div",n+"control-container",this.container);function u(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],y=v.map(function(x){return n+x}).join(" ");r[v.join("")]=Ua("div",y,o)}u(["top","left"]),u(["top","right"]),u(["bottom","left"]),u(["bottom","right"]),u(["top","center"]),u(["right","center"]),u(["left","center"]),u(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&ic(this.controlCorners[r]);this.controlContainer&&ic(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Xr),Zr,xr,Yr=(Zr=(0,Lr.b2)(),Zr(xr=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"container",void 0),(0,T.Z)(this,"scene",void 0),(0,T.Z)(this,"mapsService",void 0),(0,T.Z)(this,"markers",[]),(0,T.Z)(this,"markerLayers",[]),(0,T.Z)(this,"unAddMarkers",[]),(0,T.Z)(this,"unAddMarkerLayers",[])}return(0,Kt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(qt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||xr),Kr,gi,ni=(Kr=(0,Lr.b2)(),Kr(gi=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"scene",void 0),(0,T.Z)(this,"popup",void 0),(0,T.Z)(this,"mapsService",void 0),(0,T.Z)(this,"unAddPopup",void 0)}return(0,Kt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(qt.IMapService)}}]),e}())||gi),Hr=L(82492),en=L.n(Hr),Jn={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},ui=Jn,Ni,qa;function io(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Ri(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?io(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):io(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Jo={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},ja={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Wo=(Ni=(0,Lr.b2)(),Ni(qa=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"sceneConfigCache",{}),(0,T.Z)(this,"layerConfigCache",{})}return(0,Kt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return ui[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=Ri(Ri({},Jo),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,o){this.layerConfigCache[n]=Ri({},en()({},this.sceneConfigCache[r],ja,o))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||qa);function Rn(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function Fn(e,i,r,n,o){var u={};return Object.keys(n).forEach(function(v){u[v]=n[v]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=r.slice().reverse().reduce(function(v,y){return y(e,i,v)||v},u),o&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(o):void 0,u.initializer=void 0),u.initializer===void 0&&(Object.defineProperty(e,i,u),u=null),u}function Ao(){var e=new Aa.WT(4);return Aa.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ss(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function co(e,i,r,n){var o=new Aa.WT(4);return o[0]=e,o[1]=i,o[2]=r,o[3]=n,o}function xi(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Xo(e,i,r,n,o){return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e}function sa(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function ls(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function ii(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function Zi(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function ya(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function Co(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Zl(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Ce(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function Nt(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function _t(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function hn(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function Gi(e,i){var r=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],u=i[3]-e[3];return Math.hypot(r,n,o,u)}function Ee(e,i){var r=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],u=i[3]-e[3];return r*r+n*n+o*o+u*u}function ue(e){var i=e[0],r=e[1],n=e[2],o=e[3];return Math.hypot(i,r,n,o)}function je(e){var i=e[0],r=e[1],n=e[2],o=e[3];return i*i+r*r+n*n+o*o}function lt(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function At(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function $e(e,i){var r=i[0],n=i[1],o=i[2],u=i[3],v=r*r+n*n+o*o+u*u;return v>0&&(v=1/Math.sqrt(v)),e[0]=r*v,e[1]=n*v,e[2]=o*v,e[3]=u*v,e}function Fe(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function tt(e,i,r,n){var o=r[0]*n[1]-r[1]*n[0],u=r[0]*n[2]-r[2]*n[0],v=r[0]*n[3]-r[3]*n[0],y=r[1]*n[2]-r[2]*n[1],x=r[1]*n[3]-r[3]*n[1],E=r[2]*n[3]-r[3]*n[2],P=i[0],I=i[1],D=i[2],Z=i[3];return e[0]=I*E-D*x+Z*y,e[1]=-(P*E)+D*v-Z*u,e[2]=P*x-I*v+Z*o,e[3]=-(P*y)+I*u-D*o,e}function ye(e,i,r,n){var o=i[0],u=i[1],v=i[2],y=i[3];return e[0]=o+n*(r[0]-o),e[1]=u+n*(r[1]-u),e[2]=v+n*(r[2]-v),e[3]=y+n*(r[3]-y),e}function Ze(e,i){i=i||1;var r,n,o,u,v,y;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,v=r*r+n*n;while(v>=1);do o=glMatrix.RANDOM()*2-1,u=glMatrix.RANDOM()*2-1,y=o*o+u*u;while(y>=1);var x=Math.sqrt((1-v)/y);return e[0]=i*r,e[1]=i*n,e[2]=i*o*x,e[3]=i*u*x,e}function Se(e,i,r){var n=i[0],o=i[1],u=i[2],v=i[3];return e[0]=r[0]*n+r[4]*o+r[8]*u+r[12]*v,e[1]=r[1]*n+r[5]*o+r[9]*u+r[13]*v,e[2]=r[2]*n+r[6]*o+r[10]*u+r[14]*v,e[3]=r[3]*n+r[7]*o+r[11]*u+r[15]*v,e}function ct(e,i,r){var n=i[0],o=i[1],u=i[2],v=r[0],y=r[1],x=r[2],E=r[3],P=E*n+y*u-x*o,I=E*o+x*n-v*u,D=E*u+v*o-y*n,Z=-v*n-y*o-x*u;return e[0]=P*E+Z*-v+I*-x-D*-y,e[1]=I*E+Z*-y+D*-v-P*-x,e[2]=D*E+Z*-x+P*-y-I*-v,e[3]=i[3],e}function Et(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function fr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Nr(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function Br(e,i){var r=e[0],n=e[1],o=e[2],u=e[3],v=i[0],y=i[1],x=i[2],E=i[3];return Math.abs(r-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(u-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))}var rn=null,kr=null,En=null,on=null,_n=null,yn=null,pn=null,Qn=function(){var e=Ao();return function(i,r,n,o,u,v){var y,x;for(r||(r=4),n||(n=0),o?x=Math.min(o*r+n,i.length):x=i.length,y=n;y<x;y+=r)e[0]=i[y],e[1]=i[y+1],e[2]=i[y+2],e[3]=i[y+3],u(e,e,v),i[y]=e[0],i[y+1]=e[1],i[y+2]=e[2],i[y+3]=e[3];return i}}(),va=Math.PI/180,Qo=512,Oa=4003e4;function fa(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,o=n===void 0?0:n,u=e.scale,v=e.highPrecision,y=v===void 0?!1:v,x=e.flipY,E=x===void 0?!1:x;u=u!==void 0?u:Math.pow(2,o);var P={},I=Qo*u,D=Math.cos(r*va),Z=I/360,te=Z/D,le=I/Oa/D;if(P.pixelsPerMeter=[le,-le,le],P.metersPerPixel=[1/le,-1/le,1/le],P.pixelsPerDegree=[Z,-te,le],P.degreesPerPixel=[1/Z,-1/te,1/le],y){var ve=va*Math.tan(r*va)/D,Be=Z*ve/2,it=I/Oa*ve,yt=it/te*le;P.pixelsPerDegree2=[0,-Be,it],P.pixelsPerMeter2=[yt,0,yt],E&&(P.pixelsPerDegree2[1]=-P.pixelsPerDegree2[1],P.pixelsPerMeter2[1]=-P.pixelsPerMeter2[1])}return E&&(P.pixelsPerMeter[1]=-P.pixelsPerMeter[1],P.metersPerPixel[1]=-P.metersPerPixel[1],P.pixelsPerDegree[1]=-P.pixelsPerDegree[1],P.degreesPerPixel[1]=-P.degreesPerPixel[1]),P}var Ls;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Ls||(Ls={}));var Mo={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Fu,lu,Lh,Js,Vl,nh=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],sv=(Fu=(0,Lr.b2)(),lu=(0,Lr.f3)(qt.ICameraService),Fu(Lh=(Js=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"needRefresh",!0),Rn(this,"cameraService",Vl,this),(0,T.Z)(this,"coordinateSystem",void 0),(0,T.Z)(this,"viewportCenter",void 0),(0,T.Z)(this,"viewportCenterProjection",void 0),(0,T.Z)(this,"pixelsPerDegree",void 0),(0,T.Z)(this,"pixelsPerDegree2",void 0),(0,T.Z)(this,"pixelsPerMeter",void 0)}return(0,Kt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),o=this.cameraService.getCenter(),u=fa({latitude:o[1],zoom:r}),v=u.pixelsPerMeter,y=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=v,this.pixelsPerDegree=y,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Ls.LNGLAT||this.coordinateSystem===Ls.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Ls.LNGLAT_OFFSET?this.calculateLnglatOffset(o,r):this.coordinateSystem===Ls.P20_OFFSET&&this.calculateLnglatOffset(o,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,o,u){var v=fa({latitude:r[1],zoom:n,scale:o,flipY:u,highPrecision:!0}),y=v.pixelsPerMeter,x=v.pixelsPerDegree,E=v.pixelsPerDegree2,P=this.cameraService.getViewMatrix(),I=this.cameraService.getProjectionMatrix(),D=xu([],I,P),Z=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=Se([],[Z[0],Z[1],0,1],D),P=this.cameraService.getViewMatrixUncentered()||P,D=xu([],I,P),D=xu([],D,nh),this.cameraService.setViewProjectionMatrix(D),this.pixelsPerMeter=y,this.pixelsPerDegree=x,this.pixelsPerDegree2=E}}]),e}(),Vl=Fn(Js.prototype,"cameraService",[lu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Js))||Lh),Yo=L(20396),Wc=L.n(Yo),Po;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Po||(Po={}));var np,ip,qp,Af,yc;function uv(e){var i=lv();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function lv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dm={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},cs=(np=(0,Lr.b2)(),ip=(0,Lr.f3)(qt.IMapService),np(qp=(Af=function(e){(0,Wr.Z)(r,e);var i=uv(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),Rn((0,be.Z)(n),"mapService",yc,(0,be.Z)(n)),(0,T.Z)((0,be.Z)(n),"hammertime",void 0),(0,T.Z)((0,be.Z)(n),"lastClickTime",0),(0,T.Z)((0,be.Z)(n),"lastClickXY",[-1,-1]),(0,T.Z)((0,be.Z)(n),"clickTimer",void 0),(0,T.Z)((0,be.Z)(n),"$containter",void 0),(0,T.Z)((0,be.Z)(n),"onDrag",function(y){var x=n.interactionEvent(y);x.type=dm[x.type],n.emit(Po.Drag,x)}),(0,T.Z)((0,be.Z)(n),"onHammer",function(y){y.srcEvent.stopPropagation();var x=n.interactionEvent(y);n.emit(Po.Hover,x)}),(0,T.Z)((0,be.Z)(n),"onTouch",function(y){var x=y.touches[0];n.onHover({x:x.pageX,y:x.pageY,type:"touch"})}),(0,T.Z)((0,be.Z)(n),"onHover",function(y){var x=y.clientX,E=y.clientY,P=x,I=E,D=y.type,Z=n.mapService.getMapContainer();if(Z)if($i)P=P-Z.left-0,I=I-Z.top-0;else{var te=Z.getBoundingClientRect(),le=te.top,ve=te.left;P=P-ve-Z.clientLeft,I=I-le-Z.clientTop}var Be=n.mapService.containerToLngLat([P,I]);if(D==="click"){if(!$i&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(P,I,Be);return}if(D==="touch"){n.isDoubleTap(P,I,Be);return}D!=="click"&&D!=="dblclick"&&n.emit(Po.Hover,{x:P,y:I,lngLat:Be,type:D,target:y})}),n}return(0,Kt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Po.Hover)}},{key:"triggerHover",value:function(o){var u=o.x,v=o.y;this.emit(Po.Hover,{x:u,y:v})}},{key:"triggerSelect",value:function(o){this.emit(Po.Select,{featureId:o})}},{key:"triggerActive",value:function(o){this.emit(Po.Active,{featureId:o})}},{key:"handleMiniEvent",value:function(o){this.onHover({clientX:o.touches[0].pageX,clientY:o.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var o=this.mapService.getMapContainer();if(o)if($i)ca.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var u=new(Wc()).Manager(o);u.add(new(Wc()).Tap({event:"dblclick",taps:2})),u.add(new(Wc()).Tap({event:"click"})),u.add(new(Wc()).Pan({threshold:0,pointers:0})),u.add(new(Wc()).Press({})),u.on("dblclick click",this.onHammer),u.on("panstart panmove panend pancancel",this.onDrag),o.addEventListener("mousemove",this.onHover),o.addEventListener("mousedown",this.onHover,!0),o.addEventListener("mouseup",this.onHover),o.addEventListener("contextmenu",this.onHover),this.hammertime=u}}},{key:"removeEventListenerOnMap",value:function(){if($i)ca.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=this.mapService.getMapContainer();o&&(o.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),o.removeEventListener("mousedown",this.onHover),o.removeEventListener("mouseup",this.onHover),o.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(o){var u=o.type,v=o.pointerType,y,x;v==="touch"?(x=Math.floor(o.pointers[0].clientY),y=Math.floor(o.pointers[0].clientX)):(x=Math.floor(o.srcEvent.y),y=Math.floor(o.srcEvent.x));var E=this.mapService.getMapContainer();if(E){var P=E.getBoundingClientRect(),I=P.top,D=P.left;y-=D,x-=I}var Z=this.mapService.containerToLngLat([y,x]);return{x:y,y:x,lngLat:Z,type:u,target:o.srcEvent}}},{key:"isDoubleTap",value:function(o,u,v){var y=this,x=new Date().getTime(),E="click";x-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-o)<10&&Math.abs(this.lastClickXY[1]-u)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),E="dblclick",this.emit(Po.Hover,{x:o,y:u,lngLat:v,type:E})):(this.lastClickTime=x,this.lastClickXY=[o,u],this.clickTimer=setTimeout(function(){E="click",y.emit(Po.Hover,{x:o,y:u,lngLat:v,type:E})},400))}}]),r}(Ka()),yc=Fn(Af.prototype,"mapService",[ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Af))||qp),ks=L(92137),cv=L(87757),t=L.n(cv),a=0;function s(e){if($i)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(a++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function h(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(o){if(o!=null&&o.classList){var u;o==null||(u=o.classList)===null||u===void 0||u.forEach(function(v){(v==="l7-marker"||v==="l7-popup")&&(n=!1)})}}),n}var d;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(d||(d={}));var _,S,M,k,z,V,H,ee,se,Me,Oe;function Ke(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ze(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ke(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ke(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ot=(_=(0,Lr.b2)(),S=(0,Lr.f3)(qt.IRendererService),M=(0,Lr.f3)(qt.IGlobalConfigService),k=(0,Lr.f3)(qt.IInteractionService),z=(0,Lr.f3)(qt.ILayerService),_(V=(H=function(){function e(){var i=this;(0,St.Z)(this,e),Rn(this,"rendererService",ee,this),Rn(this,"configService",se,this),Rn(this,"interactionService",Me,this),Rn(this,"layerService",Oe,this),(0,T.Z)(this,"pickingFBO",void 0),(0,T.Z)(this,"width",0),(0,T.Z)(this,"height",0),(0,T.Z)(this,"alreadyInPicking",!1),(0,T.Z)(this,"pickBufferScale",1),(0,T.Z)(this,"pickFromPickingFBO",function(r,n){var o,u=n.x,v=n.y,y=n.lngLat,x=n.type,E=n.target,P=!1,I=i.rendererService,D=I.getViewportSize,Z=I.readPixels,te=I.getContainer,le=i.getContainerSize(te()),ve=le.width,Be=le.height;ve*=Da,Be*=Da;var it=r.getLayerConfig(),yt=it.enableHighlight,wt=it.enableSelect,jt=u*Da,Wt=v*Da;if(jt>ve-1*Da||jt<0||Wt>Be-1*Da||Wt<0)return!1;var nr;if(nr=Z({x:Math.floor(jt/i.pickBufferScale),y:Math.floor((Be-(v+1)*Da)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),nr[0]!==0||nr[1]!==0||nr[2]!==0){var mr=Hu(nr),tn=r.getSource().getFeatureById(mr);mr!==r.getCurrentPickId()&&x==="mousemove"&&(x="mouseenter");var vn={x:u,y:v,type:x,lngLat:y,featureId:mr,feature:tn,target:E};tn&&(P=!0,r.setCurrentPickId(mr),i.triggerHoverOnLayer(r,vn))}else{var Pr={x:u,y:v,lngLat:y,type:r.getCurrentPickId()!==null&&x==="mousemove"?"mouseout":"un"+x,featureId:null,target:E,feature:null};i.triggerHoverOnLayer(r,ze(ze({},Pr),{},{type:"unpick"})),i.triggerHoverOnLayer(r,Pr),r.setCurrentPickId(null)}if(yt&&i.highlightPickedFeature(r,nr),wt&&x==="click"&&((o=nr)===null||o===void 0?void 0:o.toString())!==[0,0,0,0].toString()){var In=Hu(nr);r.getCurrentSelectedId()===null||In!==r.getCurrentSelectedId()?(i.selectFeature(r,nr),r.setCurrentSelectedId(In)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return P})}return(0,Kt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,o=n.createTexture2D,u=n.createFramebuffer,v=n.getViewportSize,y=n.getContainer,x=this.getContainerSize(y()),E=x.width,P=x.height;E*=Da,P*=Da,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=u({color:o({width:Math.round(E/this.pickBufferScale),height:Math.round(P/this.pickBufferScale),wrapS:d.CLAMP_TO_EDGE,wrapT:d.CLAMP_TO_EDGE})}),this.interactionService.on(Po.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,ks.Z)(t().mark(function n(o,u,v){var y=this,x,E,P,I;return t().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:x=this.rendererService,E=x.useFramebuffer,P=x.clear,I=x.getContainer,this.resizePickingFBO(),E(this.pickingFBO,function(){P({framebuffer:y.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.hooks.beforePickingEncode.call(),o.renderModels(),o.hooks.afterPickingEncode.call();var te=y.pickBox(o,u);v(te)});case 3:case"end":return Z.stop()}},n,this)}));function r(n,o,u){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var o=this,u=n.map(function(Pr){var In=Pr<0?0:Pr;return Math.floor(In*Da/o.pickBufferScale)}),v=(0,Pn.Z)(u,4),y=v[0],x=v[1],E=v[2],P=v[3],I=this.rendererService,D=I.getViewportSize,Z=I.readPixels,te=I.getContainer,le=this.getContainerSize(te()),ve=le.width,Be=le.height;if(ve*=Da,Be*=Da,y>(ve-1)*Da/this.pickBufferScale||E<0||x>(Be-1)*Da/this.pickBufferScale||P<0)return[];var it,yt=Math.min(ve/this.pickBufferScale,E)-y,wt=Math.min(Be/this.pickBufferScale,P)-x;it=Z({x:y,y:Math.floor(Be/this.pickBufferScale-(P+1)),width:yt,height:wt,data:new Uint8Array(yt*wt*4),framebuffer:this.pickingFBO});for(var jt=[],Wt={},nr=0;nr<it.length/4;nr=nr+1){var mr=it.slice(nr*4,nr*4+4),tn=Hu(mr);if(tn!==-1&&!Wt[tn]){var vn=r.getSource().getFeatureById(tn);jt.push(vn),Wt[tn]=!0}}return jt}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Da,height:r.height/Da}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,ks.Z)(t().mark(function n(o){return t().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging())){v.next=2;break}return v.abrupt("return");case 2:return this.alreadyInPicking=!0,v.next=5,this.pickingLayers(o);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),o=n.width,u=n.height;o*=Da,u*=Da,(this.width!==o||this.height!==u)&&(this.pickingFBO.resize({width:Math.round(o/this.pickBufferScale),height:Math.round(u/this.pickBufferScale)}),this.width=o,this.height=u)}},{key:"pickingLayers",value:function(){var i=(0,ks.Z)(t().mark(function n(o){var u=this,v,y,x,E,P;return t().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:v=this.rendererService,y=v.getViewportSize,x=v.useFramebuffer,E=v.clear,P=v.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){var Z=u.layerService.getLayers();Z.filter(function(te){return te.needPick(o.type)}).reverse().some(function(te){E({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),te.hooks.beforePickingEncode.call(),te.renderModels(),te.hooks.afterPickingEncode.call();var le=u.pickFromPickingFBO(te,o);return le&&!te.getLayerConfig().enablePropagation})});case 3:case"end":return D.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){h(n)&&r.emit(n.type,n)}},{key:"highlightPickedFeature",value:function(r,n){var o=(0,Pn.Z)(n,3),u=o[0],v=o[1],y=o[2];r.hooks.beforeHighlight.call([u,v,y])}},{key:"selectFeature",value:function(r,n){var o=(0,Pn.Z)(n,3),u=o[0],v=o[1],y=o[2];r.hooks.beforeSelect.call([u,v,y])}}]),e}(),ee=Fn(H.prototype,"rendererService",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),se=Fn(H.prototype,"configService",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Me=Fn(H.prototype,"interactionService",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oe=Fn(H.prototype,"layerService",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H))||V),xt=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,St.Z)(this,e),(0,T.Z)(this,"autoStart",void 0),(0,T.Z)(this,"startTime",0),(0,T.Z)(this,"oldTime",0),(0,T.Z)(this,"running",!1),(0,T.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Kt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Bt,Vt,or,Tr,Vr,Mn,sn,Zn,ln,Li=(Bt=(0,Lr.b2)(),Vt=(0,Lr.f3)(qt.IRendererService),or=(0,Lr.f3)(qt.IMapService),Tr=(0,Lr.f3)(qt.IGlobalConfigService),Bt(Vr=(Mn=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"clock",new xt),(0,T.Z)(this,"alreadyInRendering",!1),(0,T.Z)(this,"layers",[]),(0,T.Z)(this,"layerList",[]),(0,T.Z)(this,"layerRenderID",void 0),(0,T.Z)(this,"sceneInited",!1),(0,T.Z)(this,"animateInstanceCount",0),Rn(this,"renderService",sn,this),Rn(this,"mapService",Zn,this),Rn(this,"configService",ln,this)}return(0,Kt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"remove",value:function(r,n){if(n){var o=n.layerChildren.indexOf(r);o>-1&&n.layerChildren.splice(o,1)}else{var u=this.layers.indexOf(r);u>-1&&this.layers.splice(u,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.layerList.forEach(function(r){r.hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),r.render(),r.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).forEach(function(n){r.layerList.push(n),n.layerChildren.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).forEach(function(o){r.layerList.push(o)})}),this.layerList.sort(function(n,o){return n.zIndex-o.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.layerChildren&&(r.layerChildren.forEach(function(n){return n.destroy()}),r.layerChildren=[]),r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ca.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var r=Fa(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){ca.cancelAnimationFrame(this.layerRenderID)}}]),e}(),sn=Fn(Mn.prototype,"renderService",[Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zn=Fn(Mn.prototype,"mapService",[or],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ln=Fn(Mn.prototype,"configService",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mn))||Vr),Yn=L(81253),An=L(14293),Ti=L.n(An),Si=function(){function e(i){var r=this;(0,St.Z)(this,e),(0,T.Z)(this,"name",void 0),(0,T.Z)(this,"type",void 0),(0,T.Z)(this,"scale",void 0),(0,T.Z)(this,"descriptor",void 0),(0,T.Z)(this,"featureBufferLayout",[]),(0,T.Z)(this,"needRescale",!1),(0,T.Z)(this,"needRemapping",!1),(0,T.Z)(this,"needRegenerateVertices",!1),(0,T.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,T.Z)(this,"vertexAttribute",void 0),(0,T.Z)(this,"defaultCallback",function(n){if(n.length===0){var o;return((o=r.scale)===null||o===void 0?void 0:o.defaultValues)||[]}return n.map(function(u,v){var y,x=(y=r.scale)===null||y===void 0?void 0:y.scalers[v].func,E=x(u);return E})}),this.setProps(i)}return(0,Kt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var o,u=(o=this.scale)===null||o===void 0?void 0:o.callback.apply(o,(0,we.Z)(r));if(!Ti()(u))return[u]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),ta=["buffer","update","name"],Nn,ha,$a,vo,ao,Ja;function mo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function zo(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?mo(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fs(e){return new Promise(function(i){return setTimeout(i,e)})}var Vs=(Nn={},(0,T.Z)(Nn,d.FLOAT,4),(0,T.Z)(Nn,d.UNSIGNED_BYTE,1),(0,T.Z)(Nn,d.UNSIGNED_SHORT,2),Nn),hs=(ha=(0,Lr.b2)(),$a=(0,Lr.f3)(qt.IRendererService),ha(vo=(ao=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"attributesAndIndices",void 0),Rn(this,"rendererService",Ja,this),(0,T.Z)(this,"attributes",[]),(0,T.Z)(this,"triangulation",void 0),(0,T.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Kt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Si(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,o){var u=this.getLayerStyleAttribute(r);u||(u=this.registerStyleAttribute(zo(zo({},n),{},{name:r})));var v=n.scale;v&&u&&(u.scale=v,u.needRescale=!0,u.needRemapping=!0,u.needRegenerateVertices=!0,o&&o.featureRange&&(u.featureRange=o.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,o=this.getLayerStyleAttribute(r),u=o==null||(n=o.scale)===null||n===void 0?void 0:n.scalers;return u&&u[0]?u[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0,v=this.attributes.find(function(wt){return wt.name===r});if(v&&v.descriptor){var y=v.descriptor,x=y.update,E=y.buffer,P=y.size,I=P===void 0?0:P,D=Vs[E.type||d.FLOAT];if(x){var Z=this.featureLayout,te=Z.elements,le=Z.sizePerElement,ve=te.slice(o,u);if(!ve.length)return;var Be=ve[0].offset,it=Be*I*D,yt=ve.map(function(wt,jt){for(var Wt=wt.featureIdx,nr=wt.vertices,mr=wt.normals,tn=nr.length/le,vn=[],Pr=0;Pr<tn;Pr++){var In=mr?mr.slice(Pr*3,Pr*3+3):[];vn.push.apply(vn,(0,we.Z)(x(n[Wt],Wt,nr.slice(Pr*le,Pr*le+le),jt,In)))}return vn}).reduce(function(wt,jt){return wt.push.apply(wt,(0,we.Z)(jt)),wt},[]);v.vertexAttribute.updateBuffer({data:yt,offset:it})}}}},{key:"createAttributesAndIndices",value:function(r,n,o){var u=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var v=this.attributes.map(function(it){return it.resetDescriptor(),it.descriptor}),y=0,x=[],E=[],P=[],I=3;r.forEach(function(it,yt){var wt=u.triangulation(it,o),jt=wt.indices,Wt=wt.vertices,nr=wt.normals,mr=wt.size;jt.forEach(function(In){E.push(In+y)}),I=mr;var tn=Wt.length/mr;u.featureLayout.sizePerElement=I,u.featureLayout.elements.push({featureIdx:yt,vertices:Wt,normals:nr,offset:y}),y+=tn;for(var vn=function(Gn){var yi=(nr==null?void 0:nr.slice(Gn*3,Gn*3+3))||[],Lo=Wt.slice(Gn*mr,Gn*mr+mr);v.forEach(function(As,nl){if(As&&As.update){var Ac;(Ac=As.buffer.data).push.apply(Ac,(0,we.Z)(As.update(it,yt,Lo,Gn,yi)))}})},Pr=0;Pr<tn;Pr++)vn(Pr)});var D=this.rendererService,Z=D.createAttribute,te=D.createBuffer,le=D.createElements,ve={};v.forEach(function(it,yt){if(it){var wt=it.buffer,jt=it.update,Wt=it.name,nr=(0,Yn.Z)(it,ta),mr=Z(zo({buffer:te(wt)},nr));ve[it.name||""]=mr,u.attributes[yt].vertexAttribute=mr}});var Be=le({data:E,type:d.UNSIGNED_INT,count:E.length});return this.attributesAndIndices={attributes:ve,elements:Be},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Ja=Fn(ao.prototype,"rendererService",[$a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ao))||vo),Ds=L(67709),Io=L.n(Ds),es,Hi,Ra,Sa,ra,js,ws,Ga,Oo,Ts,pa,jl,bu,Gl,xo,Hl,Qu,ts,Cf,ih,_c,ah,ap,oh,kh,op,sp,xc,Dh,sh,Xc,uh,up;function $p(e){var i=lp();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function lp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cp=(es=(0,Lr.b2)(),Hi=(0,Lr.f3)(qt.SceneID),Ra=(0,Lr.f3)(qt.IIconService),Sa=(0,Lr.f3)(qt.IFontService),ra=(0,Lr.f3)(qt.IControlService),js=(0,Lr.f3)(qt.IGlobalConfigService),ws=(0,Lr.f3)(qt.IMapService),Ga=(0,Lr.f3)(qt.ICoordinateSystemService),Oo=(0,Lr.f3)(qt.IRendererService),Ts=(0,Lr.f3)(qt.ILayerService),pa=(0,Lr.f3)(qt.ICameraService),jl=(0,Lr.f3)(qt.IInteractionService),bu=(0,Lr.f3)(qt.IPickingService),Gl=(0,Lr.f3)(qt.IShaderModuleService),xo=(0,Lr.f3)(qt.IMarkerService),Hl=(0,Lr.f3)(qt.IPopupService),es(Qu=(ts=function(e){(0,Wr.Z)(r,e);var i=$p(r);function r(){var n;return(0,St.Z)(this,r),n=i.call(this),(0,T.Z)((0,be.Z)(n),"destroyed",!1),(0,T.Z)((0,be.Z)(n),"loaded",!1),(0,T.Z)((0,be.Z)(n),"loadFont",!1),(0,T.Z)((0,be.Z)(n),"fontFamily",""),Rn((0,be.Z)(n),"id",Cf,(0,be.Z)(n)),Rn((0,be.Z)(n),"iconService",ih,(0,be.Z)(n)),Rn((0,be.Z)(n),"fontService",_c,(0,be.Z)(n)),Rn((0,be.Z)(n),"controlService",ah,(0,be.Z)(n)),Rn((0,be.Z)(n),"configService",ap,(0,be.Z)(n)),Rn((0,be.Z)(n),"map",oh,(0,be.Z)(n)),Rn((0,be.Z)(n),"coordinateSystemService",kh,(0,be.Z)(n)),Rn((0,be.Z)(n),"rendererService",op,(0,be.Z)(n)),Rn((0,be.Z)(n),"layerService",sp,(0,be.Z)(n)),Rn((0,be.Z)(n),"cameraService",xc,(0,be.Z)(n)),Rn((0,be.Z)(n),"interactionService",Dh,(0,be.Z)(n)),Rn((0,be.Z)(n),"pickingService",sh,(0,be.Z)(n)),Rn((0,be.Z)(n),"shaderModuleService",Xc,(0,be.Z)(n)),Rn((0,be.Z)(n),"markerService",uh,(0,be.Z)(n)),Rn((0,be.Z)(n),"popupService",up,(0,be.Z)(n)),(0,T.Z)((0,be.Z)(n),"inited",!1),(0,T.Z)((0,be.Z)(n),"initPromise",void 0),(0,T.Z)((0,be.Z)(n),"rendering",!1),(0,T.Z)((0,be.Z)(n),"$container",void 0),(0,T.Z)((0,be.Z)(n),"canvas",void 0),(0,T.Z)((0,be.Z)(n),"markerContainer",void 0),(0,T.Z)((0,be.Z)(n),"hooks",void 0),(0,T.Z)((0,be.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),fn(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,T.Z)((0,be.Z)(n),"handleMapCameraChanged",function(o){n.cameraService.update(o),n.render()}),n.hooks={init:new ei},n}return(0,Kt.Z)(r,[{key:"init",value:function(o){var u=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,ks.Z)(t().mark(function v(){return t().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,new Promise(function(E){u.map.onCameraChanged(function(P){u.cameraService.init(),u.cameraService.update(P),u.map.version!=="GAODE2.x"&&E()}),u.map.version!=="GAODE2.x"?u.map.init():E()});case 2:if(!(u.map.version==="GAODE2.x"&&u.map.initViewPort)){x.next=6;break}return x.next=5,u.map.init();case 5:u.map.initViewPort();case 6:u.map.onCameraChanged(u.handleMapCameraChanged),u.map.addMarkerContainer(),u.markerService.addMarkers(),u.markerService.addMarkerLayers(),u.popupService.initPopup(),u.interactionService.init(),u.interactionService.on(Po.Drag,u.addSceneEvent.bind(u));case 13:case"end":return x.stop()}},v)}))),this.hooks.init.tapPromise("initRenderer",(0,ks.Z)(t().mark(function v(){var y,x;return t().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(y=s(u.configService.getSceneConfig(u.id).id||""),u.$container=y,!y){P.next=11;break}return u.canvas=Ua("canvas","",y),u.setCanvas(),P.next=7,u.rendererService.init(u.canvas,u.configService.getSceneConfig(u.id));case 7:Io()(u.$container,u.handleWindowResized),ca.matchMedia&&((x=ca.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||x===void 0||x.addListener(u.handleWindowResized)),P.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:u.pickingService.init(u.id);case 13:case"end":return P.stop()}},v)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(o){var u=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,ks.Z)(t().mark(function v(){return t().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,new Promise(function(E){u.map.onCameraChanged(function(P){u.cameraService.init(),u.cameraService.update(P),u.map.version!=="GAODE2.x"&&E()}),u.map.initMiniMap()});case 2:u.map.onCameraChanged(u.handleMapCameraChanged),u.interactionService.init(),u.interactionService.on(Po.Drag,u.addSceneEvent.bind(u));case 5:case"end":return x.stop()}},v)}))),this.hooks.init.tapPromise("initRenderer",(0,ks.Z)(t().mark(function v(){var y;return t().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(y=o.canvas,u.$container=y||null,!u.$container){E.next=7;break}return E.next=5,u.rendererService.init(o.canvas,u.configService.getSceneConfig(u.id));case 5:E.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:u.pickingService.init(u.id);case 9:case"end":return E.stop()}},v)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(o){this.layerService.sceneService=this,this.layerService.add(o),this.render()}},{key:"render",value:function(){var n=(0,ks.Z)(t().mark(function u(){return t().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(this.rendering||this.destroyed)){y.next=2;break}return y.abrupt("return");case 2:if(this.rendering=!0,this.inited){y.next=15;break}return y.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){y.next=10;break}return y.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 18:case"end":return y.stop()}},u,this)}));function o(){return n.apply(this,arguments)}return o}()},{key:"addFontFace",value:function(o,u){this.fontFamily=o;var v=document.createElement("style");v.type="text/css",v.innerText=`
        @font-face{
            font-family: '`.concat(o,`';
            src: url('`).concat(u,`') format('woff2'),
            url('`).concat(u,`') format('woff'),
            url('`).concat(u,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(v),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(o){var u,v=(u=this.$container)===null||u===void 0?void 0:u.getElementsByTagName("canvas")[0];this.render();var y=o==="jpg"?v==null?void 0:v.toDataURL("image/jpeg"):v==null?void 0:v.toDataURL("image/png");return y}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var o=this.$container.parentElement;o!==null&&(this.markerContainer=Ua("div","l7-marker-container",o))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var o,u;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Ds.unbind)(this.$container,this.handleWindowResized),ca.matchMedia){var v;(v=ca.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var o,u,v=Da,y=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,x=((u=this.$container)===null||u===void 0?void 0:u.clientHeight)||300,E=this.canvas;E&&(E.width=y*v,E.height=x*v),this.rendererService.viewport({x:0,y:0,width:v*y,height:v*x})}},{key:"setCanvas",value:function(){var o,u,v=Da,y=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,x=((u=this.$container)===null||u===void 0?void 0:u.clientHeight)||300,E=this.canvas;E.width=y*v,E.height=x*v,E.style.width="100%",E.style.height="100%"}},{key:"addSceneEvent",value:function(o){this.emit(o.type,o)}}]),r}(Ea.EventEmitter),Cf=Fn(ts.prototype,"id",[Hi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ih=Fn(ts.prototype,"iconService",[Ra],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_c=Fn(ts.prototype,"fontService",[Sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ah=Fn(ts.prototype,"controlService",[ra],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ap=Fn(ts.prototype,"configService",[js],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oh=Fn(ts.prototype,"map",[ws],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kh=Fn(ts.prototype,"coordinateSystemService",[Ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),op=Fn(ts.prototype,"rendererService",[Oo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sp=Fn(ts.prototype,"layerService",[Ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xc=Fn(ts.prototype,"cameraService",[pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh=Fn(ts.prototype,"interactionService",[jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sh=Fn(ts.prototype,"pickingService",[bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xc=Fn(ts.prototype,"shaderModuleService",[Gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uh=Fn(ts.prototype,"markerService",[xo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),up=Fn(ts.prototype,"popupService",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ts))||Qu),Jp=L(44908),Fh=L.n(Jp);function fp(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var hp=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function pp(e){var i={};return e=e.replace(hp,function(r,n,o){var u=o.split(":"),v=u[0].trim(),y="";switch(u.length>1&&(y=u[1].trim()),n){case"bool":y=y==="true";break;case"float":case"int":y=Number(y);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":y?y=y.replace("[","").replace("]","").split(",").reduce(function(x,E){return x.push(Number(E.trim())),x},[]):y=new Array(fp(n)).fill(0);break;default:}return i[v]=y,"uniform ".concat(n," ").concat(v,`;
`)}),{content:e,uniforms:i}}var lh,dp;function ch(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Yc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ch(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ch(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Mf="#define PI 3.14159265359",vp=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Nh=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Ad=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,fv=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_Dragging;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // if(u_Dragging > 0.0) return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  return filterPickingColor(filterHighlightColor(color));
}
`,Cd=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,hv=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Md=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,vm=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,mp=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,Ro=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Wl=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,mm=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Pf=/precision\s+(high|low|medium)p\s+float/,Pd=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,pv=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Qp=(lh=(0,Lr.b2)(),lh(dp=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"moduleCache",{}),(0,T.Z)(this,"rawContentCache",{})}return(0,Kt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Mf,fs:Mf}),this.registerModule("decode",{vs:vp,fs:""}),this.registerModule("projection",{vs:Md,fs:""}),this.registerModule("project",{vs:hv,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:vm}),this.registerModule("lighting",{vs:Ad,fs:""}),this.registerModule("light",{vs:Nh,fs:""}),this.registerModule("picking",{vs:Cd,fs:fv}),this.registerModule("styleMapping",{vs:mp,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Ro,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Wl,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:mm,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var o=n.vs,u=n.fs,v=n.uniforms,y=pp(o),x=y.content,E=y.uniforms,P=pp(u),I=P.content,D=P.uniforms;this.rawContentCache[r]={fs:I,uniforms:Yc(Yc(Yc({},E),D),v),vs:x}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var o=this.rawContentCache[r].vs,u=this.rawContentCache[r].fs,v=this.processModule(o,[],"vs"),y=v.content,x=v.includeList,E=this.processModule(u,[],"fs"),P=E.content,I=E.includeList,D=P,Z=Fh()(x.concat(I).concat(r)).reduce(function(te,le){return Yc(Yc({},te),n.rawContentCache[le].uniforms)},{});return Pf.test(P)||(D=Pd+P),this.moduleCache[r]={fs:D.trim(),uniforms:Z,vs:y.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,o){var u=this,v=r.replace(pv,function(y,x){var E=x.split(" "),P=E[0].replace(/"/g,"");if(n.indexOf(P)>-1)return"";var I=u.rawContentCache[P][o];n.push(P);var D=u.processModule(I,n,o),Z=D.content;return Z});return{content:v,includeList:n}}}]),e}())||dp),el=L(66213),Xl;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Xl||(Xl={}));var Bh,gp,yp,_p,Id,If=(Bh=(0,Lr.b2)(),gp=(0,Lr.f3)(qt.IShaderModuleService),Bh(yp=(_p=function(){function e(){(0,St.Z)(this,e),Rn(this,"shaderModuleService",Id,this),(0,T.Z)(this,"rendererService",void 0),(0,T.Z)(this,"cameraService",void 0),(0,T.Z)(this,"mapService",void 0),(0,T.Z)(this,"interactionService",void 0),(0,T.Z)(this,"layerService",void 0),(0,T.Z)(this,"config",void 0)}return(0,Kt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Xl.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(qt.IRendererService),this.cameraService=r.getContainer().get(qt.ICameraService),this.mapService=r.getContainer().get(qt.IMapService),this.interactionService=r.getContainer().get(qt.IInteractionService),this.layerService=r.getContainer().get(qt.ILayerService)}},{key:"render",value:function(r){}}]),e}(),Id=Fn(_p.prototype,"shaderModuleService",[gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_p))||yp),Od,Rd;function dv(e){var i=vv();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function vv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mv=(Od=(0,Lr.b2)(),Od(Rd=function(e){(0,Wr.Z)(r,e);var i=dv(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(o,u){(0,el.Z)((0,zt.Z)(r.prototype),"init",this).call(this,o,u)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(If))||Rd),Eu,xp,Ld,xl,gv;function yv(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=fh(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function fh(e,i){if(!!e){if(typeof e=="string")return hh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hh(e,i)}}function hh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var zh=(Eu=(0,Lr.b2)(),xp=(0,Lr.f3)(qt.IPostProcessor),Eu(Ld=(xl=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"passes",[]),Rn(this,"postProcessor",gv,this),(0,T.Z)(this,"layer",void 0),(0,T.Z)(this,"renderFlag",void 0),(0,T.Z)(this,"width",0),(0,T.Z)(this,"height",0)}return(0,Kt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,ks.Z)(t().mark(function n(){var o,u,v;return t().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:o=yv(this.passes),x.prev=1,o.s();case 3:if((u=o.n()).done){x.next=9;break}return v=u.value,x.next=7,v.render(this.layer);case 7:x.next=3;break;case 9:x.next=14;break;case 11:x.prev=11,x.t0=x.catch(1),o.e(x.t0);case 14:return x.prev=14,o.f(),x.finish(14);case 17:this.layer.renderModels();case 18:case"end":return x.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Xl.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,o){r.init(this.layer,n),this.passes.splice(o,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),gv=Fn(xl.prototype,"postProcessor",[xp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xl))||Ld),ph,dh;function kd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Dd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?kd(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _v(e){var i=xv();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function xv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fd=(ph=(0,Lr.b2)(),ph(dh=function(e){(0,Wr.Z)(r,e);var i=_v(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"pickingFBO",void 0),(0,T.Z)((0,be.Z)(n),"layer",void 0),(0,T.Z)((0,be.Z)(n),"width",0),(0,T.Z)((0,be.Z)(n),"height",0),(0,T.Z)((0,be.Z)(n),"alreadyInRendering",!1),(0,T.Z)((0,be.Z)(n),"pickFromPickingFBO",function(y){var x=y.x,E=y.y,P=y.lngLat,I=y.type;if(!(!n.layer.isVisible()||!n.layer.needPick(I))){var D=n.rendererService,Z=D.getViewportSize,te=D.readPixels,le=D.useFramebuffer,ve=Z(),Be=ve.width,it=ve.height,yt=n.layer.getLayerConfig(),wt=yt.enableHighlight,jt=yt.enableSelect,Wt=x*Da,nr=E*Da;if(!(Wt>Be||Wt<0||nr>it||nr<0)){var mr;le(n.pickingFBO,function(){var tn;if(mr=te({x:Math.round(Wt),y:Math.round(it-(E+1)*Da),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),mr[0]!==0||mr[1]!==0||mr[2]!==0){var vn=Hu(mr),Pr=n.layer.getSource().getFeatureById(vn),In={x,y:E,type:I,lngLat:P,featureId:vn,feature:Pr};Pr&&(n.layer.setCurrentPickId(vn),n.triggerHoverOnLayer(In))}else{var Gn={x,y:E,lngLat:P,type:n.layer.getCurrentPickId()===null?"un"+I:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Dd(Dd({},Gn),{},{type:"unpick"})),n.triggerHoverOnLayer(Gn),n.layer.setCurrentPickId(null)}wt&&n.highlightPickedFeature(mr),jt&&I==="click"&&((tn=mr)===null||tn===void 0?void 0:tn.toString())!==[0,0,0,0].toString()&&n.selectFeature(mr)})}}}),n}return(0,Kt.Z)(r,[{key:"getType",value:function(){return Xl.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(o,u){(0,el.Z)((0,zt.Z)(r.prototype),"init",this).call(this,o,u),this.layer=o;var v=this.rendererService,y=v.createTexture2D,x=v.createFramebuffer,E=v.getViewportSize,P=E(),I=P.width,D=P.height;this.pickingFBO=x({color:y({width:I,height:D,wrapS:d.CLAMP_TO_EDGE,wrapT:d.CLAMP_TO_EDGE})}),this.interactionService.on(Po.Hover,this.pickFromPickingFBO),this.interactionService.on(Po.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Po.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(o){var u=this;if(!this.alreadyInRendering){var v=this.rendererService,y=v.getViewportSize,x=v.useFramebuffer,E=v.clear,P=y(),I=P.width,D=P.height;this.alreadyInRendering=!0,(this.width!==I||this.height!==D)&&(this.pickingFBO.resize({width:I,height:D}),this.width=I,this.height=D),x(this.pickingFBO,function(){E({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var Z=u.layer.multiPassRenderer.getRenderFlag();u.layer.multiPassRenderer.setRenderFlag(!1),o.hooks.beforePickingEncode.call(),o.render(),o.hooks.afterPickingEncode.call(),u.layer.multiPassRenderer.setRenderFlag(Z),u.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(o){this.layer.emit(o.type,o)}},{key:"highlightPickedFeature",value:function(o){var u=(0,Pn.Z)(o,3),v=u[0],y=u[1],x=u[2];this.layer.hooks.beforeHighlight.call([v,y,x]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(o){var u=(0,Pn.Z)(o,3),v=u[0],y=u[1],x=u[2];this.layer.hooks.beforeSelect.call([v,y,x]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(o){var u=o.featureId,v=Wu(u);this.selectFeature(new Uint8Array(v))}},{key:"highlightFeatureHandle",value:function(o){var u=o.featureId,v=Wu(u);this.highlightPickedFeature(new Uint8Array(v))}}]),r}(If))||dh),Nd=L(11700),Kc=L.n(Nd),bv=L(68929),Bd=L.n(bv),ed,zd,td,rd,Ud;function nd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Uh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?nd(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var bp=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qc=(ed=(0,Lr.b2)(),zd=(0,Lr.f3)(qt.IShaderModuleService),ed(td=(rd=function(){function e(){(0,St.Z)(this,e),Rn(this,"shaderModuleService",Ud,this),(0,T.Z)(this,"rendererService",void 0),(0,T.Z)(this,"config",void 0),(0,T.Z)(this,"quad",bp),(0,T.Z)(this,"enabled",!0),(0,T.Z)(this,"renderToScreen",!1),(0,T.Z)(this,"model",void 0),(0,T.Z)(this,"name",void 0),(0,T.Z)(this,"optionsToUpdate",{})}return(0,Kt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Xl.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(qt.IRendererService);var o=this.rendererService,u=o.createAttribute,v=o.createBuffer,y=o.createModel,x=this.setupShaders(),E=x.vs,P=x.fs,I=x.uniforms;this.model=y({vs:E,fs:P,attributes:{a_Position:u({buffer:v({data:[-4,-4,4,-4,0,4],type:d.FLOAT}),size:2})},uniforms:Uh(Uh({u_Texture:null},I),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r){var n=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,v=u.useFramebuffer,y=u.getViewportSize,x=u.clear,E=y(),P=E.width,I=E.height;v(this.renderToScreen?null:o.getWriteFBO(),function(){x({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),n.model.draw({uniforms:Uh({u_Texture:o.getReadFBO(),u_ViewportSize:[P,I]},n.convertOptionsToUniforms(n.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Uh(Uh({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(o){Ti()(r[o])||(n["u_".concat(Kc()(Bd()(o)))]=r[o])}),n}}]),e}(),Ud=Fn(rd.prototype,"shaderModuleService",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rd))||td),Ep,Ev;function Zd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Sv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Zd(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gm(e){var i=ym();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function ym(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _m=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,xm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bm=(Ep=(0,Lr.b2)(),Ep(Ev=function(e){(0,Wr.Z)(r,e);var i=gm(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:xm,fs:_m});var o=this.shaderModuleService.getModule("blur-pass"),u=o.vs,v=o.fs,y=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:v,uniforms:Sv(Sv({},y),{},{u_ViewportSize:[E,P]})}}},{key:"convertOptionsToUniforms",value:function(o){var u={};return Ti()(o.blurRadius)||(u.u_BlurDir=[o.blurRadius,0]),u}}]),r}(qc))||Ev),wv,Tv;function Yl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Sp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Yl(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Av(e){var i=wp();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function wp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cv=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,ax=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ox=(wv=(0,Lr.b2)(),wv(Tv=function(e){(0,Wr.Z)(r,e);var i=Av(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:ax,fs:Cv});var o=this.shaderModuleService.getModule("blur-pass"),u=o.vs,v=o.fs,y=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:v,uniforms:Sp(Sp({},y),{},{u_ViewportSize:[E,P]})}}},{key:"convertOptionsToUniforms",value:function(o){var u={};return Ti()(o.blurRadius)||(u.u_BlurDir=[0,o.blurRadius]),u}}]),r}(qc))||Tv),r0,n0;function i0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function a0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?i0(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sx(e){var i=ux();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function ux(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,cx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,fx=(r0=(0,Lr.b2)(),r0(n0=function(e){(0,Wr.Z)(r,e);var i=sx(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:cx,fs:lx});var o=this.shaderModuleService.getModule("colorhalftone-pass"),u=o.vs,v=o.fs,y=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:v,uniforms:a0(a0({},y),{},{u_ViewportSize:[E,P]})}}}]),r}(qc))||n0),o0,s0;function hx(e){var i=px();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function px(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,vx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,mx=(o0=(0,Lr.b2)(),o0(s0=function(e){(0,Wr.Z)(r,e);var i=hx(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:vx,fs:dx}),this.shaderModuleService.getModule("copy-pass")}}]),r}(qc))||s0),u0,l0;function c0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function f0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?c0(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gx(e){var i=yx();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function yx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _x=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,xx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bx=(u0=(0,Lr.b2)(),u0(l0=function(e){(0,Wr.Z)(r,e);var i=gx(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:xx,fs:_x});var o=this.shaderModuleService.getModule("hexagonalpixelate-pass"),u=o.vs,v=o.fs,y=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:v,uniforms:f0(f0({},y),{},{u_ViewportSize:[E,P]})}}}]),r}(qc))||l0),h0,p0;function d0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function v0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?d0(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ex(e){var i=Sx();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Sx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Ax=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Cx=(h0=(0,Lr.b2)(),h0(p0=function(e){(0,Wr.Z)(r,e);var i=Ex(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Ax,fs:Tx});var o=this.shaderModuleService.getModule("ink-pass"),u=o.vs,v=o.fs,y=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:v,uniforms:v0(v0({},y),{},{u_ViewportSize:[E,P]})}}}]),r}(qc))||p0),m0,g0;function Mx(e){var i=Px();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Px(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ix=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Ox=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Rx=(m0=(0,Lr.b2)(),m0(g0=function(e){(0,Wr.Z)(r,e);var i=Mx(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Ox,fs:Ix}),this.shaderModuleService.getModule("noise-pass")}}]),r}(qc))||g0),y0,_0;function Lx(e){var i=kx();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function kx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Fx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Nx=(y0=(0,Lr.b2)(),y0(_0=function(e){(0,Wr.Z)(r,e);var i=Lx(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Dx,fs:Fx}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(qc))||_0),x0,b0,E0,S0,id,w0,Bx=(x0=(0,Lr.b2)(),b0=(0,Lr.f3)(qt.IRendererService),E0=(0,Lr.zY)(),x0(S0=(id=function(){function e(){(0,St.Z)(this,e),Rn(this,"rendererService",w0,this),(0,T.Z)(this,"passes",[]),(0,T.Z)(this,"readFBO",void 0),(0,T.Z)(this,"writeFBO",void 0)}return(0,Kt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var i=(0,ks.Z)(t().mark(function n(o){var u,v;return t().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u=0;case 1:if(!(u<this.passes.length)){x.next=10;break}return v=this.passes[u],v.setRenderToScreen(this.isLastEnabledPass(u)),x.next=6,v.render(o);case 6:u!==this.passes.length-1&&this.swap();case 7:u++,x.next=1;break;case 10:case"end":return x.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,o){r.init(n,o),this.passes.push(r)}},{key:"insert",value:function(r,n,o,u){r.init(o,u),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),w0=Fn(id.prototype,"rendererService",[b0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fn(id.prototype,"init",[E0],Object.getOwnPropertyDescriptor(id.prototype,"init"),id.prototype),id))||S0),T0,A0;function zx(e){var i=Ux();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Ux(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zx=(T0=(0,Lr.b2)(),T0(A0=function(e){(0,Wr.Z)(r,e);var i=zx(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getType",value:function(){return Xl.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(o,u){(0,el.Z)((0,zt.Z)(r.prototype),"init",this).call(this,o,u)}},{key:"render",value:function(o){var u=this.rendererService,v=u.useFramebuffer,y=u.clear;v(null,function(){y({color:[0,0,0,0],depth:1,stencil:0}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)})}}]),r}(If))||A0),C0,M0,P0,Em,I0;function O0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function R0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?O0(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Vx(e){var i=jx();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function jx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gx=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,L0=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Hx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function k0(e,i){for(var r=0,n=1/i,o=e;o>0;)r=r+n*(o%i),o=Math.floor(o/i),n=n/i;return r}var Wx=1,Xx=(C0=(0,Lr.b2)(),M0=(0,Lr.f3)(qt.IShaderModuleService),C0(P0=(Em=function(e){(0,Wr.Z)(r,e);var i=Vx(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),Rn((0,be.Z)(n),"shaderModuleService",I0,(0,be.Z)(n)),(0,T.Z)((0,be.Z)(n),"haltonSequence",[]),(0,T.Z)((0,be.Z)(n),"accumulatingId",0),(0,T.Z)((0,be.Z)(n),"frame",0),(0,T.Z)((0,be.Z)(n),"timer",void 0),(0,T.Z)((0,be.Z)(n),"sampleRenderTarget",void 0),(0,T.Z)((0,be.Z)(n),"prevRenderTarget",void 0),(0,T.Z)((0,be.Z)(n),"outputRenderTarget",void 0),(0,T.Z)((0,be.Z)(n),"copyRenderTarget",void 0),(0,T.Z)((0,be.Z)(n),"blendModel",void 0),(0,T.Z)((0,be.Z)(n),"outputModel",void 0),(0,T.Z)((0,be.Z)(n),"copyModel",void 0),n}return(0,Kt.Z)(r,[{key:"getType",value:function(){return Xl.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(o,u){(0,el.Z)((0,zt.Z)(r.prototype),"init",this).call(this,o,u);var v=this.rendererService,y=v.createFramebuffer,x=v.createTexture2D;this.sampleRenderTarget=y({color:x({width:1,height:1,wrapS:d.CLAMP_TO_EDGE,wrapT:d.CLAMP_TO_EDGE})}),this.prevRenderTarget=y({color:x({width:1,height:1,wrapS:d.CLAMP_TO_EDGE,wrapT:d.CLAMP_TO_EDGE})}),this.outputRenderTarget=y({color:x({width:1,height:1,wrapS:d.CLAMP_TO_EDGE,wrapT:d.CLAMP_TO_EDGE})}),this.copyRenderTarget=y({color:x({width:1,height:1,wrapS:d.CLAMP_TO_EDGE,wrapT:d.CLAMP_TO_EDGE})});for(var E=0;E<30;E++)this.haltonSequence.push([k0(E,2),k0(E,3)]);this.blendModel=this.createTriangleModel("blend-pass",Gx),this.outputModel=this.createTriangleModel("copy-pass",L0,{blend:{enable:!0,func:{srcRGB:d.ONE,dstRGB:d.ONE_MINUS_SRC_ALPHA,srcAlpha:d.ONE,dstAlpha:d.ONE_MINUS_SRC_ALPHA},equation:{rgb:d.FUNC_ADD,alpha:d.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",L0)}},{key:"render",value:function(o){var u=this,v=this.rendererService,y=v.clear,x=v.getViewportSize,E=v.useFramebuffer,P=x(),I=P.width,D=P.height;this.sampleRenderTarget.resize({width:I,height:D}),this.prevRenderTarget.resize({width:I,height:D}),this.outputRenderTarget.resize({width:I,height:D}),this.copyRenderTarget.resize({width:I,height:D}),this.resetFrame(),this.stopAccumulating();var Z=o.multiPassRenderer.getPostProcessor().getReadFBO();E(Z,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Z}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)});var te=function le(ve){!u.accumulatingId||ve!==u.accumulatingId||u.isFinished()||(u.doRender(o),ca.requestAnimationFrame(function(){le(ve)}))};this.accumulatingId=Wx++,this.timer=ca.setTimeout(function(){te(u.accumulatingId)},50)}},{key:"doRender",value:function(o){var u=this,v=this.rendererService,y=v.clear,x=v.getViewportSize,E=v.useFramebuffer,P=x(),I=P.width,D=P.height,Z=o.getLayerConfig(),te=Z.jitterScale,le=te===void 0?1:te,ve=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ve[0]*2-1)/I*le,(ve[1]*2-1)/D*le),o.multiPassRenderer.setRenderFlag(!1),o.hooks.beforeRender.call(),E(this.sampleRenderTarget,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:u.sampleRenderTarget}),o.render()}),o.hooks.afterRender.call(),o.multiPassRenderer.setRenderFlag(!0);var Be=o.getLayerConfig();E(this.outputRenderTarget,function(){u.blendModel.draw({uniforms:{u_opacity:Be.opacity||1,u_MixRatio:u.frame===0?1:.9,u_Diffuse1:u.sampleRenderTarget,u_Diffuse2:u.frame===0?o.multiPassRenderer.getPostProcessor().getReadFBO():u.prevRenderTarget}})}),this.frame===0&&y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(E(this.copyRenderTarget,function(){u.outputModel.draw({uniforms:{u_Texture:u.outputRenderTarget}})}),E(o.multiPassRenderer.getPostProcessor().getReadFBO(),function(){u.copyModel.draw({uniforms:{u_Texture:u.copyRenderTarget}})}),o.multiPassRenderer.getPostProcessor().render(o));var it=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=it,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ca.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(o,u,v){this.shaderModuleService.registerModule(o,{vs:Hx,fs:u});var y=this.shaderModuleService.getModule(o),x=y.vs,E=y.fs,P=y.uniforms,I=this.rendererService,D=I.createAttribute,Z=I.createBuffer,te=I.createModel;return te(R0({vs:x,fs:E,attributes:{a_Position:D({buffer:Z({data:[-4,-4,4,-4,0,4],type:d.FLOAT}),size:2})},uniforms:R0({},P),depth:{enable:!1},count:3},v))}}]),r}(If),I0=Fn(Em.prototype,"shaderModuleService",[M0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Em))||P0),ad=new Lr.W2;ad.bind(qt.IGlobalConfigService).to(Wo).inSingletonScope(),ad.bind(qt.IShaderModuleService).to(Qp).inSingletonScope(),(0,Lr.GW)((0,Lr.b2)(),Ea.EventEmitter),ad.bind(qt.IEventEmitter).to(Ea.EventEmitter);var D0=(0,yf.Z)(ad,!1),Vd=function(i){var r=D0.lazyInject(i);return function(n,o,u){r.call(this,n,o),u&&(u.initializer=function(){return n[o]})}},zM=function(i){var r=D0.lazyMultiInject(i);return function(n,o,u){r.call(this,n,o),u&&(u.initializer=function(){return n[o]})}},Kl=ad,Yx=0;function Kx(){var e=new Lr.W2;return e.parent=ad,e.bind(qt.SceneID).toConstantValue("".concat(Yx++)),e.bind(qt.ILayerService).to(Li).inSingletonScope(),e.bind(qt.ISceneService).to(cp).inSingletonScope(),e.bind(qt.ICameraService).to(ur).inSingletonScope(),e.bind(qt.ICoordinateSystemService).to(sv).inSingletonScope(),e.bind(qt.IInteractionService).to(cs).inSingletonScope(),e.bind(qt.IPickingService).to(ot).inSingletonScope(),e.bind(qt.IControlService).to(gn).inSingletonScope(),e.bind(qt.IMarkerService).to(Yr).inSingletonScope(),e.bind(qt.IIconService).to(jp).inSingletonScope(),e.bind(qt.IFontService).to(yl).inSingletonScope(),e.bind(qt.IPopupService).to(ni).inSingletonScope(),e.bind(qt.INormalPass).to(mv).whenTargetNamed("clear"),e.bind(qt.INormalPass).to(Fd).whenTargetNamed("pixelPicking"),e.bind(qt.INormalPass).to(Zx).whenTargetNamed("render"),e.bind(qt.INormalPass).to(Xx).whenTargetNamed("taa"),e.bind(qt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(qt.INormalPass,r)}}),e.bind(qt.IPostProcessingPass).to(mx).whenTargetNamed("copy"),e.bind(qt.IPostProcessingPass).to(bm).whenTargetNamed("blurH"),e.bind(qt.IPostProcessingPass).to(ox).whenTargetNamed("blurV"),e.bind(qt.IPostProcessingPass).to(Rx).whenTargetNamed("noise"),e.bind(qt.IPostProcessingPass).to(Nx).whenTargetNamed("sepia"),e.bind(qt.IPostProcessingPass).to(fx).whenTargetNamed("colorHalftone"),e.bind(qt.IPostProcessingPass).to(bx).whenTargetNamed("hexagonalPixelate"),e.bind(qt.IPostProcessingPass).to(Cx).whenTargetNamed("ink"),e.bind(qt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(qt.IPostProcessingPass,r);return n.setName(r),n}}),e}function qx(e){var i=new Lr.W2;return i.parent=e,i.bind(qt.IStyleAttributeService).to(hs).inSingletonScope(),i.bind(qt.IMultiPassRenderer).to(zh).inSingletonScope(),i.bind(qt.IPostProcessor).to(Bx).inSingletonScope(),i}var UM=L(74691),$x=null;function ZM(e){return $x.indexOf(e)}var Jx=2,VM=4,Qx=64,jM=128,eb=256,tb=512,GM=8192,HM=16384,WM=32768,rb=null,F0=131072,XM=262144,nb=524288,YM=1048576,ib=2097152,KM=4194304,ab=8388608,ob=16777216,sb=null;function Mv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function qM(e){var i=e.color,r=e.radius,n=e.tileX,o=e.tileY,u=e.shape,v=e.opacity,y=e.stroke,x=e.strokeWidth,E=e.strokeOpacity,P=[],I=[],D=[],Z=[Mv(i[0],i[1]),Mv(i[2],i[3])],te=[Mv(y[0],y[1]),Mv(y[2],y[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(le){var ve=_slicedToArray(le,2),Be=ve[0],it=ve[1];P.push([].concat(Z,[(Be+1)*ab+(it+1)*ib+getShapeIndex(u)*F0+r,(n+512)*nb+(o+512)*Qx])),I.push([].concat(te,[x,E])),D.push([v,0,0,0])}),{packedBuffer:P,packedBuffer2:I,packedBuffer3:D}}function $M(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*sb+r*ob+n*F0+r*rb+n*tb+r*eb+n*Jx+r}var $c;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})($c||($c={}));var Qs;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(Qs||(Qs={}));var Zh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Zh||(Zh={}));var Ii;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Ii||(Ii={}));var ub=["mapload","mapchange"],Tp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Sm=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Vh;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Vh||(Vh={}));function N0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function B0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?N0(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lb(e){var i=cb();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function cb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fb=0,Pv=function(e){(0,Wr.Z)(r,e);var i=lb(r);function r(n){var o;return(0,St.Z)(this,r),o=i.call(this),(0,T.Z)((0,be.Z)(o),"controlOption",void 0),(0,T.Z)((0,be.Z)(o),"container",void 0),(0,T.Z)((0,be.Z)(o),"sceneContainer",void 0),(0,T.Z)((0,be.Z)(o),"mapsService",void 0),(0,T.Z)((0,be.Z)(o),"renderService",void 0),(0,T.Z)((0,be.Z)(o),"layerService",void 0),(0,T.Z)((0,be.Z)(o),"controlService",void 0),(0,T.Z)((0,be.Z)(o),"isShow",void 0),o.controlOption=B0(B0({},o.getDefault()),n||{}),o}return(0,Kt.Z)(r,[{key:"getDefault",value:function(){return{position:Vh.TOPRIGHT,name:"".concat(fb++)}}},{key:"setPosition",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Vh.BOTTOMRIGHT,u=this.controlService;return u&&u.removeControl(this),this.controlOption.position=o,u&&u.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(o){this.mapsService=o.get(qt.IMapService),this.renderService=o.get(qt.IRendererService),this.layerService=o.get(qt.ILayerService),this.controlService=o.get(qt.IControlService),this.sceneContainer=o,this.isShow=!0,this.container=this.onAdd();var u=this.container,v=this.controlOption.position,y=this.controlService.controlCorners[v];return Ll(u,"l7-control"),v.indexOf("bottom")!==-1?y.insertBefore(u,y.firstChild):y.appendChild(u),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var o=this.container;Ll(o,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var o=this.container;ju(o,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;ic(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(o){if(this.mapsService&&o&&o.screenX>0&&o.screenY>0){var u=this.mapsService.getContainer();u!==null&&u.focus()}}}]),r}(Ea.EventEmitter);function hb(e){var i=pb();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JM=function(e){(0,Wr.Z)(r,e);var i=hb(r);function r(n){var o;return(0,St.Z)(this,r),o=i.call(this,n),(0,T.Z)((0,be.Z)(o),"layerControlInputs",void 0),(0,T.Z)((0,be.Z)(o),"layers",void 0),(0,T.Z)((0,be.Z)(o),"lastZIndex",void 0),(0,T.Z)((0,be.Z)(o),"handlingClick",void 0),(0,T.Z)((0,be.Z)(o),"layersLink",void 0),(0,T.Z)((0,be.Z)(o),"baseLayersList",void 0),(0,T.Z)((0,be.Z)(o),"separator",void 0),(0,T.Z)((0,be.Z)(o),"overlaysList",void 0),(0,T.Z)((0,be.Z)(o),"form",void 0),o.layerControlInputs=[],o.layers=[],o.lastZIndex=0,o.handlingClick=!1,o.initLayers(),as(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,be.Z)(o)),o}return(0,Kt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Vh.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var o=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(u){u.layer.on("remove",o.onLayerChange),u.layer.on("add",o.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(o,u){return this.addLayer(o,u,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var o=this.renderService.getViewportSize(),u=o.height;Ll(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var v=u-(this.container.offsetTop+50);return v<this.form.clientHeight?(Ll(this.form,"l7-control-layers-scrollbar"),this.form.style.height=v+"px"):ju(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return ju(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var o=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(u){u.layer.off("remove",o.onLayerChange),u.layer.off("add",o.onLayerChange)}))}},{key:"initLayout",value:function(){var o="l7-control-layers",u=this.container=Ua("div",o),v=this.controlOption.collapsed;u.setAttribute("aria-haspopup","true");var y=this.form=Ua("form",o+"-list");v&&(this.mapsService.on("click",this.collapse),u.addEventListener("mouseenter",this.expand),u.addEventListener("mouseleave",this.collapse)),this.layersLink=Ua("a",o+"-toggle",u);var x=this.layersLink;x.title="Layers",v||this.expand(),this.baseLayersList=Ua("div",o+"-base",y),this.separator=Ua("div",o+"-separator",y),this.overlaysList=Ua("div",o+"-overlays",y),u.appendChild(y)}},{key:"initLayers",value:function(){var o=this,u=this.controlOption,v=u.baseLayers,y=v===void 0?{}:v,x=u.overlayers,E=x===void 0?{}:x;Object.keys(y).forEach(function(P,I){o.addLayer(y[P],P,!1)}),Object.keys(E).forEach(function(P,I){o.addLayer(E[P],P,!0)})}},{key:"update",value:function(){if(!this.container)return this;kl(this.baseLayersList),kl(this.overlaysList),this.layerControlInputs=[];var o,u,v,y,x=0;for(v=0;v<this.layers.length;v++)y=this.layers[v],this.addItem(y),u=u||y.overlay,o=o||!y.overlay,x+=y.overlay?0:1;return this.controlOption.hideSingleBase&&(o=o&&x>1,this.baseLayersList.style.display=o?"":"none"),this.separator.style.display=u&&o?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var o=this.layerControlInputs,u,v,y=this.mapsService.getZoom(),x=o.length-1;x>=0;x--)if(u=o[x],v=this.layerService.getLayer(u.layerId),v&&v.inited){var E=v.getMinZoom(),P=v.getMaxZoom();u.disabled=y<E||y>P}}},{key:"addLayer",value:function(o,u,v){this.mapsService&&(o.on("add",this.onLayerChange),o.on("remove",this.onLayerChange)),this.layers.push({layer:o,name:u,overlay:v});var y=this.controlOption,x=y.sortLayers,E=y.sortFunction,P=y.autoZIndex;x&&this.layers.sort(function(I,D){return E(I.layer,D.layer,I.name,D.name)}),P&&o.setZIndex&&(this.lastZIndex++,o.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(o){this.handlingClick||this.update();var u=this.layerService.getLayer(o.target.layerId),v=u!=null&&u.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;v&&this.emit(v,u)}},{key:"createRadioElement",value:function(o,u){var v='<input type="radio" class="l7-control-layers-selector" name="'+o+'"'+(u?' checked="checked"':"")+"/>",y=document.createElement("div");return y.innerHTML=v,y.firstChild}},{key:"addItem",value:function(o){var u=document.createElement("label"),v=this.layerService.getLayer(o.layer.id),y=v&&v.inited&&o.layer.isVisible(),x;o.overlay?(x=document.createElement("input"),x.type="checkbox",x.className="l7-control-layers-selector",x.defaultChecked=y):x=this.createRadioElement("l7-base-layers",y),this.layerControlInputs.push(x),x.layerId=o.layer.id,x.addEventListener("click",this.onInputClick);var E=document.createElement("span");E.innerHTML=" "+o.name;var P=document.createElement("div");u.appendChild(P),P.appendChild(x),P.appendChild(E);var I=o.overlay?this.overlaysList:this.baseLayersList;return I.appendChild(u),this.checkDisabledLayers(),u}},{key:"onInputClick",value:function(){var o=this.layerControlInputs,u,v,y=[],x=[];this.handlingClick=!0;for(var E=o.length-1;E>=0;E--)u=o[E],v=this.layerService.getLayer(u.layerId),u.checked?y.push(v):u.checked||x.push(v);x.forEach(function(P){P.hide()}),y.forEach(function(P){P.show()}),this.handlingClick=!1}}]),r}(Pv);function db(e){var i=vb();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function vb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mb=function(e){(0,Wr.Z)(r,e);var i=db(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getDefault",value:function(){return{position:Vh.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var o="l7-control-logo",u=Ua("div",o),v=Ua("a","l7-ctrl-logo");return v.target="_blank",v.rel="noopener nofollow",v.href="https://antv.alipay.com/l7",v.setAttribute("aria-label","AntV logo"),v.setAttribute("rel","noopener nofollow"),u.appendChild(v),u}},{key:"onRemove",value:function(){return null}}]),r}(Pv);function gb(e){var i=yb();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QM=function(e){(0,Wr.Z)(r,e);var i=gb(r);function r(n){var o;return(0,St.Z)(this,r),o=i.call(this,n),(0,T.Z)((0,be.Z)(o),"mScale",void 0),(0,T.Z)((0,be.Z)(o),"iScale",void 0),as(["update"],(0,be.Z)(o)),o}return(0,Kt.Z)(r,[{key:"getDefault",value:function(){return{position:Vh.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var o="l7-control-scale",u=Ua("div",o);this.addScales(o+"-line",u);var v=this.controlOption.updateWhenIdle;return this.mapsService.on(v?"moveend":"mapmove",this.update),this.mapsService.on(v?"zoomend":"zoomchange",this.update),this.update(),u}},{key:"onRemove",value:function(){var o=this.controlOption.updateWhenIdle;this.mapsService.off(o?"zoomend":"zoomchange",this.update),this.mapsService.off(o?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var o=this.mapsService,u=this.controlOption.maxWidth,v=o.getSize()[1]/2,y=o.containerToLngLat([0,v]),x=o.containerToLngLat([u,v]),E=bs([y.lng,y.lat],[x.lng,x.lat]);this.updateScales(E)}},{key:"updateScales",value:function(o){var u=this.controlOption,v=u.metric,y=u.imperial;v&&o&&this.updateMetric(o),y&&o&&this.updateImperial(o)}},{key:"updateMetric",value:function(o){var u=this.getRoundNum(o),v=u<1e3?u+" m":u/1e3+" km";this.updateScale(this.mScale,v,u/o)}},{key:"updateImperial",value:function(o){var u=o*3.2808399,v,y,x;u>5280?(v=u/5280,y=this.getRoundNum(v),this.updateScale(this.iScale,y+" mi",y/v)):(x=this.getRoundNum(u),this.updateScale(this.iScale,x+" ft",x/u))}},{key:"updateScale",value:function(o,u,v){var y=this.controlOption.maxWidth;o.style.width=Math.round(y*v)+"px",o.innerHTML=u}},{key:"getRoundNum",value:function(o){var u=Math.pow(10,(Math.floor(o)+"").length-1),v=o/u;return v=v>=10?10:v>=5?5:v>=3?3:v>=2?2:1,u*v}},{key:"addScales",value:function(o,u){var v=this.controlOption,y=v.metric,x=v.imperial;y&&(this.mScale=Ua("div",o,u)),x&&(this.iScale=Ua("div",o,u))}}]),r}(Pv);function _b(e){var i=xb();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function xb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eP=function(e){(0,Wr.Z)(r,e);var i=_b(r);function r(n){var o;return(0,St.Z)(this,r),o=i.call(this,n),(0,T.Z)((0,be.Z)(o),"disabled",void 0),(0,T.Z)((0,be.Z)(o),"zoomInButton",void 0),(0,T.Z)((0,be.Z)(o),"zoomOutButton",void 0),as(["updateDisabled","zoomIn","zoomOut"],(0,be.Z)(o)),o}return(0,Kt.Z)(r,[{key:"getDefault",value:function(){return{position:Vh.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var o="l7-control-zoom",u=Ua("div",o+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,o+"-in",u,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,o+"-out",u,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),u}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(o,u,v,y,x){var E=Ua("a",v,y);return E.innerHTML=o,E.title=u,E.href="javascript:void(0)",E.addEventListener("click",x),E}},{key:"updateDisabled",value:function(){var o=this.mapsService,u="l7-disabled";ju(this.zoomInButton,u),ju(this.zoomOutButton,u),(this.disabled||o.getZoom()<=o.getMinZoom())&&Ll(this.zoomOutButton,u),(this.disabled||o.getZoom()>=o.getMaxZoom())&&Ll(this.zoomInButton,u)}}]),r}(Pv);function z0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function U0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?z0(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bb(e){var i=Eb();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Eb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z0=function(e){(0,Wr.Z)(r,e);var i=bb(r);function r(n){var o;return(0,St.Z)(this,r),o=i.call(this),(0,T.Z)((0,be.Z)(o),"markerOption",void 0),(0,T.Z)((0,be.Z)(o),"defaultMarker",void 0),(0,T.Z)((0,be.Z)(o),"popup",void 0),(0,T.Z)((0,be.Z)(o),"mapsService",void 0),(0,T.Z)((0,be.Z)(o),"sceneSerive",void 0),(0,T.Z)((0,be.Z)(o),"lngLat",void 0),(0,T.Z)((0,be.Z)(o),"scene",void 0),(0,T.Z)((0,be.Z)(o),"added",!1),(0,T.Z)((0,be.Z)(o),"eventHandle",function(u){o.emit(u.type,{target:u,data:o.markerOption.extData,lngLat:o.lngLat})}),o.markerOption=U0(U0({},o.getDefault()),n),as(["update","onMove","onUp","addDragHandler","onMapClick"],(0,be.Z)(o)),o.init(),o}return(0,Kt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:ba.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(o){this.scene=o,this.mapsService=o.get(qt.IMapService),this.sceneSerive=o.get(qt.ISceneService);var u=this.markerOption,v=u.element,y=u.draggable;return this.mapsService.getMarkerContainer().appendChild(v),this.registerMarkerEvent(v),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var o=this.markerOption.element;return o&&ic(o),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(o){var u=this;if(!this.added)return this.once("added",function(){u.setElement(o)}),this;var v=this.markerOption.element;return v&&ic(v),this.markerOption.element=o,this.init(),this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.update(),this}},{key:"openPopup",value:function(){var o=this;if(!this.added)return this.once("added",function(){o.openPopup()}),this;var u=this.popup;return u?(u.isOpen()||u.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var o=this;this.added||this.once("added",function(){o.closePopup()});var u=this.popup;return u&&u.remove(),this}},{key:"setPopup",value:function(o){return this.popup=o,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var o=this.popup;if(o)o.isOpen()?o.remove():o.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(o){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(o){this.markerOption.extData=o}},{key:"update",value:function(){if(!!this.mapsService){var o=this.markerOption,u=o.element,v=o.anchor;this.updatePosition(),po(u,"".concat(sc[v]))}}},{key:"onMapClick",value:function(o){var u=this.markerOption.element;this.popup&&u&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.markerOption,u=o.element,v=o.offsets,y=this.lngLat,x=y.lng,E=y.lat,P=this.mapsService.getBounds(),I=this.mapsService.lngLatToContainer([x,E]);if(u){u.style.display="block";var D=this.mapsService.getContainer(),Z=0,te=0;if(D&&(Z=D.scrollWidth,te=D.scrollHeight),Math.abs(P[0][0])>180||Math.abs(P[1][0])>180){if(I.x>Z){var le=this.mapsService.lngLatToContainer([x-360,E]);I.x=le.x}if(I.x<0){var ve=this.mapsService.lngLatToContainer([x+360,E]);I.x=ve.x}}(I.x>Z||I.x<0||I.y>te||I.y<0)&&(u.style.display="none"),u.style.left=I.x+v[0]+"px",u.style.top=I.y-v[1]+"px"}}}},{key:"init",value:function(){var o=this,u=this.markerOption.element,v=this.markerOption,y=v.color,x=v.anchor;if(!u){this.defaultMarker=!0,u=Ua("div"),this.markerOption.element=u;var E=document.createElementNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","48px"),E.setAttributeNS(null,"width","48px"),E.setAttributeNS(null,"viewBox","0 0 1024 1024");var P=document.createElementNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),P.setAttributeNS(null,"fill",y),E.appendChild(P),u.appendChild(E)}Ll(u,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(I){var D,Z,te=((D=o.markerOption)===null||D===void 0?void 0:D.style)&&((Z=o.markerOption)===null||Z===void 0?void 0:Z.style[I]);u&&(u.style[I]=te)}),u.addEventListener("click",function(I){o.onMapClick(I)}),u.addEventListener("click",this.eventHandle),fl(u,x,"marker")}},{key:"registerMarkerEvent",value:function(o){o.addEventListener("mousemove",this.eventHandle),o.addEventListener("click",this.eventHandle),o.addEventListener("mousedown",this.eventHandle),o.addEventListener("mouseup",this.eventHandle),o.addEventListener("dblclick",this.eventHandle),o.addEventListener("contextmenu",this.eventHandle),o.addEventListener("mouseover",this.eventHandle),o.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var o=this.getElement();o.removeEventListener("mousemove",this.eventHandle),o.removeEventListener("click",this.eventHandle),o.removeEventListener("mousedown",this.eventHandle),o.removeEventListener("mouseup",this.eventHandle),o.removeEventListener("dblclick",this.eventHandle),o.removeEventListener("contextmenu",this.eventHandle),o.removeEventListener("mouseover",this.eventHandle),o.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(o){throw new Error("Method not implemented.")}},{key:"onUp",value:function(o){throw new Error("Method not implemented.")}}]),r}(Ea.EventEmitter);function V0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function j0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?V0(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Sb(e){var i=wb();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function wb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tP=function(e){(0,Wr.Z)(r,e);var i=Sb(r);function r(n){var o,u;return(0,St.Z)(this,r),u=i.call(this),(0,T.Z)((0,be.Z)(u),"markers",[]),(0,T.Z)((0,be.Z)(u),"markerLayerOption",void 0),(0,T.Z)((0,be.Z)(u),"clusterIndex",void 0),(0,T.Z)((0,be.Z)(u),"points",[]),(0,T.Z)((0,be.Z)(u),"clusterMarkers",[]),(0,T.Z)((0,be.Z)(u),"mapsService",void 0),(0,T.Z)((0,be.Z)(u),"scene",void 0),(0,T.Z)((0,be.Z)(u),"zoom",void 0),(0,T.Z)((0,be.Z)(u),"bbox",void 0),u.markerLayerOption=en()(u.getDefault(),n),as(["update"],(0,be.Z)(u)),u.zoom=((o=u.markerLayerOption.clusterOption)===null||o===void 0?void 0:o.zoom)||-99,u}return(0,Kt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(o){return this.scene=o,this.mapsService=o.get(qt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(o){var u=this.markerLayerOption.cluster;u&&this.addPoint(o,this.markers.length),this.markers.push(o)}},{key:"removeMarker",value:function(o){this.markers.indexOf(o);var u=this.markers.indexOf(o);u>-1&&this.markers.splice(u,1)}},{key:"hide",value:function(){this.markers.map(function(o){o.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(o){o.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var o=this.markerLayerOption.cluster;return o?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var o=this;this.getMarkers().forEach(function(u){u.addTo(o.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(o){o.remove()}),this.clusterMarkers.forEach(function(o){o.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(o,u){var v=o.getLnglat(),y=v.lng,x=v.lat,E={geometry:{type:"Point",coordinates:[y,x]},properties:j0(j0({},o.getExtData()),{},{marker_id:u})};this.points.push(E)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var o=this.markerLayerOption.clusterOption,u=o.radius,v=o.minZoom,y=v===void 0?0:v,x=o.maxZoom;this.clusterIndex=new(wo())({radius:u,minZoom:y,maxZoom:x}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(o,u){var v=this,y=o[0].concat(o[1]),x=this.clusterIndex.getClusters(y,u);this.clusterMarkers.forEach(function(E){E.remove()}),this.clusterMarkers=[],x.forEach(function(E){var P,I=v.markerLayerOption.clusterOption,D=I.field,Z=I.method;if(E.properties&&(P=E.properties)!==null&&P!==void 0&&P.cluster_id){var te,le=v.getLeaves((te=E.properties)===null||te===void 0?void 0:te.cluster_id);if(E.properties.clusterData=le,D&&Z){var ve=le==null?void 0:le.map(function(jt){var Wt=(0,T.Z)({},D,jt.properties[D]);return Wt}),Be=Yu(ve,D),it=uc(Z,Be),yt="point_"+Z;E.properties[yt]=it.toFixed(2)}}var wt=v.clusterMarker(E);v.clusterMarkers.push(wt),wt.addTo(v.scene)})}},{key:"getLeaves",value:function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return o?this.clusterIndex.getLeaves(o,u,v):null}},{key:"clusterMarker",value:function(o){var u=this.markerLayerOption.clusterOption,v=u,y=v.element,x=y===void 0?this.generateElement.bind(this):y,E=new Z0({element:x(o)}).setLnglat({lng:o.geometry.coordinates[0],lat:o.geometry.coordinates[1]});return E}},{key:"normalMarker",value:function(o){var u=o.properties.marker_id;return this.markers[u]}},{key:"update",value:function(){var o=this.mapsService.getZoom(),u=this.mapsService.getBounds();(!this.bbox||Math.abs(o-this.zoom)>=1||!bn(this.bbox,u))&&(this.bbox=Cn(u,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(o){var u=Ua("div","l7-marker-cluster"),v=Ua("div","",u),y=Ua("span","",v),x=this.markerLayerOption.clusterOption,E=x.field,P=x.method;o.properties.point_count=o.properties.point_count||1;var I=E&&P?o.properties["point_"+P]||o.properties[E]:o.properties.point_count;return y.textContent=I,u}}]),r}(Ea.EventEmitter);function G0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function H0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?G0(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Tb(e){var i=Ab();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function Ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W0=function(e){(0,Wr.Z)(r,e);var i=Tb(r);function r(n){var o;return(0,St.Z)(this,r),o=i.call(this),(0,T.Z)((0,be.Z)(o),"popupOption",void 0),(0,T.Z)((0,be.Z)(o),"mapsService",void 0),(0,T.Z)((0,be.Z)(o),"sceneSerive",void 0),(0,T.Z)((0,be.Z)(o),"lngLat",void 0),(0,T.Z)((0,be.Z)(o),"content",void 0),(0,T.Z)((0,be.Z)(o),"closeButton",void 0),(0,T.Z)((0,be.Z)(o),"timeoutInstance",void 0),(0,T.Z)((0,be.Z)(o),"container",void 0),(0,T.Z)((0,be.Z)(o),"tip",void 0),(0,T.Z)((0,be.Z)(o),"scene",void 0),o.popupOption=H0(H0({},o.getdefault()),n),as(["update","onClickClose","remove"],(0,be.Z)(o)),o}return(0,Kt.Z)(r,[{key:"addTo",value:function(o){var u=this;return this.mapsService=o.get(qt.IMapService),this.sceneSerive=o.get(qt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=o,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){u.mapsService.on("click",u.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(o){var u=window.document.createDocumentFragment(),v=window.document.createElement("body"),y;for(v.innerHTML=o;y=v.firstChild,!!y;)u.appendChild(y);return this.setDOMContent(u)}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(o){return this.setDOMContent(window.document.createTextNode(o))}},{key:"setMaxWidth",value:function(o){return this.popupOption.maxWidth=o,this.update(),this}},{key:"setDOMContent",value:function(o){return this.createContent(),this.content.appendChild(o),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&ic(this.content),this.content=Ua("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Ua("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(o,u,v){var y=window.document.createElement(o);return u!==void 0&&(y.className=u),v&&v.appendChild(y),y}},{key:"removeDom",value:function(o){o.parentNode&&o.parentNode.removeChild(o)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:ba.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(o){o.stopPropagation&&o.stopPropagation(),this.remove()}},{key:"update",value:function(){var o=this,u=this.lngLat,v=this.popupOption,y=v.className,x=v.maxWidth,E=v.anchor;if(!(!this.mapsService||!u||!this.content)){var P=this.mapsService.getMarkerContainer();if(!this.container&&P){this.container=this.creatDom("div","l7-popup",P),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),y&&y.split(" ").forEach(function(D){return o.container.classList.add(D)});var I=this.popupOption.stopPropagation;I&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(D){o.container.addEventListener(D,function(Z){Z.stopPropagation()})})}x&&this.container.style.maxWidth!==x&&(this.container.style.maxWidth=x),this.updatePosition(),po(this.container,"".concat(sc[E])),fl(this.container,E,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.lngLat,u=o.lng,v=o.lat,y=this.popupOption.offsets,x=this.mapsService.lngLatToContainer([u,v]);this.container.style.left=x.x+y[0]+"px",this.container.style.top=x.y-y[1]+"px"}}}]),r}(Ea.EventEmitter);function Cb(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var o=i.head||i.getElementsByTagName("head")[0];if(!o){o=i.createElement("head");var u=i.body||i.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):i.documentElement.appendChild(o)}var v=i.createElement("style");return v.type="text/css",v.styleSheet?v.styleSheet.cssText=e:v.appendChild(i.createTextNode(e)),o.appendChild(v),v}}Cb(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var Mb=L(88307),Pb=L.n(Mb),Ib=function(){function e(i,r){(0,St.Z)(this,e),(0,T.Z)(this,"attribute",void 0),(0,T.Z)(this,"buffer",void 0);var n=r.buffer,o=r.offset,u=r.stride,v=r.normalized,y=r.size,x=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:o||0,stride:u||0,normalized:v||!1,divisor:x||0},y&&(this.attribute.size=y)}return(0,Kt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),vh,jd,mh,bc,Gd,jh,Hd,Iv,Of,Ap,Su,Rf,Lf,Ov,Ob=(vh={},(0,T.Z)(vh,d.POINTS,"points"),(0,T.Z)(vh,d.LINES,"lines"),(0,T.Z)(vh,d.LINE_LOOP,"line loop"),(0,T.Z)(vh,d.LINE_STRIP,"line strip"),(0,T.Z)(vh,d.TRIANGLES,"triangles"),(0,T.Z)(vh,d.TRIANGLE_FAN,"triangle fan"),(0,T.Z)(vh,d.TRIANGLE_STRIP,"triangle strip"),vh),X0=(jd={},(0,T.Z)(jd,d.STATIC_DRAW,"static"),(0,T.Z)(jd,d.DYNAMIC_DRAW,"dynamic"),(0,T.Z)(jd,d.STREAM_DRAW,"stream"),jd),wm=(mh={},(0,T.Z)(mh,d.BYTE,"int8"),(0,T.Z)(mh,d.UNSIGNED_INT,"int16"),(0,T.Z)(mh,d.INT,"int32"),(0,T.Z)(mh,d.UNSIGNED_BYTE,"uint8"),(0,T.Z)(mh,d.UNSIGNED_SHORT,"uint16"),(0,T.Z)(mh,d.UNSIGNED_INT,"uint32"),(0,T.Z)(mh,d.FLOAT,"float"),mh),Rb=(bc={},(0,T.Z)(bc,d.ALPHA,"alpha"),(0,T.Z)(bc,d.LUMINANCE,"luminance"),(0,T.Z)(bc,d.LUMINANCE_ALPHA,"luminance alpha"),(0,T.Z)(bc,d.RGB,"rgb"),(0,T.Z)(bc,d.RGBA,"rgba"),(0,T.Z)(bc,d.RGBA4,"rgba4"),(0,T.Z)(bc,d.RGB5_A1,"rgb5 a1"),(0,T.Z)(bc,d.RGB565,"rgb565"),(0,T.Z)(bc,d.DEPTH_COMPONENT,"depth"),(0,T.Z)(bc,d.DEPTH_STENCIL,"depth stencil"),bc),Lb=(Gd={},(0,T.Z)(Gd,d.DONT_CARE,"dont care"),(0,T.Z)(Gd,d.NICEST,"nice"),(0,T.Z)(Gd,d.FASTEST,"fast"),Gd),Y0=(jh={},(0,T.Z)(jh,d.NEAREST,"nearest"),(0,T.Z)(jh,d.LINEAR,"linear"),(0,T.Z)(jh,d.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,T.Z)(jh,d.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,T.Z)(jh,d.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,T.Z)(jh,d.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),jh),K0=(Hd={},(0,T.Z)(Hd,d.REPEAT,"repeat"),(0,T.Z)(Hd,d.CLAMP_TO_EDGE,"clamp"),(0,T.Z)(Hd,d.MIRRORED_REPEAT,"mirror"),Hd),kb=(Iv={},(0,T.Z)(Iv,d.NONE,"none"),(0,T.Z)(Iv,d.BROWSER_DEFAULT_WEBGL,"browser"),Iv),Db=(Of={},(0,T.Z)(Of,d.NEVER,"never"),(0,T.Z)(Of,d.ALWAYS,"always"),(0,T.Z)(Of,d.LESS,"less"),(0,T.Z)(Of,d.LEQUAL,"lequal"),(0,T.Z)(Of,d.GREATER,"greater"),(0,T.Z)(Of,d.GEQUAL,"gequal"),(0,T.Z)(Of,d.EQUAL,"equal"),(0,T.Z)(Of,d.NOTEQUAL,"notequal"),Of),q0=(Ap={},(0,T.Z)(Ap,d.FUNC_ADD,"add"),(0,T.Z)(Ap,d.MIN_EXT,"min"),(0,T.Z)(Ap,d.MAX_EXT,"max"),(0,T.Z)(Ap,d.FUNC_SUBTRACT,"subtract"),(0,T.Z)(Ap,d.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Ap),Rv=(Su={},(0,T.Z)(Su,d.ZERO,"zero"),(0,T.Z)(Su,d.ONE,"one"),(0,T.Z)(Su,d.SRC_COLOR,"src color"),(0,T.Z)(Su,d.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,T.Z)(Su,d.SRC_ALPHA,"src alpha"),(0,T.Z)(Su,d.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,T.Z)(Su,d.DST_COLOR,"dst color"),(0,T.Z)(Su,d.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,T.Z)(Su,d.DST_ALPHA,"dst alpha"),(0,T.Z)(Su,d.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,T.Z)(Su,d.CONSTANT_COLOR,"constant color"),(0,T.Z)(Su,d.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,T.Z)(Su,d.CONSTANT_ALPHA,"constant alpha"),(0,T.Z)(Su,d.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,T.Z)(Su,d.SRC_ALPHA_SATURATE,"src alpha saturate"),Su),Fb=(Rf={},(0,T.Z)(Rf,d.NEVER,"never"),(0,T.Z)(Rf,d.ALWAYS,"always"),(0,T.Z)(Rf,d.LESS,"less"),(0,T.Z)(Rf,d.LEQUAL,"lequal"),(0,T.Z)(Rf,d.GREATER,"greater"),(0,T.Z)(Rf,d.GEQUAL,"gequal"),(0,T.Z)(Rf,d.EQUAL,"equal"),(0,T.Z)(Rf,d.NOTEQUAL,"notequal"),Rf),od=(Lf={},(0,T.Z)(Lf,d.ZERO,"zero"),(0,T.Z)(Lf,d.KEEP,"keep"),(0,T.Z)(Lf,d.REPLACE,"replace"),(0,T.Z)(Lf,d.INVERT,"invert"),(0,T.Z)(Lf,d.INCR,"increment"),(0,T.Z)(Lf,d.DECR,"decrement"),(0,T.Z)(Lf,d.INCR_WRAP,"increment wrap"),(0,T.Z)(Lf,d.DECR_WRAP,"decrement wrap"),Lf),Nb=(Ov={},(0,T.Z)(Ov,d.FRONT,"front"),(0,T.Z)(Ov,d.BACK,"back"),Ov),Bb=function(){function e(i,r){(0,St.Z)(this,e),(0,T.Z)(this,"buffer",void 0);var n=r.data,o=r.usage,u=r.type;this.buffer=i.buffer({data:n,usage:X0[o||d.STATIC_DRAW],type:wm[u||d.UNSIGNED_BYTE]})}return(0,Kt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,o=r.offset;this.buffer.subdata(n,o)}}]),e}(),zb=function(){function e(i,r){(0,St.Z)(this,e),(0,T.Z)(this,"elements",void 0);var n=r.data,o=r.usage,u=r.type,v=r.count;this.elements=i.elements({data:n,usage:X0[o||d.STATIC_DRAW],type:wm[u||d.UNSIGNED_BYTE],count:v})}return(0,Kt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),Ub=function(){function e(i,r){(0,St.Z)(this,e),(0,T.Z)(this,"framebuffer",void 0);var n=r.width,o=r.height,u=r.color,v=r.colors,y=r.depth,x=r.stencil,E={width:n,height:o};Array.isArray(v)&&(E.colors=v.map(function(P){return P.get()})),u&&typeof u!="boolean"&&(E.color=u.get()),this.framebuffer=i.framebuffer(E)}return(0,Kt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,o=r.height;this.framebuffer.resize(n,o)}}]),e}(),Zb=L(36719),Vb=L.n(Zb),jb=L(68630),Gb=L.n(jb);function $0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function sd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$0(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Hb=function(){function e(i,r){(0,St.Z)(this,e),(0,T.Z)(this,"reGl",void 0),(0,T.Z)(this,"destroyed",!1),(0,T.Z)(this,"drawCommand",void 0),(0,T.Z)(this,"drawParams",void 0),(0,T.Z)(this,"options",void 0),(0,T.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,o=r.fs,u=r.attributes,v=r.uniforms,y=r.primitive,x=r.count,E=r.elements,P=r.depth,I=r.blend,D=r.stencil,Z=r.cull,te=r.instances,le={};this.options=r,v&&(this.uniforms=this.extractUniforms(v),Object.keys(v).forEach(function(it){le[it]=i.prop(it)}));var ve={};Object.keys(u).forEach(function(it){ve[it]=u[it].get()});var Be={attributes:ve,frag:o,uniforms:le,vert:n,primitive:Ob[y===void 0?d.TRIANGLES:y]};te&&(Be.instances=te),x&&(Be.count=x),E&&(Be.elements=E.get()),this.initDepthDrawParams({depth:P},Be),this.initBlendDrawParams({blend:I},Be),this.initStencilDrawParams({stencil:D},Be),this.initCullDrawParams({cull:Z},Be),this.drawCommand=i(Be),this.drawParams=Be}return(0,Kt.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=sd(sd({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var n=sd(sd({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(n).forEach(function(u){var v=(0,Xe.Z)(n[u]);v==="boolean"||v==="number"||Array.isArray(n[u])||n[u].BYTES_PER_ELEMENT?o[u]=n[u]:o[u]=n[u].get()}),this.drawCommand(o)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var o=r.depth;o&&(n.depth={enable:o.enable===void 0?!0:!!o.enable,mask:o.mask===void 0?!0:!!o.mask,func:Db[o.func||d.LESS],range:o.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var o=r.blend;if(o){var u=o.enable,v=o.func,y=o.equation,x=o.color,E=x===void 0?[0,0,0,0]:x;n.blend={enable:!!u,func:{srcRGB:Rv[v&&v.srcRGB||d.SRC_ALPHA],srcAlpha:Rv[v&&v.srcAlpha||d.SRC_ALPHA],dstRGB:Rv[v&&v.dstRGB||d.ONE_MINUS_SRC_ALPHA],dstAlpha:Rv[v&&v.dstAlpha||d.ONE_MINUS_SRC_ALPHA]},equation:{rgb:q0[y&&y.rgb||d.FUNC_ADD],alpha:q0[y&&y.alpha||d.FUNC_ADD]},color:E}}}},{key:"initStencilDrawParams",value:function(r,n){var o=r.stencil;if(o){var u=o.enable,v=o.mask,y=v===void 0?-1:v,x=o.func,E=x===void 0?{cmp:d.ALWAYS,ref:0,mask:-1}:x,P=o.opFront,I=P===void 0?{fail:d.KEEP,zfail:d.KEEP,zpass:d.KEEP}:P,D=o.opBack,Z=D===void 0?{fail:d.KEEP,zfail:d.KEEP,zpass:d.KEEP}:D;n.stencil={enable:!!u,mask:y,func:sd(sd({},E),{},{cmp:Fb[E.cmp]}),opFront:{fail:od[I.fail],zfail:od[I.zfail],zpass:od[I.zpass]},opBack:{fail:od[Z.fail],zfail:od[Z.zfail],zpass:od[Z.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var o=r.cull;if(o){var u=o.enable,v=o.face,y=v===void 0?d.BACK:v;n.cull={enable:!!u,face:Nb[y]}}}},{key:"extractUniforms",value:function(r){var n=this,o={};return Object.keys(r).forEach(function(u){n.extractUniformsRecursively(u,r[u],o,"")}),o}},{key:"extractUniformsRecursively",value:function(r,n,o,u){var v=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||Vb()(n)||n===""||"resize"in n){o["".concat(u&&u+".").concat(r)]=n;return}Gb()(n)&&Object.keys(n).forEach(function(y){v.extractUniformsRecursively(y,n[y],o,"".concat(u&&u+".").concat(r))}),Array.isArray(n)&&n.forEach(function(y,x){Object.keys(y).forEach(function(E){v.extractUniformsRecursively(E,y[E],o,"".concat(u&&u+".").concat(r,"[").concat(x,"]"))})})}}]),e}(),Wb=function(){function e(i,r){(0,St.Z)(this,e),(0,T.Z)(this,"texture",void 0),(0,T.Z)(this,"width",void 0),(0,T.Z)(this,"height",void 0);var n=r.data,o=r.type,u=o===void 0?d.UNSIGNED_BYTE:o,v=r.width,y=r.height,x=r.flipY,E=x===void 0?!1:x,P=r.format,I=P===void 0?d.RGBA:P,D=r.mipmap,Z=D===void 0?!1:D,te=r.wrapS,le=te===void 0?d.CLAMP_TO_EDGE:te,ve=r.wrapT,Be=ve===void 0?d.CLAMP_TO_EDGE:ve,it=r.aniso,yt=it===void 0?0:it,wt=r.alignment,jt=wt===void 0?1:wt,Wt=r.premultiplyAlpha,nr=Wt===void 0?!1:Wt,mr=r.mag,tn=mr===void 0?d.NEAREST:mr,vn=r.min,Pr=vn===void 0?d.NEAREST:vn,In=r.colorSpace,Gn=In===void 0?d.BROWSER_DEFAULT_WEBGL:In;this.width=v,this.height=y;var yi={width:v,height:y,type:wm[u],format:Rb[I],wrapS:K0[le],wrapT:K0[Be],mag:Y0[tn],min:Y0[Pr],alignment:jt,flipY:E,colorSpace:kb[Gn],premultiplyAlpha:nr,aniso:yt};n&&(yi.data=n),typeof Z=="number"?yi.mipmap=Lb[Z]:typeof Z=="boolean"&&(yi.mipmap=Z),this.texture=i.texture(yi)}return(0,Kt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,o=r.height;this.texture.resize(n,o),this.width=n,this.height=o}},{key:"destroy",value:function(){this.texture.destroy()}}]),e}(),J0,Q0,Xb=(J0=(0,Lr.b2)(),J0(Q0=function(){function e(){var i=this;(0,St.Z)(this,e),(0,T.Z)(this,"extensionObject",void 0),(0,T.Z)(this,"gl",void 0),(0,T.Z)(this,"$container",void 0),(0,T.Z)(this,"canvas",void 0),(0,T.Z)(this,"width",void 0),(0,T.Z)(this,"height",void 0),(0,T.Z)(this,"isDirty",void 0),(0,T.Z)(this,"createModel",function(r){return new Hb(i.gl,r)}),(0,T.Z)(this,"createAttribute",function(r){return new Ib(i.gl,r)}),(0,T.Z)(this,"createBuffer",function(r){return new Bb(i.gl,r)}),(0,T.Z)(this,"createElements",function(r){return new zb(i.gl,r)}),(0,T.Z)(this,"createTexture2D",function(r){return new Wb(i.gl,r)}),(0,T.Z)(this,"createFramebuffer",function(r){return new Ub(i.gl,r)}),(0,T.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,T.Z)(this,"clear",function(r){var n=r.color,o=r.depth,u=r.stencil,v=r.framebuffer,y=v===void 0?null:v,x={color:n,depth:o,stencil:u};x.framebuffer=y===null?y:y.get(),i.gl.clear(x)}),(0,T.Z)(this,"viewport",function(r){var n=r.x,o=r.y,u=r.width,v=r.height;i.gl._gl.viewport(n,o,u,v),i.width=u,i.height=v,i.gl._refresh()}),(0,T.Z)(this,"readPixels",function(r){var n=r.framebuffer,o=r.x,u=r.y,v=r.width,y=r.height,x={x:o,y:u,width:v,height:y};return n&&(x.framebuffer=n.get()),i.gl.read(x)}),(0,T.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,T.Z)(this,"getContainer",function(){if($i)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,T.Z)(this,"getCanvas",function(){return i.canvas}),(0,T.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,T.Z)(this,"destroy",function(){i.gl.destroy()})}return(0,Kt.Z)(e,[{key:"init",value:function(){var i=(0,ks.Z)(t().mark(function n(o,u){var v=this;return t().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return this.canvas=o,x.next=3,new Promise(function(E,P){Pb()({canvas:v.canvas,attributes:{alpha:!0,antialias:u.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:u.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(D,Z){(D||!Z)&&P(D),E(Z)}})});case 3:this.gl=x.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return x.stop()}},n,this)}));function r(n,o){return i.apply(this,arguments)}return r}()},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Q0);function eg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function tg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?eg(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Yb=function(){function e(i){(0,St.Z)(this,e),(0,T.Z)(this,"sceneService",void 0),(0,T.Z)(this,"mapService",void 0),(0,T.Z)(this,"controlService",void 0),(0,T.Z)(this,"layerService",void 0),(0,T.Z)(this,"iconService",void 0),(0,T.Z)(this,"markerService",void 0),(0,T.Z)(this,"popupService",void 0),(0,T.Z)(this,"fontService",void 0),(0,T.Z)(this,"interactionService",void 0),(0,T.Z)(this,"container",void 0);var r=i.id,n=i.map,o=i.canvas,u=i.hasBaseMap,v=Kx();this.container=v,n.setContainer(v,r,o,u),v.bind(qt.IRendererService).to(Xb).inSingletonScope(),this.sceneService=v.get(qt.ISceneService),this.mapService=v.get(qt.IMapService),this.iconService=v.get(qt.IIconService),this.fontService=v.get(qt.IFontService),this.controlService=v.get(qt.IControlService),this.layerService=v.get(qt.ILayerService),this.markerService=v.get(qt.IMarkerService),this.interactionService=v.get(qt.IInteractionService),this.popupService=v.get(qt.IPopupService),$i?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,Kt.Z)(e,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var o=new r(this);o.init()}else this.on("loaded",function(){var u=new r(n);u.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=qx(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(o){var u=(0,Pn.Z)(o,2),v=u[0],y=u[1];n.fontService.addIconFont(v,y)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){$i?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){Sm.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){Sm.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){Sm.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var o=this.sceneService.getSceneConfig(),u=o.fitBoundsOptions,v=o.animate;this.mapService.fitBounds(r,n||tg(tg({},u),{},{animate:v}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(qt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"initComponent",value:function(r){this.controlService.init({container:Pa(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,o=r.logoPosition;n&&this.addControl(new mb({position:o}))}}]),e}(),Kb=L(13218),Ec=L.n(Kb),rg,ng,ig,Tm,ag;function qb(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}var $b=(rg=(0,Lr.b2)(),ng=(0,Lr.f3)(qt.IGlobalConfigService),rg(ig=(Tm=function(){function e(){(0,St.Z)(this,e),Rn(this,"configService",ag,this),(0,T.Z)(this,"enabled",void 0)}return(0,Kt.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.rendererService,v=n.postProcessingPassFactory,y=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var x=r.getLayerConfig(),E=x.enableMultiPassRenderer,P=x.passes,I=P===void 0?[]:P;o.enabled=!!E&&r.getLayerConfig().enableMultiPassRenderer!==!1,o.enabled&&(r.multiPassRenderer=o.createMultiPassRenderer(r,I,v,y),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(r,n,o,u){var v=r.multiPassRenderer,y=r.getLayerConfig(),x=y.enablePicking,E=y.enableTAA;return x&&v.add(u("pixelPicking")),v}}]),e}(),ag=Fn(Tm.prototype,"configService",[ng],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tm))||ig),Gh,og=(Gh={},(0,T.Z)(Gh,$c.additive,{enable:!0,func:{srcRGB:d.ONE,dstRGB:d.ONE,srcAlpha:1,dstAlpha:1}}),(0,T.Z)(Gh,$c.none,{enable:!1}),(0,T.Z)(Gh,$c.normal,{enable:!0,func:{srcRGB:d.SRC_ALPHA,dstRGB:d.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,T.Z)(Gh,$c.subtractive,{enable:!0,func:{srcRGB:d.ONE,dstRGB:d.ONE,srcAlpha:d.ZERO,dstAlpha:d.ONE_MINUS_SRC_COLOR},equation:{rgb:d.FUNC_SUBTRACT,alpha:d.FUNC_SUBTRACT}}),(0,T.Z)(Gh,$c.max,{enable:!0,func:{srcRGB:d.ONE,dstRGB:d.ONE},equation:{rgb:d.MAX_EXT}}),(0,T.Z)(Gh,$c.min,{enable:!0,func:{srcRGB:d.ONE,dstRGB:d.ONE},equation:{rgb:d.MIN_EXT}}),Gh),Jb=L(81763),go=L.n(Jb),Qb=L(1469),Cp=L.n(Qb),rP=1024;function tl(e,i,r,n,o){i.updateStyleAttribute(e,r,n,o)}function eE(e,i){e.opacity&&Am("opacity",i,e.opacity),e.strokeWidth&&Am("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Am("strokeOpacity",i,e.strokeOpacity),e.stroke&&tE("stroke",i,e.stroke),e.offsets&&sg("offsets",i,e.offsets),e.textOffset&&sg("textOffset",i,e.textOffset)}function Am(e,i,r){zs()(r)?tl(e,i,r,function(n){return n}):go()(r)?tl(e,i,[r],void 0):Cp()(r)&&r.length===2?zs()(r[0])&&Ho()(r[1])||zs()(r[0])&&Cp()(r[1])&&go()(r[1][0])&&go()(r[1][1])?tl(e,i,r[0],r[1]):tl(e,i,[1],void 0):tl(e,i,[1],void 0)}function sg(e,i,r){zs()(r)?tl(e,i,r,function(n){return n}):Cp()(r)&&r.length===2&&zs()(r[0])&&Ho()(r[1])?tl(e,i,r[0],r[1]):Cp()(r)&&r.length===2&&go()(r[0])&&go()(r[1])?tl(e,i,r,void 0):tl(e,i,[0,0],void 0)}function tE(e,i,r){zs()(r)?tl(e,i,r,void 0):Cp()(r)&&r.length===2&&(zs()(r[0])&&Ho()(r[1])||zs()(r[0])&&Cp()(r[1])&&r[1].length>0)?tl(e,i,r[0],r[1]):tl(e,i,"#fff",void 0)}var rE=["passes"],nE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],ug,lg,Lv,cg,fg;function iE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=aE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function aE(e,i){if(!!e){if(typeof e=="string")return hg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hg(e,i)}}function hg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function pg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Nu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?pg(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oE(e){var i=sE();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function sE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dg=0,Mp=(ug=Vd(qt.IGlobalConfigService),lg=Vd(qt.IShaderModuleService),Lv=function(e){(0,Wr.Z)(r,e);var i=oE(r);function r(){var n,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,St.Z)(this,r),n=i.call(this),(0,T.Z)((0,be.Z)(n),"id","".concat(dg++)),(0,T.Z)((0,be.Z)(n),"name","".concat(dg)),(0,T.Z)((0,be.Z)(n),"type",void 0),(0,T.Z)((0,be.Z)(n),"visible",!0),(0,T.Z)((0,be.Z)(n),"zIndex",0),(0,T.Z)((0,be.Z)(n),"minZoom",void 0),(0,T.Z)((0,be.Z)(n),"maxZoom",void 0),(0,T.Z)((0,be.Z)(n),"inited",!1),(0,T.Z)((0,be.Z)(n),"layerModelNeedUpdate",!1),(0,T.Z)((0,be.Z)(n),"pickedFeatureID",null),(0,T.Z)((0,be.Z)(n),"selectedFeatureID",null),(0,T.Z)((0,be.Z)(n),"styleNeedUpdate",!1),(0,T.Z)((0,be.Z)(n),"rendering",void 0),(0,T.Z)((0,be.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,T.Z)((0,be.Z)(n),"hooks",{init:new jn,afterInit:new jn,beforeRender:new jn,beforeRenderData:new $n,afterRender:new di,beforePickingEncode:new di,afterPickingEncode:new di,beforeHighlight:new di(["pickedColor"]),afterHighlight:new di,beforeSelect:new di(["pickedColor"]),afterSelect:new di,beforeDestroy:new di,afterDestroy:new di}),(0,T.Z)((0,be.Z)(n),"models",[]),(0,T.Z)((0,be.Z)(n),"multiPassRenderer",void 0),(0,T.Z)((0,be.Z)(n),"plugins",void 0),(0,T.Z)((0,be.Z)(n),"sourceOption",void 0),(0,T.Z)((0,be.Z)(n),"layerModel",void 0),(0,T.Z)((0,be.Z)(n),"sceneContainer",void 0),(0,T.Z)((0,be.Z)(n),"layerChildren",[]),Rn((0,be.Z)(n),"configService",cg,(0,be.Z)(n)),Rn((0,be.Z)(n),"shaderModuleService",fg,(0,be.Z)(n)),(0,T.Z)((0,be.Z)(n),"cameraService",void 0),(0,T.Z)((0,be.Z)(n),"coordinateService",void 0),(0,T.Z)((0,be.Z)(n),"iconService",void 0),(0,T.Z)((0,be.Z)(n),"fontService",void 0),(0,T.Z)((0,be.Z)(n),"pickingService",void 0),(0,T.Z)((0,be.Z)(n),"rendererService",void 0),(0,T.Z)((0,be.Z)(n),"layerService",void 0),(0,T.Z)((0,be.Z)(n),"interactionService",void 0),(0,T.Z)((0,be.Z)(n),"mapService",void 0),(0,T.Z)((0,be.Z)(n),"styleAttributeService",void 0),(0,T.Z)((0,be.Z)(n),"layerSource",void 0),(0,T.Z)((0,be.Z)(n),"postProcessingPassFactory",void 0),(0,T.Z)((0,be.Z)(n),"normalPassFactory",void 0),(0,T.Z)((0,be.Z)(n),"animateOptions",{enable:!1}),(0,T.Z)((0,be.Z)(n),"container",void 0),(0,T.Z)((0,be.Z)(n),"encodedData",void 0),(0,T.Z)((0,be.Z)(n),"configSchema",void 0),(0,T.Z)((0,be.Z)(n),"currentPickId",null),(0,T.Z)((0,be.Z)(n),"rawConfig",void 0),(0,T.Z)((0,be.Z)(n),"needUpdateConfig",void 0),(0,T.Z)((0,be.Z)(n),"pendingStyleAttributes",[]),(0,T.Z)((0,be.Z)(n),"scaleOptions",{}),(0,T.Z)((0,be.Z)(n),"animateStartTime",void 0),(0,T.Z)((0,be.Z)(n),"aniamateStatus",!1),(0,T.Z)((0,be.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var u=n.getLayerConfig(),v=u.autoFit,y=u.fitBoundsOptions;v&&n.fitBounds(y),n.emit("dataUpdate"),n.reRender()}),n.name=o.name||n.id,n.zIndex=o.zIndex||0,n.rawConfig=o,n}return(0,Kt.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(o){if(!this.inited)this.needUpdateConfig=Nu(Nu({},this.needUpdateConfig),o);else{var u=this.container.get(qt.SceneID);eE(o,this),this.configService.setLayerConfig(u,this.id,Nu(Nu(Nu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),o)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(o,u){this.container=o,this.sceneContainer=u}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(o){return this.plugins.push(o),this}},{key:"init",value:function(){var o=this,u=this.container.get(qt.SceneID),v=this.rawConfig.enableMultiPassRenderer,y=v===void 0?!1:v;this.configService.setLayerConfig(u,this.id,{enableMultiPassRenderer:y}),this.iconService=this.container.get(qt.IIconService),this.fontService=this.container.get(qt.IFontService),this.rendererService=this.container.get(qt.IRendererService),this.layerService=this.container.get(qt.ILayerService),this.interactionService=this.container.get(qt.IInteractionService),this.pickingService=this.container.get(qt.IPickingService),this.mapService=this.container.get(qt.IMapService),this.cameraService=this.container.get(qt.ICameraService),this.coordinateService=this.container.get(qt.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(qt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(qt.IFactoryNormalPass),this.styleAttributeService=this.container.get(qt.IStyleAttributeService),this.multiPassRenderer=this.container.get(qt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(I){var D=I.attributeName,Z=I.attributeField,te=I.attributeValues,le=I.updateOptions;o.styleAttributeService.updateStyleAttribute(D,{scale:Nu({field:Z},o.splitValuesAndCallbackInAttribute(te,o.getLayerConfig()[D]))},le)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(qt.ILayerPlugin);var x=iE(this.plugins),E;try{for(x.s();!(E=x.n()).done;){var P=E.value;P.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(I){x.e(I)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Nu(Nu({},this.getDefaultConfig()),this.rawConfig));var o=this.getLayerConfig(),u=o.animateOption;u!=null&&u.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(o,u,v){return this.updateStyleAttribute("color",o,u,v),this}},{key:"texture",value:function(o,u,v){return this.updateStyleAttribute("texture",o,u,v),this}},{key:"rotate",value:function(o,u,v){return this.updateStyleAttribute("rotate",o,u,v),this}},{key:"size",value:function(o,u,v){return this.updateStyleAttribute("size",o,u,v),this}},{key:"filter",value:function(o,u,v){return this.updateStyleAttribute("filter",o,u,v),this}},{key:"shape",value:function(o,u,v){return this.updateStyleAttribute("shape",o,u,v),this}},{key:"label",value:function(o,u,v){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:o,attributeValues:u,updateOptions:v}),this}},{key:"animate",value:function(o){var u={};return Ec()(o)?(u.enable=!0,u=Nu(Nu({},u),o)):u.enable=o,this.updateLayerConfig({animateOption:u}),this}},{key:"source",value:function(o,u){return o!=null&&o.data?(this.setSource(o),this):(this.sourceOption={data:o,options:u},this)}},{key:"setData",value:function(o,u){var v=this;return this.inited?this.layerSource.setData(o,u):this.on("inited",function(){v.layerSource.setData(o,u)}),this}},{key:"style",value:function(o){var u=this,v=o.passes,y=(0,Yn.Z)(o,rE);return v&&qb(v).forEach(function(x){var E=u.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);E&&E.updateOptions(x[1])}),this.rawConfig=Nu(Nu({},this.rawConfig),y),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(o,u){return Ec()(o)?this.scaleOptions=Nu(Nu({},this.scaleOptions),o):this.scaleOptions[o]=u,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(o){var u={};return u.enableHighlight=Ec()(o)?!0:o,Ec()(o)?(u.enableHighlight=!0,o.color&&(u.highlightColor=o.color)):u.enableHighlight=!!o,this.updateLayerConfig(u),this}},{key:"setActive",value:function(o,u){var v=this;if(Ec()(o)){var y=o.x,x=y===void 0?0:y,E=o.y,P=E===void 0?0:E;this.updateLayerConfig({highlightColor:Ec()(u)?u.color:this.getLayerConfig().highlightColor}),this.pick({x,y:P})}else this.updateLayerConfig({pickedFeatureID:o,highlightColor:Ec()(u)?u.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call(Wu(o)).then(function(){setTimeout(function(){v.reRender()},1)})}},{key:"select",value:function(o){var u={};return u.enableSelect=Ec()(o)?!0:o,Ec()(o)?(u.enableSelect=!0,o.color&&(u.selectColor=o.color)):u.enableSelect=!!o,this.updateLayerConfig(u),this}},{key:"setSelect",value:function(o,u){var v=this;if(Ec()(o)){var y=o.x,x=y===void 0?0:y,E=o.y,P=E===void 0?0:E;this.updateLayerConfig({selectColor:Ec()(u)?u.color:this.getLayerConfig().selectColor}),this.pick({x,y:P})}else this.updateLayerConfig({pickedFeatureID:o,selectColor:Ec()(u)?u.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call(Wu(o)).then(function(){setTimeout(function(){v.reRender()},1)})}},{key:"setBlend",value:function(o){this.updateLayerConfig({blend:o}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(o){return this.zIndex=o,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(o){this.currentPickId=o}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(o){this.selectedFeatureID=o}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var o=this.mapService.getZoom(),u=this.getLayerConfig(),v=u.visible,y=u.minZoom,x=y===void 0?-Infinity:y,E=u.maxZoom,P=E===void 0?Infinity:E;return!!v&&o>=x&&o<=P}},{key:"setMinZoom",value:function(o){return this.updateLayerConfig({minZoom:o}),this}},{key:"getMinZoom",value:function(){var o=this.getLayerConfig(),u=o.minZoom;return u}},{key:"getMaxZoom",value:function(){var o=this.getLayerConfig(),u=o.maxZoom;return u}},{key:"get",value:function(o){var u=this.getLayerConfig();return u[o]}},{key:"setMaxZoom",value:function(o){return this.updateLayerConfig({maxZoom:o}),this}},{key:"fitBounds",value:function(o){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var u=this.getSource(),v=u.extent,y=v.some(function(x){return Math.abs(x)===Infinity});return y?this:(this.mapService.fitBounds([[v[0],v[1]],[v[2],v[3]]],o),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(o){return o.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(o){return o.needRescale||o.needRemapping||o.needRegenerateVertices}).length}},{key:"setSource",value:function(o){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=o,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(o){this.encodedData=o}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(o){var u=this.styleAttributeService.getLayerAttributeScale(o);if(u){if(u.ticks){var v=u.ticks().map(function(x){return(0,T.Z)({value:x},o,u(x))});return v}else if(u.invertExtent){var y=u.range().map(function(x){return(0,T.Z)({value:u.invertExtent(x)},o,x)});return y}}else return[]}},{key:"pick",value:function(o){var u=o.x,v=o.y;this.interactionService.triggerHover({x:u,y:v})}},{key:"boxSelect",value:function(o,u){this.pickingService.boxPickLayer(this,o,u)}},{key:"buildLayerModel",value:function(o){var u=o.moduleName,v=o.vertexShader,y=o.fragmentShader,x=o.triangulation,E=o.segmentNumber,P=(0,Yn.Z)(o,nE);this.shaderModuleService.registerModule(u,{vs:v,fs:y});var I=this.shaderModuleService.getModule(u),D=I.vs,Z=I.fs,te=I.uniforms,le=this.rendererService.createModel,ve=this.styleAttributeService.createAttributesAndIndices(this.encodedData,x,E),Be=ve.attributes,it=ve.elements;return le(Nu({attributes:Be,uniforms:te,fs:Z,vs:D,elements:it,blend:og[$c.normal]},P))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(o){var u=this.getLayerConfig(),v=u.enableHighlight,y=v===void 0?!0:v,x=u.enableSelect,E=x===void 0?!0:x,P=this.eventNames().indexOf(o)!==-1||this.eventNames().indexOf("un"+o)!==-1;return(o==="click"||o==="dblclick")&&E&&(P=!0),o==="mousemove"&&(y||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(P=!0),this.isVisible()&&P}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var o=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(u){u.draw({uniforms:o.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(o,u,v,y){this.inited?this.styleAttributeService.updateStyleAttribute(o,{scale:Nu({field:u},this.splitValuesAndCallbackInAttribute(v,this.getLayerConfig()[u]))},y):this.pendingStyleAttributes.push({attributeName:o,attributeField:u,attributeValues:v,updateOptions:y})}},{key:"setEarthTime",value:function(o){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(o,u){return{values:Ho()(o)?void 0:o||u,callback:Ho()(o)?o:void 0}}}]),r}(Ea.EventEmitter),cg=Fn(Lv.prototype,"configService",[ug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fg=Fn(Lv.prototype,"shaderModuleService",[lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lv),uE=L(18446),Wd=L.n(uE),vg,mg,kv,gg,yg;function lE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=cE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function cE(e,i){if(!!e){if(typeof e=="string")return _g(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _g(e,i)}}function _g(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Gs=(vg=Vd(qt.IGlobalConfigService),mg=Vd(qt.IShaderModuleService),kv=function(){function e(i){(0,St.Z)(this,e),(0,T.Z)(this,"triangulation",void 0),(0,T.Z)(this,"createTexture2D",void 0),(0,T.Z)(this,"layer",void 0),(0,T.Z)(this,"dataTexture",void 0),(0,T.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,T.Z)(this,"rowCount",void 0),(0,T.Z)(this,"cacheStyleProperties",void 0),(0,T.Z)(this,"cellLength",void 0),(0,T.Z)(this,"cellProperties",void 0),(0,T.Z)(this,"cellTypeLayout",void 0),(0,T.Z)(this,"stylePropertyesExist",void 0),(0,T.Z)(this,"dataTextureTest",void 0),Rn(this,"configService",gg,this),Rn(this,"shaderModuleService",yg,this),(0,T.Z)(this,"rendererService",void 0),(0,T.Z)(this,"iconService",void 0),(0,T.Z)(this,"fontService",void 0),(0,T.Z)(this,"styleAttributeService",void 0),(0,T.Z)(this,"mapService",void 0),(0,T.Z)(this,"cameraService",void 0),(0,T.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(qt.IRendererService),this.styleAttributeService=i.getContainer().get(qt.IStyleAttributeService),this.mapService=i.getContainer().get(qt.IMapService),this.iconService=i.getContainer().get(qt.IIconService),this.fontService=i.getContainer().get(qt.IFontService),this.cameraService=i.getContainer().get(qt.ICameraService),this.layerService=i.getContainer().get(qt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8ClampedArray(4),mag:d.NEAREST,min:d.NEAREST,width:1,height:1}))}return(0,Kt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return Wd()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),Wd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),Wd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),Wd()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),Wd()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!go()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!go()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!go()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(r){return zs()(r)?!!(0,No.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=Fa(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Cp()(r)&&r.length===2&&go()(r[0])&&go()(r[1]))}},{key:"patchMod",value:function(r,n){for(var o=0;o<n;o++)r.push(-1)}},{key:"patchData",value:function(r,n,o){var u=lE(o),v;try{for(u.s();!(v=u.n()).done;){var y=v.value,x=y.attr,E=y.count,P=n[x];P?x==="stroke"?r.push.apply(r,(0,we.Z)(Fa(P))):x==="offsets"?this.isOffsetStatic(P)?r.push(-P[0],P[1]):r.push(0,0):r.push(go()(P)?P:1):this.patchMod(r,E)}}catch(I){u.e(I)}finally{u.f()}}},{key:"calDataFrame",value:function(r,n,o){for(var u=n.length,v=Math.ceil(u*r/this.DATA_TEXTURE_WIDTH),y=v*this.DATA_TEXTURE_WIDTH,x=[],E=0;E<u;E++){var P=n[E];this.patchData(x,P,o)}for(var I=x.length;I<y;I++)x.push(-1);return{data:x,width:this.DATA_TEXTURE_WIDTH,height:v}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,o=n===void 0?"normal":n;return og[$c[o]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),gg=Fn(kv.prototype,"configService",[vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yg=Fn(kv.prototype,"shaderModuleService",[mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kv),fE=L(9187),Hh=L.n(fE),xg=100,nP=36,iP=40;function bg(e){return e/180*Math.acos(-1)}function Eg(e){var i=bg(e[0])+Math.PI/2,r=bg(e[1]),n=xg+Math.random()*.4,o=n*Math.cos(r)*Math.cos(i),u=n*Math.cos(r)*Math.sin(i),v=n*Math.sin(r);return[u,v,o]}function aP(e,i){var r=mat4.create(),n=mat4.create(),o=vec3.fromValues(0,1,0),u=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var v=typeof i.segments!="undefined"?i.segments:32,y=2+v,x=2*y,E=[],P=[],I=[],D=[],Z=[],te=[],le=0;le<=y;le++){for(var ve=le/y,Be=ve*Math.PI,it=0;it<=x;it++){var yt=it/x,wt=yt*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Be),mat4.identity(r),mat4.rotateY(r,r,wt),vec3.transformMat4(u,o,n),vec3.transformMat4(u,u,r),vec3.scale(u,u,-e),I.push(u.slice()),D.push.apply(D,_toConsumableArray(u.slice())),vec3.normalize(u,u),Z.push.apply(Z,_toConsumableArray(u.slice())),te.push([yt,1-ve]),D.push(yt,1-ve)}if(le>0)for(var jt=I.length,Wt=jt-2*(x+1);Wt+x+2<jt;Wt++)E.push([Wt,Wt+1,Wt+x+1]),P.push(Wt,Wt+1,Wt+x+1),E.push([Wt+x+1,Wt+1,Wt+x+2]),P.push(Wt+x+1,Wt+1,Wt+x+2)}return{cells:E,positions:I,uvs:te,positionsArr:D,indicesArr:P,normalArr:Z}}var Bi=L(31437),Dv=Bi.Ue(),oP=Bi.Ue(),Bu=Bi.Ue(),ud=Bi.Ue(),Fv=Bi.Ue();function Sg(e,i,r,n,o){Bi.IH(e,r,n),Bi.Fv(e,e),i=Bi.al(-e[1],e[0]);var u=Bi.al(-r[1],r[0]);return[o/Bi.AK(i,u),i]}function ld(e,i){return Bi.t8(e,-i[1],i[0])}function Nv(e,i,r){return Bi.lu(e,i,r),Bi.Fv(e,e),e}function wg(e,i){return e[0]===i[0]&&e[1]===i[1]}function sP(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var hE=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,St.Z)(this,e),(0,T.Z)(this,"complex",void 0),(0,T.Z)(this,"join",void 0),(0,T.Z)(this,"cap",void 0),(0,T.Z)(this,"miterLimit",void 0),(0,T.Z)(this,"thickness",void 0),(0,T.Z)(this,"normal",void 0),(0,T.Z)(this,"lastFlip",-1),(0,T.Z)(this,"miter",Bi.al(0,0)),(0,T.Z)(this,"started",!1),(0,T.Z)(this,"dash",!1),(0,T.Z)(this,"totalDistance",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,Kt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var o=this.complex;if(r.length<=1)return o;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var u=r.length,v=o.startIndex,y=1;y<u;y++){var x=r[y-1],E=n[y-1],P=r[y],I=n[y],D=y<r.length-1?r[y+1]:null,Z=y<n.length-1?n[y+1]:null,te=this.segment_gaode2(o,v,x,P,D,E,I,Z);v+=te}if(this.dash)for(var le=0;le<o.positions.length/6;le++)o.positions[le*6+5]=this.totalDistance;return o.startIndex=o.positions.length/6,o}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=n.startIndex,v=1;v<o;v++){var y=r[v-1],x=r[v],E=v<r.length-1?r[v+1]:null,P=this.segment(n,u,y,x,E);u+=P}if(this.dash)for(var I=0;I<n.positions.length/6;I++)n.positions[I*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,o,u,v,y,x,E){var P=0,I=r.indices,D=r.positions,Z=r.normals,te=this.cap==="square",le=this.join==="bevel",ve=Bs([x[0],x[1]]),Be=Bs([y[0],y[1]]);Nv(Bu,u,o);var it=0;if(this.dash&&(it=this.lineSegmentDistance(ve,Be),this.totalDistance+=it),this.normal||(this.normal=Bi.Ue(),ld(this.normal,Bu)),!this.started)if(this.started=!0,te){var yt=Bi.Ue(),wt=Bi.Ue();Bi.IH(yt,this.normal,Bu),Bi.IH(wt,this.normal,Bu),Z.push(wt[0],wt[1],0),Z.push(yt[0],yt[1],0),D.push(o[0],o[1],0,this.totalDistance-it,-this.thickness,0),D.push(o[0],o[1],0,this.totalDistance-it,this.thickness,0)}else this.extrusions(D,Z,o,this.normal,this.thickness,this.totalDistance-it);if(I.push(n+0,n+1,n+2),v){wg(u,v)&&Bi.IH(v,u,Bi.Fv(v,Bi.$X(v,u,o))),Nv(ud,v,u);var nr=Sg(Fv,Bi.Ue(),Bu,ud,this.thickness),mr=(0,Pn.Z)(nr,2),tn=mr[0],vn=mr[1],Pr=Bi.AK(Fv,this.normal)<0?-1:1,In=le;if(!In&&this.join==="miter"){var Gn=tn;Gn>this.miterLimit&&(In=!0)}In?(Z.push(this.normal[0],this.normal[1],0),Z.push(vn[0],vn[1],0),D.push(u[0],u[1],0,this.totalDistance,-this.thickness*Pr,0),D.push(u[0],u[1],0,this.totalDistance,this.thickness*Pr,0),I.push.apply(I,(0,we.Z)(this.lastFlip!==-Pr?[n,n+2,n+3]:[n+2,n+1,n+3])),I.push(n+2,n+3,n+4),ld(Dv,ud),Bi.JG(this.normal,Dv),Z.push(this.normal[0],this.normal[1],0),D.push(u[0],u[1],0,this.totalDistance,-this.thickness*Pr,0),P+=3):(this.extrusions(D,Z,u,vn,tn,this.totalDistance),I.push.apply(I,(0,we.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Pr=-1,Bi.JG(this.normal,vn),P+=2),this.lastFlip=Pr}else{if(ld(this.normal,Bu),te){var jt=Bi.Ue(),Wt=Bi.Ue();Bi.lu(Wt,Bu,this.normal),Bi.IH(jt,Bu,this.normal),Z.push(Wt[0],Wt[1],0),Z.push(jt[0],jt[1],0),D.push(u[0],u[1],0,this.totalDistance,this.thickness,0),D.push(u[0],u[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(D,Z,u,this.normal,this.thickness,this.totalDistance);I.push.apply(I,(0,we.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),P+=2}return P}},{key:"segment",value:function(r,n,o,u,v){var y=0,x=r.indices,E=r.positions,P=r.normals,I=this.cap==="square",D=this.join==="bevel",Z=Bs([u[0],u[1]]),te=Bs([o[0],o[1]]);Nv(Bu,Z,te);var le=0;if(this.dash&&(le=this.lineSegmentDistance(Z,te),this.totalDistance+=le),this.normal||(this.normal=Bi.Ue(),ld(this.normal,Bu)),!this.started)if(this.started=!0,I){var ve=Bi.Ue(),Be=Bi.Ue();Bi.IH(ve,this.normal,Bu),Bi.IH(Be,this.normal,Bu),P.push(Be[0],Be[1],0),P.push(ve[0],ve[1],0),E.push(o[0],o[1],0,this.totalDistance-le,-this.thickness,0),E.push(o[0],o[1],0,this.totalDistance-le,this.thickness,0)}else this.extrusions(E,P,o,this.normal,this.thickness,this.totalDistance-le);if(x.push(n+0,n+1,n+2),v){var wt=Bs([v[0],v[1]]);wg(Z,wt)&&Bi.IH(wt,Z,Bi.Fv(wt,Bi.$X(wt,Z,te))),Nv(ud,wt,Z);var jt=Sg(Fv,Bi.Ue(),Bu,ud,this.thickness),Wt=(0,Pn.Z)(jt,2),nr=Wt[0],mr=Wt[1],tn=Bi.AK(Fv,this.normal)<0?-1:1,vn=D;if(!vn&&this.join==="miter"){var Pr=nr;Pr>this.miterLimit&&(vn=!0)}vn?(P.push(this.normal[0],this.normal[1],0),P.push(mr[0],mr[1],0),E.push(u[0],u[1],0,this.totalDistance,-this.thickness*tn,0),E.push(u[0],u[1],0,this.totalDistance,this.thickness*tn,0),x.push.apply(x,(0,we.Z)(this.lastFlip!==-tn?[n,n+2,n+3]:[n+2,n+1,n+3])),x.push(n+2,n+3,n+4),ld(Dv,ud),Bi.JG(this.normal,Dv),P.push(this.normal[0],this.normal[1],0),E.push(u[0],u[1],0,this.totalDistance,-this.thickness*tn,0),y+=3):(this.extrusions(E,P,u,mr,nr,this.totalDistance),x.push.apply(x,(0,we.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),tn=-1,Bi.JG(this.normal,mr),y+=2),this.lastFlip=tn}else{if(ld(this.normal,Bu),I){var it=Bi.Ue(),yt=Bi.Ue();Bi.lu(yt,Bu,this.normal),Bi.IH(it,Bu,this.normal),P.push(yt[0],yt[1],0),P.push(it[0],it[1],0),E.push(u[0],u[1],0,this.totalDistance,this.thickness,0),E.push(u[0],u[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(E,P,u,this.normal,this.thickness,this.totalDistance);x.push.apply(x,(0,we.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),y+=2}return y}},{key:"extrusions",value:function(r,n,o,u,v,y){n.push(u[0],u[1],0),n.push(u[0],u[1],0),r.push(o[0],o[1],0,y,-v,0),r.push(o[0],o[1],0,y,v,0)}},{key:"lineSegmentDistance",value:function(r,n){var o=n[0]-r[0],u=n[1]-r[1];return Math.sqrt(o*o+u*u)}}]),e}();function Pp(e){if(go()(e[0]))return e;if(go()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(go()(e[0][0][0])){var i=e,r=0,n=0,o=0;return i.forEach(function(u){u.forEach(function(v){r+=v[0],n+=v[1],o++})}),[r/o,n/o,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var Ha=L(77160);function pE(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,o=Hh().flatten(e),u=o.vertices,v=o.dimensions,y=[],x=[],E=0;E<u.length/v;E++)v===2?y.push(u[E*2],u[E*2+1],1):y.push(u[E*3],u[E*3+1],1);var P=Hh()(o.vertices,o.holes,o.dimensions);x.push.apply(x,(0,we.Z)(P));for(var I=function(te){var le=o.vertices.slice(te*v,(te+1)*v),ve=o.vertices.slice((te+1)*v,(te+2)*v);ve.length===0&&(ve=o.vertices.slice(0,v));var Be=y.length/3;y.push(le[0],le[1],1,ve[0],ve[1],1,le[0],le[1],0,ve[0],ve[1],0),x.push.apply(x,(0,we.Z)([0,2,1,2,3,1].map(function(it){return it+Be})))},D=0;D<n;D++)I(D);return{positions:y,index:x}}function dE(e){var i=Hh().flatten(e),r=Hh()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function Tg(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var o=e[0].length,u=Hh().flatten(e),v=u.vertices,y=u.dimensions,x=[],E=[],P=[],I=0;I<v.length/y;I++)y===2?x.push(v[I*2],v[I*2+1],1,-1,-1):x.push(v[I*3],v[I*3+1],1,-1,-1),P.push(0,0,1);var D=Hh()(u.vertices,u.holes,u.dimensions);E.push.apply(E,(0,we.Z)(D));for(var Z=function(ve){var Be=u.vertices.slice(ve*y,(ve+1)*y),it=u.vertices.slice((ve+1)*y,(ve+2)*y);it.length===0&&(it=u.vertices.slice(0,y));var yt=x.length/5;x.push(Be[0],Be[1],1,0,0,it[0],it[1],1,.1,0,Be[0],Be[1],0,0,.8,it[0],it[1],0,.1,.8);var wt=vE([it[0],it[1],1],[Be[0],Be[1],0],[Be[0],Be[1],1],i);P.push.apply(P,(0,we.Z)(wt).concat((0,we.Z)(wt),(0,we.Z)(wt),(0,we.Z)(wt))),E.push.apply(E,(0,we.Z)([1,2,0,3,2,1].map(function(jt){return jt+yt})))},te=0;te<o;te++)Z(te);return{positions:x,index:E,normals:P}}function vE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=Ha.create(),u=Ha.create(),v=Ha.create();n&&(e=wi(e),i=wi(i),r=wi(r));var y=Ha.fromValues.apply(Ha,(0,we.Z)(e)),x=Ha.fromValues.apply(Ha,(0,we.Z)(i)),E=Ha.fromValues.apply(Ha,(0,we.Z)(r));Ha.sub(o,E,x),Ha.sub(u,y,x),Ha.cross(v,o,u);var P=Ha.create();return Ha.normalize(P,v),P}var Sc,Ip;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Ip||(Ip={}));var Op;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Op||(Op={}));function Xd(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],o=0;o<e;o++)n.push(r*o+i*Math.PI/12);var u=n.map(function(v){var y=Math.sin(v+Math.PI/4),x=Math.cos(v+Math.PI/4);return[y,x,0]});return u}function Ag(){return Xd(30)}function Cg(){return Xd(4)}function Mg(){return Xd(3)}function Pg(){return Xd(6,1)}function Ig(){return Xd(5)}var cd=(Sc={},(0,T.Z)(Sc,Op.CIRCLE,Ag),(0,T.Z)(Sc,Op.HEXAGON,Pg),(0,T.Z)(Sc,Op.TRIANGLE,Mg),(0,T.Z)(Sc,Op.SQUARE,Cg),(0,T.Z)(Sc,Op.PENTAGON,Ig),(0,T.Z)(Sc,Ip.CYLINDER,Ag),(0,T.Z)(Sc,Ip.HEXAGONCOLUMN,Pg),(0,T.Z)(Sc,Ip.TRIANGLECOLUMN,Mg),(0,T.Z)(Sc,Ip.SQUARECOLUMN,Cg),(0,T.Z)(Sc,Ip.PENTAGONCOLUMN,Ig),Sc),Bv={};function Og(e){var i=Pp(e.coordinates);return{vertices:[].concat((0,we.Z)(i),(0,we.Z)(i),(0,we.Z)(i),(0,we.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function mE(e){var i=Pp(e.coordinates),r=Eg(i);return{vertices:[].concat((0,we.Z)(r),(0,we.Z)(r),(0,we.Z)(r),(0,we.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Rg(e){var i=e.shape,r=xE(i,!1),n=r.positions,o=r.index,u=r.normals;return{vertices:n,indices:o,normals:u,size:5}}function Lg(e){var i=Pp(e.coordinates);return{vertices:(0,we.Z)(i),indices:[0],size:i.length}}function gE(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,o=new hE({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var u=i;Array.isArray(u[0][0])||(u=[i]);var v=r;Array.isArray(v[0][0])||(v=[r]);for(var y=0;y<u.length;y++){var x=u[y],E=v[y];o.extrude_gaode2(x,E)}}else{var P=i;Array.isArray(P[0][0])||(P=[i]),P.forEach(function(D){o.extrude(D)})}var I=o.complex;return{vertices:I.positions,indices:I.indices,normals:I.normals,size:6}}function yE(e){var i=e.coordinates,r=Hh().flatten(i),n=r.vertices,o=r.dimensions,u=r.holes;return{indices:Hh()(n,u,o),vertices:n,size:o}}function kg(e){var i=e.coordinates,r=Tg(i,!0),n=r.positions,o=r.index,u=r.normals;return{vertices:n,indices:o,normals:u,size:5}}function Dg(e){var i=e.shape,r=EE(i),n=r.positions,o=r.index;return{vertices:n,indices:o,size:3}}function Fg(e){var i=e.coordinates,r=[].concat((0,we.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,we.Z)(i[1]),[0,1,0],(0,we.Z)(i[0]),[0,0,1],(0,we.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function zv(e,i){for(var r=i||30,n=e.coordinates,o=[],u=[],v=function(E){o.push(E,1,E,n[0][0],n[0][1],n[1][0],n[1][1],E,-1,E,n[0][0],n[0][1],n[1][0],n[1][1]),E!==r-1&&u.push.apply(u,(0,we.Z)([0,1,2,1,3,2].map(function(P){return E*2+P})))},y=0;y<r;y++)v(y);return{vertices:o,indices:u,size:7}}function _E(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=Uv(-1,1),o=Uv(1,1),u=Uv(-1,-1),v=Uv(1,-1),y=[].concat((0,we.Z)(i),(0,we.Z)(n),(0,we.Z)(i),(0,we.Z)(u),(0,we.Z)(i),(0,we.Z)(v),(0,we.Z)(i),(0,we.Z)(o)),x=[0,1,2,3,0,2];return{vertices:y,indices:x,size:5}}function xE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Bv&&Bv[e])return Bv[e];var r=cd[e]?cd[e]():cd.cylinder(),n=Tg([r],i);return Bv[e]=n,n}function uP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=new Float32Array(e.length/r*3),u,v,y,x=vec3.create(),E=vec3.create(),P=vec3.create(),I=0,D=i.length;I<D;I+=3){u=i[I+0]*3,v=i[I+1]*3,y=i[I+2]*3;var Z=[e[u],e[u+1]],te=[e[v],e[v+1]],le=[e[y],e[y+1]];n&&(Z=lngLatToMeters(Z),te=lngLatToMeters(te),le=lngLatToMeters(le));var ve=Z,Be=_slicedToArray(ve,2),it=Be[0],yt=Be[1],wt=vec3.fromValues(it,yt,e[u+2]),jt=te,Wt=_slicedToArray(jt,2),nr=Wt[0],mr=Wt[1],tn=vec3.fromValues(nr,mr,e[v+2]),vn=le,Pr=_slicedToArray(vn,2),In=Pr[0],Gn=Pr[1],yi=vec3.fromValues(In,Gn,e[y+2]);vec3.sub(x,yi,tn),vec3.sub(E,wt,tn),vec3.cross(P,x,E),o[u]+=x[0],o[u+1]+=x[1],o[u+2]+=x[2],o[v]+=x[0],o[v+1]+=x[1],o[v+2]+=x[2],o[y]+=x[0],o[y+1]+=x[1],o[y+2]+=x[2]}return bE(o),o}function bE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),o=vec3.create();vec3.normalize(o,n),e.set(o,i)}}function lP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function EE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=cd[e]?cd[e]():cd.circle(),n=i.indexOf(e)===-1?dE([r]):pE([r]);return n}function Uv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function cP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function fP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function SE(e){var i=wE();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function wE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,AE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,CE=function(e){(0,Wr.Z)(r,e);var i=SE(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u,y=o.baseColor,x=y===void 0?"rgb(16,16,16)":y,E=o.brightColor,P=E===void 0?"rgb(255,176,38)":E,I=o.windowColor,D=I===void 0?"rgb(30,60,89)":I,Z=o.time,te=Z===void 0?0:Z;return{u_opacity:v,u_baseColor:Fa(x),u_brightColor:Fa(P),u_windowColor:Fa(D),u_time:this.layer.getLayerAnimateTime()||te}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:AE,fragmentShader:TE,triangulation:kg})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ii.Attribute,descriptor:{name:"a_Normal",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:3,update:function(u,v,y,x,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(u,v,y,x){var E=u.size,P=E===void 0?10:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ii.Attribute,descriptor:{name:"a_Uv",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(u,v,y,x){var E=u.size;return[y[3],y[4]]}}})}}]),r}(Gs);function ME(e){var i=PE();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function PE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IE=function(e){(0,Wr.Z)(r,e);var i=ME(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"type","PolygonLayer"),n}return(0,Kt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new CE(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(o){this.updateLayerConfig({time:o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Mp);function OE(e){var i=RE();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function RE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,kE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,DE=function(e){(0,Wr.Z)(r,e);var i=OE(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.coverage,y=o.angle;return{u_opacity:u||1,u_coverage:v||.9,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:LE,fragmentShader:kE,triangulation:Dg,depth:{enable:!1},primitive:d.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ii.Attribute,descriptor:{name:"a_Pos",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:3,update:function(u,v){var y=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[y[0],y[1],0]}}})}}]),r}(Gs);function FE(e){var i=NE();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function NE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,zE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,UE=function(e){(0,Wr.Z)(r,e);var i=FE(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.coverage,y=o.angle;return{u_opacity:u||1,u_coverage:v||1,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:BE,fragmentShader:zE,triangulation:Rg,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(u,v,y,x){var E=u.size;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ii.Attribute,descriptor:{name:"a_Normal",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:3,update:function(u,v,y,x,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ii.Attribute,descriptor:{name:"a_Pos",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:3,update:function(u,v){var y=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[y[0],y[1],0]}}})}}]),r}(Gs);function ZE(e,i){for(var r=[],n=[],o=[],u=e+1,v=i+1,y=e/2,x=i/2,E=0;E<v;E++)for(var P=E-x,I=0;I<u;I++){var D=I-y;n.push(D/y,-P/x,0),o.push(I/e),o.push(1-E/i)}for(var Z=0;Z<i;Z++)for(var te=0;te<e;te++){var le=te+u*Z,ve=te+u*(Z+1),Be=te+1+u*(Z+1),it=te+1+u*Z;r.push(le,ve,it),r.push(ve,Be,it)}return{vertices:n,indices:r,uvs:o}}var Ng,Bg;function zg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Ug(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zg(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VE(e){var i=jE();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function jE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GE=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,HE=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,WE=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,XE=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,YE=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,KE=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Zg=(Ng=(0,Lr.b2)(),Ng(Bg=function(e){(0,Wr.Z)(r,e);var i=VE(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"texture",void 0),(0,T.Z)((0,be.Z)(n),"colorTexture",void 0),(0,T.Z)((0,be.Z)(n),"heatmapFramerBuffer",void 0),(0,T.Z)((0,be.Z)(n),"intensityModel",void 0),(0,T.Z)((0,be.Z)(n),"colorModel",void 0),(0,T.Z)((0,be.Z)(n),"shapeType",void 0),n}return(0,Kt.Z)(r,[{key:"render",value:function(){var o=this,u=this.rendererService,v=u.clear,y=u.useFramebuffer;y(this.heatmapFramerBuffer,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var o,u=this.rendererService,v=u.createFramebuffer,y=u.clear,x=u.getViewportSize,E=u.createTexture2D,P=u.useFramebuffer,I=this.styleAttributeService.getLayerStyleAttribute("shape"),D=(I==null||(o=I.scale)===null||o===void 0?void 0:o.field)||"heatmap";this.shapeType=D,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=D==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Z=x(),te=Z.width,le=Z.height;return this.heatmapFramerBuffer=v({color:E({width:Math.floor(te/4),height:Math.floor(le/4),wrapS:d.CLAMP_TO_EDGE,wrapT:d.CLAMP_TO_EDGE,min:d.LINEAR,mag:d.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Ii.Attribute,descriptor:{name:"a_Dir",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(u,v,y,x){return[y[3],y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(u,v,y,x){var E=u.size,P=E===void 0?1:E;return[P]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:YE,fragmentShader:XE,triangulation:_E,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:d.ONE,srcAlpha:1,dstRGB:d.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:KE,fs:WE});var o=this.shaderModuleService.getModule("heatmapColor"),u=o.vs,v=o.fs,y=o.uniforms,x=this.rendererService,E=x.createAttribute,P=x.createElements,I=x.createBuffer,D=x.createModel;return D({vs:u,fs:v,attributes:{a_Position:E({buffer:I({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:d.FLOAT}),size:3}),a_Uv:E({buffer:I({data:[0,1,1,1,0,0,1,0],type:d.FLOAT}),size:2})},uniforms:Ug({},y),depth:{enable:!1},blend:this.getBlend(),count:6,elements:P({data:[0,2,1,2,3,1],type:d.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.intensity,y=v===void 0?10:v,x=o.radius,E=x===void 0?5:x;this.intensityModel.draw({uniforms:{u_opacity:u||1,u_radius:E,u_intensity:y}})}},{key:"drawColorMode",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;this.colorModel.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=_u();Ju(v,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,we.Z)(v)}})}},{key:"build3dHeatMap",value:function(){var o=this.rendererService.getViewportSize,u=o(),v=u.width,y=u.height,x=ZE(v/4,y/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:HE,fs:GE});var E=this.shaderModuleService.getModule("heatmap3dColor"),P=E.vs,I=E.fs,D=E.uniforms,Z=this.rendererService,te=Z.createAttribute,le=Z.createElements,ve=Z.createBuffer,Be=Z.createModel;return Be({vs:P,fs:I,attributes:{a_Position:te({buffer:ve({data:x.vertices,type:d.FLOAT}),size:3}),a_Uv:te({buffer:ve({data:x.uvs,type:d.FLOAT}),size:2})},primitive:d.TRIANGLES,uniforms:Ug({},D),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:d.SRC_ALPHA,srcAlpha:1,dstRGB:d.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:le({data:x.indices,type:d.UNSIGNED_INT,count:x.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var o=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var u=this.layer.getLayerConfig(),v=u.rampColors,y=oa(v);this.colorTexture=o({data:new Uint8Array(y.data),width:y.width,height:y.height,wrapS:d.CLAMP_TO_EDGE,wrapT:d.CLAMP_TO_EDGE,min:d.NEAREST,mag:d.NEAREST,flipY:!1})}}]),r}(Gs))||Bg);function qE(e){var i=$E();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function $E(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,QE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,e2=function(e){(0,Wr.Z)(r,e);var i=qE(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.coverage,y=o.angle;return{u_opacity:u||1,u_coverage:v||.9,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:QE,fragmentShader:JE,triangulation:Dg,depth:{enable:!1},primitive:d.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ii.Attribute,descriptor:{name:"a_Pos",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:3,update:function(u,v){var y=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[y[0],y[1],0]}}})}}]),r}(Gs),t2={heatmap:Zg,heatmap3d:Zg,grid:DE,grid3d:UE,hexagon:e2},r2=t2;function n2(e){var i=i2();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function i2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a2=function(e){(0,Wr.Z)(r,e);var i=n2(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"type","HeatMapLayer"),n}return(0,Kt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new r2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var o=this,u=this.getModelType();return u==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(v){return v.draw({uniforms:o.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),v=this.getLayerConfig(),y=v.shape3d,x=this.getSource(),E=x.data.type,P=(u==null||(o=u.scale)===null||o===void 0?void 0:o.field)||"heatmap";return P==="heatmap"||P==="heatmap3d"?"heatmap":E==="hexagon"?(y==null?void 0:y.indexOf(P))===-1?"hexagon":"grid3d":E==="grid"?(y==null?void 0:y.indexOf(P))===-1?"grid":"grid3d":"heatmap"}}]),r}(Mp);function o2(e){var i=s2();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function s2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var u2=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,l2=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,c2=function(e){(0,Wr.Z)(r,e);var i=o2(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"texture",void 0),n}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;return{u_opacity:u||1,u_texture:this.texture}}},{key:"initModels",value:function(){var o=this,u=this.layer.getSource(),v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),$i){var y=this.layerService.sceneService.getSceneConfig().canvas,x=y.createImage();x.crossOrigin="anonymous",x.src=u.data.originData,x.onload=function(){o.texture=v({data:x,width:x.width,height:x.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else u.data.images.then(function(E){o.texture=v({data:E[0],width:E[0].width,height:E[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:l2,fragmentShader:u2,triangulation:Fg,primitive:d.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ii.Attribute,descriptor:{name:"a_Uv",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(u,v,y,x){return[y[3],y[4]]}}})}}]),r}(Gs),f2={image:c2},h2=f2;function p2(e){var i=d2();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function d2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v2=function(e){(0,Wr.Z)(r,e);var i=p2(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"type","ImageLayer"),n}return(0,Kt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new h2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={image:{}};return u[o]}},{key:"getModelType",value:function(){return"image"}}]),r}(Mp);function m2(e){var i=g2();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function g2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float d_texCount = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = 1.0 - fract(arcRadio * d_texCount + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,_2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,x2={solid:0,dash:1},b2=function(e){(0,Wr.Z)(r,e);var i=m2(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"texture",void 0),(0,T.Z)((0,be.Z)(n),"updateTexture",function(){var y=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=y({data:n.iconService.getCanvas(),mag:d.NEAREST,min:d.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.sourceColor,y=o.targetColor,x=o.textureBlend,E=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,D=o.dashArray,Z=D===void 0?[10,5]:D,te=o.forward,le=te===void 0?!0:te,ve=o.lineTexture,Be=ve===void 0?!1:ve,it=o.iconStep,yt=it===void 0?100:it,wt=o.segmentNumber,jt=wt===void 0?30:wt,Wt=o.thetaOffset,nr=Wt===void 0?.314:Wt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var mr=this.layer.getEncodedData(),tn=this.calDataFrame(this.cellLength,mr,this.cellProperties),vn=tn.data,Pr=tn.width,In=tn.height;this.rowCount=In,this.dataTexture=this.cellLength>0&&vn.length>0?this.createTexture2D({flipY:!0,data:vn,format:d.LUMINANCE,type:d.FLOAT,width:Pr,height:In}):this.createTexture2D({flipY:!0,data:[1],format:d.LUMINANCE,type:d.FLOAT,width:1,height:1})}Z.length===2&&Z.push(0,0);var Gn=0,yi=[0,0,0,0],Lo=[0,0,0,0];return v&&y&&(yi=Fa(v),Lo=Fa(y),Gn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:nr,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:go()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:jt,u_line_type:x2[I||"solid"],u_dash_array:Z,u_blur:.9,u_lineDir:le?1:-1,u_texture:this.texture,u_line_texture:Be?1:0,u_icon_step:yt,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Gn,u_sourceColor:yi,u_targetColor:Lo}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,v=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:_2,fragmentShader:y2,triangulation:zv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:v})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(v,y,x,E){var P=v.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ii.Attribute,descriptor:{name:"a_Instance",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:4,update:function(v,y,x,E){return[x[3],x[4],x[5],x[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ii.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(v,y,x,E){var P=o.iconService.getIconMap(),I=v.texture,D=P[I]||{x:0,y:0},Z=D.x,te=D.y;return[Z,te]}}})}}]),r}(Gs);function E2(e){var i=S2();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function S2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,T2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,A2={solid:0,dash:1},C2=function(e){(0,Wr.Z)(r,e);var i=E2(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"texture",void 0),(0,T.Z)((0,be.Z)(n),"updateTexture",function(){var y=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=y({data:n.iconService.getCanvas(),mag:d.NEAREST,min:d.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.sourceColor,y=o.targetColor,x=o.textureBlend,E=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,D=o.dashArray,Z=D===void 0?[10,5]:D,te=o.lineTexture,le=te===void 0?!1:te,ve=o.iconStep,Be=ve===void 0?100:ve,it=o.segmentNumber,yt=it===void 0?30:it,wt=o.globalArcHeight,jt=wt===void 0?10:wt;Z.length===2&&Z.push(0,0);var Wt=0,nr=[0,0,0,0],mr=[0,0,0,0];if(v&&y&&(nr=Fa(v),mr=Fa(y),Wt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var tn=this.layer.getEncodedData(),vn=this.calDataFrame(this.cellLength,tn,this.cellProperties),Pr=vn.data,In=vn.width,Gn=vn.height;this.rowCount=Gn,this.dataTexture=this.cellLength>0&&Pr.length>0?this.createTexture2D({flipY:!0,data:Pr,format:d.LUMINANCE,type:d.FLOAT,width:In,height:Gn}):this.createTexture2D({flipY:!0,data:[1],format:d.LUMINANCE,type:d.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:xg,u_global_height:jt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:go()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:yt,u_line_type:A2[I]||0,u_dash_array:Z,u_texture:this.texture,u_line_texture:le?1:0,u_icon_step:Be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Wt,u_sourceColor:nr,u_targetColor:mr}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,v=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:T2,fragmentShader:w2,triangulation:zv,blend:this.getBlend(),segmentNumber:v})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(v,y,x,E){var P=v.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ii.Attribute,descriptor:{name:"a_Instance",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:4,update:function(v,y,x,E){return[x[3],x[4],x[5],x[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ii.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(v,y,x,E){var P=o.iconService.getIconMap(),I=v.texture,D=P[I]||{x:0,y:0},Z=D.x,te=D.y;return[Z,te]}}})}}]),r}(Gs);function M2(e){var i=P2();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function P2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I2=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
  gl_FragColor = filterColor(gl_FragColor);
}`,O2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,R2=function(e){(0,Wr.Z)(r,e);var i=M2(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.sourceColor,y=o.targetColor,x=o.forward,E=x===void 0?!0:x,P=o.segmentNumber,I=P===void 0?30:P,D=o.thetaOffset,Z=D===void 0?.314:D,te=0,le=[0,0,0,0],ve=[0,0,0,0];return v&&y&&(le=Fa(v),ve=Fa(y),te=1),{u_thetaOffset:Z,u_opacity:go()(u)?u:1,segmentNumber:I,u_blur:.9,u_lineDir:E?1:-1,u_linearColor:te,u_sourceColor:le,u_targetColor:ve}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,v=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:O2,fragmentShader:I2,triangulation:zv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:v})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(u,v,y,x){var E=u.size,P=E===void 0?1:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ii.Attribute,descriptor:{name:"a_Instance",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:4,update:function(u,v,y,x){return[y[3],y[4],y[5],y[6]]}}})}}]),r}(Gs);function L2(e){var i=k2();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function k2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,F2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,N2={solid:0,dash:1},B2=function(e){(0,Wr.Z)(r,e);var i=L2(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"texture",void 0),(0,T.Z)((0,be.Z)(n),"updateTexture",function(){var y=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=y({data:n.iconService.getCanvas(),mag:d.NEAREST,min:d.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.sourceColor,y=o.targetColor,x=o.textureBlend,E=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,D=o.dashArray,Z=D===void 0?[10,5]:D,te=o.lineTexture,le=te===void 0?!1:te,ve=o.iconStep,Be=ve===void 0?100:ve,it=o.segmentNumber,yt=it===void 0?30:it;Z.length===2&&Z.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var wt=0,jt=[0,0,0,0],Wt=[0,0,0,0];if(v&&y&&(jt=Fa(v),Wt=Fa(y),wt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var nr=this.layer.getEncodedData(),mr=this.calDataFrame(this.cellLength,nr,this.cellProperties),tn=mr.data,vn=mr.width,Pr=mr.height;this.rowCount=Pr,this.dataTexture=this.cellLength>0&&tn.length>0?this.createTexture2D({flipY:!0,data:tn,format:d.LUMINANCE,type:d.FLOAT,width:vn,height:Pr}):this.createTexture2D({flipY:!0,data:[1],format:d.LUMINANCE,type:d.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:go()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:yt,u_line_type:N2[I]||0,u_dash_array:Z,u_texture:this.texture,u_line_texture:le?1:0,u_icon_step:Be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:wt,u_sourceColor:jt,u_targetColor:Wt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:F2,fragmentShader:D2,triangulation:zv,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(v,y,x,E){var P=v.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ii.Attribute,descriptor:{name:"a_Instance",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:4,update:function(v,y,x,E){return[x[3],x[4],x[5],x[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ii.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(v,y,x,E){var P=o.iconService.getIconMap(),I=v.texture,D=P[I]||{x:0,y:0},Z=D.x,te=D.y;return[Z,te]}}})}}]),r}(Gs);function z2(e){var i=U2();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function U2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
// varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = (vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // if(v > 0.9) {
    // gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,V2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,j2={solid:0,dash:1},Vg=function(e){(0,Wr.Z)(r,e);var i=z2(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"texture",void 0),(0,T.Z)((0,be.Z)(n),"updateTexture",function(){var y=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=y({data:n.iconService.getCanvas(),mag:d.NEAREST,min:d.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.sourceColor,y=o.targetColor,x=o.textureBlend,E=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,D=o.dashArray,Z=D===void 0?[10,5,0,0]:D,te=o.lineTexture,le=te===void 0?!1:te,ve=o.iconStep,Be=ve===void 0?100:ve;Z.length===2&&Z.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var it=0,yt=[0,0,0,0],wt=[0,0,0,0];if(v&&y&&(yt=Fa(v),wt=Fa(y),it=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var jt=this.layer.getEncodedData(),Wt=this.calDataFrame(this.cellLength,jt,this.cellProperties),nr=Wt.data,mr=Wt.width,tn=Wt.height;this.rowCount=tn,this.dataTexture=this.cellLength>0&&nr.length>0?this.createTexture2D({flipY:!0,data:nr,format:d.LUMINANCE,type:d.FLOAT,width:mr,height:tn}):this.createTexture2D({flipY:!0,data:[1],format:d.LUMINANCE,type:d.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:go()(u)?u:1,u_textureBlend:E==="normal"?0:1,u_line_type:j2[I],u_dash_array:Z,u_texture:this.texture,u_line_texture:le?1:0,u_icon_step:Be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:it,u_sourceColor:yt,u_targetColor:wt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:V2,fragmentShader:Z2,triangulation:gE,primitive:d.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.layer.getLayerConfig(),v=u.lineType,y=v===void 0?"solid":v;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Ii.Attribute,descriptor:{name:"a_Distance",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(E,P,I,D){return[I[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ii.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(E,P,I,D){return[I[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(E,P,I,D){var Z=E.size,te=Z===void 0?1:Z;return Array.isArray(te)?[te[0],te[1]]:[te,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ii.Attribute,descriptor:{name:"a_Normal",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:3,update:function(E,P,I,D,Z){return Z}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ii.Attribute,descriptor:{name:"a_Miter",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(E,P,I,D){return[I[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ii.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(E,P,I,D){var Z=o.iconService.getIconMap(),te=E.texture,le=Z[te]||{x:0,y:0},ve=le.x,Be=le.y;return[ve,Be]}}})}},{key:"loadImage",value:function(o){return new Promise(function(u,v){if(o instanceof HTMLImageElement){u(o);return}var y=new Image;y.crossOrigin="anonymous",y.onload=function(){u(y)},y.onerror=function(){v(new Error("Could not load image at "+o))},y.src=o instanceof File?URL.createObjectURL(o):o})}}]),r}(Gs),G2={arc:b2,arcmini:R2,arc3d:C2,greatcircle:B2,line:Vg},H2=G2;function W2(e){var i=X2();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function X2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y2=function(e){(0,Wr.Z)(r,e);var i=W2(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"type","LineLayer"),n}return(0,Kt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new H2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return u[o]}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),v=u==null||(o=u.scale)===null||o===void 0?void 0:o.field;return v||"line"}}]),r}(Mp);function K2(e){var i=q2();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $2=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,J2=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,jg=function(e){(0,Wr.Z)(r,e);var i=K2(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var y=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,y,this.cellProperties),E=x.data,P=x.width,I=x.height;this.rowCount=I,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:d.LUMINANCE,type:d.FLOAT,width:P,height:I}):this.createTexture2D({flipY:!0,data:[1],format:d.LUMINANCE,type:d.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:go()(v)?v:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:J2,fragmentShader:$2,triangulation:Rg,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:3,update:function(v,y,x,E){var P=v.size;if(P){var I=[];return Array.isArray(P)&&(I=P.length===2?[P[0],P[0],P[1]]:P),Array.isArray(P)||(I=[P,P,P]),I}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ii.Attribute,descriptor:{name:"a_Normal",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:3,update:function(v,y,x,E,P){return P}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ii.Attribute,descriptor:{name:"a_Pos",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:3,update:function(v,y){var x=Pp(v.coordinates);return o?Eg([x[0],x[1]]):[x[0],x[1],0]}}})}}]),r}(Gs);function Q2(e){var i=eS();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function eS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tS=`#define Animate 0.0

uniform float u_globel;
uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiased_blur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  
 
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

  

}
`,rS=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Gg=function(e){(0,Wr.Z)(r,e);var i=Q2(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u,y=o.strokeOpacity,x=y===void 0?1:y,E=o.strokeWidth,P=E===void 0?0:E,I=o.stroke,D=I===void 0?"rgba(0,0,0,0)":I,Z=o.offsets,te=Z===void 0?[0,0]:Z;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,strokeOpacity:x,strokeWidth:P,stroke:D,offsets:te})){this.judgeStyleAttributes({opacity:v,strokeOpacity:x,strokeWidth:P,stroke:D,offsets:te});var le=this.layer.getEncodedData(),ve=this.calDataFrame(this.cellLength,le,this.cellProperties),Be=ve.data,it=ve.width,yt=ve.height;this.rowCount=yt,this.dataTexture=this.cellLength>0&&Be.length>0?this.createTexture2D({flipY:!0,data:Be,format:d.LUMINANCE,type:d.FLOAT,width:it,height:yt}):this.createTexture2D({flipY:!0,data:[1],format:d.LUMINANCE,type:d.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:go()(v)?v:1,u_stroke_opacity:go()(x)?x:1,u_stroke_width:go()(P)?P:0,u_stroke_color:this.getStrokeColor(D),u_offsets:this.isOffsetStatic(te)?te:[0,0]}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Og)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:rS,fragmentShader:tS,triangulation:o?mE:Og,depth:{enable:o},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.speed||1,o.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ii.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:3,update:function(y,x,E,P){var I;if(u){var D=(0,Pn.Z)(E,3),Z=D[0],te=D[1],le=D[2],ve=Ha.fromValues(0,0,1),Be=Ha.fromValues(Z,0,le),it=Z>=0?Ha.angle(ve,Be):Math.PI*2-Ha.angle(ve,Be),yt=Math.PI*2-Math.asin(te/100),wt=_u();Rs(wt,wt,it),lo(wt,wt,yt);var jt=Ha.fromValues(1,1,0);Ha.transformMat4(jt,jt,wt),Ha.normalize(jt,jt);var Wt=Ha.fromValues(-1,1,0);Ha.transformMat4(Wt,Wt,wt),Ha.normalize(Wt,Wt);var nr=Ha.fromValues(-1,-1,0);Ha.transformMat4(nr,nr,wt),Ha.normalize(nr,nr);var mr=Ha.fromValues(1,-1,0);Ha.transformMat4(mr,mr,wt),Ha.normalize(mr,mr),I=[].concat((0,we.Z)(jt),(0,we.Z)(Wt),(0,we.Z)(nr),(0,we.Z)(mr))}else I=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var tn=P%4*3;return[I[tn],I[tn+1],I[tn+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(y,x,E,P){var I=y.size,D=I===void 0?5:I;return Array.isArray(D)?[D[0]]:[D]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Ii.Attribute,descriptor:{name:"a_Shape",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(y,x,E,P){var I=y.shape,D=I===void 0?2:I,Z=o.layer.getLayerConfig().shape2d,te=Z.indexOf(D);return[te]}}})}}]),r}(Gs);function nS(e){var i=iS();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function iS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aS=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,oS=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,sS=function(e){(0,Wr.Z)(r,e);var i=nS(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"texture",void 0),n}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;return{u_opacity:u||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var o=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){o.updateTexture(),o.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:oS,fragmentShader:aS,triangulation:Lg,primitive:d.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(v,y,x,E){var P=v.size;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ii.Attribute,descriptor:{name:"a_Uv",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(v,y,x,E){var P=o.fontService.mapping,I=v.shape,D=o.fontService.getGlyph(I),Z=P[D],te=Z.x,le=Z.y;return[te,le]}}})}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,u=this.fontService.canvas;this.texture=o({data:u,mag:d.LINEAR,min:d.LINEAR,width:u.width,height:u.height})}},{key:"initIconFontGlyphs",value:function(){var o=this,u=this.layer.getLayerConfig(),v=u.fontWeight,y=v===void 0?"normal":v,x=u.fontFamily,E=x===void 0?"sans-serif":x,P=this.layer.getEncodedData(),I=[];P.forEach(function(D){var Z=D.shape,te=Z===void 0?"":Z;te=te.toString();var le=o.fontService.getGlyph(te);I.indexOf(le)===-1&&I.push(le)}),this.fontService.setFontOptions({characterSet:I,fontWeight:y,fontFamily:E,fontSize:48})}}]),r}(Gs);function uS(e){var i=lS();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function lS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cS=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,fS=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Hg=function(e){(0,Wr.Z)(r,e);var i=uS(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"texture",void 0),(0,T.Z)((0,be.Z)(n),"updateTexture",function(){var y=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.renderLayers();return}n.texture=y({data:n.iconService.getCanvas(),mag:d.LINEAR,min:d.LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=o.offsets,y=v===void 0?[0,0]:v;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:y})){this.judgeStyleAttributes({opacity:u,offsets:y});var x=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,x,this.cellProperties),P=E.data,I=E.width,D=E.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:d.LUMINANCE,type:d.FLOAT,width:I,height:D}):this.createTexture2D({flipY:!0,data:[1],format:d.LUMINANCE,type:d.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:go()(u)?u:1,u_offsets:this.isOffsetStatic(y)?y:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:fS,fragmentShader:cS,triangulation:Lg,primitive:d.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(v,y,x,E){var P=v.size,I=P===void 0?5:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ii.Attribute,descriptor:{name:"a_Uv",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(v,y,x,E){var P=o.iconService.getIconMap(),I=v.shape,D=P[I]||{x:0,y:0},Z=D.x,te=D.y;return[Z,te]}}})}}]),r}(Gs);function hS(e){var i=pS();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function pS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dS=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,vS=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function mS(e){var i=e.coordinates;return{vertices:(0,we.Z)(i),indices:[0],size:i.length}}var Wg=function(e){(0,Wr.Z)(r,e);var i=hS(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u,y=o.offsets,x=y===void 0?[0,0]:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,offsets:x})){this.judgeStyleAttributes({opacity:v,offsets:x});var E=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,E,this.cellProperties),I=P.data,D=P.width,Z=P.height;this.rowCount=Z,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:d.LUMINANCE,type:d.FLOAT,width:D,height:Z}):this.createTexture2D({flipY:!0,data:[1],format:d.LUMINANCE,type:d.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:go()(v)?v:1,u_offsets:this.isOffsetStatic(x)?x:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:vS,fragmentShader:dS,triangulation:mS,depth:{enable:!1},primitive:d.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(u,v,y,x){var E=u.size,P=E===void 0?1:E;return Array.isArray(P)?[P[0]]:[P]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:$c.additive}}}]),r}(Gs);function gS(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=yS(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function yS(e,i){if(!!e){if(typeof e=="string")return Xg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xg(e,i)}}function Xg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var _S=function(){function e(i,r,n){(0,St.Z)(this,e),(0,T.Z)(this,"boxCells",[]),(0,T.Z)(this,"xCellCount",void 0),(0,T.Z)(this,"yCellCount",void 0),(0,T.Z)(this,"boxKeys",void 0),(0,T.Z)(this,"bboxes",void 0),(0,T.Z)(this,"width",void 0),(0,T.Z)(this,"height",void 0),(0,T.Z)(this,"xScale",void 0),(0,T.Z)(this,"yScale",void 0),(0,T.Z)(this,"boxUid",void 0);var o=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var u=0;u<this.xCellCount*this.yCellCount;u++)o.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Kt.Z)(e,[{key:"insert",value:function(r,n,o,u,v){this.forEachCell(n,o,u,v,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(v)}},{key:"query",value:function(r,n,o,u,v){return this.queryHitTest(r,n,o,u,!1,v)}},{key:"hitTest",value:function(r,n,o,u,v){return this.queryHitTest(r,n,o,u,!0,v)}},{key:"insertBoxCell",value:function(r,n,o,u,v,y){this.boxCells[v].push(y)}},{key:"queryHitTest",value:function(r,n,o,u,v,y){if(o<0||r>this.width||u<0||n>this.height)return v?!1:[];var x=[];if(r<=0&&n<=0&&this.width<=o&&this.height<=u){if(v)return!0;for(var E=0;E<this.boxKeys.length;E++)x.push({key:this.boxKeys[E],x1:this.bboxes[E*4],y1:this.bboxes[E*4+1],x2:this.bboxes[E*4+2],y2:this.bboxes[E*4+3]});return y?x.filter(y):x}var P={hitTest:v,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,o,u,this.queryCell,x,P,y),v?x.length>0:x}},{key:"queryCell",value:function(r,n,o,u,v,y,x,E){var P=x.seenUids,I=this.boxCells[v];if(I!==null){var D=this.bboxes,Z=gS(I),te;try{for(Z.s();!(te=Z.n()).done;){var le=te.value;if(!P.box[le]){P.box[le]=!0;var ve=le*4;if(r<=D[ve+2]&&n<=D[ve+3]&&o>=D[ve+0]&&u>=D[ve+1]&&(!E||E(this.boxKeys[le]))){if(x.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[le],x1:D[ve],y1:D[ve+1],x2:D[ve+2],y2:D[ve+3]})}}}}catch(Be){Z.e(Be)}finally{Z.f()}}return!1}},{key:"forEachCell",value:function(r,n,o,u,v,y,x,E){for(var P=this.convertToXCellCoord(r),I=this.convertToYCellCoord(n),D=this.convertToXCellCoord(o),Z=this.convertToYCellCoord(u),te=P;te<=D;te++)for(var le=I;le<=Z;le++){var ve=this.xCellCount*le+te;if(v.call(this,r,n,o,u,ve,y,x,E))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),xS=_S,bS=function(){function e(i,r){(0,St.Z)(this,e),(0,T.Z)(this,"width",void 0),(0,T.Z)(this,"height",void 0),(0,T.Z)(this,"grid",void 0),(0,T.Z)(this,"viewportPadding",100),(0,T.Z)(this,"screenRightBoundary",void 0),(0,T.Z)(this,"screenBottomBoundary",void 0),(0,T.Z)(this,"gridRightBoundary",void 0),(0,T.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new xS(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Kt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,o=r.y1+r.anchorPointY+this.viewportPadding,u=r.x2+r.anchorPointX+this.viewportPadding,v=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,o,u,v)||this.grid.hitTest(n,o,u,v)?{box:[]}:{box:[n,o,u,v]}}},{key:"insertCollisionBox",value:function(r,n){var o={featureIndex:n};this.grid.insert(o,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,o){var u=co(n,o,0,1),v=Ao(),y=Hp.apply(X,(0,we.Z)(r));return Se(v,u,y),{x:(v[0]/v[3]+1)/2*this.width+this.viewportPadding,y:(-v[1]/v[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,o,u){return o>=0&&r<this.gridRightBoundary&&u>=0&&n<this.gridBottomBoundary}}]),e}();function Yg(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ES(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function ES(e,i){if(!!e){if(typeof e=="string")return Kg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kg(e,i)}}function Kg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function qg(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function $g(e,i,r,n,o){if(!!o){var u=e[n],v=u.glyph;if(v)for(var y=i[v].advance*u.scale,x=(e[n].x+y)*o,E=r;E<=n;E++)e[E].x-=x}}function Jg(e,i,r,n,o,u,v){var y=(i-r)*o,x=(-n*v+.5)*u,E=Yg(e),P;try{for(E.s();!(P=E.n()).done;){var I=P.value;I.x+=y,I.y+=x}}catch(D){E.e(D)}finally{E.f()}}function SS(e,i,r,n,o,u,v){var y=-8,x=0,E=y,P=0,I=e.positionedGlyphs,D=u==="right"?1:u==="left"?0:.5,Z=I.length;r.forEach(function(it){if(it.split("").forEach(function(wt){var jt=i[wt],Wt=0;jt&&(I.push({glyph:wt,x,y:E+Wt,vertical:!1,scale:1,metrics:jt}),x+=jt.advance+v)}),I.length!==Z){var yt=x-v;P=Math.max(yt,P),$g(I,i,Z,I.length-1,D)}x=0,E-=n+5});var te=qg(o),le=te.horizontalAlign,ve=te.verticalAlign;Jg(I,D,le,ve,P,n,r.length);var Be=E-y;e.top+=-ve*Be,e.bottom=e.top-Be,e.left+=-le*P,e.right=e.left+P}function wS(e,i,r,n,o,u,v){var y=-8,x=0,E=y,P=0,I=e.positionedGlyphs,D=u==="right"?1:u==="left"?0:.5,Z=I.length;r.forEach(function(it){var yt=i[it],wt=0;if(yt&&(I.push({glyph:it,x,y:E+wt,vertical:!1,scale:1,metrics:yt}),x+=yt.advance+v),I.length!==Z){var jt=x-v;P=Math.max(jt,P),$g(I,i,Z,I.length-1,D)}x=0,E-=n+5});var te=qg(o),le=te.horizontalAlign,ve=te.verticalAlign;Jg(I,D,le,ve,P,n,r.length);var Be=E-y;e.top+=-ve*Be,e.bottom=e.top-Be,e.left+=-le*P,e.right=e.left+P}function TS(e,i,r,n,o,u){var v=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],y=arguments.length>7?arguments[7]:void 0,x=e.split(`
`),E=[],P={positionedGlyphs:E,top:v[1],bottom:v[1],left:v[0],right:v[0],lineCount:x.length,text:e};return y?wS(P,i,x,r,n,o,u):SS(P,i,x,r,n,o,u),E.length?P:!1}function AS(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,o=n===void 0?[]:n,u=[],v=Yg(o),y;try{for(v.s();!(y=v.n()).done;){var x=y.value,E=x.metrics,P=4,I=E.advance*x.scale/2,D=r?[x.x+I,x.y]:[0,0],Z=r?[0,0]:[x.x+I+i[0],x.y+i[1]],te=(0-P)*x.scale-I+Z[0],le=(0-P)*x.scale+Z[1],ve=te+E.width*x.scale,Be=le+E.height*x.scale,it={x:te,y:le},yt={x:ve,y:le},wt={x:te,y:Be},jt={x:ve,y:Be};u.push({tl:it,tr:yt,bl:wt,br:jt,tex:E,glyphOffset:D})}}catch(Wt){v.e(Wt)}finally{v.f()}return u}function CS(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=MS(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,v=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){v=!0,y=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(v)throw y}}}}function MS(e,i){if(!!e){if(typeof e=="string")return Qg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qg(e,i)}}function Qg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function PS(e){var i=IS();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function IS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ey=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ty=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function ry(e){var i=this,r=e.id,n=[],o=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var u=i.glyphInfoMap[r].centroid,v=u.length===2?[u[0],u[1],0]:u;return i.glyphInfoMap[r].glyphQuads.forEach(function(y,x){n.push.apply(n,(0,we.Z)(v).concat([y.tex.x,y.tex.y+y.tex.height,y.tl.x,y.tl.y],(0,we.Z)(v),[y.tex.x+y.tex.width,y.tex.y+y.tex.height,y.tr.x,y.tr.y],(0,we.Z)(v),[y.tex.x+y.tex.width,y.tex.y,y.br.x,y.br.y],(0,we.Z)(v),[y.tex.x,y.tex.y,y.bl.x,y.bl.y])),o.push(0+x*4,1+x*4,2+x*4,2+x*4,3+x*4,0+x*4)}),{vertices:n,indices:o,size:7}}var ny=function(e){(0,Wr.Z)(r,e);var i=PS(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"glyphInfo",void 0),(0,T.Z)((0,be.Z)(n),"glyphInfoMap",{}),(0,T.Z)((0,be.Z)(n),"texture",void 0),(0,T.Z)((0,be.Z)(n),"currentZoom",-1),(0,T.Z)((0,be.Z)(n),"extent",void 0),(0,T.Z)((0,be.Z)(n),"textureHeight",0),(0,T.Z)((0,be.Z)(n),"textCount",0),(0,T.Z)((0,be.Z)(n),"preTextStyle",{}),(0,T.Z)((0,be.Z)(n),"buildModels",function(){return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:ty,fragmentShader:ey,triangulation:ry.bind((0,be.Z)(n)),depth:{enable:!1},blend:n.getBlend()})]}),n}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u,y=o.stroke,x=y===void 0?"#fff":y,E=o.strokeWidth,P=E===void 0?0:E,I=o.textAnchor,D=I===void 0?"center":I,Z=o.textAllowOverlap,te=Z===void 0?!1:Z,le=o.halo,ve=le===void 0?.5:le,Be=o.gamma,it=Be===void 0?2:Be,yt=this.fontService,wt=yt.canvas,jt=yt.mapping;if(Object.keys(jt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(jt).length),this.preTextStyle={textAnchor:D,textAllowOverlap:te},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v,strokeWidth:P,stroke:x})){this.judgeStyleAttributes({opacity:v,strokeWidth:P,stroke:x});var Wt=this.layer.getEncodedData(),nr=this.calDataFrame(this.cellLength,Wt,this.cellProperties),mr=nr.data,tn=nr.width,vn=nr.height;this.rowCount=vn,this.dataTexture=this.cellLength>0&&mr.length>0?this.createTexture2D({flipY:!0,data:mr,format:d.LUMINANCE,type:d.FLOAT,width:tn,height:vn}):this.createTexture2D({flipY:!0,data:[1],format:d.LUMINANCE,type:d.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:go()(v)?v:1,u_stroke_width:go()(P)?P:0,u_stroke_color:this.getStrokeColor(x),u_sdf_map:this.texture,u_halo_blur:ve,u_gamma_scale:it,u_sdf_map_size:[wt.width,wt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,v=u===void 0?"center":u,y=o.textAllowOverlap,x=y===void 0?!0:y;return this.preTextStyle={textAnchor:v,textAllowOverlap:x},this.buildModels()}},{key:"needUpdate",value:function(){var o=this.layer.getLayerConfig(),u=o.textAllowOverlap,v=u===void 0?!1:u,y=this.mapService.getZoom(),x=this.mapService.getBounds(),E=bn(this.extent,x);return!v&&(Math.abs(this.currentZoom-y)>1||!E)||v!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Ii.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(u,v,y,x){var E=u.rotate,P=E===void 0?0:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Ii.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(u,v,y,x){return[y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(u,v,y,x){var E=u.size,P=E===void 0?12:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Ii.Attribute,descriptor:{name:"a_tex",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(u,v,y,x){return[y[3],y[4]]}}})}},{key:"textExtent",value:function(){var o=this.mapService.getBounds();return Cn(o,.5)}},{key:"initTextFont",value:function(){var o=this.layer.getLayerConfig(),u=o.fontWeight,v=u===void 0?"400":u,y=o.fontFamily,x=y===void 0?"sans-serif":y,E=this.layer.getEncodedData(),P=[];E.forEach(function(I){var D=I.shape,Z=D===void 0?"":D;Z=Z.toString();var te=CS(Z),le;try{for(te.s();!(le=te.n()).done;){var ve=le.value;P.indexOf(ve)===-1&&P.push(ve)}}catch(Be){te.e(Be)}finally{te.f()}}),this.fontService.setFontOptions({characterSet:P,fontWeight:v,fontFamily:x,iconfont:!1})}},{key:"initIconFontTex",value:function(){var o=this.layer.getLayerConfig(),u=o.fontWeight,v=u===void 0?"400":u,y=o.fontFamily,x=y===void 0?"sans-serif":y,E=this.layer.getEncodedData(),P=[];E.forEach(function(I){var D=I.shape,Z=D===void 0?"":D;Z="".concat(Z),P.indexOf(Z)===-1&&P.push(Z)}),this.fontService.setFontOptions({characterSet:P,fontWeight:v,fontFamily:x,iconfont:!0})}},{key:"generateGlyphLayout",value:function(o){var u=this,v=this.fontService.mapping,y=this.layer.getLayerConfig(),x=y.spacing,E=x===void 0?2:x,P=y.textAnchor,I=P===void 0?"center":P,D=this.layer.getEncodedData();this.glyphInfo=D.map(function(Z){var te=Z.shape,le=te===void 0?"":te,ve=Z.id,Be=Z.size,it=Be===void 0?1:Be,yt=Z.textOffset,wt=yt===void 0?[0,0]:yt,jt=TS(le.toString(),v,it,I,"left",E,wt,o),Wt=AS(jt,wt,!1);return Z.shaping=jt,Z.glyphQuads=Wt,Z.centroid=Pp(Z.coordinates),Z.originCentroid=Z.version==="GAODE2.x"?Pp(Z.originCoordinates):Z.originCentroid=Z.centroid,u.glyphInfoMap[ve]={shaping:jt,glyphQuads:Wt,centroid:Pp(Z.coordinates)},Z})}},{key:"filterGlyphs",value:function(){var o=this,u=this.layer.getLayerConfig(),v=u.padding,y=v===void 0?[4,4]:v,x=u.textAllowOverlap,E=x===void 0?!1:x;if(!E){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var P=this.rendererService.getViewportSize(),I=P.width,D=P.height,Z=new bS(I,D),te=this.glyphInfo.filter(function(le){var ve=le.shaping,Be=le.id,it=Be===void 0?0:Be,yt=le.version==="GAODE2.x"?le.originCentroid:le.centroid,wt=le.size,jt=wt/24,Wt=o.mapService.lngLatToContainer(yt),nr=Z.placeCollisionBox({x1:ve.left*jt-y[0],x2:ve.right*jt+y[0],y1:ve.top*jt-y[1],y2:ve.bottom*jt+y[1],anchorPointX:Wt.x,anchorPointY:Wt.y}),mr=nr.box;return mr&&mr.length?(Z.insertCollisionBox(mr,it),!0):!1});te.forEach(function(le){o.glyphInfoMap[le.id]=le})}}},{key:"initGlyph",value:function(){var o=this.layer.getLayerConfig(),u=o.iconfont,v=u===void 0?!1:u;v?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(v)}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,u=this.fontService.canvas;this.textureHeight=u.height,this.texture&&this.texture.destroy(),this.texture=o({data:u,mag:d.LINEAR,min:d.LINEAR,width:u.width,height:u.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:ty,fragmentShader:ey,triangulation:ry.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),r}(Gs),OS={fill:Gg,image:Hg,normal:Wg,extrude:jg,text:ny,icon:sS},RS=OS;function LS(e){var i=kS();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function kS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DS=function(e){(0,Wr.Z)(r,e);var i=LS(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"type","PointLayer"),n}return(0,Kt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new RS[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return u[o]}},{key:"getModelType",value:function(){var o=this.getEncodedData(),u=this.getLayerConfig(),v=u.shape2d,y=u.shape3d,x=this.iconService.getIconMap(),E=o.find(function(I){return I.hasOwnProperty("shape")});if(E){var P=E.shape;return P==="dot"?"normal":(v==null?void 0:v.indexOf(P))!==-1?"fill":(y==null?void 0:y.indexOf(P))!==-1?"extrude":x.hasOwnProperty(P)?"image":this.fontService.getGlyph(P)!==""?"icon":"text"}else return"normal"}}]),r}(Mp);function FS(e){var i=NS();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function NS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,zS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,US=function(e){(0,Wr.Z)(r,e);var i=FS(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var y=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,y,this.cellProperties),E=x.data,P=x.width,I=x.height;this.rowCount=I,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:d.LUMINANCE,type:d.FLOAT,width:P,height:I}):this.createTexture2D({flipY:!0,data:[1],format:d.LUMINANCE,type:d.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:go()(v)?v:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:zS,fragmentShader:BS,triangulation:kg})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ii.Attribute,descriptor:{name:"a_Normal",buffer:{usage:d.STATIC_DRAW,data:[],type:d.FLOAT},size:3,update:function(u,v,y,x,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ii.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(u,v,y,x){var E=u.size,P=E===void 0?10:E;return Array.isArray(P)?[P[0]]:[P]}}})}}]),r}(Gs);function ZS(e){var i=VS();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function VS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jS=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,GS=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,HS=function(e){(0,Wr.Z)(r,e);var i=ZS(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var y=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,y,this.cellProperties),E=x.data,P=x.width,I=x.height;this.rowCount=I,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:d.LUMINANCE,type:d.FLOAT,width:P,height:I}):this.createTexture2D({flipY:!0,data:[1],format:d.LUMINANCE,type:d.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:go()(v)?v:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:GS,fragmentShader:jS,triangulation:yE,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(Gs),WS={fill:HS,line:Vg,extrude:US,text:ny,point_fill:Gg,point_image:Hg,point_normal:Wg,point_extrude:jg},XS=WS;function YS(e){var i=KS();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function KS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iy=function(e){(0,Wr.Z)(r,e);var i=YS(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"type","PolygonLayer"),n}return(0,Kt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new XS[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),v=u==null||(o=u.scale)===null||o===void 0?void 0:o.field;return v==="fill"?"fill":v==="extrude"?"extrude":v==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var o=this.getEncodedData(),u=this.getLayerConfig(),v=u.shape2d,y=u.shape3d,x=this.iconService.getIconMap(),E=o.find(function(I){return I.hasOwnProperty("shape")});if(E){var P=E.shape;return P==="dot"?"point_normal":(v==null?void 0:v.indexOf(P))!==-1?"point_fill":(y==null?void 0:y.indexOf(P))!==-1?"point_extrude":x.hasOwnProperty(P)?"point_image":"text"}else return"fill"}}]),r}(Mp);function qS(e){var i=$S();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function $S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,QS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,ay=function(e){(0,Wr.Z)(r,e);var i=qS(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"texture",void 0),(0,T.Z)((0,be.Z)(n),"colorTexture",void 0),n}return(0,Kt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,v=u===void 0?1:u,y=o.clampLow,x=y===void 0?!0:y,E=o.clampHigh,P=E===void 0?!0:E,I=o.noDataValue,D=I===void 0?-9999999:I,Z=o.domain,te=Z===void 0?[0,1]:Z;return this.updateColorTexure(),{u_opacity:v||1,u_texture:this.texture,u_domain:te,u_clampLow:x,u_clampHigh:typeof P!="undefined"?P:x,u_noDataValue:D,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var o=this.layer.getSource(),u=this.rendererService.createTexture2D,v=o.data.dataArray[0];this.texture=u({data:v.data,width:v.width,height:v.height,format:d.LUMINANCE,type:d.FLOAT});var y=this.layer.getLayerConfig(),x=y.rampColors,E=oa(x);return this.colorTexture=u({data:E.data,width:E.width,height:E.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:QS,fragmentShader:JS,triangulation:Fg,primitive:d.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ii.Attribute,descriptor:{name:"a_Uv",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:2,update:function(u,v,y,x){return[y[3],y[4]]}}})}},{key:"updateColorTexure",value:function(){var o=this.rendererService.createTexture2D,u=this.layer.getLayerConfig(),v=u.rampColors,y=oa(v);this.colorTexture=o({data:y.data,width:y.width,height:y.height,flipY:!1})}}]),r}(Gs),ew={raster:ay,raster3d:ay},tw=ew;function rw(e){var i=nw();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function nw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iw=function(e){(0,Wr.Z)(r,e);var i=rw(r);function r(){var n;(0,St.Z)(this,r);for(var o=arguments.length,u=new Array(o),v=0;v<o;v++)u[v]=arguments[v];return n=i.call.apply(i,[this].concat(u)),(0,T.Z)((0,be.Z)(n),"type","RasterLayer"),n}return(0,Kt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new tw[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={raster:{},raster3d:{}};return u[o]}},{key:"getModelType",value:function(){return"raster"}}]),r}(Mp),oy,sy,uy,ly,cy,Yd,fy,hy,py;function dy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function aw(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?dy(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ow=(oy=(0,Lr.b2)(),sy=(0,Lr.f3)(qt.IGlobalConfigService),uy=(0,Lr.f3)(qt.IMapService),ly=(0,Lr.f3)(qt.IFontService),oy(cy=(Yd=function(){function e(){(0,St.Z)(this,e),Rn(this,"configService",fy,this),Rn(this,"mapService",hy,this),Rn(this,"fontService",py,this)}return(0,Kt.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){o.generateMaping(r,{styleAttributeService:u})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,o.generateMaping(r,{styleAttributeService:u}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var v=u.getLayerStyleAttributes()||[],y=u.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,E=v.filter(function(I){return I.needRemapping}),P=x;y!=null&&y.needRemapping&&y!==null&&y!==void 0&&y.scale&&(P=x.filter(function(I){return o.applyAttributeMapping(y,I)[0]})),E.length&&(y!=null&&y.needRemapping?(r.setEncodedData(o.mapping(v,P)),y.needRemapping=!1):r.setEncodedData(o.mapping(E,P,r.getEncodedData())),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var o=this,u=n.styleAttributeService,v=u.getLayerStyleAttributes()||[],y=u.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,E=x;y!=null&&y.scale&&(E=x.filter(function(P){return o.applyAttributeMapping(y,P)[0]})),r.setEncodedData(this.mapping(v,E))}},{key:"mapping",value:function(r,n,o){var u=this,v=n.map(function(y,x){var E=o?o[x]:{},P=aw({id:y._id,coordinates:y.coordinates},E);return r.filter(function(I){return I.scale!==void 0}).forEach(function(I){var D=u.applyAttributeMapping(I,y);I.needRemapping=!1,I.name==="color"&&(D=D.map(function(Z){return Fa(Z)})),P[I.name]=Array.isArray(D)&&D.length===1?D[0]:D,I.name==="shape"&&(P.shape=u.fontService.getIconFontKey(P[I.name]))}),P});return v.length>0&&this.mapService.version==="GAODE2.x"&&(typeof v[0].coordinates[0]=="number"?v.filter(function(y){return!y.originCoordinates}).map(function(y){y.version="GAODE2.x",y.originCoordinates=Nl()(y.coordinates),y.coordinates=u.mapService.lngLatToCoord(y.coordinates)}):v.filter(function(y){return!y.originCoordinates}).map(function(y){y.version="GAODE2.x",y.originCoordinates=Nl()(y.coordinates),y.coordinates=u.mapService.lngLatToCoords(y.coordinates)})),v}},{key:"applyAttributeMapping",value:function(r,n){var o;if(!r.scale)return[];var u=(r==null||(o=r.scale)===null||o===void 0?void 0:o.scalers)||[],v=[];return u.forEach(function(y){var x,E=y.field;(n.hasOwnProperty(E)||((x=r.scale)===null||x===void 0?void 0:x.type)==="variable")&&v.push(n[E])}),r.mapping?r.mapping(v):[]}}]),e}(),fy=Fn(Yd.prototype,"configService",[sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hy=Fn(Yd.prototype,"mapService",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),py=Fn(Yd.prototype,"fontService",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yd))||cy),vy,gy,sw=(vy=(0,Lr.b2)(),vy(gy=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"mapService",void 0)}return(0,Kt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(qt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var o=r.getSource();if(!o){var u=r.sourceOption||{data:gf,options:Sh},v=u.data,y=u.options;r.setSource(new dc(v,y))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var o=n.updateClusterData(r),u=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,o||u})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),o=n.cluster,u=n.clusterOptions,v=u.zoom,y=v===void 0?0:v,x=u.maxZoom,E=x===void 0?16:x,P=this.mapService.getZoom()-1,I=r.dataState.dataSourceNeedUpdate;return o&&(I||Math.abs(y-P)>1)&&E>y?(n.updateClusterData(Math.floor(P)),!0):!1}}]),e}())||gy);function Cm(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function yy(e){return e.length===1&&(e=uw(e)),{left:function(i,r,n,o){for(n==null&&(n=0),o==null&&(o=i.length);n<o;){var u=n+o>>>1;e(i[u],r)<0?n=u+1:o=u}return n},right:function(i,r,n,o){for(n==null&&(n=0),o==null&&(o=i.length);n<o;){var u=n+o>>>1;e(i[u],r)>0?o=u:n=u+1}return n}}}function uw(e){return function(i,r){return Cm(e(i),r)}}var _y=yy(Cm),lw=_y.right,hP=_y.left,Zv=lw;function cw(e,i){var r=e.length,n=-1,o,u,v;if(i==null){for(;++n<r;)if((o=e[n])!=null&&o>=o)for(u=v=o;++n<r;)(o=e[n])!=null&&(u>o&&(u=o),v<o&&(v=o))}else for(;++n<r;)if((o=i(e[n],n,e))!=null&&o>=o)for(u=v=o;++n<r;)(o=i(e[n],n,e))!=null&&(u>o&&(u=o),v<o&&(v=o));return[u,v]}var xy=Array.prototype,pP=xy.slice,dP=xy.map,Mm=Math.sqrt(50),Pm=Math.sqrt(10),Im=Math.sqrt(2);function by(e,i,r){var n,o=-1,u,v,y;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(u=e,e=i,i=u),(y=Vv(e,i,r))===0||!isFinite(y))return[];if(y>0)for(e=Math.ceil(e/y),i=Math.floor(i/y),v=new Array(u=Math.ceil(i-e+1));++o<u;)v[o]=(e+o)*y;else for(e=Math.floor(e*y),i=Math.ceil(i*y),v=new Array(u=Math.ceil(e-i+1));++o<u;)v[o]=(e-o)/y;return n&&v.reverse(),v}function Vv(e,i,r){var n=(i-e)/Math.max(0,r),o=Math.floor(Math.log(n)/Math.LN10),u=n/Math.pow(10,o);return o>=0?(u>=Mm?10:u>=Pm?5:u>=Im?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(u>=Mm?10:u>=Pm?5:u>=Im?2:1)}function Om(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),o=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),u=n/o;return u>=Mm?o*=10:u>=Pm?o*=5:u>=Im&&(o*=2),i<e?-o:o}function vP(){var e=identity,i=extent,r=sturges;function n(o){var u,v=o.length,y,x=new Array(v);for(u=0;u<v;++u)x[u]=e(o[u],u,o);var E=i(x),P=E[0],I=E[1],D=r(x,P,I);Array.isArray(D)||(D=tickStep(P,I,D),D=range(Math.ceil(P/D)*D,I,D));for(var Z=D.length;D[0]<=P;)D.shift(),--Z;for(;D[Z-1]>I;)D.pop(),--Z;var te=new Array(Z+1),le;for(u=0;u<=Z;++u)le=te[u]=[],le.x0=u>0?D[u-1]:P,le.x1=u<Z?D[u]:I;for(u=0;u<v;++u)y=x[u],P<=y&&y<=I&&te[bisect(D,y,0,Z)].push(o[u]);return te}return n.value=function(o){return arguments.length?(e=typeof o=="function"?o:constant(o),n):e},n.domain=function(o){return arguments.length?(i=typeof o=="function"?o:constant([o[0],o[1]]),n):i},n.thresholds=function(o){return arguments.length?(r=typeof o=="function"?o:Array.isArray(o)?constant(slice.call(o)):constant(o),n):r},n}function mP(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function fw(e){return e===null?NaN:+e}function hw(e,i,r){if(r==null&&(r=fw),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,o=(n-1)*i,u=Math.floor(o),v=+r(e[u],u,e),y=+r(e[u+1],u+1,e);return v+(y-v)*(o-u)}}var wc="$";function jv(){}jv.prototype=Ey.prototype={constructor:jv,has:function(e){return wc+e in this},get:function(e){return this[wc+e]},set:function(e,i){return this[wc+e]=i,this},remove:function(e){var i=wc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===wc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===wc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===wc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===wc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===wc&&++e;return e},empty:function(){for(var e in this)if(e[0]===wc)return!1;return!0},each:function(e){for(var i in this)i[0]===wc&&e(this[i],i.slice(1),this)}};function Ey(e,i){var r=new jv;if(e instanceof jv)e.each(function(y,x){r.set(x,y)});else if(Array.isArray(e)){var n=-1,o=e.length,u;if(i==null)for(;++n<o;)r.set(n,e[n]);else for(;++n<o;)r.set(i(u=e[n],n,e),u)}else if(e)for(var v in e)r.set(v,e[v]);return r}var Rm=Ey;function gP(){var e=[],i=[],r,n,o;function u(y,x,E,P){if(x>=e.length)return r!=null&&y.sort(r),n!=null?n(y):y;for(var I=-1,D=y.length,Z=e[x++],te,le,ve=map(),Be,it=E();++I<D;)(Be=ve.get(te=Z(le=y[I])+""))?Be.push(le):ve.set(te,[le]);return ve.each(function(yt,wt){P(it,wt,u(yt,x,E,P))}),it}function v(y,x){if(++x>e.length)return y;var E,P=i[x-1];return n!=null&&x>=e.length?E=y.entries():(E=[],y.each(function(I,D){E.push({key:D,values:v(I,x)})})),P!=null?E.sort(function(I,D){return P(I.key,D.key)}):E}return o={object:function(y){return u(y,0,pw,dw)},map:function(y){return u(y,0,Sy,wy)},entries:function(y){return v(u(y,0,Sy,wy),0)},key:function(y){return e.push(y),o},sortKeys:function(y){return i[e.length-1]=y,o},sortValues:function(y){return r=y,o},rollup:function(y){return n=y,o}}}function pw(){return{}}function dw(e,i,r){e[i]=r}function Sy(){return map()}function wy(e,i,r){e.set(i,r)}function Gv(){}var Rp=Rm.prototype;Gv.prototype=vw.prototype={constructor:Gv,has:Rp.has,add:function(e){return e+="",this[wc+e]=e,this},remove:Rp.remove,clear:Rp.clear,values:Rp.keys,size:Rp.size,empty:Rp.empty,each:Rp.each};function vw(e,i){var r=new Gv;if(e instanceof Gv)e.each(function(u){r.add(u)});else if(e){var n=-1,o=e.length;if(i==null)for(;++n<o;)r.add(e[n]);else for(;++n<o;)r.add(i(e[n],n,e))}return r}var yP=null,Ty=Array.prototype,Hv=Ty.map,Lp=Ty.slice;function Wh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function _P(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var Ay={name:"implicit"};function Wv(){var e=Rm(),i=[],r=[],n=Ay;function o(u){var v=u+"",y=e.get(v);if(!y){if(n!==Ay)return n;e.set(v,y=i.push(u))}return r[(y-1)%r.length]}return o.domain=function(u){if(!arguments.length)return i.slice();i=[],e=Rm();for(var v=-1,y=u.length,x,E;++v<y;)e.has(E=(x=u[v])+"")||e.set(E,i.push(x));return o},o.range=function(u){return arguments.length?(r=Lp.call(u),o):r.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.copy=function(){return Wv(i,r).unknown(n)},Wh.apply(o,arguments),o}function Cy(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],o,u,v=!1,y=0,x=0,E=.5;delete e.unknown;function P(){var I=i().length,D=n[1]<n[0],Z=n[D-0],te=n[1-D];o=(te-Z)/Math.max(1,I-y+x*2),v&&(o=Math.floor(o)),Z+=(te-Z-o*(I-y))*E,u=o*(1-y),v&&(Z=Math.round(Z),u=Math.round(u));var le=sequence(I).map(function(ve){return Z+o*ve});return r(D?le.reverse():le)}return e.domain=function(I){return arguments.length?(i(I),P()):i()},e.range=function(I){return arguments.length?(n=[+I[0],+I[1]],P()):n.slice()},e.rangeRound=function(I){return n=[+I[0],+I[1]],v=!0,P()},e.bandwidth=function(){return u},e.step=function(){return o},e.round=function(I){return arguments.length?(v=!!I,P()):v},e.padding=function(I){return arguments.length?(y=Math.min(1,x=+I),P()):y},e.paddingInner=function(I){return arguments.length?(y=Math.min(1,I),P()):y},e.paddingOuter=function(I){return arguments.length?(x=+I,P()):x},e.align=function(I){return arguments.length?(E=Math.max(0,Math.min(1,I)),P()):E},e.copy=function(){return Cy(i(),n).round(v).paddingInner(y).paddingOuter(x).align(E)},initRange.apply(P(),arguments)}function My(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return My(i())},e}function xP(){return My(Cy.apply(null,arguments).paddingInner(1))}var mw=L(26257),gw=L(73626);function yw(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function _w(e){return function(){return e}}function Lm(e){return+e}var Py=[0,1];function Tc(e){return e}function km(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:_w(isNaN(i)?NaN:.5)}function Iy(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(o){return Math.max(i,Math.min(r,o))}}function xw(e,i,r){var n=e[0],o=e[1],u=i[0],v=i[1];return o<n?(n=km(o,n),u=r(v,u)):(n=km(n,o),u=r(u,v)),function(y){return u(n(y))}}function bw(e,i,r){var n=Math.min(e.length,i.length)-1,o=new Array(n),u=new Array(n),v=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++v<n;)o[v]=km(e[v],e[v+1]),u[v]=r(i[v],i[v+1]);return function(y){var x=Zv(e,y,1,n)-1;return u[x](o[x](y))}}function Xv(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Dm(){var e=Py,i=Py,r=mw.Z,n,o,u,v=Tc,y,x,E;function P(){return y=Math.min(e.length,i.length)>2?bw:xw,x=E=null,I}function I(D){return isNaN(D=+D)?u:(x||(x=y(e.map(n),i,r)))(n(v(D)))}return I.invert=function(D){return v(o((E||(E=y(i,e.map(n),gw.Z)))(D)))},I.domain=function(D){return arguments.length?(e=Hv.call(D,Lm),v===Tc||(v=Iy(e)),P()):e.slice()},I.range=function(D){return arguments.length?(i=Lp.call(D),P()):i.slice()},I.rangeRound=function(D){return i=Lp.call(D),r=yw,P()},I.clamp=function(D){return arguments.length?(v=D?Iy(e):Tc,I):v!==Tc},I.interpolate=function(D){return arguments.length?(r=D,P()):r},I.unknown=function(D){return arguments.length?(u=D,I):u},function(D,Z){return n=D,o=Z,P()}}function Oy(e,i){return Dm()(e,i)}var Ew=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Yv(e){if(!(i=Ew.exec(e)))throw new Error("invalid format: "+e);var i;return new Fm({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}Yv.prototype=Fm.prototype;function Fm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Fm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Sw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Kv(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function fd(e){return e=Kv(Math.abs(e)),e?e[1]:NaN}function ww(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(fd(i)/3)))*3-fd(Math.abs(e)))}function Tw(e,i){return function(r,n){for(var o=r.length,u=[],v=0,y=e[0],x=0;o>0&&y>0&&(x+y+1>n&&(y=Math.max(1,n-x)),u.push(r.substring(o-=y,o+y)),!((x+=y+1)>n));)y=e[v=(v+1)%e.length];return u.reverse().join(i)}}function Aw(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function Cw(e){e:for(var i=e.length,r=1,n=-1,o;r<i;++r)switch(e[r]){case".":n=o=r;break;case"0":n===0&&(n=r),o=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(o+1):e}var Ry;function Mw(e,i){var r=Kv(e,i);if(!r)return e+"";var n=r[0],o=r[1],u=o-(Ry=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,v=n.length;return u===v?n:u>v?n+new Array(u-v+1).join("0"):u>0?n.slice(0,u)+"."+n.slice(u):"0."+new Array(1-u).join("0")+Kv(e,Math.max(0,i+u-1))[0]}function Ly(e,i){var r=Kv(e,i);if(!r)return e+"";var n=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+n:n.length>o+1?n.slice(0,o+1)+"."+n.slice(o+1):n+new Array(o-n.length+2).join("0")}var ky={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:Sw,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return Ly(e*100,i)},r:Ly,s:Mw,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Dy(e){return e}var Fy=Array.prototype.map,Ny=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Pw(e){var i=e.grouping===void 0||e.thousands===void 0?Dy:Tw(Fy.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",u=e.numerals===void 0?Dy:Aw(Fy.call(e.numerals,String)),v=e.percent===void 0?"%":e.percent+"",y=e.minus===void 0?"-":e.minus+"",x=e.nan===void 0?"NaN":e.nan+"";function E(I){I=Yv(I);var D=I.fill,Z=I.align,te=I.sign,le=I.symbol,ve=I.zero,Be=I.width,it=I.comma,yt=I.precision,wt=I.trim,jt=I.type;jt==="n"?(it=!0,jt="g"):ky[jt]||(yt===void 0&&(yt=12),wt=!0,jt="g"),(ve||D==="0"&&Z==="=")&&(ve=!0,D="0",Z="=");var Wt=le==="$"?r:le==="#"&&/[boxX]/.test(jt)?"0"+jt.toLowerCase():"",nr=le==="$"?n:/[%p]/.test(jt)?v:"",mr=ky[jt],tn=/[defgprs%]/.test(jt);yt=yt===void 0?6:/[gprs]/.test(jt)?Math.max(1,Math.min(21,yt)):Math.max(0,Math.min(20,yt));function vn(Pr){var In=Wt,Gn=nr,yi,Lo,As;if(jt==="c")Gn=mr(Pr)+Gn,Pr="";else{Pr=+Pr;var nl=Pr<0||1/Pr<0;if(Pr=isNaN(Pr)?x:mr(Math.abs(Pr),yt),wt&&(Pr=Cw(Pr)),nl&&+Pr==0&&te!=="+"&&(nl=!1),In=(nl?te==="("?te:y:te==="-"||te==="("?"":te)+In,Gn=(jt==="s"?Ny[8+Ry/3]:"")+Gn+(nl&&te==="("?")":""),tn){for(yi=-1,Lo=Pr.length;++yi<Lo;)if(As=Pr.charCodeAt(yi),48>As||As>57){Gn=(As===46?o+Pr.slice(yi+1):Pr.slice(yi))+Gn,Pr=Pr.slice(0,yi);break}}}it&&!ve&&(Pr=i(Pr,Infinity));var Ac=In.length+Pr.length+Gn.length,bl=Ac<Be?new Array(Be-Ac+1).join(D):"";switch(it&&ve&&(Pr=i(bl+Pr,bl.length?Be-Gn.length:Infinity),bl=""),Z){case"<":Pr=In+Pr+Gn+bl;break;case"=":Pr=In+bl+Pr+Gn;break;case"^":Pr=bl.slice(0,Ac=bl.length>>1)+In+Pr+Gn+bl.slice(Ac);break;default:Pr=bl+In+Pr+Gn;break}return u(Pr)}return vn.toString=function(){return I+""},vn}function P(I,D){var Z=E((I=Yv(I),I.type="f",I)),te=Math.max(-8,Math.min(8,Math.floor(fd(D)/3)))*3,le=Math.pow(10,-te),ve=Ny[8+te/3];return function(Be){return Z(le*Be)+ve}}return{format:E,formatPrefix:P}}var qv,Nm,By;Iw({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Iw(e){return qv=Pw(e),Nm=qv.format,By=qv.formatPrefix,qv}function Ow(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,fd(i)-fd(e))+1}function Rw(e){return Math.max(0,-fd(Math.abs(e)))}function Lw(e,i,r,n){var o=Om(e,i,r),u;switch(n=Yv(n==null?",f":n),n.type){case"s":{var v=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(u=ww(o,v))&&(n.precision=u),By(n,v)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(u=Ow(o,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=u-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(u=Rw(o))&&(n.precision=u-(n.type==="%")*2);break}}return Nm(n)}function $v(e){var i=e.domain;return e.ticks=function(r){var n=i();return by(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var o=i();return Lw(o[0],o[o.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),o=0,u=n.length-1,v=n[o],y=n[u],x;return y<v&&(x=v,v=y,y=x,x=o,o=u,u=x),x=Vv(v,y,r),x>0?(v=Math.floor(v/x)*x,y=Math.ceil(y/x)*x,x=Vv(v,y,r)):x<0&&(v=Math.ceil(v*x)/x,y=Math.floor(y*x)/x,x=Vv(v,y,r)),x>0?(n[o]=Math.floor(v/x)*x,n[u]=Math.ceil(y/x)*x,i(n)):x<0&&(n[o]=Math.ceil(v*x)/x,n[u]=Math.floor(y*x)/x,i(n)),e},e}function zy(){var e=Oy(Tc,Tc);return e.copy=function(){return Xv(e,zy())},Wh.apply(e,arguments),$v(e)}function Uy(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Hv.call(n,Lm),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return Uy(e).unknown(i)},e=arguments.length?Hv.call(e,Lm):[0,1],$v(r)}function Zy(e,i){e=e.slice();var r=0,n=e.length-1,o=e[r],u=e[n],v;return u<o&&(v=r,r=n,n=v,v=o,o=u,u=v),e[r]=i.floor(o),e[n]=i.ceil(u),e}function Vy(e){return Math.log(e)}function jy(e){return Math.exp(e)}function kw(e){return-Math.log(-e)}function Dw(e){return-Math.exp(-e)}function Fw(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Nw(e){return e===10?Fw:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function Bw(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function Gy(e){return function(i){return-e(-i)}}function zw(e){var i=e(Vy,jy),r=i.domain,n=10,o,u;function v(){return o=Bw(n),u=Nw(n),r()[0]<0?(o=Gy(o),u=Gy(u),e(kw,Dw)):e(Vy,jy),i}return i.base=function(y){return arguments.length?(n=+y,v()):n},i.domain=function(y){return arguments.length?(r(y),v()):r()},i.ticks=function(y){var x=r(),E=x[0],P=x[x.length-1],I;(I=P<E)&&(D=E,E=P,P=D);var D=o(E),Z=o(P),te,le,ve,Be=y==null?10:+y,it=[];if(!(n%1)&&Z-D<Be){if(D=Math.round(D)-1,Z=Math.round(Z)+1,E>0){for(;D<Z;++D)for(le=1,te=u(D);le<n;++le)if(ve=te*le,!(ve<E)){if(ve>P)break;it.push(ve)}}else for(;D<Z;++D)for(le=n-1,te=u(D);le>=1;--le)if(ve=te*le,!(ve<E)){if(ve>P)break;it.push(ve)}}else it=by(D,Z,Math.min(Z-D,Be)).map(u);return I?it.reverse():it},i.tickFormat=function(y,x){if(x==null&&(x=n===10?".0e":","),typeof x!="function"&&(x=Nm(x)),y===Infinity)return x;y==null&&(y=10);var E=Math.max(1,n*y/i.ticks().length);return function(P){var I=P/u(Math.round(o(P)));return I*n<n-.5&&(I*=n),I<=E?x(P):""}},i.nice=function(){return r(Zy(r(),{floor:function(y){return u(Math.floor(o(y)))},ceil:function(y){return u(Math.ceil(o(y)))}}))},i}function Hy(){var e=zw(Dm()).domain([1,10]);return e.copy=function(){return Xv(e,Hy()).base(e.base())},Wh.apply(e,arguments),e}function Wy(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function Xy(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function Uw(e){var i=1,r=e(Wy(i),Xy(i));return r.constant=function(n){return arguments.length?e(Wy(i=+n),Xy(i)):i},linearish(r)}function Zw(){var e=Uw(transformer());return e.copy=function(){return copy(e,Zw()).constant(e.constant())},initRange.apply(e,arguments)}function Yy(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function Vw(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function jw(e){return e<0?-e*e:e*e}function Gw(e){var i=e(Tc,Tc),r=1;function n(){return r===1?e(Tc,Tc):r===.5?e(Vw,jw):e(Yy(r),Yy(1/r))}return i.exponent=function(o){return arguments.length?(r=+o,n()):r},$v(i)}function Bm(){var e=Gw(Dm());return e.copy=function(){return Xv(e,Bm()).exponent(e.exponent())},Wh.apply(e,arguments),e}function bP(){return Bm.apply(null,arguments).exponent(.5)}function Ky(){var e=[],i=[],r=[],n;function o(){var v=0,y=Math.max(1,i.length);for(r=new Array(y-1);++v<y;)r[v-1]=hw(e,v/y);return u}function u(v){return isNaN(v=+v)?n:i[Zv(r,v)]}return u.invertExtent=function(v){var y=i.indexOf(v);return y<0?[NaN,NaN]:[y>0?r[y-1]:e[0],y<r.length?r[y]:e[e.length-1]]},u.domain=function(v){if(!arguments.length)return e.slice();e=[];for(var y=0,x=v.length,E;y<x;++y)E=v[y],E!=null&&!isNaN(E=+E)&&e.push(E);return e.sort(Cm),o()},u.range=function(v){return arguments.length?(i=Lp.call(v),o()):i.slice()},u.unknown=function(v){return arguments.length?(n=v,u):n},u.quantiles=function(){return r.slice()},u.copy=function(){return Ky().domain(e).range(i).unknown(n)},Wh.apply(u,arguments)}function qy(){var e=0,i=1,r=1,n=[.5],o=[0,1],u;function v(x){return x<=x?o[Zv(n,x,0,r)]:u}function y(){var x=-1;for(n=new Array(r);++x<r;)n[x]=((x+1)*i-(x-r)*e)/(r+1);return v}return v.domain=function(x){return arguments.length?(e=+x[0],i=+x[1],y()):[e,i]},v.range=function(x){return arguments.length?(r=(o=Lp.call(x)).length-1,y()):o.slice()},v.invertExtent=function(x){var E=o.indexOf(x);return E<0?[NaN,NaN]:E<1?[e,n[0]]:E>=r?[n[r-1],i]:[n[E-1],n[E]]},v.unknown=function(x){return arguments.length&&(u=x),v},v.thresholds=function(){return n.slice()},v.copy=function(){return qy().domain([e,i]).range(o).unknown(u)},Wh.apply($v(v),arguments)}function $y(){var e=[.5],i=[0,1],r,n=1;function o(u){return u<=u?i[Zv(e,u,0,n)]:r}return o.domain=function(u){return arguments.length?(e=Lp.call(u),n=Math.min(e.length,i.length-1),o):e.slice()},o.range=function(u){return arguments.length?(i=Lp.call(u),n=Math.min(e.length,i.length-1),o):i.slice()},o.invertExtent=function(u){var v=i.indexOf(u);return[e[v-1],e[v]]},o.unknown=function(u){return arguments.length?(r=u,o):r},o.copy=function(){return $y().domain(e).range(i).unknown(r)},Wh.apply(o,arguments)}var zm=new Date,Um=new Date;function rl(e,i,r,n){function o(u){return e(u=arguments.length===0?new Date:new Date(+u)),u}return o.floor=function(u){return e(u=new Date(+u)),u},o.ceil=function(u){return e(u=new Date(u-1)),i(u,1),e(u),u},o.round=function(u){var v=o(u),y=o.ceil(u);return u-v<y-u?v:y},o.offset=function(u,v){return i(u=new Date(+u),v==null?1:Math.floor(v)),u},o.range=function(u,v,y){var x=[],E;if(u=o.ceil(u),y=y==null?1:Math.floor(y),!(u<v)||!(y>0))return x;do x.push(E=new Date(+u)),i(u,y),e(u);while(E<u&&u<v);return x},o.filter=function(u){return rl(function(v){if(v>=v)for(;e(v),!u(v);)v.setTime(v-1)},function(v,y){if(v>=v)if(y<0)for(;++y<=0;)for(;i(v,-1),!u(v););else for(;--y>=0;)for(;i(v,1),!u(v););})},r&&(o.count=function(u,v){return zm.setTime(+u),Um.setTime(+v),e(zm),e(Um),Math.floor(r(zm,Um))},o.every=function(u){return u=Math.floor(u),!isFinite(u)||!(u>0)?null:u>1?o.filter(n?function(v){return n(v)%u==0}:function(v){return o.count(0,v)%u==0}):o}),o}var Zm=rl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Zm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:rl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var hd=Zm,EP=Zm.range,Jy=rl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),Hw=Jy,SP=Jy.range,Jv=1e3,Kd=6e4,Qy=36e5,e_=864e5,t_=6048e5;function kp(e){return rl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*Kd)/t_})}var Vm=kp(0),Qv=kp(1),Ww=kp(2),Xw=kp(3),pd=kp(4),Yw=kp(5),Kw=kp(6),wP=Vm.range,TP=Qv.range,AP=Ww.range,CP=Xw.range,MP=pd.range,PP=Yw.range,IP=Kw.range,r_=rl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*Kd)/e_},function(e){return e.getDate()-1}),jm=r_,OP=r_.range,n_=rl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Jv-e.getMinutes()*Kd)},function(e,i){e.setTime(+e+i*Qy)},function(e,i){return(i-e)/Qy},function(e){return e.getHours()}),qw=n_,RP=n_.range,i_=rl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Jv)},function(e,i){e.setTime(+e+i*Kd)},function(e,i){return(i-e)/Kd},function(e){return e.getMinutes()}),$w=i_,LP=i_.range,a_=rl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*Jv)},function(e,i){return(i-e)/Jv},function(e){return e.getUTCSeconds()}),Jw=a_,kP=a_.range,em=rl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});em.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?rl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):em};var Qw=em,DP=em.range;function Dp(e){return rl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/t_})}var o_=Dp(0),tm=Dp(1),eT=Dp(2),tT=Dp(3),dd=Dp(4),rT=Dp(5),nT=Dp(6),FP=o_.range,NP=tm.range,BP=eT.range,zP=tT.range,UP=dd.range,ZP=rT.range,VP=nT.range,s_=rl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/e_},function(e){return e.getUTCDate()-1}),u_=s_,jP=s_.range,Gm=rl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Gm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:rl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var qd=Gm,GP=Gm.range;function Hm(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Wm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function $d(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function iT(e){var i=e.dateTime,r=e.date,n=e.time,o=e.periods,u=e.days,v=e.shortDays,y=e.months,x=e.shortMonths,E=Jd(o),P=Qd(o),I=Jd(u),D=Qd(u),Z=Jd(v),te=Qd(v),le=Jd(y),ve=Qd(y),Be=Jd(x),it=Qd(x),yt={a:nl,A:Ac,b:bl,B:IM,c:null,d:d_,e:d_,f:CT,g:NT,G:zT,H:wT,I:TT,j:AT,L:v_,m:MT,M:PT,p:OM,q:RM,Q:b_,s:E_,S:IT,u:OT,U:RT,V:LT,w:kT,W:DT,x:null,X:null,y:FT,Y:BT,Z:UT,"%":x_},wt={a:LM,A:kM,b:DM,B:FM,c:null,d:g_,e:g_,f:GT,g:eA,G:rA,H:ZT,I:VT,j:jT,L:y_,m:HT,M:WT,p:NM,q:BM,Q:b_,s:E_,S:XT,u:YT,U:KT,V:qT,w:$T,W:JT,x:null,X:null,y:QT,Y:tA,Z:nA,"%":x_},jt={a:vn,A:Pr,b:In,B:Gn,c:yi,d:h_,e:h_,f:xT,g:f_,G:c_,H:p_,I:p_,j:mT,L:_T,m:vT,M:gT,p:tn,q:dT,Q:ET,s:ST,S:yT,u:lT,U:cT,V:fT,w:uT,W:hT,x:Lo,X:As,y:f_,Y:c_,Z:pT,"%":bT};yt.x=Wt(r,yt),yt.X=Wt(n,yt),yt.c=Wt(i,yt),wt.x=Wt(r,wt),wt.X=Wt(n,wt),wt.c=Wt(i,wt);function Wt(oi,La){return function(eo){var dn=[],El=-1,Uo=0,ql=oi.length,$l,Np,ix;for(eo instanceof Date||(eo=new Date(+eo));++El<ql;)oi.charCodeAt(El)===37&&(dn.push(oi.slice(Uo,El)),(Np=l_[$l=oi.charAt(++El)])!=null?$l=oi.charAt(++El):Np=$l==="e"?" ":"0",(ix=La[$l])&&($l=ix(eo,Np)),dn.push($l),Uo=El+1);return dn.push(oi.slice(Uo,El)),dn.join("")}}function nr(oi,La){return function(eo){var dn=$d(1900,void 0,1),El=mr(dn,oi,eo+="",0),Uo,ql;if(El!=eo.length)return null;if("Q"in dn)return new Date(dn.Q);if("s"in dn)return new Date(dn.s*1e3+("L"in dn?dn.L:0));if(La&&!("Z"in dn)&&(dn.Z=0),"p"in dn&&(dn.H=dn.H%12+dn.p*12),dn.m===void 0&&(dn.m="q"in dn?dn.q:0),"V"in dn){if(dn.V<1||dn.V>53)return null;"w"in dn||(dn.w=1),"Z"in dn?(Uo=Wm($d(dn.y,0,1)),ql=Uo.getUTCDay(),Uo=ql>4||ql===0?tm.ceil(Uo):tm(Uo),Uo=u_.offset(Uo,(dn.V-1)*7),dn.y=Uo.getUTCFullYear(),dn.m=Uo.getUTCMonth(),dn.d=Uo.getUTCDate()+(dn.w+6)%7):(Uo=Hm($d(dn.y,0,1)),ql=Uo.getDay(),Uo=ql>4||ql===0?Qv.ceil(Uo):Qv(Uo),Uo=jm.offset(Uo,(dn.V-1)*7),dn.y=Uo.getFullYear(),dn.m=Uo.getMonth(),dn.d=Uo.getDate()+(dn.w+6)%7)}else("W"in dn||"U"in dn)&&("w"in dn||(dn.w="u"in dn?dn.u%7:"W"in dn?1:0),ql="Z"in dn?Wm($d(dn.y,0,1)).getUTCDay():Hm($d(dn.y,0,1)).getDay(),dn.m=0,dn.d="W"in dn?(dn.w+6)%7+dn.W*7-(ql+5)%7:dn.w+dn.U*7-(ql+6)%7);return"Z"in dn?(dn.H+=dn.Z/100|0,dn.M+=dn.Z%100,Wm(dn)):Hm(dn)}}function mr(oi,La,eo,dn){for(var El=0,Uo=La.length,ql=eo.length,$l,Np;El<Uo;){if(dn>=ql)return-1;if($l=La.charCodeAt(El++),$l===37){if($l=La.charAt(El++),Np=jt[$l in l_?La.charAt(El++):$l],!Np||(dn=Np(oi,eo,dn))<0)return-1}else if($l!=eo.charCodeAt(dn++))return-1}return dn}function tn(oi,La,eo){var dn=E.exec(La.slice(eo));return dn?(oi.p=P[dn[0].toLowerCase()],eo+dn[0].length):-1}function vn(oi,La,eo){var dn=Z.exec(La.slice(eo));return dn?(oi.w=te[dn[0].toLowerCase()],eo+dn[0].length):-1}function Pr(oi,La,eo){var dn=I.exec(La.slice(eo));return dn?(oi.w=D[dn[0].toLowerCase()],eo+dn[0].length):-1}function In(oi,La,eo){var dn=Be.exec(La.slice(eo));return dn?(oi.m=it[dn[0].toLowerCase()],eo+dn[0].length):-1}function Gn(oi,La,eo){var dn=le.exec(La.slice(eo));return dn?(oi.m=ve[dn[0].toLowerCase()],eo+dn[0].length):-1}function yi(oi,La,eo){return mr(oi,i,La,eo)}function Lo(oi,La,eo){return mr(oi,r,La,eo)}function As(oi,La,eo){return mr(oi,n,La,eo)}function nl(oi){return v[oi.getDay()]}function Ac(oi){return u[oi.getDay()]}function bl(oi){return x[oi.getMonth()]}function IM(oi){return y[oi.getMonth()]}function OM(oi){return o[+(oi.getHours()>=12)]}function RM(oi){return 1+~~(oi.getMonth()/3)}function LM(oi){return v[oi.getUTCDay()]}function kM(oi){return u[oi.getUTCDay()]}function DM(oi){return x[oi.getUTCMonth()]}function FM(oi){return y[oi.getUTCMonth()]}function NM(oi){return o[+(oi.getUTCHours()>=12)]}function BM(oi){return 1+~~(oi.getUTCMonth()/3)}return{format:function(oi){var La=Wt(oi+="",yt);return La.toString=function(){return oi},La},parse:function(oi){var La=nr(oi+="",!1);return La.toString=function(){return oi},La},utcFormat:function(oi){var La=Wt(oi+="",wt);return La.toString=function(){return oi},La},utcParse:function(oi){var La=nr(oi+="",!0);return La.toString=function(){return oi},La}}}var l_={"-":"",_:" ","0":"0"},cu=/^\s*\d+/,aT=/^%/,oT=/[\\^$*+?|[\]().{}]/g;function Qa(e,i,r){var n=e<0?"-":"",o=(n?-e:e)+"",u=o.length;return n+(u<r?new Array(r-u+1).join(i)+o:o)}function sT(e){return e.replace(oT,"\\$&")}function Jd(e){return new RegExp("^(?:"+e.map(sT).join("|")+")","i")}function Qd(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function uT(e,i,r){var n=cu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function lT(e,i,r){var n=cu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function cT(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function fT(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function hT(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function c_(e,i,r){var n=cu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function f_(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function pT(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function dT(e,i,r){var n=cu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function vT(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function h_(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function mT(e,i,r){var n=cu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function p_(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function gT(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function yT(e,i,r){var n=cu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function _T(e,i,r){var n=cu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function xT(e,i,r){var n=cu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function bT(e,i,r){var n=aT.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function ET(e,i,r){var n=cu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function ST(e,i,r){var n=cu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function d_(e,i){return Qa(e.getDate(),i,2)}function wT(e,i){return Qa(e.getHours(),i,2)}function TT(e,i){return Qa(e.getHours()%12||12,i,2)}function AT(e,i){return Qa(1+jm.count(hd(e),e),i,3)}function v_(e,i){return Qa(e.getMilliseconds(),i,3)}function CT(e,i){return v_(e,i)+"000"}function MT(e,i){return Qa(e.getMonth()+1,i,2)}function PT(e,i){return Qa(e.getMinutes(),i,2)}function IT(e,i){return Qa(e.getSeconds(),i,2)}function OT(e){var i=e.getDay();return i===0?7:i}function RT(e,i){return Qa(Vm.count(hd(e)-1,e),i,2)}function m_(e){var i=e.getDay();return i>=4||i===0?pd(e):pd.ceil(e)}function LT(e,i){return e=m_(e),Qa(pd.count(hd(e),e)+(hd(e).getDay()===4),i,2)}function kT(e){return e.getDay()}function DT(e,i){return Qa(Qv.count(hd(e)-1,e),i,2)}function FT(e,i){return Qa(e.getFullYear()%100,i,2)}function NT(e,i){return e=m_(e),Qa(e.getFullYear()%100,i,2)}function BT(e,i){return Qa(e.getFullYear()%1e4,i,4)}function zT(e,i){var r=e.getDay();return e=r>=4||r===0?pd(e):pd.ceil(e),Qa(e.getFullYear()%1e4,i,4)}function UT(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+Qa(i/60|0,"0",2)+Qa(i%60,"0",2)}function g_(e,i){return Qa(e.getUTCDate(),i,2)}function ZT(e,i){return Qa(e.getUTCHours(),i,2)}function VT(e,i){return Qa(e.getUTCHours()%12||12,i,2)}function jT(e,i){return Qa(1+u_.count(qd(e),e),i,3)}function y_(e,i){return Qa(e.getUTCMilliseconds(),i,3)}function GT(e,i){return y_(e,i)+"000"}function HT(e,i){return Qa(e.getUTCMonth()+1,i,2)}function WT(e,i){return Qa(e.getUTCMinutes(),i,2)}function XT(e,i){return Qa(e.getUTCSeconds(),i,2)}function YT(e){var i=e.getUTCDay();return i===0?7:i}function KT(e,i){return Qa(o_.count(qd(e)-1,e),i,2)}function __(e){var i=e.getUTCDay();return i>=4||i===0?dd(e):dd.ceil(e)}function qT(e,i){return e=__(e),Qa(dd.count(qd(e),e)+(qd(e).getUTCDay()===4),i,2)}function $T(e){return e.getUTCDay()}function JT(e,i){return Qa(tm.count(qd(e)-1,e),i,2)}function QT(e,i){return Qa(e.getUTCFullYear()%100,i,2)}function eA(e,i){return e=__(e),Qa(e.getUTCFullYear()%100,i,2)}function tA(e,i){return Qa(e.getUTCFullYear()%1e4,i,4)}function rA(e,i){var r=e.getUTCDay();return e=r>=4||r===0?dd(e):dd.ceil(e),Qa(e.getUTCFullYear()%1e4,i,4)}function nA(){return"+0000"}function x_(){return"%"}function b_(e){return+e}function E_(e){return Math.floor(+e/1e3)}var vd,S_,iA,aA,oA;sA({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function sA(e){return vd=iT(e),S_=vd.format,iA=vd.parse,aA=vd.utcFormat,oA=vd.utcParse,vd}var ev=1e3,tv=ev*60,rv=tv*60,nv=rv*24,uA=nv*7,w_=nv*30,Xm=nv*365;function lA(e){return new Date(e)}function cA(e){return e instanceof Date?+e:+new Date(+e)}function T_(e,i,r,n,o,u,v,y,x){var E=Oy(Tc,Tc),P=E.invert,I=E.domain,D=x(".%L"),Z=x(":%S"),te=x("%I:%M"),le=x("%I %p"),ve=x("%a %d"),Be=x("%b %d"),it=x("%B"),yt=x("%Y"),wt=[[v,1,ev],[v,5,5*ev],[v,15,15*ev],[v,30,30*ev],[u,1,tv],[u,5,5*tv],[u,15,15*tv],[u,30,30*tv],[o,1,rv],[o,3,3*rv],[o,6,6*rv],[o,12,12*rv],[n,1,nv],[n,2,2*nv],[r,1,uA],[i,1,w_],[i,3,3*w_],[e,1,Xm]];function jt(nr){return(v(nr)<nr?D:u(nr)<nr?Z:o(nr)<nr?te:n(nr)<nr?le:i(nr)<nr?r(nr)<nr?ve:Be:e(nr)<nr?it:yt)(nr)}function Wt(nr,mr,tn,vn){if(nr==null&&(nr=10),typeof nr=="number"){var Pr=Math.abs(tn-mr)/nr,In=yy(function(Gn){return Gn[2]}).right(wt,Pr);In===wt.length?(vn=Om(mr/Xm,tn/Xm,nr),nr=e):In?(In=wt[Pr/wt[In-1][2]<wt[In][2]/Pr?In-1:In],vn=In[1],nr=In[0]):(vn=Math.max(Om(mr,tn,nr),1),nr=y)}return vn==null?nr:nr.every(vn)}return E.invert=function(nr){return new Date(P(nr))},E.domain=function(nr){return arguments.length?I(Hv.call(nr,cA)):I().map(lA)},E.ticks=function(nr,mr){var tn=I(),vn=tn[0],Pr=tn[tn.length-1],In=Pr<vn,Gn;return In&&(Gn=vn,vn=Pr,Pr=Gn),Gn=Wt(nr,vn,Pr,mr),Gn=Gn?Gn.range(vn,Pr+1):[],In?Gn.reverse():Gn},E.tickFormat=function(nr,mr){return mr==null?jt:x(mr)},E.nice=function(nr,mr){var tn=I();return(nr=Wt(nr,tn[0],tn[tn.length-1],mr))?I(Zy(tn,nr)):E},E.copy=function(){return Xv(E,T_(e,i,r,n,o,u,v,y,x))},E}function fA(){return Wh.apply(T_(hd,Hw,Vm,jm,qw,$w,Jw,Qw,S_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function HP(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function rm(){var e=0,i=1,r,n,o,u,v=identity,y=!1,x;function E(P){return isNaN(P=+P)?x:v(o===0?.5:(P=(u(P)-r)*o,y?Math.max(0,Math.min(1,P)):P))}return E.domain=function(P){return arguments.length?(r=u(e=+P[0]),n=u(i=+P[1]),o=r===n?0:1/(n-r),E):[e,i]},E.clamp=function(P){return arguments.length?(y=!!P,E):y},E.interpolator=function(P){return arguments.length?(v=P,E):v},E.unknown=function(P){return arguments.length?(x=P,E):x},function(P){return u=P,r=P(e),n=P(i),o=r===n?0:1/(n-r),E}}function nm(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function hA(){var e=linearish(rm()(identity));return e.copy=function(){return nm(e,hA())},initInterpolator.apply(e,arguments)}function pA(){var e=loggish(rm()).domain([1,10]);return e.copy=function(){return nm(e,pA()).base(e.base())},initInterpolator.apply(e,arguments)}function dA(){var e=symlogish(rm());return e.copy=function(){return nm(e,dA()).constant(e.constant())},initInterpolator.apply(e,arguments)}function A_(){var e=powish(rm());return e.copy=function(){return nm(e,A_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function WP(){return A_.apply(null,arguments).exponent(.5)}function vA(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var o=0,u=n.length,v;o<u;++o)v=n[o],v!=null&&!isNaN(v=+v)&&e.push(v);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return vA(i).domain(e)},initInterpolator.apply(r,arguments)}function im(){var e=0,i=.5,r=1,n,o,u,v,y,x=identity,E,P=!1,I;function D(Z){return isNaN(Z=+Z)?I:(Z=.5+((Z=+E(Z))-o)*(Z<o?v:y),x(P?Math.max(0,Math.min(1,Z)):Z))}return D.domain=function(Z){return arguments.length?(n=E(e=+Z[0]),o=E(i=+Z[1]),u=E(r=+Z[2]),v=n===o?0:.5/(o-n),y=o===u?0:.5/(u-o),D):[e,i,r]},D.clamp=function(Z){return arguments.length?(P=!!Z,D):P},D.interpolator=function(Z){return arguments.length?(x=Z,D):x},D.unknown=function(Z){return arguments.length?(I=Z,D):I},function(Z){return E=Z,n=Z(e),o=Z(i),u=Z(r),v=n===o?0:.5/(o-n),y=o===u?0:.5/(u-o),D}}function mA(){var e=linearish(im()(identity));return e.copy=function(){return copy(e,mA())},initInterpolator.apply(e,arguments)}function gA(){var e=loggish(im()).domain([.1,1,10]);return e.copy=function(){return copy(e,gA()).base(e.base())},initInterpolator.apply(e,arguments)}function yA(){var e=symlogish(im());return e.copy=function(){return copy(e,yA()).constant(e.constant())},initInterpolator.apply(e,arguments)}function C_(){var e=powish(im());return e.copy=function(){return copy(e,C_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function XP(){return C_.apply(null,arguments).exponent(.5)}var Jc,M_,P_,I_,Ym,O_,_A=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,xA=(Jc={},(0,T.Z)(Jc,Qs.LINEAR,zy),(0,T.Z)(Jc,Qs.POWER,Bm),(0,T.Z)(Jc,Qs.LOG,Hy),(0,T.Z)(Jc,Qs.IDENTITY,Uy),(0,T.Z)(Jc,Qs.TIME,fA),(0,T.Z)(Jc,Qs.QUANTILE,Ky),(0,T.Z)(Jc,Qs.QUANTIZE,qy),(0,T.Z)(Jc,Qs.THRESHOLD,$y),(0,T.Z)(Jc,Qs.CAT,Wv),Jc),bA=(M_=(0,Lr.b2)(),P_=(0,Lr.f3)(qt.IGlobalConfigService),M_(I_=(Ym=function(){function e(){(0,St.Z)(this,e),Rn(this,"configService",O_,this),(0,T.Z)(this,"scaleCache",{}),(0,T.Z)(this,"scaleOptions",{})}return(0,Kt.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var v=u.getLayerStyleAttributes(),y=r.getSource().data.dataArray;y.length!==0&&o.caculateScalesForAttributes(v||[],y)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var v=u.getLayerStyleAttributes(),y=r.getSource().data.dataArray;return o.caculateScalesForAttributes(v||[],y),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){o.scaleOptions=r.getScaleOptions();var v=u.getLayerStyleAttributes();if(v){var y=r.getSource().data.dataArray;if(y.length===0)return;var x=v.filter(function(E){return E.needRescale});x.length&&o.caculateScalesForAttributes(x,y)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var o=this;this.scaleCache={},r.forEach(function(u){if(u.scale){var v=u.scale,y=u.name;v.names=o.parseFields(u.scale.field||[]);var x=[];v.names.forEach(function(E){x.push(o.getOrCreateScale(E,u,n))}),x.some(function(E){return E.type===Zh.VARIABLE})?(v.type=Zh.VARIABLE,x.forEach(function(E){if(!v.callback){var P;if(v.values&&v.values!=="text"){var I;if(((I=E.option)===null||I===void 0?void 0:I.type)==="linear"&&v.values.length>2){var D=E.scale.ticks(v.values.length);y==="color"&&E.scale.domain(D)}E.scale.range(v.values)}else((P=E.option)===null||P===void 0?void 0:P.type)==="cat"&&E.scale.range(E.option.domain)}})):(v.type=Zh.CONSTANT,v.defaultValues=x.map(function(E,P){return E.scale(v.names[P])})),v.scalers=x.map(function(E){return{field:E.field,func:E.scale,option:E.option}}),u.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,o){var u,v=[r,n.name].join("_"),y=(u=n.scale)===null||u===void 0?void 0:u.values,x=this.createScale(r,n.name,y,o);return x}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:zs()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,o,u){var v,y,x=this.scaleOptions[n]&&((v=this.scaleOptions[n])===null||v===void 0?void 0:v.field)===r?this.scaleOptions[n]:this.scaleOptions[r],E={field:r,scale:void 0,type:Zh.VARIABLE,option:x};if(!u||!u.length)return x&&x.type?E.scale=this.createDefaultScale(x):(E.scale=Wv([r]),E.type=Zh.CONSTANT),E;var P=(y=u.find(function(Z){return!Ti()(Z[r])}))===null||y===void 0?void 0:y[r];if(this.isNumber(r)||Ti()(P)&&!x)E.scale=Wv([r]),E.type=Zh.CONSTANT;else{var I=x&&x.type||this.getDefaultType(P);o==="text"&&(I=Qs.CAT);var D=this.createDefaultScaleConfig(I,r,u);Object.assign(D,x),E.scale=this.createDefaultScale(D),E.option=D}return E}},{key:"getDefaultType",value:function(r){var n=Qs.LINEAR;return typeof r=="string"&&(n=_A.test(r)?Qs.TIME:Qs.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,o){var u={type:r},v=(o==null?void 0:o.map(function(y){return y[n]}))||[];return r!==Qs.CAT&&r!==Qs.QUANTILE?u.domain=cw(v):r===Qs.CAT?u.domain=Fh()(v):r===Qs.QUANTILE&&(u.domain=v),u}},{key:"createDefaultScale",value:function(r){var n=r.type,o=r.domain,u=xA[n]();return o&&u.domain(o),u}}]),e}(),O_=Fn(Ym.prototype,"configService",[P_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ym))||I_),R_,L_,k_,D_,am,F_,N_;function B_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function EA(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?B_(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var SA=(R_=(0,Lr.b2)(),L_=(0,Lr.f3)(qt.ICameraService),k_=(0,Lr.f3)(qt.IRendererService),R_(D_=(am=function(){function e(){(0,St.Z)(this,e),Rn(this,"cameraService",F_,this),Rn(this,"rendererService",N_,this)}return(0,Kt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(EA({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),F_=Fn(am.prototype,"cameraService",[L_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N_=Fn(am.prototype,"rendererService",[k_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am))||D_),z_,U_,wA=(z_=(0,Lr.b2)(),z_(U_=function(){function e(){(0,St.Z)(this,e)}return(0,Kt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||U_),Z_,V_,TA=(Z_=(0,Lr.b2)(),Z_(V_=function(){function e(){(0,St.Z)(this,e)}return(0,Kt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),o=n.autoFit,u=n.fitBoundsOptions;o&&setTimeout(function(){r.fitBounds(u)},100)})}}]),e}())||V_),j_,G_,AA=["type"];function H_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function iv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?H_(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var W_={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},CA={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},MA={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},PA={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},YP=null;function IA(e){var i={u_DirectionalLights:new Array(3).fill(iv({},MA)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(iv({},PA)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[CA]),e.forEach(function(r,n){var o=r.type,u=o===void 0?"directional":o,v=(0,Yn.Z)(r,AA),y=W_[u].lights,x=W_[u].num,E=i[x];i[y][E]=iv(iv({},i[y][E]),v),i[x]++}),i}var OA=(j_=(0,Lr.b2)(),j_(G_=function(){function e(){(0,St.Z)(this,e)}return(0,Kt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),o=n.enableLighting;o&&r.models.forEach(function(u){return u.addUniforms(iv({},IA()))})})}}]),e}())||G_),X_,Y_,om={NONE:0,ENCODE:1,HIGHLIGHT:2},RA=(X_=(0,Lr.b2)(),X_(Y_=function(){function e(){(0,St.Z)(this,e)}return(0,Kt.Z)(e,[{key:"apply",value:function(r,n){var o=n.rendererService,u=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var v=r.getLayerConfig(),y=v.enablePicking;u.registerStyleAttribute({name:"pickingColor",type:Ii.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:d.FLOAT},size:3,update:function(E,P){var I=E.id;return y?Wu(I):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var v=r.getLayerConfig(),y=v.enablePicking;y&&r.isVisible()&&r.models.forEach(function(x){return x.addUniforms({u_PickingStage:om.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var v=r.getLayerConfig(),y=v.enablePicking;y&&r.isVisible()&&r.models.forEach(function(x){return x.addUniforms({u_PickingStage:om.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(v){var y=r.getLayerConfig(),x=y.highlightColor,E=typeof x=="string"?Fa(x):x||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Hu(new Uint8Array(v))}),r.models.forEach(function(P){return P.addUniforms({u_PickingStage:om.HIGHLIGHT,u_PickingColor:v,u_HighlightColor:E.map(function(I){return I*255})})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(v){var y=r.getLayerConfig(),x=y.selectColor,E=typeof x=="string"?Fa(x):x||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Hu(new Uint8Array(v))}),r.models.forEach(function(P){return P.addUniforms({u_PickingStage:om.HIGHLIGHT,u_PickingColor:v,u_HighlightColor:E.map(function(I){return I*255})})})})}}]),e}())||Y_),K_,q_,LA=(K_=(0,Lr.b2)(),K_(q_=function(){function e(){(0,St.Z)(this,e)}return(0,Kt.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){o.registerBuiltinAttributes(u)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:Ii.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:d.FLOAT},size:3,update:function(o,u,v){return v.length===2?[v[0],v[1],0]:[v[0],v[1],v[2]]}}}),r.registerStyleAttribute({name:"filter",type:Ii.Attribute,descriptor:{name:"filter",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(o,u){var v=o.filter;return v?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:Ii.Attribute,descriptor:{name:"a_Color",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:4,update:function(o,u){var v=o.color;return!v||!v.length?[1,1,1,1]:v}}}),r.registerStyleAttribute({name:"vertexId",type:Ii.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:d.DYNAMIC_DRAW,data:[],type:d.FLOAT},size:1,update:function(o,u,v,y){return[u]}}})}}]),e}())||q_),$_,J_,Q_,e1,t1,r1,md,n1,i1,a1,o1,kA=($_=(0,Lr.b2)(),J_=(0,Lr.f3)(qt.ICameraService),Q_=(0,Lr.f3)(qt.ICoordinateSystemService),e1=(0,Lr.f3)(qt.IRendererService),t1=(0,Lr.f3)(qt.IMapService),$_(r1=(md=function(){function e(){(0,St.Z)(this,e),Rn(this,"cameraService",n1,this),Rn(this,"coordinateSystemService",i1,this),Rn(this,"rendererService",a1,this),Rn(this,"mapService",o1,this)}return(0,Kt.Z)(e,[{key:"apply",value:function(r){var n=this,o=this.mapService.version,u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],v=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),o==="GAODE2.x"&&(u=n.mapService.map.customCoords.getMVPMatrix(),v=n.mapService.getCustomCoordCenter());var y=n.rendererService.getViewportSize(),x=y.width,E=y.height;r.models.forEach(function(P){var I;P.addUniforms((I={},(0,T.Z)(I,Tp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,T.Z)(I,Tp.ViewMatrix,n.cameraService.getViewMatrix()),(0,T.Z)(I,Tp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,T.Z)(I,Tp.Zoom,n.cameraService.getZoom()),(0,T.Z)(I,Tp.ZoomScale,n.cameraService.getZoomScale()),(0,T.Z)(I,Tp.FocalDistance,n.cameraService.getFocalDistance()),(0,T.Z)(I,Tp.CameraPosition,n.cameraService.getCameraPosition()),(0,T.Z)(I,Mo.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,T.Z)(I,Mo.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,T.Z)(I,Mo.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,T.Z)(I,Mo.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,T.Z)(I,Mo.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,T.Z)(I,Mo.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,T.Z)(I,Mo.Mvp,u),(0,T.Z)(I,"u_SceneCenterMKT",v),(0,T.Z)(I,"u_ViewportSize",[x,E]),(0,T.Z)(I,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,T.Z)(I,"u_DevicePixelRatio",ca.devicePixelRatio),(0,T.Z)(I,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,T.Z)(I,"u_Dragging",Number(n.mapService.dragging)),I))})})}}]),e}(),n1=Fn(md.prototype,"cameraService",[J_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i1=Fn(md.prototype,"coordinateSystemService",[Q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a1=Fn(md.prototype,"rendererService",[e1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o1=Fn(md.prototype,"mapService",[t1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),md))||r1),s1,u1,DA=(s1=(0,Lr.b2)(),s1(u1=function(){function e(){(0,St.Z)(this,e)}return(0,Kt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||u1),l1,c1,FA=(l1=(0,Lr.b2)(),l1(c1=function(){function e(){(0,St.Z)(this,e)}return(0,Kt.Z)(e,[{key:"apply",value:function(r,n){var o=this,u=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){o.initStyleAttribute(r,{styleAttributeService:u})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||o.updateStyleAtrribute(r,{styleAttributeService:u})})}},{key:"updateStyleAtrribute",value:function(r,n){var o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[],v=o.getLayerStyleAttribute("filter"),y=o.getLayerStyleAttribute("shape");if(v&&v.needRegenerateVertices||y&&y.needRegenerateVertices){r.layerModelNeedUpdate=!0,u.forEach(function(x){return x.needRegenerateVertices=!1});return}u.filter(function(x){return x.needRegenerateVertices}).forEach(function(x){o.updateAttributeByFeatureRange(x.name,r.getEncodedData(),x.featureRange.startIndex,x.featureRange.endIndex),x.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var o=n.styleAttributeService,u=o.getLayerStyleAttributes()||[];u.filter(function(v){return v.needRegenerateVertices}).forEach(function(v){o.updateAttributeByFeatureRange(v.name,r.getEncodedData(),v.featureRange.startIndex,v.featureRange.endIndex),v.needRegenerateVertices=!1})}}]),e}())||c1);Kl.bind(qt.ILayerPlugin).to(sw).inRequestScope(),Kl.bind(qt.ILayerPlugin).to(LA).inRequestScope(),Kl.bind(qt.ILayerPlugin).to(bA).inRequestScope(),Kl.bind(qt.ILayerPlugin).to(ow).inRequestScope(),Kl.bind(qt.ILayerPlugin).to(TA).inRequestScope(),Kl.bind(qt.ILayerPlugin).to(FA).inRequestScope(),Kl.bind(qt.ILayerPlugin).to(DA).inRequestScope(),Kl.bind(qt.ILayerPlugin).to($b).inRequestScope(),Kl.bind(qt.ILayerPlugin).to(kA).inRequestScope(),Kl.bind(qt.ILayerPlugin).to(SA).inRequestScope(),Kl.bind(qt.ILayerPlugin).to(OA).inRequestScope(),Kl.bind(qt.ILayerPlugin).to(RA).inRequestScope(),Kl.bind(qt.ILayerPlugin).to(wA).inRequestScope();var KP="2.5.54";function f1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function qP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?f1(Object(r),!0).forEach(function(n){NA(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function NA(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function $P(e,i){return ZA(e)||UA(e,i)||zA(e,i)||BA()}function BA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zA(e,i){if(!!e){if(typeof e=="string")return h1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h1(e,i)}}function h1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function UA(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(n.push(v.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,y=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return n}}function ZA(e){if(Array.isArray(e))return e}var JP=null,QP=null,p1,Km,d1;function v1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function m1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?v1(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var VA=(p1=Vd(qt.IGlobalConfigService),Km=function(){function e(i){(0,St.Z)(this,e),Rn(this,"configService",d1,this),(0,T.Z)(this,"config",void 0),this.config=i}return(0,Kt.Z)(e,[{key:"setContainer",value:function(r,n,o,u){r.bind(qt.MapConfig).toConstantValue(m1(m1({},this.config),{},{id:n,canvas:o,hasBaseMap:u})),r.bind(qt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),d1=Fn(Km.prototype,"configService",[p1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Km),jA=L(6158),GA=L.n(jA),qm;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})(qm||(qm={}));function av(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function sm(e,i){var r=Se([],i,e);return _t(r,r,1/r[3]),r}function eI(e,i){var r=e%i;return r<0?i+r:r}function tI(e,i,r){return r*i+(1-r)*e}function Fp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var Qc=Math.PI,g1=Qc/4,gh=Qc/180,y1=180/Qc,$m=512,Jm=4003e4,HA=1.5;function _1(e){return Math.pow(2,e)}function WA(e){return Math.log2(e)}function um(e,i){var r=(0,Pn.Z)(e,2),n=r[0],o=r[1];Fp(Number.isFinite(n)&&Number.isFinite(i)),Fp(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude"),i*=$m;var u=n*gh,v=o*gh,y=i*(u+Qc)/(2*Qc),x=i*(Qc-Math.log(Math.tan(g1+v*.5)))/(2*Qc);return[y,x]}function Qm(e,i){var r=(0,Pn.Z)(e,2),n=r[0],o=r[1];i*=$m;var u=n/i*(2*Qc)-Qc,v=2*(Math.atan(Math.exp(Qc-o/i*(2*Qc)))-g1);return[u*y1,v*y1]}function rI(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*gh);return WA(Jm*r)-9}function x1(e){var i=e.latitude,r=e.longitude,n=e.zoom,o=e.scale,u=e.highPrecision,v=u===void 0?!1:u;o=o!==void 0?o:_1(n),Fp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(o));var y={},x=$m*o,E=Math.cos(i*gh),P=x/360,I=P/E,D=x/Jm/E;if(y.pixelsPerMeter=[D,-D,D],y.metersPerPixel=[1/D,-1/D,1/D],y.pixelsPerDegree=[P,-I,D],y.degreesPerPixel=[1/P,-1/I,1/D],v){var Z=gh*Math.tan(i*gh)/E,te=P*Z/2,le=x/Jm*Z,ve=le/I*D;y.pixelsPerDegree2=[0,-te,le],y.pixelsPerMeter2=[ve,0,ve]}return y}function nI(e,i){var r=_slicedToArray(e,3),n=r[0],o=r[1],u=r[2],v=_slicedToArray(i,3),y=v[0],x=v[1],E=v[2],P=1,I=x1({longitude:n,latitude:o,scale:P,highPrecision:!0}),D=I.pixelsPerMeter,Z=I.pixelsPerMeter2,te=um(e,P);te[0]+=y*(D[0]+Z[0]*x),te[1]+=x*(D[1]+Z[1]*x);var le=Qm(te,P),ve=(u||0)+(E||0);return Number.isFinite(u)||Number.isFinite(E)?[le[0],le[1],ve]:le}function XA(e){var i=e.height,r=e.pitch,n=e.bearing,o=e.altitude,u=e.center,v=u===void 0?null:u,y=e.flipY,x=y===void 0?!1:y,E=av();return Hc(E,E,[0,0,-o]),ea(E,E,[1,1,1/i]),lo(E,E,-r*gh),Oh(E,E,n*gh),x&&ea(E,E,[1,-1,1]),v&&Hc(E,E,Ha.negate([],v)),E}function YA(e){var i=e.width,r=e.height,n=e.altitude,o=n===void 0?HA:n,u=e.pitch,v=u===void 0?0:u,y=e.nearZMultiplier,x=y===void 0?1:y,E=e.farZMultiplier,P=E===void 0?1:E,I=v*gh,D=Math.atan(.5/o),Z=Math.sin(D)*o/Math.sin(Math.PI/2-I-D),te=Math.cos(Math.PI/2-I)*Z+o;return{fov:2*Math.atan(r/2/o),aspect:i/r,focalDistance:o,near:x,far:te*P}}function KA(e){var i=e.width,r=e.height,n=e.pitch,o=e.altitude,u=e.nearZMultiplier,v=e.farZMultiplier,y=YA({width:i,height:r,altitude:o,pitch:n,nearZMultiplier:u,farZMultiplier:v}),x=y.fov,E=y.aspect,P=y.near,I=y.far,D=Kp([],x,E,P,I);return D}function qA(e,i){var r=(0,Pn.Z)(e,3),n=r[0],o=r[1],u=r[2],v=u===void 0?0:u;return Fp(Number.isFinite(n)&&Number.isFinite(o)&&Number.isFinite(v)),sm(i,[n,o,v,1])}function b1(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Pn.Z)(e,3),o=n[0],u=n[1],v=n[2];if(Fp(Number.isFinite(o)&&Number.isFinite(u),"invalid pixel coordinate"),Number.isFinite(v)){var y=sm(i,[o,u,v,1]);return y}var x=sm(i,[o,u,0,1]),E=sm(i,[o,u,1,1]),P=x[2],I=E[2],D=P===I?0:((r||0)-P)/(I-P);return Bi.t7([],x,E,D)}var E1=av(),$A=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,o=i.viewMatrix,u=o===void 0?E1:o,v=i.projectionMatrix,y=v===void 0?E1:v;(0,St.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=u,this.projectionMatrix=y;var x=av();xu(x,x,this.projectionMatrix),xu(x,x,this.viewMatrix),this.viewProjectionMatrix=x;var E=av();ea(E,E,[this.width/2,-this.height/2,1]),Hc(E,E,[1,-1,0]),xu(E,E,this.viewProjectionMatrix);var P=Ju(av(),E);if(!P)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=E,this.pixelUnprojectionMatrix=P,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Kt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Er(r.projectionMatrix,this.projectionMatrix)&&Er(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n.topLeft,u=o===void 0?!0:o,v=this.projectPosition(r),y=qA(v,this.pixelProjectionMatrix),x=(0,Pn.Z)(y,2),E=x[0],P=x[1],I=u?P:this.height-P;return r.length===2?[E,I]:[E,I,y[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n.topLeft,u=o===void 0?!0:o,v=n.targetZ,y=(0,Pn.Z)(r,3),x=y[0],E=y[1],P=y[2],I=u?E:this.height-E,D=v&&v*this.pixelsPerMeter,Z=b1([x,I,P],this.pixelUnprojectionMatrix,D),te=this.unprojectPosition(Z),le=(0,Pn.Z)(te,3),ve=le[0],Be=le[1],it=le[2];return Number.isFinite(P)?[ve,Be,it]:Number.isFinite(v)?[ve,Be,v]:[ve,Be]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),o=(0,Pn.Z)(n,2),u=o[0],v=o[1],y=(r[2]||0)*this.pixelsPerMeter;return[u,v,y]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),o=(0,Pn.Z)(n,2),u=o[0],v=o[1],y=(r[2]||0)/this.pixelsPerMeter;return[u,v,y]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function JA(e){var i=e.width,r=e.height,n=e.bounds,o=e.minExtent,u=o===void 0?0:o,v=e.maxZoom,y=v===void 0?24:v,x=e.padding,E=x===void 0?0:x,P=e.offset,I=P===void 0?[0,0]:P,D=(0,Pn.Z)(n,2),Z=(0,Pn.Z)(D[0],2),te=Z[0],le=Z[1],ve=(0,Pn.Z)(D[1],2),Be=ve[0],it=ve[1];if(Number.isFinite(E)){var yt=E;E={top:yt,bottom:yt,left:yt,right:yt}}else Fp(Number.isFinite(E.top)&&Number.isFinite(E.bottom)&&Number.isFinite(E.left)&&Number.isFinite(E.right));var wt=new S1({width:i,height:r,longitude:0,latitude:0,zoom:0}),jt=wt.project([te,it]),Wt=wt.project([Be,le]),nr=[Math.max(Math.abs(Wt[0]-jt[0]),u),Math.max(Math.abs(Wt[1]-jt[1]),u)],mr=[i-E.left-E.right-Math.abs(I[0])*2,r-E.top-E.bottom-Math.abs(I[1])*2];Fp(mr[0]>0&&mr[1]>0);var tn=mr[0]/nr[0],vn=mr[1]/nr[1],Pr=(E.right-E.left)/2/tn,In=(E.bottom-E.top)/2/vn,Gn=[(Wt[0]+jt[0])/2+Pr,(Wt[1]+jt[1])/2+In],yi=wt.unproject(Gn),Lo=wt.zoom+Math.log2(Math.abs(Math.min(tn,vn)));return{longitude:yi[0],latitude:yi[1],zoom:Math.min(Lo,y)}}var S1=function(e){(0,Wr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=n.width,u=n.height,v=n.latitude,y=v===void 0?0:v,x=n.longitude,E=x===void 0?0:x,P=n.zoom,I=P===void 0?0:P,D=n.pitch,Z=D===void 0?0:D,te=n.bearing,le=te===void 0?0:te,ve=n.altitude,Be=ve===void 0?1.5:ve,it=n.nearZMultiplier,yt=n.farZMultiplier;(0,St.Z)(this,i),o=o||1,u=u||1;var wt=_1(I);Be=Math.max(.75,Be);var jt=um([E,y],wt);jt[2]=0;var Wt=KA({width:o,height:u,pitch:Z,bearing:le,altitude:Be,nearZMultiplier:it||1/u,farZMultiplier:yt||1.01}),nr=XA({height:u,center:jt,pitch:Z,bearing:le,altitude:Be,flipY:!0});return r=(0,Sn.Z)(this,(0,zt.Z)(i).call(this,{width:o,height:u,viewMatrix:nr,projectionMatrix:Wt})),r.latitude=y,r.longitude=E,r.zoom=I,r.pitch=Z,r.bearing=le,r.altitude=Be,r.scale=wt,r.center=jt,r.pixelsPerMeter=x1((0,be.Z)((0,be.Z)(r))).pixelsPerMeter[2],Object.freeze((0,be.Z)((0,be.Z)(r))),r}return(0,Kt.Z)(i,[{key:"projectFlat",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return um(n,o)}},{key:"unprojectFlat",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Qm(n,o)}},{key:"getMapCenterByLngLatPosition",value:function(n){var o=n.lngLat,u=n.pos,v=b1(u,this.pixelUnprojectionMatrix),y=um(o,this.scale),x=Bi.IH([],y,Bi.tk([],v)),E=Bi.IH([],this.center,x);return Qm(E,this.scale)}},{key:"getLocationAtPoint",value:function(n){var o=n.lngLat,u=n.pos;return this.getMapCenterByLngLatPosition({lngLat:o,pos:u})}},{key:"fitBounds",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=this.width,v=this.height,y=JA(Object.assign({width:u,height:v,bounds:n},o)),x=y.longitude,E=y.latitude,P=y.zoom;return new i({width:u,height:v,longitude:x,latitude:E,zoom:P})}}]),i}($A),QA=function(){function e(){(0,St.Z)(this,e),(0,T.Z)(this,"viewport",void 0)}return(0,Kt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,o=r.zoom,u=r.pitch,v=r.bearing,y=r.viewportHeight,x=r.viewportWidth;this.viewport=new S1({width:x,height:y,longitude:n&&n[0],latitude:n&&n[1],zoom:o,pitch:u,bearing:v})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),w1={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},eC=["id","attributionControl","style","token","rotation","mapInstance"],T1,A1,C1,M1,P1,I1,gd,O1,R1,L1,k1;function D1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function tC(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?D1(Object(r),!0).forEach(function(n){(0,T.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rC(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var o=i.head||i.getElementsByTagName("head")[0];if(!o){o=i.createElement("head");var u=i.body||i.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):i.documentElement.appendChild(o)}var v=i.createElement("style");return v.type="text/css",v.styleSheet?v.styleSheet.cssText=e:v.appendChild(i.createTextNode(e)),o.appendChild(v),v}}rC(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=GA();var F1={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},nC=0,iC=12,N1="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",aC=(T1=(0,Lr.b2)(),A1=(0,Lr.f3)(qt.MapConfig),C1=(0,Lr.f3)(qt.IGlobalConfigService),M1=(0,Lr.f3)(qt.ICoordinateSystemService),P1=(0,Lr.f3)(qt.IEventEmitter),T1(I1=(gd=function(){function e(){var i=this;(0,St.Z)(this,e),(0,T.Z)(this,"version",qm.MAPBOX),(0,T.Z)(this,"map",void 0),(0,T.Z)(this,"dragging",!1),(0,T.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Rn(this,"config",O1,this),Rn(this,"configService",R1,this),Rn(this,"coordinateSystemService",L1,this),Rn(this,"eventEmitter",k1,this),(0,T.Z)(this,"viewport",void 0),(0,T.Z)(this,"markerContainer",void 0),(0,T.Z)(this,"cameraChangedCallback",void 0),(0,T.Z)(this,"$mapContainer",void 0),(0,T.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,o=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var u=i.config.offsetZoom,v=u===void 0?iC:u;i.viewport.getZoom()>v?i.coordinateSystemService.setCoordinateSystem(Ls.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Ls.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Kt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Ua("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){ub.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(F1[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(F1[r]||r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},o=this.lngLatToMercator(r,0),u=o.x,v=o.y;return[u-n.x,v-n.y]}},{key:"lngLatToMercator",value:function(r,n){var o=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),u=o.x,v=u===void 0?0:u,y=o.y,x=y===void 0?0:y,E=o.z,P=E===void 0?0:E;return{x:v,y:x,z:P}}},{key:"getModelMatrix",value:function(r,n,o){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],v=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},y=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),x=y.meterInMercatorCoordinateUnits(),E=_u();return Hc(E,E,Ha.fromValues(y.x-v.x,y.y-v.y,y.z||0-v.z)),ea(E,E,Ha.fromValues(x*u[0],-x*u[1],x*u[2])),lo(E,E,o[0]),Rs(E,E,o[1]),Oh(E,E,o[2]),E}},{key:"init",value:function(){var i=(0,ks.Z)(t().mark(function n(){var o=this,u,v,y,x,E,P,I,D,Z,te,le,ve,Be;return t().wrap(function(yt){for(;;)switch(yt.prev=yt.next){case 0:u=this.config,v=u.id,y=v===void 0?"map":v,x=u.attributionControl,E=x===void 0?!1:x,P=u.style,I=P===void 0?"light":P,D=u.token,Z=D===void 0?N1:D,te=u.rotation,le=te===void 0?0:te,ve=u.mapInstance,Be=(0,Yn.Z)(u,eC),this.viewport=new QA,!ve&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),Z===N1&&I!=="blank"&&!window.mapboxgl.accessToken&&!ve&&console.warn(this.configService.getSceneWarninfo("MapToken")),!ve&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=Z),ve?(this.map=ve,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(y),this.map=new window.mapboxgl.Map(tC({container:this.$mapContainer,style:this.getMapStyle(I),attributionControl:E,bearing:le},Be))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return o.dragging=!0,""}),this.map.on("dragend",function(){return o.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return yt.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,o=arguments.length,u=new Array(o>1?o-1:0),v=1;v<o;v++)u[v-1]=arguments[v];(n=this.eventEmitter).emit.apply(n,[r].concat(u))}},{key:"once",value:function(r){for(var n,o=arguments.length,u=new Array(o>1?o-1:0),v=1;v<o;v++)u[v-1]=arguments[v];(n=this.eventEmitter).once.apply(n,[r].concat(u))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),o=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return o}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var o=document.createElement("div");return o.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,o.id="l7_mapbox_div"+nC++,n.appendChild(o),o}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:w1[r]?w1[r]:r}}]),e}(),O1=Fn(gd.prototype,"config",[A1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R1=Fn(gd.prototype,"configService",[C1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L1=Fn(gd.prototype,"coordinateSystemService",[M1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k1=Fn(gd.prototype,"eventEmitter",[P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gd))||I1);function oC(e){var i=sC();return function(){var n=(0,zt.Z)(e),o;if(i){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return(0,Sn.Z)(this,o)}}function sC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function uC(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var o=i.head||i.getElementsByTagName("head")[0];if(!o){o=i.createElement("head");var u=i.body||i.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):i.documentElement.appendChild(o)}var v=i.createElement("style");return v.type="text/css",v.styleSheet?v.styleSheet.cssText=e:v.appendChild(i.createTextNode(e)),o.appendChild(v),v}}uC(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var lC=function(e){(0,Wr.Z)(r,e);var i=oC(r);function r(){return(0,St.Z)(this,r),i.apply(this,arguments)}return(0,Kt.Z)(r,[{key:"getServiceConstructor",value:function(){return aC}}]),r}(VA);function B1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function z1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?B1(Object(r),!0).forEach(function(n){cC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cC(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function fC(e,i){return vC(e)||dC(e,i)||pC(e,i)||hC()}function hC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pC(e,i){if(!!e){if(typeof e=="string")return U1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return U1(e,i)}}function U1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function dC(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(n.push(v.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,y=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return n}}function vC(e){if(Array.isArray(e))return e}var mC=j.memo(function(e){var i=e.style,r=e.className,n=e.map,o=e.option,u=e.onSceneLoaded,v=(0,j.createRef)(),y=(0,j.useState)(),x=fC(y,2),E=x[0],P=x[1];return(0,j.useEffect)(function(){var I=new Yb(z1(z1({id:v.current},o),{},{map:new lC(n)}));return I.on("loaded",function(){P(I),u&&u(I)}),function(){I.destroy()}},[]),(0,j.useEffect)(function(){E&&n.style&&E.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,j.useEffect)(function(){E&&n.zoom&&E.setZoom(n.zoom)},[n.zoom]),(0,j.useEffect)(function(){E&&n.center&&E.setCenter(n.center)},[JSON.stringify(n.center)]),(0,j.useEffect)(function(){E&&n.pitch!==void 0&&E.setPitch(n.pitch||0)},[n.pitch]),(0,j.useEffect)(function(){E&&n.rotation&&E.setRotation(n.rotation)},[n.rotation]),j.createElement(m.Provider,{value:E},(0,j.createElement)("div",{ref:v,style:i,className:r},E&&e.children))}),gC=mC;function Z1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function iI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Z1(Object(r),!0).forEach(function(n){yC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yC(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function aI(e,i){return EC(e)||bC(e,i)||xC(e,i)||_C()}function _C(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xC(e,i){if(!!e){if(typeof e=="string")return V1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return V1(e,i)}}function V1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function bC(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(n.push(v.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,y=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return n}}function EC(e){if(Array.isArray(e))return e}var oI=null,sI=null;function j1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function uI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?j1(Object(r),!0).forEach(function(n){SC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function SC(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function lI(e,i){return CC(e)||AC(e,i)||TC(e,i)||wC()}function wC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TC(e,i){if(!!e){if(typeof e=="string")return G1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return G1(e,i)}}function G1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function AC(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(n.push(v.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,y=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return n}}function CC(e){if(Array.isArray(e))return e}var cI=null,fI=null;function hI(e,i){return OC(e)||IC(e,i)||PC(e,i)||MC()}function MC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PC(e,i){if(!!e){if(typeof e=="string")return H1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H1(e,i)}}function H1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function IC(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(n.push(v.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,y=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return n}}function OC(e){if(Array.isArray(e))return e}var pI=null,dI=null;function W1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function vI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?W1(Object(r),!0).forEach(function(n){RC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function RC(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function mI(e,i){if(e==null)return{};var r=LC(e,i),n,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)n=u[o],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function LC(e,i){if(e==null)return{};var r={},n=Object.keys(e),o,u;for(u=0;u<n.length;u++)o=n[u],!(i.indexOf(o)>=0)&&(r[o]=e[o]);return r}var gI=null,X1=L(73935);function Y1(e,i){return NC(e)||FC(e,i)||DC(e,i)||kC()}function kC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DC(e,i){if(!!e){if(typeof e=="string")return K1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return K1(e,i)}}function K1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function FC(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(n.push(v.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,y=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return n}}function NC(e){if(Array.isArray(e))return e}var q1=j.useEffect,$1=j.useState;function yI(e){var i=e.className,r=e.style,n=e.children,o=e.position,u=$1(),v=Y1(u,2),y=v[0],x=v[1],E=useSceneValue(),P=$1(function(){return document.createElement("div")}),I=Y1(P,1),D=I[0];return q1(function(){var Z=new Control({position:o});return Z.onAdd=function(){if(i&&(D.className=i),r){var te=Object.keys(r).map(function(le){return"".concat(le,":").concat(r[le])}).join(";");D.style.cssText=te}return D},Z.onRemove=function(){},x(Z),E.addControl(Z),function(){E.removeControl(Z)}},[]),q1(function(){y&&y.setPosition(o||"bottomleft")},[o]),createPortal(n,D)}var J1=(0,j.createContext)({});function _I(){return useContext(J1)}var BC=j.useEffect,zC=j.memo(function(i){var r=i.layer,n=i.active;return BC(function(){r.active(n.option)},[JSON.stringify(n)]),null}),UC=j.useEffect,ZC=j.memo(function(i){var r=i.layer,n=i.animate;return UC(function(){r.animate(n)},[JSON.stringify(n)]),null}),VC=j.useEffect,jC=j.memo(function(i){var r=i.layer,n=i.color;return VC(function(){n.field?r.color(n.field,n.values):r.color(n.values)},[n.field,n.scale,JSON.stringify(n.values),JSON.stringify(n.options)]),null}),GC=j.useEffect,HC=j.memo(function(i){var r=i.layer,n=i.filter;return GC(function(){n.field&&r.filter(n.field,n.values)},[n.field,n.values,JSON.stringify(n.values),JSON.stringify(n.options)]),null}),WC=j.useEffect,XC=j.memo(function(i){var r=i.layer,n=i.scale;return WC(function(){r.scale(n.values)},[n.values]),null}),YC=j.useEffect,KC=j.memo(function(i){var r=i.layer,n=i.select;return YC(function(){r.select(n.option)},[JSON.stringify(n)]),null}),qC=j.useEffect,$C=j.memo(function(i){var r=i.layer,n=i.shape;return qC(function(){n.field?r.shape(n.field,n.values):r.shape(n.values)},[n.field,JSON.stringify(n.values),JSON.stringify(n.options)]),null}),JC=j.useEffect,QC=j.memo(function(i){var r=i.layer,n=i.size;return JC(function(){n.field?r.size(n.field,n.values):r.size(n.values)},[n.field,n.scale,JSON.stringify(n.values),JSON.stringify(n.options)]),null}),eM=["data"];function tM(e,i){if(e==null)return{};var r=rM(e,i),n,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)n=u[o],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function rM(e,i){if(e==null)return{};var r={},n=Object.keys(e),o,u;for(u=0;u<n.length;u++)o=n[u],!(i.indexOf(o)>=0)&&(r[o]=e[o]);return r}var nM=j.useEffect,iM=j.memo(function(i){var r=i.layer,n=i.source,o=n.data,u=tM(n,eM);return nM(function(){r.inited?r.setData(o,u):r.source(o,u),u.autoFit&&r.fitBounds(u&&u.fitBoundsOptions)},[o,JSON.stringify(u)]),null}),aM=j.useEffect,oM=j.memo(function(i){var r=i.layer,n=i.style;return aM(function(){r.style(n)},Object.keys(n).map(function(o){return n[o]})),null});function sM(e,i){return fM(e)||cM(e,i)||lM(e,i)||uM()}function uM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lM(e,i){if(!!e){if(typeof e=="string")return Q1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Q1(e,i)}}function Q1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function cM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,u=!1,v,y;try{for(r=r.call(e);!(o=(v=r.next()).done)&&(n.push(v.value),!(i&&n.length===i));o=!0);}catch(x){u=!0,y=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw y}}return n}}function fM(e){if(Array.isArray(e))return e}var ov=j.useEffect,hM=j.useState;function ex(e,i){var r=i.source,n=i.color,o=i.shape,u=i.style,v=i.size,y=i.scale,x=i.active,E=i.select,P=i.filter,I=i.animate,D=i.options,Z=i.onLayerLoaded,te=J(),le=hM(function(){var it;switch(e){case"polygonLayer":it=new iy(D);break;case"lineLayer":it=new Y2(D);break;case"pointLayer":it=new DS(D);break;case"heatmapLayer":it=new a2(D);break;case"rasterLayer":it=new iw(D);break;case"imageLayer":it=new v2(D);break;case"citybuildingLayer":it=new IE(D);break;default:it=new iy(D)}return it.on("inited",function(){Z&&Z(it,te)}),it}),ve=sM(le,1),Be=ve[0];return ov(function(){return te.addLayer(Be),function(){te.removeLayer(Be)}},[]),ov(function(){Be.inited&&D&&Be.updateLayerConfig(D)},[D==null?void 0:D.minZoom,D==null?void 0:D.maxZoom,D==null?void 0:D.visible]),ov(function(){Be.inited&&(D==null?void 0:D.zIndex)&&Be.setIndex(D.zIndex)},[D==null?void 0:D.zIndex]),ov(function(){Be.inited&&(D==null?void 0:D.blend)&&Be.setBlend(D.blend)},[D==null?void 0:D.blend]),ov(function(){te.render()}),j.createElement(J1.Provider,{value:Be},j.createElement(iM,{layer:Be,source:r}),y&&j.createElement(XC,{layer:Be,scale:y}),n&&j.createElement(jC,{layer:Be,color:n}),v&&j.createElement(QC,{layer:Be,size:v}),o&&j.createElement($C,{layer:Be,shape:o}),u&&j.createElement(oM,{layer:Be,style:u}),x&&j.createElement(zC,{layer:Be,active:x}),E&&j.createElement(KC,{layer:Be,select:E}),P&&j.createElement(HC,{layer:Be,filter:P}),I&&j.createElement(ZC,{layer:Be,animate:I}),i.children)}var xI=null,bI=null,pM=j.memo(function(i){return ex("pointLayer",i)}),dM=j.memo(function(i){return ex("heatmapLayer",i)}),EI=null,SI=null,wI=null,TI=j.useEffect,AI=null,CI=null;function lm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?lm=function(r){return typeof r}:lm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},lm(e)}function tx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function cm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?tx(Object(r),!0).forEach(function(n){vM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function mM(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function rx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gM(e,i,r){return i&&rx(e.prototype,i),r&&rx(e,r),e}function yM(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&e0(e,i)}function e0(e,i){return e0=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},e0(e,i)}function _M(e){var i=EM();return function(){var n=fm(e),o;if(i){var u=fm(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return xM(this,o)}}function xM(e,i){if(i&&(lm(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bM(e)}function bM(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function EM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function fm(e){return fm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},fm(e)}var MI=function(e){yM(r,e);var i=_M(r);function r(n){var o;return mM(this,r),o=i.call(this,n),o.el=void 0,o.scene=void 0,o.popup=void 0,o.el=document.createElement("div"),o}return gM(r,[{key:"componentDidMount",value:function(){var o,u=this.props,v=u.lnglat,y=u.children,x=u.option,E=u.lngLat,P=new W0(cm(cm({},x),{},{stopPropagation:(o=this.props.option)===null||o===void 0?void 0:o.stopPropagation}));v&&P.setLnglat(v),E&&P.setLnglat(E),y&&P.setDOMContent(this.el),this.popup=P,this.scene.addPopup(P)}},{key:"componentDidUpdate",value:function(o){var u,v,y,x,E,P,I=Array.isArray(o.lnglat)?o.lnglat:[o==null||(u=o.lnglat)===null||u===void 0?void 0:u.lng,o==null||(v=o.lnglat)===null||v===void 0?void 0:v.lat],D=Array.isArray(this.props.lnglat)?this.props.lnglat:[(y=this.props)===null||y===void 0||(x=y.lnglat)===null||x===void 0?void 0:x.lng,(E=this.props)===null||E===void 0||(P=E.lnglat)===null||P===void 0?void 0:P.lat],Z=I.toString()!==D.toString();if(Z){var te;this.popup.remove(),this.popup=new W0(cm(cm({},this.props.option),{},{stopPropagation:(te=this.props.option)===null||te===void 0?void 0:te.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var o=this;return j.createElement(m.Consumer,{},function(u){return u&&(o.scene=u),(0,X1.createPortal)(o.props.children,o.el)})}}]),r}(j.PureComponent);function hm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?hm=function(r){return typeof r}:hm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},hm(e)}function SM(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function nx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wM(e,i,r){return i&&nx(e.prototype,i),r&&nx(e,r),e}function TM(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&t0(e,i)}function t0(e,i){return t0=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},t0(e,i)}function AM(e){var i=PM();return function(){var n=pm(e),o;if(i){var u=pm(this).constructor;o=Reflect.construct(n,arguments,u)}else o=n.apply(this,arguments);return CM(this,o)}}function CM(e,i){if(i&&(hm(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return MM(e)}function MM(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function PM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function pm(e){return pm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},pm(e)}var PI=function(e){TM(r,e);var i=AM(r);function r(n){var o;return SM(this,r),o=i.call(this,n),o.el=void 0,o.scene=void 0,o.marker=void 0,o.el=document.createElement("div"),o}return wM(r,[{key:"componentDidMount",value:function(){var o=this.props,u=o.lnglat,v=o.children,y=o.option,x=o.onMarkerLoaded,E=new Z0(y);u&&E.setLnglat(u),v&&E.setElement(this.el),this.marker=E,x&&x(E),this.scene.addMarker(E)}},{key:"componentDidUpdate",value:function(o){var u,v=(o==null?void 0:o.lnglat.toString())!==((u=this.props)===null||u===void 0?void 0:u.lnglat.toString());v&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var o=this;return j.createElement(m.Consumer,{},function(u){return u&&(o.scene=u),(0,X1.createPortal)(o.props.children,o.el)})}}]),r}(j.PureComponent),II=j.useEffect,OI=null,RI=null,LI=j.useEffect,kI=null},6563:function(Ue,W,L){var X=L(31795);Ue.exports=j;function j(ie,ne){switch(ie&&ie.type||null){case"FeatureCollection":return ie.features=ie.features.map(m(j,ne)),ie;case"GeometryCollection":return ie.geometries=ie.geometries.map(m(j,ne)),ie;case"Feature":return ie.geometry=j(ie.geometry,ne),ie;case"Polygon":case"MultiPolygon":return J(ie,ne);default:return ie}}function m(ie,ne){return function(Le){return ie(Le,ne)}}function J(ie,ne){return ie.type==="Polygon"?ie.coordinates=F(ie.coordinates,ne):ie.type==="MultiPolygon"&&(ie.coordinates=ie.coordinates.map(m(F,ne))),ie}function F(ie,ne){ne=!!ne,ie[0]=$(ie[0],ne);for(var Le=1;Le<ie.length;Le++)ie[Le]=$(ie[Le],!ne);return ie}function $(ie,ne){return re(ie)===ne?ie:ie.reverse()}function re(ie){return X.ring(ie)>=0}},66213:function(Ue,W,L){"use strict";L.d(W,{Z:function(){return m}});var X=L(77608);function j(J,F){for(;!Object.prototype.hasOwnProperty.call(J,F)&&(J=(0,X.Z)(J),J!==null););return J}function m(){return typeof Reflect!="undefined"&&Reflect.get?m=Reflect.get:m=function(F,$,re){var ie=j(F,$);if(!!ie){var ne=Object.getOwnPropertyDescriptor(ie,$);return ne.get?ne.get.call(arguments.length<3?F:re):ne.value}},m.apply(this,arguments)}},31795:function(Ue,W,L){var X=L(75752);Ue.exports.geometry=j,Ue.exports.ring=J;function j($){var re=0,ie;switch($.type){case"Polygon":return m($.coordinates);case"MultiPolygon":for(ie=0;ie<$.coordinates.length;ie++)re+=m($.coordinates[ie]);return re;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ie=0;ie<$.geometries.length;ie++)re+=j($.geometries[ie]);return re}}function m($){var re=0;if($&&$.length>0){re+=Math.abs(J($[0]));for(var ie=1;ie<$.length;ie++)re-=Math.abs(J($[ie]))}return re}function J($){var re,ie,ne,Le,Ie,He,Rt,$t=0,ht=$.length;if(ht>2){for(Rt=0;Rt<ht;Rt++)Rt===ht-2?(Le=ht-2,Ie=ht-1,He=0):Rt===ht-1?(Le=ht-1,Ie=0,He=1):(Le=Rt,Ie=Rt+1,He=Rt+2),re=$[Le],ie=$[Ie],ne=$[He],$t+=(F(ne[0])-F(re[0]))*Math.sin(F(ie[1]));$t=$t*X.RADIUS*X.RADIUS/2}return $t}function F($){return $*Math.PI/180}},53645:function(Ue){Ue.exports={"ant-pro-grid-content":"ant-pro-grid-content",wide:"wide"}},9187:function(Ue){"use strict";Ue.exports=W,Ue.exports.default=W;function W(T,we,De){De=De||2;var bt=we&&we.length,mt=bt?we[0]*De:T.length,Lt=L(T,0,mt,De,!0),Yt=[];if(!Lt||Lt.next===Lt.prev)return Yt;var br,Kn,cn,li,Vn,ti,ci;if(bt&&(Lt=re(T,we,Lt,De)),T.length>80*De){br=cn=T[0],Kn=li=T[1];for(var Hn=De;Hn<mt;Hn+=De)Vn=T[Hn],ti=T[Hn+1],Vn<br&&(br=Vn),ti<Kn&&(Kn=ti),Vn>cn&&(cn=Vn),ti>li&&(li=ti);ci=Math.max(cn-br,li-Kn),ci=ci!==0?1/ci:0}return j(Lt,Yt,De,br,Kn,ci),Yt}function L(T,we,De,bt,mt){var Lt,Yt;if(mt===jr(T,we,De,bt)>0)for(Lt=we;Lt<De;Lt+=bt)Yt=Ot(Lt,T[Lt],T[Lt+1],Yt);else for(Lt=De-bt;Lt>=we;Lt-=bt)Yt=Ot(Lt,T[Lt],T[Lt+1],Yt);return Yt&&rt(Yt,Yt.next)&&(dr(Yt),Yt=Yt.next),Yt}function X(T,we){if(!T)return T;we||(we=T);var De=T,bt;do if(bt=!1,!De.steiner&&(rt(De,De.next)||nt(De.prev,De,De.next)===0)){if(dr(De),De=we=De.prev,De===De.next)break;bt=!0}else De=De.next;while(bt||De!==we);return we}function j(T,we,De,bt,mt,Lt,Yt){if(!!T){!Yt&&Lt&&He(T,bt,mt,Lt);for(var br=T,Kn,cn;T.prev!==T.next;){if(Kn=T.prev,cn=T.next,Lt?J(T,bt,mt,Lt):m(T)){we.push(Kn.i/De),we.push(T.i/De),we.push(cn.i/De),dr(T),T=cn.next,br=cn.next;continue}if(T=cn,T===br){Yt?Yt===1?(T=F(X(T),we,De),j(T,we,De,bt,mt,Lt,2)):Yt===2&&$(T,we,De,bt,mt,Lt):j(X(T),we,De,bt,mt,Lt,1);break}}}}function m(T){var we=T.prev,De=T,bt=T.next;if(nt(we,De,bt)>=0)return!1;for(var mt=T.next.next;mt!==T.prev;){if(Ut(we.x,we.y,De.x,De.y,bt.x,bt.y,mt.x,mt.y)&&nt(mt.prev,mt,mt.next)>=0)return!1;mt=mt.next}return!0}function J(T,we,De,bt){var mt=T.prev,Lt=T,Yt=T.next;if(nt(mt,Lt,Yt)>=0)return!1;for(var br=mt.x<Lt.x?mt.x<Yt.x?mt.x:Yt.x:Lt.x<Yt.x?Lt.x:Yt.x,Kn=mt.y<Lt.y?mt.y<Yt.y?mt.y:Yt.y:Lt.y<Yt.y?Lt.y:Yt.y,cn=mt.x>Lt.x?mt.x>Yt.x?mt.x:Yt.x:Lt.x>Yt.x?Lt.x:Yt.x,li=mt.y>Lt.y?mt.y>Yt.y?mt.y:Yt.y:Lt.y>Yt.y?Lt.y:Yt.y,Vn=$t(br,Kn,we,De,bt),ti=$t(cn,li,we,De,bt),ci=T.prevZ,Hn=T.nextZ;ci&&ci.z>=Vn&&Hn&&Hn.z<=ti;){if(ci!==T.prev&&ci!==T.next&&Ut(mt.x,mt.y,Lt.x,Lt.y,Yt.x,Yt.y,ci.x,ci.y)&&nt(ci.prev,ci,ci.next)>=0||(ci=ci.prevZ,Hn!==T.prev&&Hn!==T.next&&Ut(mt.x,mt.y,Lt.x,Lt.y,Yt.x,Yt.y,Hn.x,Hn.y)&&nt(Hn.prev,Hn,Hn.next)>=0))return!1;Hn=Hn.nextZ}for(;ci&&ci.z>=Vn;){if(ci!==T.prev&&ci!==T.next&&Ut(mt.x,mt.y,Lt.x,Lt.y,Yt.x,Yt.y,ci.x,ci.y)&&nt(ci.prev,ci,ci.next)>=0)return!1;ci=ci.prevZ}for(;Hn&&Hn.z<=ti;){if(Hn!==T.prev&&Hn!==T.next&&Ut(mt.x,mt.y,Lt.x,Lt.y,Yt.x,Yt.y,Hn.x,Hn.y)&&nt(Hn.prev,Hn,Hn.next)>=0)return!1;Hn=Hn.nextZ}return!0}function F(T,we,De){var bt=T;do{var mt=bt.prev,Lt=bt.next.next;!rt(mt,Lt)&&er(mt,bt,bt.next,Lt)&&Ye(mt,Lt)&&Ye(Lt,mt)&&(we.push(mt.i/De),we.push(bt.i/De),we.push(Lt.i/De),dr(bt),dr(bt.next),bt=T=Lt),bt=bt.next}while(bt!==T);return X(bt)}function $(T,we,De,bt,mt,Lt){var Yt=T;do{for(var br=Yt.next.next;br!==Yt.prev;){if(Yt.i!==br.i&&dt(Yt,br)){var Kn=Je(Yt,br);Yt=X(Yt,Yt.next),Kn=X(Kn,Kn.next),j(Yt,we,De,bt,mt,Lt),j(Kn,we,De,bt,mt,Lt);return}br=br.next}Yt=Yt.next}while(Yt!==T)}function re(T,we,De,bt){var mt=[],Lt,Yt,br,Kn,cn;for(Lt=0,Yt=we.length;Lt<Yt;Lt++)br=we[Lt]*bt,Kn=Lt<Yt-1?we[Lt+1]*bt:T.length,cn=L(T,br,Kn,bt,!1),cn===cn.next&&(cn.steiner=!0),mt.push(ht(cn));for(mt.sort(ie),Lt=0;Lt<mt.length;Lt++)De=ne(mt[Lt],De),De=X(De,De.next);return De}function ie(T,we){return T.x-we.x}function ne(T,we){var De=Le(T,we);if(!De)return we;var bt=Je(De,T),mt=X(De,De.next);return X(bt,bt.next),we===De?mt:we}function Le(T,we){var De=we,bt=T.x,mt=T.y,Lt=-Infinity,Yt;do{if(mt<=De.y&&mt>=De.next.y&&De.next.y!==De.y){var br=De.x+(mt-De.y)*(De.next.x-De.x)/(De.next.y-De.y);if(br<=bt&&br>Lt){if(Lt=br,br===bt){if(mt===De.y)return De;if(mt===De.next.y)return De.next}Yt=De.x<De.next.x?De:De.next}}De=De.next}while(De!==we);if(!Yt)return null;if(bt===Lt)return Yt;var Kn=Yt,cn=Yt.x,li=Yt.y,Vn=Infinity,ti;De=Yt;do bt>=De.x&&De.x>=cn&&bt!==De.x&&Ut(mt<li?bt:Lt,mt,cn,li,mt<li?Lt:bt,mt,De.x,De.y)&&(ti=Math.abs(mt-De.y)/(bt-De.x),Ye(De,T)&&(ti<Vn||ti===Vn&&(De.x>Yt.x||De.x===Yt.x&&Ie(Yt,De)))&&(Yt=De,Vn=ti)),De=De.next;while(De!==Kn);return Yt}function Ie(T,we){return nt(T.prev,T,we.prev)<0&&nt(we.next,T,T.next)<0}function He(T,we,De,bt){var mt=T;do mt.z===null&&(mt.z=$t(mt.x,mt.y,we,De,bt)),mt.prevZ=mt.prev,mt.nextZ=mt.next,mt=mt.next;while(mt!==T);mt.prevZ.nextZ=null,mt.prevZ=null,Rt(mt)}function Rt(T){var we,De,bt,mt,Lt,Yt,br,Kn,cn=1;do{for(De=T,T=null,Lt=null,Yt=0;De;){for(Yt++,bt=De,br=0,we=0;we<cn&&(br++,bt=bt.nextZ,!!bt);we++);for(Kn=cn;br>0||Kn>0&&bt;)br!==0&&(Kn===0||!bt||De.z<=bt.z)?(mt=De,De=De.nextZ,br--):(mt=bt,bt=bt.nextZ,Kn--),Lt?Lt.nextZ=mt:T=mt,mt.prevZ=Lt,Lt=mt;De=bt}Lt.nextZ=null,cn*=2}while(Yt>1);return T}function $t(T,we,De,bt,mt){return T=32767*(T-De)*mt,we=32767*(we-bt)*mt,T=(T|T<<8)&16711935,T=(T|T<<4)&252645135,T=(T|T<<2)&858993459,T=(T|T<<1)&1431655765,we=(we|we<<8)&16711935,we=(we|we<<4)&252645135,we=(we|we<<2)&858993459,we=(we|we<<1)&1431655765,T|we<<1}function ht(T){var we=T,De=T;do(we.x<De.x||we.x===De.x&&we.y<De.y)&&(De=we),we=we.next;while(we!==T);return De}function Ut(T,we,De,bt,mt,Lt,Yt,br){return(mt-Yt)*(we-br)-(T-Yt)*(Lt-br)>=0&&(T-Yt)*(bt-br)-(De-Yt)*(we-br)>=0&&(De-Yt)*(Lt-br)-(mt-Yt)*(bt-br)>=0}function dt(T,we){return T.next.i!==we.i&&T.prev.i!==we.i&&!at(T,we)&&(Ye(T,we)&&Ye(we,T)&&ut(T,we)&&(nt(T.prev,T,we.prev)||nt(T,we.prev,we))||rt(T,we)&&nt(T.prev,T,T.next)>0&&nt(we.prev,we,we.next)>0)}function nt(T,we,De){return(we.y-T.y)*(De.x-we.x)-(we.x-T.x)*(De.y-we.y)}function rt(T,we){return T.x===we.x&&T.y===we.y}function er(T,we,De,bt){var mt=Ht(nt(T,we,De)),Lt=Ht(nt(T,we,bt)),Yt=Ht(nt(De,bt,T)),br=Ht(nt(De,bt,we));return!!(mt!==Lt&&Yt!==br||mt===0&&K(T,De,we)||Lt===0&&K(T,bt,we)||Yt===0&&K(De,T,bt)||br===0&&K(De,we,bt))}function K(T,we,De){return we.x<=Math.max(T.x,De.x)&&we.x>=Math.min(T.x,De.x)&&we.y<=Math.max(T.y,De.y)&&we.y>=Math.min(T.y,De.y)}function Ht(T){return T>0?1:T<0?-1:0}function at(T,we){var De=T;do{if(De.i!==T.i&&De.next.i!==T.i&&De.i!==we.i&&De.next.i!==we.i&&er(De,De.next,T,we))return!0;De=De.next}while(De!==T);return!1}function Ye(T,we){return nt(T.prev,T,T.next)<0?nt(T,we,T.next)>=0&&nt(T,T.prev,we)>=0:nt(T,we,T.prev)<0||nt(T,T.next,we)<0}function ut(T,we){var De=T,bt=!1,mt=(T.x+we.x)/2,Lt=(T.y+we.y)/2;do De.y>Lt!=De.next.y>Lt&&De.next.y!==De.y&&mt<(De.next.x-De.x)*(Lt-De.y)/(De.next.y-De.y)+De.x&&(bt=!bt),De=De.next;while(De!==T);return bt}function Je(T,we){var De=new Cr(T.i,T.x,T.y),bt=new Cr(we.i,we.x,we.y),mt=T.next,Lt=we.prev;return T.next=we,we.prev=T,De.next=mt,mt.prev=De,bt.next=De,De.prev=bt,Lt.next=bt,bt.prev=Lt,bt}function Ot(T,we,De,bt){var mt=new Cr(T,we,De);return bt?(mt.next=bt.next,mt.prev=bt,bt.next.prev=mt,bt.next=mt):(mt.prev=mt,mt.next=mt),mt}function dr(T){T.next.prev=T.prev,T.prev.next=T.next,T.prevZ&&(T.prevZ.nextZ=T.nextZ),T.nextZ&&(T.nextZ.prevZ=T.prevZ)}function Cr(T,we,De){this.i=T,this.x=we,this.y=De,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}W.deviation=function(T,we,De,bt){var mt=we&&we.length,Lt=mt?we[0]*De:T.length,Yt=Math.abs(jr(T,0,Lt,De));if(mt)for(var br=0,Kn=we.length;br<Kn;br++){var cn=we[br]*De,li=br<Kn-1?we[br+1]*De:T.length;Yt-=Math.abs(jr(T,cn,li,De))}var Vn=0;for(br=0;br<bt.length;br+=3){var ti=bt[br]*De,ci=bt[br+1]*De,Hn=bt[br+2]*De;Vn+=Math.abs((T[ti]-T[Hn])*(T[ci+1]-T[ti+1])-(T[ti]-T[ci])*(T[Hn+1]-T[ti+1]))}return Yt===0&&Vn===0?0:Math.abs((Vn-Yt)/Yt)};function jr(T,we,De,bt){for(var mt=0,Lt=we,Yt=De-bt;Lt<De;Lt+=bt)mt+=(T[Yt]-T[Lt])*(T[Lt+1]+T[Yt+1]),Yt=Lt;return mt}W.flatten=function(T){for(var we=T[0][0].length,De={vertices:[],holes:[],dimensions:we},bt=0,mt=0;mt<T.length;mt++){for(var Lt=0;Lt<T[mt].length;Lt++)for(var Yt=0;Yt<we;Yt++)De.vertices.push(T[mt][Lt][Yt]);mt>0&&(bt+=T[mt-1].length,De.holes.push(bt))}return De}},67709:function(Ue){function W(X){var j=X.target||X.srcElement;j.__resizeRAF__&&cancelAnimationFrame(j.__resizeRAF__),j.__resizeRAF__=requestAnimationFrame(function(){var m=j.__resizeTrigger__,J=m&&m.__resizeListeners__;J&&J.forEach(function(F){F.call(m,X)})})}var L=function(j,m){var J=this,F=J.document,$,re=F.attachEvent;typeof navigator!="undefined"&&($=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function ie(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",W)}if(!j.__resizeListeners__)if(j.__resizeListeners__=[],re)j.__resizeTrigger__=j,j.attachEvent("onresize",W);else{getComputedStyle(j).position==="static"&&(j.style.position="relative");var ne=j.__resizeTrigger__=F.createElement("object");ne.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ne.setAttribute("class","resize-sensor"),ne.setAttribute("tabindex","-1"),ne.setAttribute("title",""),ne.__resizeElement__=j,ne.onload=ie,ne.type="text/html",$&&j.appendChild(ne),ne.data="about:blank",$||j.appendChild(ne)}j.__resizeListeners__.push(m)};Ue.exports=typeof window=="undefined"?L:L.bind(window),Ue.exports.unbind=function(X,j){var m=document.attachEvent,J=X.__resizeListeners__||[];if(j){var F=J.indexOf(j);F!==-1&&J.splice(F,1)}else J=X.__resizeListeners__=[];if(!J.length){if(m)X.detachEvent("onresize",W);else if(X.__resizeTrigger__){var $=X.__resizeTrigger__.contentDocument,re=$&&$.defaultView;re&&(re.removeEventListener("resize",W),delete re.__resizeTrigger__),X.__resizeTrigger__=!X.removeChild(X.__resizeTrigger__)}delete X.__resizeListeners__}}},26729:function(Ue){"use strict";var W=Object.prototype.hasOwnProperty,L="~";function X(){}Object.create&&(X.prototype=Object.create(null),new X().__proto__||(L=!1));function j($,re,ie){this.fn=$,this.context=re,this.once=ie||!1}function m($,re,ie,ne,Le){if(typeof ie!="function")throw new TypeError("The listener must be a function");var Ie=new j(ie,ne||$,Le),He=L?L+re:re;return $._events[He]?$._events[He].fn?$._events[He]=[$._events[He],Ie]:$._events[He].push(Ie):($._events[He]=Ie,$._eventsCount++),$}function J($,re){--$._eventsCount==0?$._events=new X:delete $._events[re]}function F(){this._events=new X,this._eventsCount=0}F.prototype.eventNames=function(){var re=[],ie,ne;if(this._eventsCount===0)return re;for(ne in ie=this._events)W.call(ie,ne)&&re.push(L?ne.slice(1):ne);return Object.getOwnPropertySymbols?re.concat(Object.getOwnPropertySymbols(ie)):re},F.prototype.listeners=function(re){var ie=L?L+re:re,ne=this._events[ie];if(!ne)return[];if(ne.fn)return[ne.fn];for(var Le=0,Ie=ne.length,He=new Array(Ie);Le<Ie;Le++)He[Le]=ne[Le].fn;return He},F.prototype.listenerCount=function(re){var ie=L?L+re:re,ne=this._events[ie];return ne?ne.fn?1:ne.length:0},F.prototype.emit=function(re,ie,ne,Le,Ie,He){var Rt=L?L+re:re;if(!this._events[Rt])return!1;var $t=this._events[Rt],ht=arguments.length,Ut,dt;if($t.fn){switch($t.once&&this.removeListener(re,$t.fn,void 0,!0),ht){case 1:return $t.fn.call($t.context),!0;case 2:return $t.fn.call($t.context,ie),!0;case 3:return $t.fn.call($t.context,ie,ne),!0;case 4:return $t.fn.call($t.context,ie,ne,Le),!0;case 5:return $t.fn.call($t.context,ie,ne,Le,Ie),!0;case 6:return $t.fn.call($t.context,ie,ne,Le,Ie,He),!0}for(dt=1,Ut=new Array(ht-1);dt<ht;dt++)Ut[dt-1]=arguments[dt];$t.fn.apply($t.context,Ut)}else{var nt=$t.length,rt;for(dt=0;dt<nt;dt++)switch($t[dt].once&&this.removeListener(re,$t[dt].fn,void 0,!0),ht){case 1:$t[dt].fn.call($t[dt].context);break;case 2:$t[dt].fn.call($t[dt].context,ie);break;case 3:$t[dt].fn.call($t[dt].context,ie,ne);break;case 4:$t[dt].fn.call($t[dt].context,ie,ne,Le);break;default:if(!Ut)for(rt=1,Ut=new Array(ht-1);rt<ht;rt++)Ut[rt-1]=arguments[rt];$t[dt].fn.apply($t[dt].context,Ut)}}return!0},F.prototype.on=function(re,ie,ne){return m(this,re,ie,ne,!1)},F.prototype.once=function(re,ie,ne){return m(this,re,ie,ne,!0)},F.prototype.removeListener=function(re,ie,ne,Le){var Ie=L?L+re:re;if(!this._events[Ie])return this;if(!ie)return J(this,Ie),this;var He=this._events[Ie];if(He.fn)He.fn===ie&&(!Le||He.once)&&(!ne||He.context===ne)&&J(this,Ie);else{for(var Rt=0,$t=[],ht=He.length;Rt<ht;Rt++)(He[Rt].fn!==ie||Le&&!He[Rt].once||ne&&He[Rt].context!==ne)&&$t.push(He[Rt]);$t.length?this._events[Ie]=$t.length===1?$t[0]:$t:J(this,Ie)}return this},F.prototype.removeAllListeners=function(re){var ie;return re?(ie=L?L+re:re,this._events[ie]&&J(this,ie)):(this._events=new X,this._eventsCount=0),this},F.prototype.off=F.prototype.removeListener,F.prototype.addListener=F.prototype.on,F.prefixed=L,F.EventEmitter=F,Ue.exports=F},7375:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0});var L=Symbol.for("INJECTION");function X($,re,ie,ne){function Le(){return ne&&!Reflect.hasMetadata(L,this,re)&&Reflect.defineMetadata(L,ie(),this,re),Reflect.hasMetadata(L,this,re)?Reflect.getMetadata(L,this,re):ie()}function Ie(He){Reflect.defineMetadata(L,He,this,re)}Object.defineProperty($,re,{configurable:!0,enumerable:!0,get:Le,set:Ie})}function j($,re){return function(ie){return function(ne,Le){var Ie=function(){return $.get(ie)};X(ne,Le,Ie,re)}}}W.makePropertyInjectDecorator=j;function m($,re){return function(ie,ne){return function(Le,Ie){var He=function(){return $.getNamed(ie,ne)};X(Le,Ie,He,re)}}}W.makePropertyInjectNamedDecorator=m;function J($,re){return function(ie,ne,Le){return function(Ie,He){var Rt=function(){return $.getTagged(ie,ne,Le)};X(Ie,He,Rt,re)}}}W.makePropertyInjectTaggedDecorator=J;function F($,re){return function(ie){return function(ne,Le){var Ie=function(){return $.getAll(ie)};X(ne,Le,Ie,re)}}}W.makePropertyMultiInjectDecorator=F},84879:function(Ue,W,L){"use strict";var X;X={value:!0};var j=L(7375);function m(J,F){F===void 0&&(F=!0);var $=j.makePropertyInjectDecorator(J,F),re=j.makePropertyInjectNamedDecorator(J,F),ie=j.makePropertyInjectTaggedDecorator(J,F),ne=j.makePropertyMultiInjectDecorator(J,F);return{lazyInject:$,lazyInjectNamed:re,lazyInjectTagged:ie,lazyMultiInject:ne}}W.Z=m},99934:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.tagProperty=W.tagParameter=W.decorate=void 0;var X=L(16674),j=L(6867);function m(ne,Le,Ie,He){var Rt=j.TAGGED;F(Rt,ne,Le,He,Ie)}W.tagParameter=m;function J(ne,Le,Ie){var He=j.TAGGED_PROP;F(He,ne.constructor,Le,Ie)}W.tagProperty=J;function F(ne,Le,Ie,He,Rt){var $t={},ht=typeof Rt=="number",Ut=Rt!==void 0&&ht?Rt.toString():Ie;if(ht&&Ie!==void 0)throw new Error(X.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ne,Le)&&($t=Reflect.getMetadata(ne,Le));var dt=$t[Ut];if(!Array.isArray(dt))dt=[];else for(var nt=0,rt=dt;nt<rt.length;nt++){var er=rt[nt];if(er.key===He.key)throw new Error(X.DUPLICATED_METADATA+" "+er.key.toString())}dt.push(He),$t[Ut]=dt,Reflect.defineMetadata(ne,$t,Le)}function $(ne,Le){Reflect.decorate(ne,Le)}function re(ne,Le){return function(Ie,He){Le(Ie,He,ne)}}function ie(ne,Le,Ie){typeof Ie=="number"?$([re(Ie,ne)],Le):typeof Ie=="string"?Reflect.decorate([ne],Le,Ie):$([ne],Le)}W.decorate=ie},5744:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.inject=W.LazyServiceIdentifer=void 0;var X=L(16674),j=L(6867),m=L(47738),J=L(99934),F=function(){function re(ie){this._cb=ie}return re.prototype.unwrap=function(){return this._cb()},re}();W.LazyServiceIdentifer=F;function $(re){return function(ie,ne,Le){if(re===void 0)throw new Error(X.UNDEFINED_INJECT_ANNOTATION(ie.name));var Ie=new m.Metadata(j.INJECT_TAG,re);typeof Le=="number"?J.tagParameter(ie,ne,Le,Ie):J.tagProperty(ie,ne,Ie)}}W.inject=$},64315:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.injectable=void 0;var X=L(16674),j=L(6867);function m(){return function(J){if(Reflect.hasOwnMetadata(j.PARAM_TYPES,J))throw new Error(X.DUPLICATED_INJECTABLE_DECORATOR);var F=Reflect.getMetadata(j.DESIGN_PARAM_TYPES,J)||[];return Reflect.defineMetadata(j.PARAM_TYPES,F,J),J}}W.injectable=m},71693:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.multiInject=void 0;var X=L(6867),j=L(47738),m=L(99934);function J(F){return function($,re,ie){var ne=new j.Metadata(X.MULTI_INJECT_TAG,F);typeof ie=="number"?m.tagParameter($,re,ie,ne):m.tagProperty($,re,ne)}}W.multiInject=J},38085:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.named=void 0;var X=L(6867),j=L(47738),m=L(99934);function J(F){return function($,re,ie){var ne=new j.Metadata(X.NAMED_TAG,F);typeof ie=="number"?m.tagParameter($,re,ie,ne):m.tagProperty($,re,ne)}}W.named=J},6515:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.optional=void 0;var X=L(6867),j=L(47738),m=L(99934);function J(){return function(F,$,re){var ie=new j.Metadata(X.OPTIONAL_TAG,!0);typeof re=="number"?m.tagParameter(F,$,re,ie):m.tagProperty(F,$,ie)}}W.optional=J},7014:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.postConstruct=void 0;var X=L(16674),j=L(6867),m=L(47738);function J(){return function(F,$,re){var ie=new m.Metadata(j.POST_CONSTRUCT,$);if(Reflect.hasOwnMetadata(j.POST_CONSTRUCT,F.constructor))throw new Error(X.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(j.POST_CONSTRUCT,ie,F.constructor)}}W.postConstruct=J},32052:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.tagged=void 0;var X=L(47738),j=L(99934);function m(J,F){return function($,re,ie){var ne=new X.Metadata(J,F);typeof ie=="number"?j.tagParameter($,re,ie,ne):j.tagProperty($,re,ne)}}W.tagged=m},55638:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.targetName=void 0;var X=L(6867),j=L(47738),m=L(99934);function J(F){return function($,re,ie){var ne=new j.Metadata(X.NAME_TAG,F);m.tagParameter($,re,ie,ne)}}W.targetName=J},86757:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.unmanaged=void 0;var X=L(6867),j=L(47738),m=L(99934);function J(){return function(F,$,re){var ie=new j.Metadata(X.UNMANAGED_TAG,!0);m.tagParameter(F,$,re,ie)}}W.unmanaged=J},44290:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Binding=void 0;var X=L(28421),j=L(37791),m=function(){function J(F,$){this.id=j.id(),this.activated=!1,this.serviceIdentifier=F,this.scope=$,this.type=X.BindingTypeEnum.Invalid,this.constraint=function(re){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return J.prototype.clone=function(){var F=new J(this.serviceIdentifier,this.scope);return F.activated=F.scope===X.BindingScopeEnum.Singleton?this.activated:!1,F.implementationType=this.implementationType,F.dynamicValue=this.dynamicValue,F.scope=this.scope,F.type=this.type,F.factory=this.factory,F.provider=this.provider,F.constraint=this.constraint,F.onActivation=this.onActivation,F.cache=this.cache,F},J}();W.Binding=m},23184:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingCount=void 0;var L={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};W.BindingCount=L},16674:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.STACK_OVERFLOW=W.CIRCULAR_DEPENDENCY_IN_FACTORY=W.POST_CONSTRUCT_ERROR=W.MULTIPLE_POST_CONSTRUCT_METHODS=W.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=W.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=W.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=W.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=W.ARGUMENTS_LENGTH_MISMATCH=W.INVALID_DECORATOR_OPERATION=W.INVALID_TO_SELF_VALUE=W.INVALID_FUNCTION_BINDING=W.INVALID_MIDDLEWARE_RETURN=W.NO_MORE_SNAPSHOTS_AVAILABLE=W.INVALID_BINDING_TYPE=W.NOT_IMPLEMENTED=W.CIRCULAR_DEPENDENCY=W.UNDEFINED_INJECT_ANNOTATION=W.MISSING_INJECT_ANNOTATION=W.MISSING_INJECTABLE_ANNOTATION=W.NOT_REGISTERED=W.CANNOT_UNBIND=W.AMBIGUOUS_MATCH=W.KEY_NOT_FOUND=W.NULL_ARGUMENT=W.DUPLICATED_METADATA=W.DUPLICATED_INJECTABLE_DECORATOR=void 0,W.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",W.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",W.NULL_ARGUMENT="NULL argument",W.KEY_NOT_FOUND="Key Not Found",W.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",W.CANNOT_UNBIND="Could not unbind serviceIdentifier:",W.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",W.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",W.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var L=function(J){return"@inject called with undefined this could mean that the class "+J+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};W.UNDEFINED_INJECT_ANNOTATION=L,W.CIRCULAR_DEPENDENCY="Circular dependency found:",W.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",W.INVALID_BINDING_TYPE="Invalid binding type:",W.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",W.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",W.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",W.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",W.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var X=function(){for(var J=[],F=0;F<arguments.length;F++)J[F]=arguments[F];return"The number of constructor arguments in the derived class "+(J[0]+" must be >= than the number of constructor arguments of its base class.")};W.ARGUMENTS_LENGTH_MISMATCH=X,W.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",W.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",W.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",W.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",W.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var j=function(){for(var J=[],F=0;F<arguments.length;F++)J[F]=arguments[F];return"@postConstruct error in class "+J[0]+": "+J[1]};W.POST_CONSTRUCT_ERROR=j;var m=function(){for(var J=[],F=0;F<arguments.length;F++)J[F]=arguments[F];return"It looks like there is a circular dependency "+("in one of the '"+J[0]+"' bindings. Please investigate bindings with")+("service identifier '"+J[1]+"'.")};W.CIRCULAR_DEPENDENCY_IN_FACTORY=m,W.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.TargetTypeEnum=W.BindingTypeEnum=W.BindingScopeEnum=void 0;var L={Request:"Request",Singleton:"Singleton",Transient:"Transient"};W.BindingScopeEnum=L;var X={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};W.BindingTypeEnum=X;var j={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};W.TargetTypeEnum=j},6867:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.NON_CUSTOM_TAG_KEYS=W.POST_CONSTRUCT=W.DESIGN_PARAM_TYPES=W.PARAM_TYPES=W.TAGGED_PROP=W.TAGGED=W.MULTI_INJECT_TAG=W.INJECT_TAG=W.OPTIONAL_TAG=W.UNMANAGED_TAG=W.NAME_TAG=W.NAMED_TAG=void 0,W.NAMED_TAG="named",W.NAME_TAG="name",W.UNMANAGED_TAG="unmanaged",W.OPTIONAL_TAG="optional",W.INJECT_TAG="inject",W.MULTI_INJECT_TAG="multi_inject",W.TAGGED="inversify:tagged",W.TAGGED_PROP="inversify:tagged_props",W.PARAM_TYPES="inversify:paramtypes",W.DESIGN_PARAM_TYPES="design:paramtypes",W.POST_CONSTRUCT="post_construct";function L(){return[W.INJECT_TAG,W.MULTI_INJECT_TAG,W.NAME_TAG,W.UNMANAGED_TAG,W.NAMED_TAG,W.OPTIONAL_TAG]}W.NON_CUSTOM_TAG_KEYS=L()},51389:function(Ue,W,L){"use strict";var X=this&&this.__awaiter||function(dt,nt,rt,er){function K(Ht){return Ht instanceof rt?Ht:new rt(function(at){at(Ht)})}return new(rt||(rt=Promise))(function(Ht,at){function Ye(Ot){try{Je(er.next(Ot))}catch(dr){at(dr)}}function ut(Ot){try{Je(er.throw(Ot))}catch(dr){at(dr)}}function Je(Ot){Ot.done?Ht(Ot.value):K(Ot.value).then(Ye,ut)}Je((er=er.apply(dt,nt||[])).next())})},j=this&&this.__generator||function(dt,nt){var rt={label:0,sent:function(){if(Ht[0]&1)throw Ht[1];return Ht[1]},trys:[],ops:[]},er,K,Ht,at;return at={next:Ye(0),throw:Ye(1),return:Ye(2)},typeof Symbol=="function"&&(at[Symbol.iterator]=function(){return this}),at;function Ye(Je){return function(Ot){return ut([Je,Ot])}}function ut(Je){if(er)throw new TypeError("Generator is already executing.");for(;rt;)try{if(er=1,K&&(Ht=Je[0]&2?K.return:Je[0]?K.throw||((Ht=K.return)&&Ht.call(K),0):K.next)&&!(Ht=Ht.call(K,Je[1])).done)return Ht;switch(K=0,Ht&&(Je=[Je[0]&2,Ht.value]),Je[0]){case 0:case 1:Ht=Je;break;case 4:return rt.label++,{value:Je[1],done:!1};case 5:rt.label++,K=Je[1],Je=[0];continue;case 7:Je=rt.ops.pop(),rt.trys.pop();continue;default:if(Ht=rt.trys,!(Ht=Ht.length>0&&Ht[Ht.length-1])&&(Je[0]===6||Je[0]===2)){rt=0;continue}if(Je[0]===3&&(!Ht||Je[1]>Ht[0]&&Je[1]<Ht[3])){rt.label=Je[1];break}if(Je[0]===6&&rt.label<Ht[1]){rt.label=Ht[1],Ht=Je;break}if(Ht&&rt.label<Ht[2]){rt.label=Ht[2],rt.ops.push(Je);break}Ht[2]&&rt.ops.pop(),rt.trys.pop();continue}Je=nt.call(dt,rt)}catch(Ot){Je=[6,Ot],K=0}finally{er=Ht=0}if(Je[0]&5)throw Je[1];return{value:Je[0]?Je[1]:void 0,done:!0}}},m=this&&this.__spreadArray||function(dt,nt){for(var rt=0,er=nt.length,K=dt.length;rt<er;rt++,K++)dt[K]=nt[rt];return dt};Object.defineProperty(W,"__esModule",{value:!0}),W.Container=void 0;var J=L(44290),F=L(16674),$=L(28421),re=L(6867),ie=L(51377),ne=L(86311),Le=L(31927),Ie=L(15451),He=L(37791),Rt=L(55800),$t=L(85700),ht=L(80175),Ut=function(){function dt(nt){this._appliedMiddleware=[];var rt=nt||{};if(typeof rt!="object")throw new Error(""+F.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(rt.defaultScope===void 0)rt.defaultScope=$.BindingScopeEnum.Transient;else if(rt.defaultScope!==$.BindingScopeEnum.Singleton&&rt.defaultScope!==$.BindingScopeEnum.Transient&&rt.defaultScope!==$.BindingScopeEnum.Request)throw new Error(""+F.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(rt.autoBindInjectable===void 0)rt.autoBindInjectable=!1;else if(typeof rt.autoBindInjectable!="boolean")throw new Error(""+F.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(rt.skipBaseClassChecks===void 0)rt.skipBaseClassChecks=!1;else if(typeof rt.skipBaseClassChecks!="boolean")throw new Error(""+F.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:rt.autoBindInjectable,defaultScope:rt.defaultScope,skipBaseClassChecks:rt.skipBaseClassChecks},this.id=He.id(),this._bindingDictionary=new ht.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ie.MetadataReader}return dt.merge=function(nt,rt){for(var er=[],K=2;K<arguments.length;K++)er[K-2]=arguments[K];var Ht=new dt,at=m([nt,rt],er).map(function(Je){return ne.getBindingDictionary(Je)}),Ye=ne.getBindingDictionary(Ht);function ut(Je,Ot){Je.traverse(function(dr,Cr){Cr.forEach(function(jr){Ot.add(jr.serviceIdentifier,jr.clone())})})}return at.forEach(function(Je){ut(Je,Ye)}),Ht},dt.prototype.load=function(){for(var nt=[],rt=0;rt<arguments.length;rt++)nt[rt]=arguments[rt];for(var er=this._getContainerModuleHelpersFactory(),K=0,Ht=nt;K<Ht.length;K++){var at=Ht[K],Ye=er(at.id);at.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)}},dt.prototype.loadAsync=function(){for(var nt=[],rt=0;rt<arguments.length;rt++)nt[rt]=arguments[rt];return X(this,void 0,void 0,function(){var er,K,Ht,at,Ye;return j(this,function(ut){switch(ut.label){case 0:er=this._getContainerModuleHelpersFactory(),K=0,Ht=nt,ut.label=1;case 1:return K<Ht.length?(at=Ht[K],Ye=er(at.id),[4,at.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)]):[3,4];case 2:ut.sent(),ut.label=3;case 3:return K++,[3,1];case 4:return[2]}})})},dt.prototype.unload=function(){for(var nt=this,rt=[],er=0;er<arguments.length;er++)rt[er]=arguments[er];var K=function(Ht){return function(at){return at.moduleId===Ht}};rt.forEach(function(Ht){var at=K(Ht.id);nt._bindingDictionary.removeByCondition(at)})},dt.prototype.bind=function(nt){var rt=this.options.defaultScope||$.BindingScopeEnum.Transient,er=new J.Binding(nt,rt);return this._bindingDictionary.add(nt,er),new Ie.BindingToSyntax(er)},dt.prototype.rebind=function(nt){return this.unbind(nt),this.bind(nt)},dt.prototype.unbind=function(nt){try{this._bindingDictionary.remove(nt)}catch(rt){throw new Error(F.CANNOT_UNBIND+" "+Rt.getServiceIdentifierAsString(nt))}},dt.prototype.unbindAll=function(){this._bindingDictionary=new ht.Lookup},dt.prototype.isBound=function(nt){var rt=this._bindingDictionary.hasKey(nt);return!rt&&this.parent&&(rt=this.parent.isBound(nt)),rt},dt.prototype.isBoundNamed=function(nt,rt){return this.isBoundTagged(nt,re.NAMED_TAG,rt)},dt.prototype.isBoundTagged=function(nt,rt,er){var K=!1;if(this._bindingDictionary.hasKey(nt)){var Ht=this._bindingDictionary.get(nt),at=ne.createMockRequest(this,nt,rt,er);K=Ht.some(function(Ye){return Ye.constraint(at)})}return!K&&this.parent&&(K=this.parent.isBoundTagged(nt,rt,er)),K},dt.prototype.snapshot=function(){this._snapshots.push($t.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},dt.prototype.restore=function(){var nt=this._snapshots.pop();if(nt===void 0)throw new Error(F.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=nt.bindings,this._middleware=nt.middleware},dt.prototype.createChild=function(nt){var rt=new dt(nt||this.options);return rt.parent=this,rt},dt.prototype.applyMiddleware=function(){for(var nt=[],rt=0;rt<arguments.length;rt++)nt[rt]=arguments[rt];this._appliedMiddleware=this._appliedMiddleware.concat(nt);var er=this._middleware?this._middleware:this._planAndResolve();this._middleware=nt.reduce(function(K,Ht){return Ht(K)},er)},dt.prototype.applyCustomMetadataReader=function(nt){this._metadataReader=nt},dt.prototype.get=function(nt){return this._get(!1,!1,$.TargetTypeEnum.Variable,nt)},dt.prototype.getTagged=function(nt,rt,er){return this._get(!1,!1,$.TargetTypeEnum.Variable,nt,rt,er)},dt.prototype.getNamed=function(nt,rt){return this.getTagged(nt,re.NAMED_TAG,rt)},dt.prototype.getAll=function(nt){return this._get(!0,!0,$.TargetTypeEnum.Variable,nt)},dt.prototype.getAllTagged=function(nt,rt,er){return this._get(!1,!0,$.TargetTypeEnum.Variable,nt,rt,er)},dt.prototype.getAllNamed=function(nt,rt){return this.getAllTagged(nt,re.NAMED_TAG,rt)},dt.prototype.resolve=function(nt){var rt=this.createChild();return rt.bind(nt).toSelf(),this._appliedMiddleware.forEach(function(er){rt.applyMiddleware(er)}),rt.get(nt)},dt.prototype._getContainerModuleHelpersFactory=function(){var nt=this,rt=function(Ye,ut){Ye._binding.moduleId=ut},er=function(Ye){return function(ut){var Je=nt.bind.bind(nt),Ot=Je(ut);return rt(Ot,Ye),Ot}},K=function(Ye){return function(ut){var Je=nt.unbind.bind(nt);Je(ut)}},Ht=function(Ye){return function(ut){var Je=nt.isBound.bind(nt);return Je(ut)}},at=function(Ye){return function(ut){var Je=nt.rebind.bind(nt),Ot=Je(ut);return rt(Ot,Ye),Ot}};return function(Ye){return{bindFunction:er(Ye),isboundFunction:Ht(Ye),rebindFunction:at(Ye),unbindFunction:K(Ye)}}},dt.prototype._get=function(nt,rt,er,K,Ht,at){var Ye=null,ut={avoidConstraints:nt,contextInterceptor:function(Je){return Je},isMultiInject:rt,key:Ht,serviceIdentifier:K,targetType:er,value:at};if(this._middleware){if(Ye=this._middleware(ut),Ye==null)throw new Error(F.INVALID_MIDDLEWARE_RETURN)}else Ye=this._planAndResolve()(ut);return Ye},dt.prototype._planAndResolve=function(){var nt=this;return function(rt){var er=ne.plan(nt._metadataReader,nt,rt.isMultiInject,rt.targetType,rt.serviceIdentifier,rt.key,rt.value,rt.avoidConstraints);er=rt.contextInterceptor(er);var K=Le.resolve(er);return K}},dt}();W.Container=Ut},33244:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.AsyncContainerModule=W.ContainerModule=void 0;var X=L(37791),j=function(){function J(F){this.id=X.id(),this.registry=F}return J}();W.ContainerModule=j;var m=function(){function J(F){this.id=X.id(),this.registry=F}return J}();W.AsyncContainerModule=m},85700:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.ContainerSnapshot=void 0;var L=function(){function X(){}return X.of=function(j,m){var J=new X;return J.bindings=j,J.middleware=m,J},X}();W.ContainerSnapshot=L},80175:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Lookup=void 0;var X=L(16674),j=function(){function m(){this._map=new Map}return m.prototype.getMap=function(){return this._map},m.prototype.add=function(J,F){if(J==null)throw new Error(X.NULL_ARGUMENT);if(F==null)throw new Error(X.NULL_ARGUMENT);var $=this._map.get(J);$!==void 0?($.push(F),this._map.set(J,$)):this._map.set(J,[F])},m.prototype.get=function(J){if(J==null)throw new Error(X.NULL_ARGUMENT);var F=this._map.get(J);if(F!==void 0)return F;throw new Error(X.KEY_NOT_FOUND)},m.prototype.remove=function(J){if(J==null)throw new Error(X.NULL_ARGUMENT);if(!this._map.delete(J))throw new Error(X.KEY_NOT_FOUND)},m.prototype.removeByCondition=function(J){var F=this;this._map.forEach(function($,re){var ie=$.filter(function(ne){return!J(ne)});ie.length>0?F._map.set(re,ie):F._map.delete(re)})},m.prototype.hasKey=function(J){if(J==null)throw new Error(X.NULL_ARGUMENT);return this._map.has(J)},m.prototype.clone=function(){var J=new m;return this._map.forEach(function(F,$){F.forEach(function(re){return J.add($,re.clone())})}),J},m.prototype.traverse=function(J){this._map.forEach(function(F,$){J($,F)})},m}();W.Lookup=j},86700:function(Ue,W,L){"use strict";var X;X={value:!0},X=X=X=X=X=X=W.GW=X=X=W.zY=X=X=X=X=X=W.f3=X=X=W.b2=X=X=X=X=X=W.W2=X=void 0;var j=L(6867);X=j;var m=L(51389);Object.defineProperty(W,"W2",{enumerable:!0,get:function(){return m.Container}});var J=L(28421);X={enumerable:!0,get:function(){return J.BindingScopeEnum}},X={enumerable:!0,get:function(){return J.BindingTypeEnum}},X={enumerable:!0,get:function(){return J.TargetTypeEnum}};var F=L(33244);X={enumerable:!0,get:function(){return F.AsyncContainerModule}},X={enumerable:!0,get:function(){return F.ContainerModule}};var $=L(64315);Object.defineProperty(W,"b2",{enumerable:!0,get:function(){return $.injectable}});var re=L(32052);X={enumerable:!0,get:function(){return re.tagged}};var ie=L(38085);X={enumerable:!0,get:function(){return ie.named}};var ne=L(5744);Object.defineProperty(W,"f3",{enumerable:!0,get:function(){return ne.inject}}),X={enumerable:!0,get:function(){return ne.LazyServiceIdentifer}};var Le=L(6515);X={enumerable:!0,get:function(){return Le.optional}};var Ie=L(86757);X={enumerable:!0,get:function(){return Ie.unmanaged}};var He=L(71693);X={enumerable:!0,get:function(){return He.multiInject}};var Rt=L(55638);X={enumerable:!0,get:function(){return Rt.targetName}};var $t=L(7014);Object.defineProperty(W,"zY",{enumerable:!0,get:function(){return $t.postConstruct}});var ht=L(51377);X={enumerable:!0,get:function(){return ht.MetadataReader}};var Ut=L(37791);X={enumerable:!0,get:function(){return Ut.id}};var dt=L(99934);Object.defineProperty(W,"GW",{enumerable:!0,get:function(){return dt.decorate}});var nt=L(80758);X={enumerable:!0,get:function(){return nt.traverseAncerstors}},X={enumerable:!0,get:function(){return nt.taggedConstraint}},X={enumerable:!0,get:function(){return nt.namedConstraint}},X={enumerable:!0,get:function(){return nt.typeConstraint}};var rt=L(55800);X={enumerable:!0,get:function(){return rt.getServiceIdentifierAsString}};var er=L(70600);X={enumerable:!0,get:function(){return er.multiBindToService}}},95228:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Context=void 0;var X=L(37791),j=function(){function m(J){this.id=X.id(),this.container=J}return m.prototype.addPlan=function(J){this.plan=J},m.prototype.setCurrentRequest=function(J){this.currentRequest=J},m}();W.Context=j},47738:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Metadata=void 0;var X=L(6867),j=function(){function m(J,F){this.key=J,this.value=F}return m.prototype.toString=function(){return this.key===X.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},m}();W.Metadata=j},51377:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.MetadataReader=void 0;var X=L(6867),j=function(){function m(){}return m.prototype.getConstructorMetadata=function(J){var F=Reflect.getMetadata(X.PARAM_TYPES,J),$=Reflect.getMetadata(X.TAGGED,J);return{compilerGeneratedMetadata:F,userGeneratedMetadata:$||{}}},m.prototype.getPropertiesMetadata=function(J){var F=Reflect.getMetadata(X.TAGGED_PROP,J)||[];return F},m}();W.MetadataReader=j},55314:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Plan=void 0;var L=function(){function X(j,m){this.parentContext=j,this.rootRequest=m}return X}();W.Plan=L},86311:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.getBindingDictionary=W.createMockRequest=W.plan=void 0;var X=L(23184),j=L(16674),m=L(28421),J=L(6867),F=L(85265),$=L(55800),re=L(95228),ie=L(47738),ne=L(55314),Le=L(6e3),Ie=L(6748),He=L(18924);function Rt(K){return K._bindingDictionary}W.getBindingDictionary=Rt;function $t(K,Ht,at,Ye,ut,Je){var Ot=K?J.MULTI_INJECT_TAG:J.INJECT_TAG,dr=new ie.Metadata(Ot,at),Cr=new He.Target(Ht,Ye,at,dr);if(ut!==void 0){var jr=new ie.Metadata(ut,Je);Cr.metadata.push(jr)}return Cr}function ht(K,Ht,at,Ye,ut){var Je=nt(at.container,ut.serviceIdentifier),Ot=[];return Je.length===X.BindingCount.NoBindingsAvailable&&at.container.options.autoBindInjectable&&typeof ut.serviceIdentifier=="function"&&K.getConstructorMetadata(ut.serviceIdentifier).compilerGeneratedMetadata&&(at.container.bind(ut.serviceIdentifier).toSelf(),Je=nt(at.container,ut.serviceIdentifier)),Ht?Ot=Je:Ot=Je.filter(function(dr){var Cr=new Ie.Request(dr.serviceIdentifier,at,Ye,dr,ut);return dr.constraint(Cr)}),Ut(ut.serviceIdentifier,Ot,ut,at.container),Ot}function Ut(K,Ht,at,Ye){switch(Ht.length){case X.BindingCount.NoBindingsAvailable:if(at.isOptional())return Ht;var ut=$.getServiceIdentifierAsString(K),Je=j.NOT_REGISTERED;throw Je+=$.listMetadataForTarget(ut,at),Je+=$.listRegisteredBindingsForServiceIdentifier(Ye,ut,nt),new Error(Je);case X.BindingCount.OnlyOneBindingAvailable:if(!at.isArray())return Ht;case X.BindingCount.MultipleBindingsAvailable:default:if(at.isArray())return Ht;var ut=$.getServiceIdentifierAsString(K),Je=j.AMBIGUOUS_MATCH+" "+ut;throw Je+=$.listRegisteredBindingsForServiceIdentifier(Ye,ut,nt),new Error(Je)}}function dt(K,Ht,at,Ye,ut,Je){var Ot,dr;if(ut===null){Ot=ht(K,Ht,Ye,null,Je),dr=new Ie.Request(at,Ye,null,Ot,Je);var Cr=new ne.Plan(Ye,dr);Ye.addPlan(Cr)}else Ot=ht(K,Ht,Ye,ut,Je),dr=ut.addChildRequest(Je.serviceIdentifier,Ot,Je);Ot.forEach(function(jr){var T=null;if(Je.isArray())T=dr.addChildRequest(jr.serviceIdentifier,jr,Je);else{if(jr.cache)return;T=dr}if(jr.type===m.BindingTypeEnum.Instance&&jr.implementationType!==null){var we=Le.getDependencies(K,jr.implementationType);if(!Ye.container.options.skipBaseClassChecks){var De=Le.getBaseClassDependencyCount(K,jr.implementationType);if(we.length<De){var bt=j.ARGUMENTS_LENGTH_MISMATCH(Le.getFunctionName(jr.implementationType));throw new Error(bt)}}we.forEach(function(mt){dt(K,!1,mt.serviceIdentifier,Ye,T,mt)})}})}function nt(K,Ht){var at=[],Ye=Rt(K);return Ye.hasKey(Ht)?at=Ye.get(Ht):K.parent!==null&&(at=nt(K.parent,Ht)),at}function rt(K,Ht,at,Ye,ut,Je,Ot,dr){dr===void 0&&(dr=!1);var Cr=new re.Context(Ht),jr=$t(at,Ye,ut,"",Je,Ot);try{return dt(K,dr,ut,Cr,null,jr),Cr}catch(T){throw F.isStackOverflowExeption(T)&&Cr.plan&&$.circularDependencyToException(Cr.plan.rootRequest),T}}W.plan=rt;function er(K,Ht,at,Ye){var ut=new He.Target(m.TargetTypeEnum.Variable,"",Ht,new ie.Metadata(at,Ye)),Je=new re.Context(K),Ot=new Ie.Request(Ht,Je,null,[],ut);return Ot}W.createMockRequest=er},88460:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.QueryableString=void 0;var L=function(){function X(j){this.str=j}return X.prototype.startsWith=function(j){return this.str.indexOf(j)===0},X.prototype.endsWith=function(j){var m="",J=j.split("").reverse().join("");return m=this.str.split("").reverse().join(""),this.startsWith.call({str:m},J)},X.prototype.contains=function(j){return this.str.indexOf(j)!==-1},X.prototype.equals=function(j){return this.str===j},X.prototype.value=function(){return this.str},X}();W.QueryableString=L},6e3:function(Ue,W,L){"use strict";var X=this&&this.__spreadArray||function(ht,Ut){for(var dt=0,nt=Ut.length,rt=ht.length;dt<nt;dt++,rt++)ht[rt]=Ut[dt];return ht};Object.defineProperty(W,"__esModule",{value:!0}),W.getFunctionName=W.getBaseClassDependencyCount=W.getDependencies=void 0;var j=L(5744),m=L(16674),J=L(28421),F=L(6867),$=L(55800);Object.defineProperty(W,"getFunctionName",{enumerable:!0,get:function(){return $.getFunctionName}});var re=L(18924);function ie(ht,Ut){var dt=$.getFunctionName(Ut),nt=ne(ht,dt,Ut,!1);return nt}W.getDependencies=ie;function ne(ht,Ut,dt,nt){var rt=ht.getConstructorMetadata(dt),er=rt.compilerGeneratedMetadata;if(er===void 0){var K=m.MISSING_INJECTABLE_ANNOTATION+" "+Ut+".";throw new Error(K)}var Ht=rt.userGeneratedMetadata,at=Object.keys(Ht),Ye=dt.length===0&&at.length>0,ut=at.length>dt.length,Je=Ye||ut?at.length:dt.length,Ot=Ie(nt,Ut,er,Ht,Je),dr=He(ht,dt),Cr=X(X([],Ot),dr);return Cr}function Le(ht,Ut,dt,nt,rt){var er=rt[ht.toString()]||[],K=$t(er),Ht=K.unmanaged!==!0,at=nt[ht],Ye=K.inject||K.multiInject;if(at=Ye||at,at instanceof j.LazyServiceIdentifer&&(at=at.unwrap()),Ht){var ut=at===Object,Je=at===Function,Ot=at===void 0,dr=ut||Je||Ot;if(!Ut&&dr){var Cr=m.MISSING_INJECT_ANNOTATION+" argument "+ht+" in class "+dt+".";throw new Error(Cr)}var jr=new re.Target(J.TargetTypeEnum.ConstructorArgument,K.targetName,at);return jr.metadata=er,jr}return null}function Ie(ht,Ut,dt,nt,rt){for(var er=[],K=0;K<rt;K++){var Ht=K,at=Le(Ht,ht,Ut,dt,nt);at!==null&&er.push(at)}return er}function He(ht,Ut){for(var dt=ht.getPropertiesMetadata(Ut),nt=[],rt=Object.keys(dt),er=0,K=rt;er<K.length;er++){var Ht=K[er],at=dt[Ht],Ye=$t(dt[Ht]),ut=Ye.targetName||Ht,Je=Ye.inject||Ye.multiInject,Ot=new re.Target(J.TargetTypeEnum.ClassProperty,ut,Je);Ot.metadata=at,nt.push(Ot)}var dr=Object.getPrototypeOf(Ut.prototype).constructor;if(dr!==Object){var Cr=He(ht,dr);nt=X(X([],nt),Cr)}return nt}function Rt(ht,Ut){var dt=Object.getPrototypeOf(Ut.prototype).constructor;if(dt!==Object){var nt=$.getFunctionName(dt),rt=ne(ht,nt,dt,!0),er=rt.map(function(at){return at.metadata.filter(function(Ye){return Ye.key===F.UNMANAGED_TAG})}),K=[].concat.apply([],er).length,Ht=rt.length-K;return Ht>0?Ht:Rt(ht,dt)}else return 0}W.getBaseClassDependencyCount=Rt;function $t(ht){var Ut={};return ht.forEach(function(dt){Ut[dt.key.toString()]=dt.value}),{inject:Ut[F.INJECT_TAG],multiInject:Ut[F.MULTI_INJECT_TAG],targetName:Ut[F.NAME_TAG],unmanaged:Ut[F.UNMANAGED_TAG]}}},6748:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Request=void 0;var X=L(37791),j=function(){function m(J,F,$,re,ie){this.id=X.id(),this.serviceIdentifier=J,this.parentContext=F,this.parentRequest=$,this.target=ie,this.childRequests=[],this.bindings=Array.isArray(re)?re:[re],this.requestScope=$===null?new Map:null}return m.prototype.addChildRequest=function(J,F,$){var re=new m(J,this.parentContext,this,F,$);return this.childRequests.push(re),re},m}();W.Request=j},18924:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Target=void 0;var X=L(6867),j=L(37791),m=L(47738),J=L(88460),F=function(){function $(re,ie,ne,Le){this.id=j.id(),this.type=re,this.serviceIdentifier=ne,this.name=new J.QueryableString(ie||""),this.metadata=new Array;var Ie=null;typeof Le=="string"?Ie=new m.Metadata(X.NAMED_TAG,Le):Le instanceof m.Metadata&&(Ie=Le),Ie!==null&&this.metadata.push(Ie)}return $.prototype.hasTag=function(re){for(var ie=0,ne=this.metadata;ie<ne.length;ie++){var Le=ne[ie];if(Le.key===re)return!0}return!1},$.prototype.isArray=function(){return this.hasTag(X.MULTI_INJECT_TAG)},$.prototype.matchesArray=function(re){return this.matchesTag(X.MULTI_INJECT_TAG)(re)},$.prototype.isNamed=function(){return this.hasTag(X.NAMED_TAG)},$.prototype.isTagged=function(){return this.metadata.some(function(re){return X.NON_CUSTOM_TAG_KEYS.every(function(ie){return re.key!==ie})})},$.prototype.isOptional=function(){return this.matchesTag(X.OPTIONAL_TAG)(!0)},$.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(re){return re.key===X.NAMED_TAG})[0]:null},$.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(re){return X.NON_CUSTOM_TAG_KEYS.every(function(ie){return re.key!==ie})}):null},$.prototype.matchesNamedTag=function(re){return this.matchesTag(X.NAMED_TAG)(re)},$.prototype.matchesTag=function(re){var ie=this;return function(ne){for(var Le=0,Ie=ie.metadata;Le<Ie.length;Le++){var He=Ie[Le];if(He.key===re&&He.value===ne)return!0}return!1}},$}();W.Target=F},52279:function(Ue,W,L){"use strict";var X=this&&this.__spreadArray||function(ne,Le){for(var Ie=0,He=Le.length,Rt=ne.length;Ie<He;Ie++,Rt++)ne[Rt]=Le[Ie];return ne};Object.defineProperty(W,"__esModule",{value:!0}),W.resolveInstance=void 0;var j=L(16674),m=L(28421),J=L(6867);function F(ne,Le,Ie){var He=Le.filter(function($t){return $t.target!==null&&$t.target.type===m.TargetTypeEnum.ClassProperty}),Rt=He.map(Ie);return He.forEach(function($t,ht){var Ut="";Ut=$t.target.name.value();var dt=Rt[ht];ne[Ut]=dt}),ne}function $(ne,Le){return new(ne.bind.apply(ne,X([void 0],Le)))}function re(ne,Le){if(Reflect.hasMetadata(J.POST_CONSTRUCT,ne)){var Ie=Reflect.getMetadata(J.POST_CONSTRUCT,ne);try{Le[Ie.value]()}catch(He){throw new Error(j.POST_CONSTRUCT_ERROR(ne.name,He.message))}}}function ie(ne,Le,Ie){var He=null;if(Le.length>0){var Rt=Le.filter(function(ht){return ht.target!==null&&ht.target.type===m.TargetTypeEnum.ConstructorArgument}),$t=Rt.map(Ie);He=$(ne,$t),He=F(He,Le,Ie)}else He=new ne;return re(ne,He),He}W.resolveInstance=ie},31927:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.resolve=void 0;var X=L(16674),j=L(28421),m=L(85265),J=L(55800),F=L(52279),$=function(ne,Le,Ie){try{return Ie()}catch(He){throw m.isStackOverflowExeption(He)?new Error(X.CIRCULAR_DEPENDENCY_IN_FACTORY(ne,Le.toString())):He}},re=function(ne){return function(Le){Le.parentContext.setCurrentRequest(Le);var Ie=Le.bindings,He=Le.childRequests,Rt=Le.target&&Le.target.isArray(),$t=!Le.parentRequest||!Le.parentRequest.target||!Le.target||!Le.parentRequest.target.matchesArray(Le.target.serviceIdentifier);if(Rt&&$t)return He.map(function(er){var K=re(ne);return K(er)});var ht=null;if(Le.target.isOptional()&&Ie.length===0)return;var Ut=Ie[0],dt=Ut.scope===j.BindingScopeEnum.Singleton,nt=Ut.scope===j.BindingScopeEnum.Request;if(dt&&Ut.activated)return Ut.cache;if(nt&&ne!==null&&ne.has(Ut.id))return ne.get(Ut.id);if(Ut.type===j.BindingTypeEnum.ConstantValue)ht=Ut.cache,Ut.activated=!0;else if(Ut.type===j.BindingTypeEnum.Function)ht=Ut.cache,Ut.activated=!0;else if(Ut.type===j.BindingTypeEnum.Constructor)ht=Ut.implementationType;else if(Ut.type===j.BindingTypeEnum.DynamicValue&&Ut.dynamicValue!==null)ht=$("toDynamicValue",Ut.serviceIdentifier,function(){return Ut.dynamicValue(Le.parentContext)});else if(Ut.type===j.BindingTypeEnum.Factory&&Ut.factory!==null)ht=$("toFactory",Ut.serviceIdentifier,function(){return Ut.factory(Le.parentContext)});else if(Ut.type===j.BindingTypeEnum.Provider&&Ut.provider!==null)ht=$("toProvider",Ut.serviceIdentifier,function(){return Ut.provider(Le.parentContext)});else if(Ut.type===j.BindingTypeEnum.Instance&&Ut.implementationType!==null)ht=F.resolveInstance(Ut.implementationType,He,re(ne));else{var rt=J.getServiceIdentifierAsString(Le.serviceIdentifier);throw new Error(X.INVALID_BINDING_TYPE+" "+rt)}return typeof Ut.onActivation=="function"&&(ht=Ut.onActivation(Le.parentContext,ht)),dt&&(Ut.cache=ht,Ut.activated=!0),nt&&ne!==null&&!ne.has(Ut.id)&&ne.set(Ut.id,ht),ht}};function ie(ne){var Le=re(ne.plan.rootRequest.requestScope);return Le(ne.plan.rootRequest)}W.resolve=ie},83366:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingInSyntax=void 0;var X=L(28421),j=L(71325),m=function(){function J(F){this._binding=F}return J.prototype.inRequestScope=function(){return this._binding.scope=X.BindingScopeEnum.Request,new j.BindingWhenOnSyntax(this._binding)},J.prototype.inSingletonScope=function(){return this._binding.scope=X.BindingScopeEnum.Singleton,new j.BindingWhenOnSyntax(this._binding)},J.prototype.inTransientScope=function(){return this._binding.scope=X.BindingScopeEnum.Transient,new j.BindingWhenOnSyntax(this._binding)},J}();W.BindingInSyntax=m},74889:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingInWhenOnSyntax=void 0;var X=L(83366),j=L(51811),m=L(98370),J=function(){function F($){this._binding=$,this._bindingWhenSyntax=new m.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new j.BindingOnSyntax(this._binding),this._bindingInSyntax=new X.BindingInSyntax($)}return F.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},F.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},F.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},F.prototype.when=function($){return this._bindingWhenSyntax.when($)},F.prototype.whenTargetNamed=function($){return this._bindingWhenSyntax.whenTargetNamed($)},F.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},F.prototype.whenTargetTagged=function($,re){return this._bindingWhenSyntax.whenTargetTagged($,re)},F.prototype.whenInjectedInto=function($){return this._bindingWhenSyntax.whenInjectedInto($)},F.prototype.whenParentNamed=function($){return this._bindingWhenSyntax.whenParentNamed($)},F.prototype.whenParentTagged=function($,re){return this._bindingWhenSyntax.whenParentTagged($,re)},F.prototype.whenAnyAncestorIs=function($){return this._bindingWhenSyntax.whenAnyAncestorIs($)},F.prototype.whenNoAncestorIs=function($){return this._bindingWhenSyntax.whenNoAncestorIs($)},F.prototype.whenAnyAncestorNamed=function($){return this._bindingWhenSyntax.whenAnyAncestorNamed($)},F.prototype.whenAnyAncestorTagged=function($,re){return this._bindingWhenSyntax.whenAnyAncestorTagged($,re)},F.prototype.whenNoAncestorNamed=function($){return this._bindingWhenSyntax.whenNoAncestorNamed($)},F.prototype.whenNoAncestorTagged=function($,re){return this._bindingWhenSyntax.whenNoAncestorTagged($,re)},F.prototype.whenAnyAncestorMatches=function($){return this._bindingWhenSyntax.whenAnyAncestorMatches($)},F.prototype.whenNoAncestorMatches=function($){return this._bindingWhenSyntax.whenNoAncestorMatches($)},F.prototype.onActivation=function($){return this._bindingOnSyntax.onActivation($)},F}();W.BindingInWhenOnSyntax=J},51811:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingOnSyntax=void 0;var X=L(98370),j=function(){function m(J){this._binding=J}return m.prototype.onActivation=function(J){return this._binding.onActivation=J,new X.BindingWhenSyntax(this._binding)},m}();W.BindingOnSyntax=j},15451:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingToSyntax=void 0;var X=L(16674),j=L(28421),m=L(74889),J=L(71325),F=function(){function $(re){this._binding=re}return $.prototype.to=function(re){return this._binding.type=j.BindingTypeEnum.Instance,this._binding.implementationType=re,new m.BindingInWhenOnSyntax(this._binding)},$.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+X.INVALID_TO_SELF_VALUE);var re=this._binding.serviceIdentifier;return this.to(re)},$.prototype.toConstantValue=function(re){return this._binding.type=j.BindingTypeEnum.ConstantValue,this._binding.cache=re,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=j.BindingScopeEnum.Singleton,new J.BindingWhenOnSyntax(this._binding)},$.prototype.toDynamicValue=function(re){return this._binding.type=j.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=re,this._binding.implementationType=null,new m.BindingInWhenOnSyntax(this._binding)},$.prototype.toConstructor=function(re){return this._binding.type=j.BindingTypeEnum.Constructor,this._binding.implementationType=re,this._binding.scope=j.BindingScopeEnum.Singleton,new J.BindingWhenOnSyntax(this._binding)},$.prototype.toFactory=function(re){return this._binding.type=j.BindingTypeEnum.Factory,this._binding.factory=re,this._binding.scope=j.BindingScopeEnum.Singleton,new J.BindingWhenOnSyntax(this._binding)},$.prototype.toFunction=function(re){if(typeof re!="function")throw new Error(X.INVALID_FUNCTION_BINDING);var ie=this.toConstantValue(re);return this._binding.type=j.BindingTypeEnum.Function,this._binding.scope=j.BindingScopeEnum.Singleton,ie},$.prototype.toAutoFactory=function(re){return this._binding.type=j.BindingTypeEnum.Factory,this._binding.factory=function(ie){var ne=function(){return ie.container.get(re)};return ne},this._binding.scope=j.BindingScopeEnum.Singleton,new J.BindingWhenOnSyntax(this._binding)},$.prototype.toProvider=function(re){return this._binding.type=j.BindingTypeEnum.Provider,this._binding.provider=re,this._binding.scope=j.BindingScopeEnum.Singleton,new J.BindingWhenOnSyntax(this._binding)},$.prototype.toService=function(re){this.toDynamicValue(function(ie){return ie.container.get(re)})},$}();W.BindingToSyntax=F},71325:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingWhenOnSyntax=void 0;var X=L(51811),j=L(98370),m=function(){function J(F){this._binding=F,this._bindingWhenSyntax=new j.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new X.BindingOnSyntax(this._binding)}return J.prototype.when=function(F){return this._bindingWhenSyntax.when(F)},J.prototype.whenTargetNamed=function(F){return this._bindingWhenSyntax.whenTargetNamed(F)},J.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},J.prototype.whenTargetTagged=function(F,$){return this._bindingWhenSyntax.whenTargetTagged(F,$)},J.prototype.whenInjectedInto=function(F){return this._bindingWhenSyntax.whenInjectedInto(F)},J.prototype.whenParentNamed=function(F){return this._bindingWhenSyntax.whenParentNamed(F)},J.prototype.whenParentTagged=function(F,$){return this._bindingWhenSyntax.whenParentTagged(F,$)},J.prototype.whenAnyAncestorIs=function(F){return this._bindingWhenSyntax.whenAnyAncestorIs(F)},J.prototype.whenNoAncestorIs=function(F){return this._bindingWhenSyntax.whenNoAncestorIs(F)},J.prototype.whenAnyAncestorNamed=function(F){return this._bindingWhenSyntax.whenAnyAncestorNamed(F)},J.prototype.whenAnyAncestorTagged=function(F,$){return this._bindingWhenSyntax.whenAnyAncestorTagged(F,$)},J.prototype.whenNoAncestorNamed=function(F){return this._bindingWhenSyntax.whenNoAncestorNamed(F)},J.prototype.whenNoAncestorTagged=function(F,$){return this._bindingWhenSyntax.whenNoAncestorTagged(F,$)},J.prototype.whenAnyAncestorMatches=function(F){return this._bindingWhenSyntax.whenAnyAncestorMatches(F)},J.prototype.whenNoAncestorMatches=function(F){return this._bindingWhenSyntax.whenNoAncestorMatches(F)},J.prototype.onActivation=function(F){return this._bindingOnSyntax.onActivation(F)},J}();W.BindingWhenOnSyntax=m},98370:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingWhenSyntax=void 0;var X=L(51811),j=L(80758),m=function(){function J(F){this._binding=F}return J.prototype.when=function(F){return this._binding.constraint=F,new X.BindingOnSyntax(this._binding)},J.prototype.whenTargetNamed=function(F){return this._binding.constraint=j.namedConstraint(F),new X.BindingOnSyntax(this._binding)},J.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(F){var $=F.target!==null&&!F.target.isNamed()&&!F.target.isTagged();return $},new X.BindingOnSyntax(this._binding)},J.prototype.whenTargetTagged=function(F,$){return this._binding.constraint=j.taggedConstraint(F)($),new X.BindingOnSyntax(this._binding)},J.prototype.whenInjectedInto=function(F){return this._binding.constraint=function($){return j.typeConstraint(F)($.parentRequest)},new X.BindingOnSyntax(this._binding)},J.prototype.whenParentNamed=function(F){return this._binding.constraint=function($){return j.namedConstraint(F)($.parentRequest)},new X.BindingOnSyntax(this._binding)},J.prototype.whenParentTagged=function(F,$){return this._binding.constraint=function(re){return j.taggedConstraint(F)($)(re.parentRequest)},new X.BindingOnSyntax(this._binding)},J.prototype.whenAnyAncestorIs=function(F){return this._binding.constraint=function($){return j.traverseAncerstors($,j.typeConstraint(F))},new X.BindingOnSyntax(this._binding)},J.prototype.whenNoAncestorIs=function(F){return this._binding.constraint=function($){return!j.traverseAncerstors($,j.typeConstraint(F))},new X.BindingOnSyntax(this._binding)},J.prototype.whenAnyAncestorNamed=function(F){return this._binding.constraint=function($){return j.traverseAncerstors($,j.namedConstraint(F))},new X.BindingOnSyntax(this._binding)},J.prototype.whenNoAncestorNamed=function(F){return this._binding.constraint=function($){return!j.traverseAncerstors($,j.namedConstraint(F))},new X.BindingOnSyntax(this._binding)},J.prototype.whenAnyAncestorTagged=function(F,$){return this._binding.constraint=function(re){return j.traverseAncerstors(re,j.taggedConstraint(F)($))},new X.BindingOnSyntax(this._binding)},J.prototype.whenNoAncestorTagged=function(F,$){return this._binding.constraint=function(re){return!j.traverseAncerstors(re,j.taggedConstraint(F)($))},new X.BindingOnSyntax(this._binding)},J.prototype.whenAnyAncestorMatches=function(F){return this._binding.constraint=function($){return j.traverseAncerstors($,F)},new X.BindingOnSyntax(this._binding)},J.prototype.whenNoAncestorMatches=function(F){return this._binding.constraint=function($){return!j.traverseAncerstors($,F)},new X.BindingOnSyntax(this._binding)},J}();W.BindingWhenSyntax=m},80758:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.typeConstraint=W.namedConstraint=W.taggedConstraint=W.traverseAncerstors=void 0;var X=L(6867),j=L(47738),m=function(re,ie){var ne=re.parentRequest;return ne!==null?ie(ne)?!0:m(ne,ie):!1};W.traverseAncerstors=m;var J=function(re){return function(ie){var ne=function(Le){return Le!==null&&Le.target!==null&&Le.target.matchesTag(re)(ie)};return ne.metaData=new j.Metadata(re,ie),ne}};W.taggedConstraint=J;var F=J(X.NAMED_TAG);W.namedConstraint=F;var $=function(re){return function(ie){var ne=null;if(ie!==null)if(ne=ie.bindings[0],typeof re=="string"){var Le=ne.serviceIdentifier;return Le===re}else{var Ie=ie.bindings[0].implementationType;return re===Ie}return!1}};W.typeConstraint=$},70600:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.multiBindToService=void 0;var L=function(X){return function(j){return function(){for(var m=[],J=0;J<arguments.length;J++)m[J]=arguments[J];return m.forEach(function(F){return X.bind(F).toService(j)})}}};W.multiBindToService=L},85265:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.isStackOverflowExeption=void 0;var X=L(16674);function j(m){return m instanceof RangeError||m.message===X.STACK_OVERFLOW}W.isStackOverflowExeption=j},37791:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.id=void 0;var L=0;function X(){return L++}W.id=X},55800:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.circularDependencyToException=W.listMetadataForTarget=W.listRegisteredBindingsForServiceIdentifier=W.getServiceIdentifierAsString=W.getFunctionName=void 0;var X=L(16674);function j(ne){if(typeof ne=="function"){var Le=ne;return Le.name}else{if(typeof ne=="symbol")return ne.toString();var Le=ne;return Le}}W.getServiceIdentifierAsString=j;function m(ne,Le,Ie){var He="",Rt=Ie(ne,Le);return Rt.length!==0&&(He=`
Registered bindings:`,Rt.forEach(function($t){var ht="Object";$t.implementationType!==null&&(ht=ie($t.implementationType)),He=He+`
 `+ht,$t.constraint.metaData&&(He=He+" - "+$t.constraint.metaData)})),He}W.listRegisteredBindingsForServiceIdentifier=m;function J(ne,Le){return ne.parentRequest===null?!1:ne.parentRequest.serviceIdentifier===Le?!0:J(ne.parentRequest,Le)}function F(ne){function Le(He,Rt){Rt===void 0&&(Rt=[]);var $t=j(He.serviceIdentifier);return Rt.push($t),He.parentRequest!==null?Le(He.parentRequest,Rt):Rt}var Ie=Le(ne);return Ie.reverse().join(" --> ")}function $(ne){ne.childRequests.forEach(function(Le){if(J(Le,Le.serviceIdentifier)){var Ie=F(Le);throw new Error(X.CIRCULAR_DEPENDENCY+" "+Ie)}else $(Le)})}W.circularDependencyToException=$;function re(ne,Le){if(Le.isTagged()||Le.isNamed()){var Ie="",He=Le.getNamedTag(),Rt=Le.getCustomTags();return He!==null&&(Ie+=He.toString()+`
`),Rt!==null&&Rt.forEach(function($t){Ie+=$t.toString()+`
`})," "+ne+`
 `+ne+" - "+Ie}else return" "+ne}W.listMetadataForTarget=re;function ie(ne){if(ne.name)return ne.name;var Le=ne.toString(),Ie=Le.match(/^function\s*([^\s(]+)/);return Ie?Ie[1]:"Anonymous function: "+Le}W.getFunctionName=ie},31745:function(Ue){"use strict";Ue.exports=L,Ue.exports.default=L;var W=1e20;function L(F,$,re,ie,ne,Le){this.fontSize=F||24,this.buffer=$===void 0?3:$,this.cutoff=ie||.25,this.fontFamily=ne||"sans-serif",this.fontWeight=Le||"normal",this.radius=re||8;var Ie=this.size=this.fontSize+this.buffer*2,He=Ie+this.buffer*2,Rt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";Rt?this.canvas=my.createOffscreenCanvas(Ie,Ie,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ie),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(He*He),this.gridInner=new Float64Array(He*He),this.f=new Float64Array(He),this.z=new Float64Array(He+1),this.v=new Uint16Array(He),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Rt?this.middle=Math.round(Ie/2*1):this.middle=Math.round(Ie/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function X(F,$,re,ie,ne,Le,Ie){Le.fill(W,0,$*re),Ie.fill(0,0,$*re);for(var He=($-ie)/2,Rt=0;Rt<ne;Rt++)for(var $t=0;$t<ie;$t++){var ht=(Rt+He)*$+$t+He,Ut=F.data[4*(Rt*ie+$t)+3]/255;if(Ut===1)Le[ht]=0,Ie[ht]=W;else if(Ut===0)Le[ht]=W,Ie[ht]=0;else{var dt=Math.max(0,.5-Ut),nt=Math.max(0,Ut-.5);Le[ht]=dt*dt,Ie[ht]=nt*nt}}}function j(F,$,re,ie,ne,Le,Ie){for(var He=0;He<$*re;He++){var Rt=Math.sqrt(ie[He])-Math.sqrt(ne[He]);F[He]=Math.round(255-255*(Rt/Le+Ie))}}L.prototype._draw=function(F,$){var re=this.ctx.measureText(F),ie=re.width,ne=2*this.buffer,Le,Ie,He,Rt,$t,ht,Ut,dt;$&&this.useMetrics?($t=Math.floor(re.actualBoundingBoxAscent),dt=this.buffer+Math.ceil(re.actualBoundingBoxAscent),ht=this.buffer,Ut=this.buffer,Ie=Math.min(this.size,Math.ceil(re.actualBoundingBoxRight-re.actualBoundingBoxLeft)),Rt=Math.min(this.size-ht,Math.ceil(re.actualBoundingBoxAscent+re.actualBoundingBoxDescent)),Le=Ie+ne,He=Rt+ne,this.ctx.textBaseline="alphabetic"):(Le=Ie=this.size,He=Rt=this.size,$t=19*this.fontSize/24,ht=Ut=0,dt=this.middle,this.ctx.textBaseline="middle");var nt;Ie&&Rt&&(this.ctx.clearRect(Ut,ht,Ie,Rt),this.ctx.fillText(F,this.buffer,dt),nt=this.ctx.getImageData(Ut,ht,Ie,Rt));var rt=new Uint8ClampedArray(Le*He);return X(nt,Le,He,Ie,Rt,this.gridOuter,this.gridInner),m(this.gridOuter,Le,He,this.f,this.v,this.z),m(this.gridInner,Le,He,this.f,this.v,this.z),j(rt,Le,He,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:rt,metrics:{width:Ie,height:Rt,sdfWidth:Le,sdfHeight:He,top:$t,left:0,advance:ie}}},L.prototype.draw=function(F){return this._draw(F,!1).data},L.prototype.drawWithMetrics=function(F){return this._draw(F,!0)};function m(F,$,re,ie,ne,Le){for(var Ie=0;Ie<$;Ie++)J(F,Ie,$,re,ie,ne,Le);for(var He=0;He<re;He++)J(F,He*$,1,$,ie,ne,Le)}function J(F,$,re,ie,ne,Le,Ie){var He,Rt,$t,ht;for(Le[0]=0,Ie[0]=-W,Ie[1]=W,He=0;He<ie;He++)ne[He]=F[$+He*re];for(He=1,Rt=0,$t=0;He<ie;He++){do ht=Le[Rt],$t=(ne[He]-ne[ht]+He*He-ht*ht)/(He-ht)/2;while($t<=Ie[Rt]&&--Rt>-1);Rt++,Le[Rt]=He,Ie[Rt]=$t,Ie[Rt+1]=W}for(He=0,Rt=0;He<ie;He++){for(;Ie[Rt+1]<He;)Rt++;ht=Le[Rt],F[$+He*re]=ne[ht]+(He-ht)*(He-ht)}}},18857:function(Ue,W,L){"use strict";L.r(W),L.d(W,{Function:function(){return Ws},Interpreter:function(){return _a},default:function(){return il},evaluate:function(){return zu},vm:function(){return X}});var X={};L.r(X),L.d(X,{Script:function(){return Jl},compileFunction:function(){return ef},createContext:function(){return ns},runInContext:function(){return wl},runInNewContext:function(){return Hs}});var j={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},m="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",J={5:m,"5module":m+" export import",6:m+" const class extends export import super"},F=/^in(stanceof)?$/,$="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",re="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",ie=new RegExp("["+$+"]"),ne=new RegExp("["+$+re+"]");$=re=null;var Le=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Ie=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function He(g,A){for(var N=65536,O=0;O<A.length;O+=2){if(N+=A[O],N>g)return!1;if(N+=A[O+1],N>=g)return!0}}function Rt(g,A){return g<65?g===36:g<91?!0:g<97?g===95:g<123?!0:g<=65535?g>=170&&ie.test(String.fromCharCode(g)):A===!1?!1:He(g,Le)}function $t(g,A){return g<48?g===36:g<58?!0:g<65?!1:g<91?!0:g<97?g===95:g<123?!0:g<=65535?g>=170&&ne.test(String.fromCharCode(g)):A===!1?!1:He(g,Le)||He(g,Ie)}var ht=function(A,N){N===void 0&&(N={}),this.label=A,this.keyword=N.keyword,this.beforeExpr=!!N.beforeExpr,this.startsExpr=!!N.startsExpr,this.isLoop=!!N.isLoop,this.isAssign=!!N.isAssign,this.prefix=!!N.prefix,this.postfix=!!N.postfix,this.binop=N.binop||null,this.updateContext=null};function Ut(g,A){return new ht(g,{beforeExpr:!0,binop:A})}var dt={beforeExpr:!0},nt={startsExpr:!0},rt={};function er(g,A){return A===void 0&&(A={}),A.keyword=g,rt[g]=new ht(g,A)}var K={num:new ht("num",nt),regexp:new ht("regexp",nt),string:new ht("string",nt),name:new ht("name",nt),eof:new ht("eof"),bracketL:new ht("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new ht("]"),braceL:new ht("{",{beforeExpr:!0,startsExpr:!0}),braceR:new ht("}"),parenL:new ht("(",{beforeExpr:!0,startsExpr:!0}),parenR:new ht(")"),comma:new ht(",",dt),semi:new ht(";",dt),colon:new ht(":",dt),dot:new ht("."),question:new ht("?",dt),questionDot:new ht("?."),arrow:new ht("=>",dt),template:new ht("template"),invalidTemplate:new ht("invalidTemplate"),ellipsis:new ht("...",dt),backQuote:new ht("`",nt),dollarBraceL:new ht("${",{beforeExpr:!0,startsExpr:!0}),eq:new ht("=",{beforeExpr:!0,isAssign:!0}),assign:new ht("_=",{beforeExpr:!0,isAssign:!0}),incDec:new ht("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new ht("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Ut("||",1),logicalAND:Ut("&&",2),bitwiseOR:Ut("|",3),bitwiseXOR:Ut("^",4),bitwiseAND:Ut("&",5),equality:Ut("==/!=/===/!==",6),relational:Ut("</>/<=/>=",7),bitShift:Ut("<</>>/>>>",8),plusMin:new ht("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Ut("%",10),star:Ut("*",10),slash:Ut("/",10),starstar:new ht("**",{beforeExpr:!0}),coalesce:Ut("??",1),_break:er("break"),_case:er("case",dt),_catch:er("catch"),_continue:er("continue"),_debugger:er("debugger"),_default:er("default",dt),_do:er("do",{isLoop:!0,beforeExpr:!0}),_else:er("else",dt),_finally:er("finally"),_for:er("for",{isLoop:!0}),_function:er("function",nt),_if:er("if"),_return:er("return",dt),_switch:er("switch"),_throw:er("throw",dt),_try:er("try"),_var:er("var"),_const:er("const"),_while:er("while",{isLoop:!0}),_with:er("with"),_new:er("new",{beforeExpr:!0,startsExpr:!0}),_this:er("this",nt),_super:er("super",nt),_class:er("class",nt),_extends:er("extends",dt),_export:er("export"),_import:er("import",nt),_null:er("null",nt),_true:er("true",nt),_false:er("false",nt),_in:er("in",{beforeExpr:!0,binop:7}),_instanceof:er("instanceof",{beforeExpr:!0,binop:7}),_typeof:er("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:er("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:er("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Ht=/\r\n?|\n|\u2028|\u2029/,at=new RegExp(Ht.source,"g");function Ye(g,A){return g===10||g===13||!A&&(g===8232||g===8233)}var ut=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Je=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Ot=Object.prototype,dr=Ot.hasOwnProperty,Cr=Ot.toString;function jr(g,A){return dr.call(g,A)}var T=Array.isArray||function(g){return Cr.call(g)==="[object Array]"};function we(g){return new RegExp("^(?:"+g.replace(/ /g,"|")+")$")}var De=function(A,N){this.line=A,this.column=N};De.prototype.offset=function(A){return new De(this.line,this.column+A)};var bt=function(A,N,O){this.start=N,this.end=O,A.sourceFile!==null&&(this.source=A.sourceFile)};function mt(g,A){for(var N=1,O=0;;){at.lastIndex=O;var q=at.exec(g);if(q&&q.index<A)++N,O=q.index+q[0].length;else return new De(N,A-O)}}var Lt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Yt(g){var A={};for(var N in Lt)A[N]=g&&jr(g,N)?g[N]:Lt[N];if(A.ecmaVersion>=2015&&(A.ecmaVersion-=2009),A.allowReserved==null&&(A.allowReserved=A.ecmaVersion<5),T(A.onToken)){var O=A.onToken;A.onToken=function(q){return O.push(q)}}return T(A.onComment)&&(A.onComment=br(A,A.onComment)),A}function br(g,A){return function(N,O,q,_e,Xe,ft){var pt={type:N?"Block":"Line",value:O,start:q,end:_e};g.locations&&(pt.loc=new bt(this,Xe,ft)),g.ranges&&(pt.range=[q,_e]),A.push(pt)}}var Kn=1,cn=2,li=Kn|cn,Vn=4,ti=8,ci=16,Hn=32,fi=64,ua=128;function Vi(g,A){return cn|(g?Vn:0)|(A?ti:0)}var ki=0,Ki=1,la=2,Ai=3,ma=4,Xn=5,bi=function(A,N,O){this.options=A=Yt(A),this.sourceFile=A.sourceFile,this.keywords=we(J[A.ecmaVersion>=6?6:A.sourceType==="module"?"5module":5]);var q="";if(A.allowReserved!==!0){for(var _e=A.ecmaVersion;!(q=j[_e]);_e--);A.sourceType==="module"&&(q+=" await")}this.reservedWords=we(q);var Xe=(q?q+" ":"")+j.strict;this.reservedWordsStrict=we(Xe),this.reservedWordsStrictBind=we(Xe+" "+j.strictBind),this.input=String(N),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Ht).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=K.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=A.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&A.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Kn),this.regexpState=null},zi={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};bi.prototype.parse=function(){var A=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(A)},zi.inFunction.get=function(){return(this.currentVarScope().flags&cn)>0},zi.inGenerator.get=function(){return(this.currentVarScope().flags&ti)>0},zi.inAsync.get=function(){return(this.currentVarScope().flags&Vn)>0},zi.allowSuper.get=function(){return(this.currentThisScope().flags&fi)>0},zi.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ua)>0},zi.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},bi.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&cn)>0},bi.extend=function(){for(var A=[],N=arguments.length;N--;)A[N]=arguments[N];for(var O=this,q=0;q<A.length;q++)O=A[q](O);return O},bi.parse=function(A,N){return new this(N,A).parse()},bi.parseExpressionAt=function(A,N,O){var q=new this(O,A,N);return q.nextToken(),q.parseExpression()},bi.tokenizer=function(A,N){return new this(N,A)},Object.defineProperties(bi.prototype,zi);var qi=bi.prototype,ko=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;qi.strictDirective=function(g){for(;;){Je.lastIndex=g,g+=Je.exec(this.input)[0].length;var A=ko.exec(this.input.slice(g));if(!A)return!1;if((A[1]||A[2])==="use strict"){Je.lastIndex=g+A[0].length;var N=Je.exec(this.input),O=N.index+N[0].length,q=this.input.charAt(O);return q===";"||q==="}"||Ht.test(N[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(q)||q==="!"&&this.input.charAt(O+1)==="=")}g+=A[0].length,Je.lastIndex=g,g+=Je.exec(this.input)[0].length,this.input[g]===";"&&g++}},qi.eat=function(g){return this.type===g?(this.next(),!0):!1},qi.isContextual=function(g){return this.type===K.name&&this.value===g&&!this.containsEsc},qi.eatContextual=function(g){return this.isContextual(g)?(this.next(),!0):!1},qi.expectContextual=function(g){this.eatContextual(g)||this.unexpected()},qi.canInsertSemicolon=function(){return this.type===K.eof||this.type===K.braceR||Ht.test(this.input.slice(this.lastTokEnd,this.start))},qi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},qi.semicolon=function(){!this.eat(K.semi)&&!this.insertSemicolon()&&this.unexpected()},qi.afterTrailingComma=function(g,A){if(this.type===g)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),A||this.next(),!0},qi.expect=function(g){this.eat(g)||this.unexpected()},qi.unexpected=function(g){this.raise(g!=null?g:this.start,"Unexpected token")};function de(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}qi.checkPatternErrors=function(g,A){if(!!g){g.trailingComma>-1&&this.raiseRecoverable(g.trailingComma,"Comma is not permitted after the rest element");var N=A?g.parenthesizedAssign:g.parenthesizedBind;N>-1&&this.raiseRecoverable(N,"Parenthesized pattern")}},qi.checkExpressionErrors=function(g,A){if(!g)return!1;var N=g.shorthandAssign,O=g.doubleProto;if(!A)return N>=0||O>=0;N>=0&&this.raise(N,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},qi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},qi.isSimpleAssignTarget=function(g){return g.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(g.expression):g.type==="Identifier"||g.type==="MemberExpression"};var Ln=bi.prototype;Ln.parseTopLevel=function(g){var A={};for(g.body||(g.body=[]);this.type!==K.eof;){var N=this.parseStatement(null,!0,A);g.body.push(N)}if(this.inModule)for(var O=0,q=Object.keys(this.undefinedExports);O<q.length;O+=1){var _e=q[O];this.raiseRecoverable(this.undefinedExports[_e].start,"Export '"+_e+"' is not defined")}return this.adaptDirectivePrologue(g.body),this.next(),g.sourceType=this.options.sourceType,this.finishNode(g,"Program")};var Za={kind:"loop"},rs={kind:"switch"};Ln.isLet=function(g){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Je.lastIndex=this.pos;var A=Je.exec(this.input),N=this.pos+A[0].length,O=this.input.charCodeAt(N);if(O===91)return!0;if(g)return!1;if(O===123)return!0;if(Rt(O,!0)){for(var q=N+1;$t(this.input.charCodeAt(q),!0);)++q;var _e=this.input.slice(N,q);if(!F.test(_e))return!0}return!1},Ln.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Je.lastIndex=this.pos;var g=Je.exec(this.input),A=this.pos+g[0].length;return!Ht.test(this.input.slice(this.pos,A))&&this.input.slice(A,A+8)==="function"&&(A+8===this.input.length||!$t(this.input.charAt(A+8)))},Ln.parseStatement=function(g,A,N){var O=this.type,q=this.startNode(),_e;switch(this.isLet(g)&&(O=K._var,_e="let"),O){case K._break:case K._continue:return this.parseBreakContinueStatement(q,O.keyword);case K._debugger:return this.parseDebuggerStatement(q);case K._do:return this.parseDoStatement(q);case K._for:return this.parseForStatement(q);case K._function:return g&&(this.strict||g!=="if"&&g!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(q,!1,!g);case K._class:return g&&this.unexpected(),this.parseClass(q,!0);case K._if:return this.parseIfStatement(q);case K._return:return this.parseReturnStatement(q);case K._switch:return this.parseSwitchStatement(q);case K._throw:return this.parseThrowStatement(q);case K._try:return this.parseTryStatement(q);case K._const:case K._var:return _e=_e||this.value,g&&_e!=="var"&&this.unexpected(),this.parseVarStatement(q,_e);case K._while:return this.parseWhileStatement(q);case K._with:return this.parseWithStatement(q);case K.braceL:return this.parseBlock(!0,q);case K.semi:return this.parseEmptyStatement(q);case K._export:case K._import:if(this.options.ecmaVersion>10&&O===K._import){Je.lastIndex=this.pos;var Xe=Je.exec(this.input),ft=this.pos+Xe[0].length,pt=this.input.charCodeAt(ft);if(pt===40||pt===46)return this.parseExpressionStatement(q,this.parseExpression())}return this.options.allowImportExportEverywhere||(A||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===K._import?this.parseImport(q):this.parseExport(q,N);default:if(this.isAsyncFunction())return g&&this.unexpected(),this.next(),this.parseFunctionStatement(q,!0,!g);var ir=this.value,sr=this.parseExpression();return O===K.name&&sr.type==="Identifier"&&this.eat(K.colon)?this.parseLabeledStatement(q,ir,sr,g):this.parseExpressionStatement(q,sr)}},Ln.parseBreakContinueStatement=function(g,A){var N=A==="break";this.next(),this.eat(K.semi)||this.insertSemicolon()?g.label=null:this.type!==K.name?this.unexpected():(g.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var q=this.labels[O];if((g.label==null||q.name===g.label.name)&&(q.kind!=null&&(N||q.kind==="loop")||g.label&&N))break}return O===this.labels.length&&this.raise(g.start,"Unsyntactic "+A),this.finishNode(g,N?"BreakStatement":"ContinueStatement")},Ln.parseDebuggerStatement=function(g){return this.next(),this.semicolon(),this.finishNode(g,"DebuggerStatement")},Ln.parseDoStatement=function(g){return this.next(),this.labels.push(Za),g.body=this.parseStatement("do"),this.labels.pop(),this.expect(K._while),g.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(K.semi):this.semicolon(),this.finishNode(g,"DoWhileStatement")},Ln.parseForStatement=function(g){this.next();var A=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Za),this.enterScope(0),this.expect(K.parenL),this.type===K.semi)return A>-1&&this.unexpected(A),this.parseFor(g,null);var N=this.isLet();if(this.type===K._var||this.type===K._const||N){var O=this.startNode(),q=N?"let":this.value;return this.next(),this.parseVar(O,!0,q),this.finishNode(O,"VariableDeclaration"),(this.type===K._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===K._in?A>-1&&this.unexpected(A):g.await=A>-1),this.parseForIn(g,O)):(A>-1&&this.unexpected(A),this.parseFor(g,O))}var _e=new de,Xe=this.parseExpression(!0,_e);return this.type===K._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===K._in?A>-1&&this.unexpected(A):g.await=A>-1),this.toAssignable(Xe,!1,_e),this.checkLVal(Xe),this.parseForIn(g,Xe)):(this.checkExpressionErrors(_e,!0),A>-1&&this.unexpected(A),this.parseFor(g,Xe))},Ln.parseFunctionStatement=function(g,A,N){return this.next(),this.parseFunction(g,tr|(N?0:Sr),!1,A)},Ln.parseIfStatement=function(g){return this.next(),g.test=this.parseParenExpression(),g.consequent=this.parseStatement("if"),g.alternate=this.eat(K._else)?this.parseStatement("if"):null,this.finishNode(g,"IfStatement")},Ln.parseReturnStatement=function(g){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(K.semi)||this.insertSemicolon()?g.argument=null:(g.argument=this.parseExpression(),this.semicolon()),this.finishNode(g,"ReturnStatement")},Ln.parseSwitchStatement=function(g){this.next(),g.discriminant=this.parseParenExpression(),g.cases=[],this.expect(K.braceL),this.labels.push(rs),this.enterScope(0);for(var A,N=!1;this.type!==K.braceR;)if(this.type===K._case||this.type===K._default){var O=this.type===K._case;A&&this.finishNode(A,"SwitchCase"),g.cases.push(A=this.startNode()),A.consequent=[],this.next(),O?A.test=this.parseExpression():(N&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),N=!0,A.test=null),this.expect(K.colon)}else A||this.unexpected(),A.consequent.push(this.parseStatement(null));return this.exitScope(),A&&this.finishNode(A,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(g,"SwitchStatement")},Ln.parseThrowStatement=function(g){return this.next(),Ht.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),g.argument=this.parseExpression(),this.semicolon(),this.finishNode(g,"ThrowStatement")};var kt=[];Ln.parseTryStatement=function(g){if(this.next(),g.block=this.parseBlock(),g.handler=null,this.type===K._catch){var A=this.startNode();if(this.next(),this.eat(K.parenL)){A.param=this.parseBindingAtom();var N=A.param.type==="Identifier";this.enterScope(N?Hn:0),this.checkLVal(A.param,N?ma:la),this.expect(K.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),A.param=null,this.enterScope(0);A.body=this.parseBlock(!1),this.exitScope(),g.handler=this.finishNode(A,"CatchClause")}return g.finalizer=this.eat(K._finally)?this.parseBlock():null,!g.handler&&!g.finalizer&&this.raise(g.start,"Missing catch or finally clause"),this.finishNode(g,"TryStatement")},Ln.parseVarStatement=function(g,A){return this.next(),this.parseVar(g,!1,A),this.semicolon(),this.finishNode(g,"VariableDeclaration")},Ln.parseWhileStatement=function(g){return this.next(),g.test=this.parseParenExpression(),this.labels.push(Za),g.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(g,"WhileStatement")},Ln.parseWithStatement=function(g){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),g.object=this.parseParenExpression(),g.body=this.parseStatement("with"),this.finishNode(g,"WithStatement")},Ln.parseEmptyStatement=function(g){return this.next(),this.finishNode(g,"EmptyStatement")},Ln.parseLabeledStatement=function(g,A,N,O){for(var q=0,_e=this.labels;q<_e.length;q+=1){var Xe=_e[q];Xe.name===A&&this.raise(N.start,"Label '"+A+"' is already declared")}for(var ft=this.type.isLoop?"loop":this.type===K._switch?"switch":null,pt=this.labels.length-1;pt>=0;pt--){var ir=this.labels[pt];if(ir.statementStart===g.start)ir.statementStart=this.start,ir.kind=ft;else break}return this.labels.push({name:A,kind:ft,statementStart:this.start}),g.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),g.label=N,this.finishNode(g,"LabeledStatement")},Ln.parseExpressionStatement=function(g,A){return g.expression=A,this.semicolon(),this.finishNode(g,"ExpressionStatement")},Ln.parseBlock=function(g,A,N){for(g===void 0&&(g=!0),A===void 0&&(A=this.startNode()),A.body=[],this.expect(K.braceL),g&&this.enterScope(0);this.type!==K.braceR;){var O=this.parseStatement(null);A.body.push(O)}return N&&(this.strict=!1),this.next(),g&&this.exitScope(),this.finishNode(A,"BlockStatement")},Ln.parseFor=function(g,A){return g.init=A,this.expect(K.semi),g.test=this.type===K.semi?null:this.parseExpression(),this.expect(K.semi),g.update=this.type===K.parenR?null:this.parseExpression(),this.expect(K.parenR),g.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(g,"ForStatement")},Ln.parseForIn=function(g,A){var N=this.type===K._in;return this.next(),A.type==="VariableDeclaration"&&A.declarations[0].init!=null&&(!N||this.options.ecmaVersion<8||this.strict||A.kind!=="var"||A.declarations[0].id.type!=="Identifier")?this.raise(A.start,(N?"for-in":"for-of")+" loop variable declaration may not have an initializer"):A.type==="AssignmentPattern"&&this.raise(A.start,"Invalid left-hand side in for-loop"),g.left=A,g.right=N?this.parseExpression():this.parseMaybeAssign(),this.expect(K.parenR),g.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(g,N?"ForInStatement":"ForOfStatement")},Ln.parseVar=function(g,A,N){for(g.declarations=[],g.kind=N;;){var O=this.startNode();if(this.parseVarId(O,N),this.eat(K.eq)?O.init=this.parseMaybeAssign(A):N==="const"&&!(this.type===K._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(A&&(this.type===K._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,g.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(K.comma))break}return g},Ln.parseVarId=function(g,A){g.id=this.parseBindingAtom(),this.checkLVal(g.id,A==="var"?Ki:la,!1)};var tr=1,Sr=2,qr=4;Ln.parseFunction=function(g,A,N,O){this.initFunction(g),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===K.star&&A&Sr&&this.unexpected(),g.generator=this.eat(K.star)),this.options.ecmaVersion>=8&&(g.async=!!O),A&tr&&(g.id=A&qr&&this.type!==K.name?null:this.parseIdent(),g.id&&!(A&Sr)&&this.checkLVal(g.id,this.strict||g.generator||g.async?this.treatFunctionsAsVar?Ki:la:Ai));var q=this.yieldPos,_e=this.awaitPos,Xe=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Vi(g.async,g.generator)),A&tr||(g.id=this.type===K.name?this.parseIdent():null),this.parseFunctionParams(g),this.parseFunctionBody(g,N,!1),this.yieldPos=q,this.awaitPos=_e,this.awaitIdentPos=Xe,this.finishNode(g,A&tr?"FunctionDeclaration":"FunctionExpression")},Ln.parseFunctionParams=function(g){this.expect(K.parenL),g.params=this.parseBindingList(K.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Ln.parseClass=function(g,A){this.next();var N=this.strict;this.strict=!0,this.parseClassId(g,A),this.parseClassSuper(g);var O=this.startNode(),q=!1;for(O.body=[],this.expect(K.braceL);this.type!==K.braceR;){var _e=this.parseClassElement(g.superClass!==null);_e&&(O.body.push(_e),_e.type==="MethodDefinition"&&_e.kind==="constructor"&&(q&&this.raise(_e.start,"Duplicate constructor in the same class"),q=!0))}return this.strict=N,this.next(),g.body=this.finishNode(O,"ClassBody"),this.finishNode(g,A?"ClassDeclaration":"ClassExpression")},Ln.parseClassElement=function(g){var A=this;if(this.eat(K.semi))return null;var N=this.startNode(),O=function(pt,ir){ir===void 0&&(ir=!1);var sr=A.start,wn=A.startLoc;return A.eatContextual(pt)?A.type!==K.parenL&&(!ir||!A.canInsertSemicolon())?!0:(N.key&&A.unexpected(),N.computed=!1,N.key=A.startNodeAt(sr,wn),N.key.name=pt,A.finishNode(N.key,"Identifier"),!1):!1};N.kind="method",N.static=O("static");var q=this.eat(K.star),_e=!1;q||(this.options.ecmaVersion>=8&&O("async",!0)?(_e=!0,q=this.options.ecmaVersion>=9&&this.eat(K.star)):O("get")?N.kind="get":O("set")&&(N.kind="set")),N.key||this.parsePropertyName(N);var Xe=N.key,ft=!1;return!N.computed&&!N.static&&(Xe.type==="Identifier"&&Xe.name==="constructor"||Xe.type==="Literal"&&Xe.value==="constructor")?(N.kind!=="method"&&this.raise(Xe.start,"Constructor can't have get/set modifier"),q&&this.raise(Xe.start,"Constructor can't be a generator"),_e&&this.raise(Xe.start,"Constructor can't be an async method"),N.kind="constructor",ft=g):N.static&&Xe.type==="Identifier"&&Xe.name==="prototype"&&this.raise(Xe.start,"Classes may not have a static property named prototype"),this.parseClassMethod(N,q,_e,ft),N.kind==="get"&&N.value.params.length!==0&&this.raiseRecoverable(N.value.start,"getter should have no params"),N.kind==="set"&&N.value.params.length!==1&&this.raiseRecoverable(N.value.start,"setter should have exactly one param"),N.kind==="set"&&N.value.params[0].type==="RestElement"&&this.raiseRecoverable(N.value.params[0].start,"Setter cannot use rest params"),N},Ln.parseClassMethod=function(g,A,N,O){return g.value=this.parseMethod(A,N,O),this.finishNode(g,"MethodDefinition")},Ln.parseClassId=function(g,A){this.type===K.name?(g.id=this.parseIdent(),A&&this.checkLVal(g.id,la,!1)):(A===!0&&this.unexpected(),g.id=null)},Ln.parseClassSuper=function(g){g.superClass=this.eat(K._extends)?this.parseExprSubscripts():null},Ln.parseExport=function(g,A){if(this.next(),this.eat(K.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(g.exported=this.parseIdent(!0),this.checkExport(A,g.exported.name,this.lastTokStart)):g.exported=null),this.expectContextual("from"),this.type!==K.string&&this.unexpected(),g.source=this.parseExprAtom(),this.semicolon(),this.finishNode(g,"ExportAllDeclaration");if(this.eat(K._default)){this.checkExport(A,"default",this.lastTokStart);var N;if(this.type===K._function||(N=this.isAsyncFunction())){var O=this.startNode();this.next(),N&&this.next(),g.declaration=this.parseFunction(O,tr|qr,!1,N)}else if(this.type===K._class){var q=this.startNode();g.declaration=this.parseClass(q,"nullableID")}else g.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(g,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())g.declaration=this.parseStatement(null),g.declaration.type==="VariableDeclaration"?this.checkVariableExport(A,g.declaration.declarations):this.checkExport(A,g.declaration.id.name,g.declaration.id.start),g.specifiers=[],g.source=null;else{if(g.declaration=null,g.specifiers=this.parseExportSpecifiers(A),this.eatContextual("from"))this.type!==K.string&&this.unexpected(),g.source=this.parseExprAtom();else{for(var _e=0,Xe=g.specifiers;_e<Xe.length;_e+=1){var ft=Xe[_e];this.checkUnreserved(ft.local),this.checkLocalExport(ft.local)}g.source=null}this.semicolon()}return this.finishNode(g,"ExportNamedDeclaration")},Ln.checkExport=function(g,A,N){!g||(jr(g,A)&&this.raiseRecoverable(N,"Duplicate export '"+A+"'"),g[A]=!0)},Ln.checkPatternExport=function(g,A){var N=A.type;if(N==="Identifier")this.checkExport(g,A.name,A.start);else if(N==="ObjectPattern")for(var O=0,q=A.properties;O<q.length;O+=1){var _e=q[O];this.checkPatternExport(g,_e)}else if(N==="ArrayPattern")for(var Xe=0,ft=A.elements;Xe<ft.length;Xe+=1){var pt=ft[Xe];pt&&this.checkPatternExport(g,pt)}else N==="Property"?this.checkPatternExport(g,A.value):N==="AssignmentPattern"?this.checkPatternExport(g,A.left):N==="RestElement"?this.checkPatternExport(g,A.argument):N==="ParenthesizedExpression"&&this.checkPatternExport(g,A.expression)},Ln.checkVariableExport=function(g,A){if(!!g)for(var N=0,O=A;N<O.length;N+=1){var q=O[N];this.checkPatternExport(g,q.id)}},Ln.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Ln.parseExportSpecifiers=function(g){var A=[],N=!0;for(this.expect(K.braceL);!this.eat(K.braceR);){if(N)N=!1;else if(this.expect(K.comma),this.afterTrailingComma(K.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(g,O.exported.name,O.exported.start),A.push(this.finishNode(O,"ExportSpecifier"))}return A},Ln.parseImport=function(g){return this.next(),this.type===K.string?(g.specifiers=kt,g.source=this.parseExprAtom()):(g.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),g.source=this.type===K.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(g,"ImportDeclaration")},Ln.parseImportSpecifiers=function(){var g=[],A=!0;if(this.type===K.name){var N=this.startNode();if(N.local=this.parseIdent(),this.checkLVal(N.local,la),g.push(this.finishNode(N,"ImportDefaultSpecifier")),!this.eat(K.comma))return g}if(this.type===K.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,la),g.push(this.finishNode(O,"ImportNamespaceSpecifier")),g}for(this.expect(K.braceL);!this.eat(K.braceR);){if(A)A=!1;else if(this.expect(K.comma),this.afterTrailingComma(K.braceR))break;var q=this.startNode();q.imported=this.parseIdent(!0),this.eatContextual("as")?q.local=this.parseIdent():(this.checkUnreserved(q.imported),q.local=q.imported),this.checkLVal(q.local,la),g.push(this.finishNode(q,"ImportSpecifier"))}return g},Ln.adaptDirectivePrologue=function(g){for(var A=0;A<g.length&&this.isDirectiveCandidate(g[A]);++A)g[A].directive=g[A].expression.raw.slice(1,-1)},Ln.isDirectiveCandidate=function(g){return g.type==="ExpressionStatement"&&g.expression.type==="Literal"&&typeof g.expression.value=="string"&&(this.input[g.start]==='"'||this.input[g.start]==="'")};var xn=bi.prototype;xn.toAssignable=function(g,A,N){if(this.options.ecmaVersion>=6&&g)switch(g.type){case"Identifier":this.inAsync&&g.name==="await"&&this.raise(g.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":g.type="ObjectPattern",N&&this.checkPatternErrors(N,!0);for(var O=0,q=g.properties;O<q.length;O+=1){var _e=q[O];this.toAssignable(_e,A),_e.type==="RestElement"&&(_e.argument.type==="ArrayPattern"||_e.argument.type==="ObjectPattern")&&this.raise(_e.argument.start,"Unexpected token")}break;case"Property":g.kind!=="init"&&this.raise(g.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(g.value,A);break;case"ArrayExpression":g.type="ArrayPattern",N&&this.checkPatternErrors(N,!0),this.toAssignableList(g.elements,A);break;case"SpreadElement":g.type="RestElement",this.toAssignable(g.argument,A),g.argument.type==="AssignmentPattern"&&this.raise(g.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":g.operator!=="="&&this.raise(g.left.end,"Only '=' operator can be used for specifying default value."),g.type="AssignmentPattern",delete g.operator,this.toAssignable(g.left,A);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(g.expression,A,N);break;case"ChainExpression":this.raiseRecoverable(g.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!A)break;default:this.raise(g.start,"Assigning to rvalue")}else N&&this.checkPatternErrors(N,!0);return g},xn.toAssignableList=function(g,A){for(var N=g.length,O=0;O<N;O++){var q=g[O];q&&this.toAssignable(q,A)}if(N){var _e=g[N-1];this.options.ecmaVersion===6&&A&&_e&&_e.type==="RestElement"&&_e.argument.type!=="Identifier"&&this.unexpected(_e.argument.start)}return g},xn.parseSpread=function(g){var A=this.startNode();return this.next(),A.argument=this.parseMaybeAssign(!1,g),this.finishNode(A,"SpreadElement")},xn.parseRestBinding=function(){var g=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==K.name&&this.unexpected(),g.argument=this.parseBindingAtom(),this.finishNode(g,"RestElement")},xn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case K.bracketL:var g=this.startNode();return this.next(),g.elements=this.parseBindingList(K.bracketR,!0,!0),this.finishNode(g,"ArrayPattern");case K.braceL:return this.parseObj(!0)}return this.parseIdent()},xn.parseBindingList=function(g,A,N){for(var O=[],q=!0;!this.eat(g);)if(q?q=!1:this.expect(K.comma),A&&this.type===K.comma)O.push(null);else{if(N&&this.afterTrailingComma(g))break;if(this.type===K.ellipsis){var _e=this.parseRestBinding();this.parseBindingListItem(_e),O.push(_e),this.type===K.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(g);break}else{var Xe=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(Xe),O.push(Xe)}}return O},xn.parseBindingListItem=function(g){return g},xn.parseMaybeDefault=function(g,A,N){if(N=N||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(K.eq))return N;var O=this.startNodeAt(g,A);return O.left=N,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},xn.checkLVal=function(g,A,N){switch(A===void 0&&(A=ki),g.type){case"Identifier":A===la&&g.name==="let"&&this.raiseRecoverable(g.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(g.name)&&this.raiseRecoverable(g.start,(A?"Binding ":"Assigning to ")+g.name+" in strict mode"),N&&(jr(N,g.name)&&this.raiseRecoverable(g.start,"Argument name clash"),N[g.name]=!0),A!==ki&&A!==Xn&&this.declareName(g.name,A,g.start);break;case"ChainExpression":this.raiseRecoverable(g.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":A&&this.raiseRecoverable(g.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,q=g.properties;O<q.length;O+=1){var _e=q[O];this.checkLVal(_e,A,N)}break;case"Property":this.checkLVal(g.value,A,N);break;case"ArrayPattern":for(var Xe=0,ft=g.elements;Xe<ft.length;Xe+=1){var pt=ft[Xe];pt&&this.checkLVal(pt,A,N)}break;case"AssignmentPattern":this.checkLVal(g.left,A,N);break;case"RestElement":this.checkLVal(g.argument,A,N);break;case"ParenthesizedExpression":this.checkLVal(g.expression,A,N);break;default:this.raise(g.start,(A?"Binding":"Assigning to")+" rvalue")}};var kn=bi.prototype;kn.checkPropClash=function(g,A,N){if(!(this.options.ecmaVersion>=9&&g.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(g.computed||g.method||g.shorthand))){var O=g.key,q;switch(O.type){case"Identifier":q=O.name;break;case"Literal":q=String(O.value);break;default:return}var _e=g.kind;if(this.options.ecmaVersion>=6){q==="__proto__"&&_e==="init"&&(A.proto&&(N?N.doubleProto<0&&(N.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),A.proto=!0);return}q="$"+q;var Xe=A[q];if(Xe){var ft;_e==="init"?ft=this.strict&&Xe.init||Xe.get||Xe.set:ft=Xe.init||Xe[_e],ft&&this.raiseRecoverable(O.start,"Redefinition of property")}else Xe=A[q]={init:!1,get:!1,set:!1};Xe[_e]=!0}},kn.parseExpression=function(g,A){var N=this.start,O=this.startLoc,q=this.parseMaybeAssign(g,A);if(this.type===K.comma){var _e=this.startNodeAt(N,O);for(_e.expressions=[q];this.eat(K.comma);)_e.expressions.push(this.parseMaybeAssign(g,A));return this.finishNode(_e,"SequenceExpression")}return q},kn.parseMaybeAssign=function(g,A,N){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(g);this.exprAllowed=!1}var O=!1,q=-1,_e=-1;A?(q=A.parenthesizedAssign,_e=A.trailingComma,A.parenthesizedAssign=A.trailingComma=-1):(A=new de,O=!0);var Xe=this.start,ft=this.startLoc;(this.type===K.parenL||this.type===K.name)&&(this.potentialArrowAt=this.start);var pt=this.parseMaybeConditional(g,A);if(N&&(pt=N.call(this,pt,Xe,ft)),this.type.isAssign){var ir=this.startNodeAt(Xe,ft);return ir.operator=this.value,ir.left=this.type===K.eq?this.toAssignable(pt,!1,A):pt,O||(A.parenthesizedAssign=A.trailingComma=A.doubleProto=-1),A.shorthandAssign>=ir.left.start&&(A.shorthandAssign=-1),this.checkLVal(pt),this.next(),ir.right=this.parseMaybeAssign(g),this.finishNode(ir,"AssignmentExpression")}else O&&this.checkExpressionErrors(A,!0);return q>-1&&(A.parenthesizedAssign=q),_e>-1&&(A.trailingComma=_e),pt},kn.parseMaybeConditional=function(g,A){var N=this.start,O=this.startLoc,q=this.parseExprOps(g,A);if(this.checkExpressionErrors(A))return q;if(this.eat(K.question)){var _e=this.startNodeAt(N,O);return _e.test=q,_e.consequent=this.parseMaybeAssign(),this.expect(K.colon),_e.alternate=this.parseMaybeAssign(g),this.finishNode(_e,"ConditionalExpression")}return q},kn.parseExprOps=function(g,A){var N=this.start,O=this.startLoc,q=this.parseMaybeUnary(A,!1);return this.checkExpressionErrors(A)||q.start===N&&q.type==="ArrowFunctionExpression"?q:this.parseExprOp(q,N,O,-1,g)},kn.parseExprOp=function(g,A,N,O,q){var _e=this.type.binop;if(_e!=null&&(!q||this.type!==K._in)&&_e>O){var Xe=this.type===K.logicalOR||this.type===K.logicalAND,ft=this.type===K.coalesce;ft&&(_e=K.logicalAND.binop);var pt=this.value;this.next();var ir=this.start,sr=this.startLoc,wn=this.parseExprOp(this.parseMaybeUnary(null,!1),ir,sr,_e,q),ri=this.buildBinary(A,N,g,wn,pt,Xe||ft);return(Xe&&this.type===K.coalesce||ft&&(this.type===K.logicalOR||this.type===K.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ri,A,N,O,q)}return g},kn.buildBinary=function(g,A,N,O,q,_e){var Xe=this.startNodeAt(g,A);return Xe.left=N,Xe.operator=q,Xe.right=O,this.finishNode(Xe,_e?"LogicalExpression":"BinaryExpression")},kn.parseMaybeUnary=function(g,A){var N=this.start,O=this.startLoc,q;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))q=this.parseAwait(),A=!0;else if(this.type.prefix){var _e=this.startNode(),Xe=this.type===K.incDec;_e.operator=this.value,_e.prefix=!0,this.next(),_e.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(g,!0),Xe?this.checkLVal(_e.argument):this.strict&&_e.operator==="delete"&&_e.argument.type==="Identifier"?this.raiseRecoverable(_e.start,"Deleting local variable in strict mode"):A=!0,q=this.finishNode(_e,Xe?"UpdateExpression":"UnaryExpression")}else{if(q=this.parseExprSubscripts(g),this.checkExpressionErrors(g))return q;for(;this.type.postfix&&!this.canInsertSemicolon();){var ft=this.startNodeAt(N,O);ft.operator=this.value,ft.prefix=!1,ft.argument=q,this.checkLVal(q),this.next(),q=this.finishNode(ft,"UpdateExpression")}}return!A&&this.eat(K.starstar)?this.buildBinary(N,O,q,this.parseMaybeUnary(null,!1),"**",!1):q},kn.parseExprSubscripts=function(g){var A=this.start,N=this.startLoc,O=this.parseExprAtom(g);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var q=this.parseSubscripts(O,A,N);return g&&q.type==="MemberExpression"&&(g.parenthesizedAssign>=q.start&&(g.parenthesizedAssign=-1),g.parenthesizedBind>=q.start&&(g.parenthesizedBind=-1)),q},kn.parseSubscripts=function(g,A,N,O){for(var q=this.options.ecmaVersion>=8&&g.type==="Identifier"&&g.name==="async"&&this.lastTokEnd===g.end&&!this.canInsertSemicolon()&&g.end-g.start==5&&this.potentialArrowAt===g.start,_e=!1;;){var Xe=this.parseSubscript(g,A,N,O,q,_e);if(Xe.optional&&(_e=!0),Xe===g||Xe.type==="ArrowFunctionExpression"){if(_e){var ft=this.startNodeAt(A,N);ft.expression=Xe,Xe=this.finishNode(ft,"ChainExpression")}return Xe}g=Xe}},kn.parseSubscript=function(g,A,N,O,q,_e){var Xe=this.options.ecmaVersion>=11,ft=Xe&&this.eat(K.questionDot);O&&ft&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var pt=this.eat(K.bracketL);if(pt||ft&&this.type!==K.parenL&&this.type!==K.backQuote||this.eat(K.dot)){var ir=this.startNodeAt(A,N);ir.object=g,ir.property=pt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),ir.computed=!!pt,pt&&this.expect(K.bracketR),Xe&&(ir.optional=ft),g=this.finishNode(ir,"MemberExpression")}else if(!O&&this.eat(K.parenL)){var sr=new de,wn=this.yieldPos,ri=this.awaitPos,On=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Xi=this.parseExprList(K.parenR,this.options.ecmaVersion>=8,!1,sr);if(q&&!ft&&!this.canInsertSemicolon()&&this.eat(K.arrow))return this.checkPatternErrors(sr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=wn,this.awaitPos=ri,this.awaitIdentPos=On,this.parseArrowExpression(this.startNodeAt(A,N),Xi,!0);this.checkExpressionErrors(sr,!0),this.yieldPos=wn||this.yieldPos,this.awaitPos=ri||this.awaitPos,this.awaitIdentPos=On||this.awaitIdentPos;var da=this.startNodeAt(A,N);da.callee=g,da.arguments=Xi,Xe&&(da.optional=ft),g=this.finishNode(da,"CallExpression")}else if(this.type===K.backQuote){(ft||_e)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var wa=this.startNodeAt(A,N);wa.tag=g,wa.quasi=this.parseTemplate({isTagged:!0}),g=this.finishNode(wa,"TaggedTemplateExpression")}return g},kn.parseExprAtom=function(g){this.type===K.slash&&this.readRegexp();var A,N=this.potentialArrowAt===this.start;switch(this.type){case K._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),A=this.startNode(),this.next(),this.type===K.parenL&&!this.allowDirectSuper&&this.raise(A.start,"super() call outside constructor of a subclass"),this.type!==K.dot&&this.type!==K.bracketL&&this.type!==K.parenL&&this.unexpected(),this.finishNode(A,"Super");case K._this:return A=this.startNode(),this.next(),this.finishNode(A,"ThisExpression");case K.name:var O=this.start,q=this.startLoc,_e=this.containsEsc,Xe=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!_e&&Xe.name==="async"&&!this.canInsertSemicolon()&&this.eat(K._function))return this.parseFunction(this.startNodeAt(O,q),0,!1,!0);if(N&&!this.canInsertSemicolon()){if(this.eat(K.arrow))return this.parseArrowExpression(this.startNodeAt(O,q),[Xe],!1);if(this.options.ecmaVersion>=8&&Xe.name==="async"&&this.type===K.name&&!_e)return Xe=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(K.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,q),[Xe],!0)}return Xe;case K.regexp:var ft=this.value;return A=this.parseLiteral(ft.value),A.regex={pattern:ft.pattern,flags:ft.flags},A;case K.num:case K.string:return this.parseLiteral(this.value);case K._null:case K._true:case K._false:return A=this.startNode(),A.value=this.type===K._null?null:this.type===K._true,A.raw=this.type.keyword,this.next(),this.finishNode(A,"Literal");case K.parenL:var pt=this.start,ir=this.parseParenAndDistinguishExpression(N);return g&&(g.parenthesizedAssign<0&&!this.isSimpleAssignTarget(ir)&&(g.parenthesizedAssign=pt),g.parenthesizedBind<0&&(g.parenthesizedBind=pt)),ir;case K.bracketL:return A=this.startNode(),this.next(),A.elements=this.parseExprList(K.bracketR,!0,!0,g),this.finishNode(A,"ArrayExpression");case K.braceL:return this.parseObj(!1,g);case K._function:return A=this.startNode(),this.next(),this.parseFunction(A,0);case K._class:return this.parseClass(this.startNode(),!1);case K._new:return this.parseNew();case K.backQuote:return this.parseTemplate();case K._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},kn.parseExprImport=function(){var g=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var A=this.parseIdent(!0);switch(this.type){case K.parenL:return this.parseDynamicImport(g);case K.dot:return g.meta=A,this.parseImportMeta(g);default:this.unexpected()}},kn.parseDynamicImport=function(g){if(this.next(),g.source=this.parseMaybeAssign(),!this.eat(K.parenR)){var A=this.start;this.eat(K.comma)&&this.eat(K.parenR)?this.raiseRecoverable(A,"Trailing comma is not allowed in import()"):this.unexpected(A)}return this.finishNode(g,"ImportExpression")},kn.parseImportMeta=function(g){this.next();var A=this.containsEsc;return g.property=this.parseIdent(!0),g.property.name!=="meta"&&this.raiseRecoverable(g.property.start,"The only valid meta property for import is 'import.meta'"),A&&this.raiseRecoverable(g.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(g.start,"Cannot use 'import.meta' outside a module"),this.finishNode(g,"MetaProperty")},kn.parseLiteral=function(g){var A=this.startNode();return A.value=g,A.raw=this.input.slice(this.start,this.end),A.raw.charCodeAt(A.raw.length-1)===110&&(A.bigint=A.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(A,"Literal")},kn.parseParenExpression=function(){this.expect(K.parenL);var g=this.parseExpression();return this.expect(K.parenR),g},kn.parseParenAndDistinguishExpression=function(g){var A=this.start,N=this.startLoc,O,q=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var _e=this.start,Xe=this.startLoc,ft=[],pt=!0,ir=!1,sr=new de,wn=this.yieldPos,ri=this.awaitPos,On;for(this.yieldPos=0,this.awaitPos=0;this.type!==K.parenR;)if(pt?pt=!1:this.expect(K.comma),q&&this.afterTrailingComma(K.parenR,!0)){ir=!0;break}else if(this.type===K.ellipsis){On=this.start,ft.push(this.parseParenItem(this.parseRestBinding())),this.type===K.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ft.push(this.parseMaybeAssign(!1,sr,this.parseParenItem));var Xi=this.start,da=this.startLoc;if(this.expect(K.parenR),g&&!this.canInsertSemicolon()&&this.eat(K.arrow))return this.checkPatternErrors(sr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=wn,this.awaitPos=ri,this.parseParenArrowList(A,N,ft);(!ft.length||ir)&&this.unexpected(this.lastTokStart),On&&this.unexpected(On),this.checkExpressionErrors(sr,!0),this.yieldPos=wn||this.yieldPos,this.awaitPos=ri||this.awaitPos,ft.length>1?(O=this.startNodeAt(_e,Xe),O.expressions=ft,this.finishNodeAt(O,"SequenceExpression",Xi,da)):O=ft[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var wa=this.startNodeAt(A,N);return wa.expression=O,this.finishNode(wa,"ParenthesizedExpression")}else return O},kn.parseParenItem=function(g){return g},kn.parseParenArrowList=function(g,A,N){return this.parseArrowExpression(this.startNodeAt(g,A),N)};var hi=[];kn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var g=this.startNode(),A=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(K.dot)){g.meta=A;var N=this.containsEsc;return g.property=this.parseIdent(!0),g.property.name!=="target"&&this.raiseRecoverable(g.property.start,"The only valid meta property for new is 'new.target'"),N&&this.raiseRecoverable(g.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(g.start,"'new.target' can only be used in functions"),this.finishNode(g,"MetaProperty")}var O=this.start,q=this.startLoc,_e=this.type===K._import;return g.callee=this.parseSubscripts(this.parseExprAtom(),O,q,!0),_e&&g.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(K.parenL)?g.arguments=this.parseExprList(K.parenR,this.options.ecmaVersion>=8,!1):g.arguments=hi,this.finishNode(g,"NewExpression")},kn.parseTemplateElement=function(g){var A=g.isTagged,N=this.startNode();return this.type===K.invalidTemplate?(A||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),N.value={raw:this.value,cooked:null}):N.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),N.tail=this.type===K.backQuote,this.finishNode(N,"TemplateElement")},kn.parseTemplate=function(g){g===void 0&&(g={});var A=g.isTagged;A===void 0&&(A=!1);var N=this.startNode();this.next(),N.expressions=[];var O=this.parseTemplateElement({isTagged:A});for(N.quasis=[O];!O.tail;)this.type===K.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(K.dollarBraceL),N.expressions.push(this.parseExpression()),this.expect(K.braceR),N.quasis.push(O=this.parseTemplateElement({isTagged:A}));return this.next(),this.finishNode(N,"TemplateLiteral")},kn.isAsyncProp=function(g){return!g.computed&&g.key.type==="Identifier"&&g.key.name==="async"&&(this.type===K.name||this.type===K.num||this.type===K.string||this.type===K.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===K.star)&&!Ht.test(this.input.slice(this.lastTokEnd,this.start))},kn.parseObj=function(g,A){var N=this.startNode(),O=!0,q={};for(N.properties=[],this.next();!this.eat(K.braceR);){if(O)O=!1;else if(this.expect(K.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(K.braceR))break;var _e=this.parseProperty(g,A);g||this.checkPropClash(_e,q,A),N.properties.push(_e)}return this.finishNode(N,g?"ObjectPattern":"ObjectExpression")},kn.parseProperty=function(g,A){var N=this.startNode(),O,q,_e,Xe;if(this.options.ecmaVersion>=9&&this.eat(K.ellipsis))return g?(N.argument=this.parseIdent(!1),this.type===K.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(N,"RestElement")):(this.type===K.parenL&&A&&(A.parenthesizedAssign<0&&(A.parenthesizedAssign=this.start),A.parenthesizedBind<0&&(A.parenthesizedBind=this.start)),N.argument=this.parseMaybeAssign(!1,A),this.type===K.comma&&A&&A.trailingComma<0&&(A.trailingComma=this.start),this.finishNode(N,"SpreadElement"));this.options.ecmaVersion>=6&&(N.method=!1,N.shorthand=!1,(g||A)&&(_e=this.start,Xe=this.startLoc),g||(O=this.eat(K.star)));var ft=this.containsEsc;return this.parsePropertyName(N),!g&&!ft&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(N)?(q=!0,O=this.options.ecmaVersion>=9&&this.eat(K.star),this.parsePropertyName(N,A)):q=!1,this.parsePropertyValue(N,g,O,q,_e,Xe,A,ft),this.finishNode(N,"Property")},kn.parsePropertyValue=function(g,A,N,O,q,_e,Xe,ft){if((N||O)&&this.type===K.colon&&this.unexpected(),this.eat(K.colon))g.value=A?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,Xe),g.kind="init";else if(this.options.ecmaVersion>=6&&this.type===K.parenL)A&&this.unexpected(),g.kind="init",g.method=!0,g.value=this.parseMethod(N,O);else if(!A&&!ft&&this.options.ecmaVersion>=5&&!g.computed&&g.key.type==="Identifier"&&(g.key.name==="get"||g.key.name==="set")&&this.type!==K.comma&&this.type!==K.braceR&&this.type!==K.eq){(N||O)&&this.unexpected(),g.kind=g.key.name,this.parsePropertyName(g),g.value=this.parseMethod(!1);var pt=g.kind==="get"?0:1;if(g.value.params.length!==pt){var ir=g.value.start;g.kind==="get"?this.raiseRecoverable(ir,"getter should have no params"):this.raiseRecoverable(ir,"setter should have exactly one param")}else g.kind==="set"&&g.value.params[0].type==="RestElement"&&this.raiseRecoverable(g.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!g.computed&&g.key.type==="Identifier"?((N||O)&&this.unexpected(),this.checkUnreserved(g.key),g.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=q),g.kind="init",A?g.value=this.parseMaybeDefault(q,_e,g.key):this.type===K.eq&&Xe?(Xe.shorthandAssign<0&&(Xe.shorthandAssign=this.start),g.value=this.parseMaybeDefault(q,_e,g.key)):g.value=g.key,g.shorthand=!0):this.unexpected()},kn.parsePropertyName=function(g){if(this.options.ecmaVersion>=6){if(this.eat(K.bracketL))return g.computed=!0,g.key=this.parseMaybeAssign(),this.expect(K.bracketR),g.key;g.computed=!1}return g.key=this.type===K.num||this.type===K.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},kn.initFunction=function(g){g.id=null,this.options.ecmaVersion>=6&&(g.generator=g.expression=!1),this.options.ecmaVersion>=8&&(g.async=!1)},kn.parseMethod=function(g,A,N){var O=this.startNode(),q=this.yieldPos,_e=this.awaitPos,Xe=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=g),this.options.ecmaVersion>=8&&(O.async=!!A),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Vi(A,O.generator)|fi|(N?ua:0)),this.expect(K.parenL),O.params=this.parseBindingList(K.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=q,this.awaitPos=_e,this.awaitIdentPos=Xe,this.finishNode(O,"FunctionExpression")},kn.parseArrowExpression=function(g,A,N){var O=this.yieldPos,q=this.awaitPos,_e=this.awaitIdentPos;return this.enterScope(Vi(N,!1)|ci),this.initFunction(g),this.options.ecmaVersion>=8&&(g.async=!!N),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,g.params=this.toAssignableList(A,!0),this.parseFunctionBody(g,!0,!1),this.yieldPos=O,this.awaitPos=q,this.awaitIdentPos=_e,this.finishNode(g,"ArrowFunctionExpression")},kn.parseFunctionBody=function(g,A,N){var O=A&&this.type!==K.braceL,q=this.strict,_e=!1;if(O)g.body=this.parseMaybeAssign(),g.expression=!0,this.checkParams(g,!1);else{var Xe=this.options.ecmaVersion>=7&&!this.isSimpleParamList(g.params);(!q||Xe)&&(_e=this.strictDirective(this.end),_e&&Xe&&this.raiseRecoverable(g.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ft=this.labels;this.labels=[],_e&&(this.strict=!0),this.checkParams(g,!q&&!_e&&!A&&!N&&this.isSimpleParamList(g.params)),this.strict&&g.id&&this.checkLVal(g.id,Xn),g.body=this.parseBlock(!1,void 0,_e&&!q),g.expression=!1,this.adaptDirectivePrologue(g.body.body),this.labels=ft}this.exitScope()},kn.isSimpleParamList=function(g){for(var A=0,N=g;A<N.length;A+=1){var O=N[A];if(O.type!=="Identifier")return!1}return!0},kn.checkParams=function(g,A){for(var N={},O=0,q=g.params;O<q.length;O+=1){var _e=q[O];this.checkLVal(_e,Ki,A?null:N)}},kn.parseExprList=function(g,A,N,O){for(var q=[],_e=!0;!this.eat(g);){if(_e)_e=!1;else if(this.expect(K.comma),A&&this.afterTrailingComma(g))break;var Xe=void 0;N&&this.type===K.comma?Xe=null:this.type===K.ellipsis?(Xe=this.parseSpread(O),O&&this.type===K.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):Xe=this.parseMaybeAssign(!1,O),q.push(Xe)}return q},kn.checkUnreserved=function(g){var A=g.start,N=g.end,O=g.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(A,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(A,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(A,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(A,N).indexOf("\\")!==-1)){var q=this.strict?this.reservedWordsStrict:this.reservedWords;q.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(A,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(A,"The keyword '"+O+"' is reserved"))}},kn.parseIdent=function(g,A){var N=this.startNode();return this.type===K.name?N.name=this.value:this.type.keyword?(N.name=this.type.keyword,(N.name==="class"||N.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!g),this.finishNode(N,"Identifier"),g||(this.checkUnreserved(N),N.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=N.start)),N},kn.parseYield=function(g){this.yieldPos||(this.yieldPos=this.start);var A=this.startNode();return this.next(),this.type===K.semi||this.canInsertSemicolon()||this.type!==K.star&&!this.type.startsExpr?(A.delegate=!1,A.argument=null):(A.delegate=this.eat(K.star),A.argument=this.parseMaybeAssign(g)),this.finishNode(A,"YieldExpression")},kn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var g=this.startNode();return this.next(),g.argument=this.parseMaybeUnary(null,!1),this.finishNode(g,"AwaitExpression")};var qn=bi.prototype;qn.raise=function(g,A){var N=mt(this.input,g);A+=" ("+N.line+":"+N.column+")";var O=new SyntaxError(A);throw O.pos=g,O.loc=N,O.raisedAt=this.pos,O},qn.raiseRecoverable=qn.raise,qn.curPosition=function(){if(this.options.locations)return new De(this.curLine,this.pos-this.lineStart)};var an=bi.prototype,Di=function(A){this.flags=A,this.var=[],this.lexical=[],this.functions=[]};an.enterScope=function(g){this.scopeStack.push(new Di(g))},an.exitScope=function(){this.scopeStack.pop()},an.treatFunctionsAsVarInScope=function(g){return g.flags&cn||!this.inModule&&g.flags&Kn},an.declareName=function(g,A,N){var O=!1;if(A===la){var q=this.currentScope();O=q.lexical.indexOf(g)>-1||q.functions.indexOf(g)>-1||q.var.indexOf(g)>-1,q.lexical.push(g),this.inModule&&q.flags&Kn&&delete this.undefinedExports[g]}else if(A===ma){var _e=this.currentScope();_e.lexical.push(g)}else if(A===Ai){var Xe=this.currentScope();this.treatFunctionsAsVar?O=Xe.lexical.indexOf(g)>-1:O=Xe.lexical.indexOf(g)>-1||Xe.var.indexOf(g)>-1,Xe.functions.push(g)}else for(var ft=this.scopeStack.length-1;ft>=0;--ft){var pt=this.scopeStack[ft];if(pt.lexical.indexOf(g)>-1&&!(pt.flags&Hn&&pt.lexical[0]===g)||!this.treatFunctionsAsVarInScope(pt)&&pt.functions.indexOf(g)>-1){O=!0;break}if(pt.var.push(g),this.inModule&&pt.flags&Kn&&delete this.undefinedExports[g],pt.flags&li)break}O&&this.raiseRecoverable(N,"Identifier '"+g+"' has already been declared")},an.checkLocalExport=function(g){this.scopeStack[0].lexical.indexOf(g.name)===-1&&this.scopeStack[0].var.indexOf(g.name)===-1&&(this.undefinedExports[g.name]=g)},an.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},an.currentVarScope=function(){for(var g=this.scopeStack.length-1;;g--){var A=this.scopeStack[g];if(A.flags&li)return A}},an.currentThisScope=function(){for(var g=this.scopeStack.length-1;;g--){var A=this.scopeStack[g];if(A.flags&li&&!(A.flags&ci))return A}};var Oi=function(A,N,O){this.type="",this.start=N,this.end=0,A.options.locations&&(this.loc=new bt(A,O)),A.options.directSourceFile&&(this.sourceFile=A.options.directSourceFile),A.options.ranges&&(this.range=[N,0])},to=bi.prototype;to.startNode=function(){return new Oi(this,this.start,this.startLoc)},to.startNodeAt=function(g,A){return new Oi(this,g,A)};function ps(g,A,N,O){return g.type=A,g.end=N,this.options.locations&&(g.loc.end=O),this.options.ranges&&(g.range[1]=N),g}to.finishNode=function(g,A){return ps.call(this,g,A,this.lastTokEnd,this.lastTokEndLoc)},to.finishNodeAt=function(g,A,N,O){return ps.call(this,g,A,N,O)};var Zo=function(A,N,O,q,_e){this.token=A,this.isExpr=!!N,this.preserveSpace=!!O,this.override=q,this.generator=!!_e},Na={b_stat:new Zo("{",!1),b_expr:new Zo("{",!0),b_tmpl:new Zo("${",!1),p_stat:new Zo("(",!1),p_expr:new Zo("(",!0),q_tmpl:new Zo("`",!0,!0,function(g){return g.tryReadTemplateToken()}),f_stat:new Zo("function",!1),f_expr:new Zo("function",!0),f_expr_gen:new Zo("function",!0,!1,null,!0),f_gen:new Zo("function",!1,!1,null,!0)},xa=bi.prototype;xa.initialContext=function(){return[Na.b_stat]},xa.braceIsBlock=function(g){var A=this.curContext();return A===Na.f_expr||A===Na.f_stat?!0:g===K.colon&&(A===Na.b_stat||A===Na.b_expr)?!A.isExpr:g===K._return||g===K.name&&this.exprAllowed?Ht.test(this.input.slice(this.lastTokEnd,this.start)):g===K._else||g===K.semi||g===K.eof||g===K.parenR||g===K.arrow?!0:g===K.braceL?A===Na.b_stat:g===K._var||g===K._const||g===K.name?!1:!this.exprAllowed},xa.inGeneratorContext=function(){for(var g=this.context.length-1;g>=1;g--){var A=this.context[g];if(A.token==="function")return A.generator}return!1},xa.updateContext=function(g){var A,N=this.type;N.keyword&&g===K.dot?this.exprAllowed=!1:(A=N.updateContext)?A.call(this,g):this.exprAllowed=N.beforeExpr},K.parenR.updateContext=K.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var g=this.context.pop();g===Na.b_stat&&this.curContext().token==="function"&&(g=this.context.pop()),this.exprAllowed=!g.isExpr},K.braceL.updateContext=function(g){this.context.push(this.braceIsBlock(g)?Na.b_stat:Na.b_expr),this.exprAllowed=!0},K.dollarBraceL.updateContext=function(){this.context.push(Na.b_tmpl),this.exprAllowed=!0},K.parenL.updateContext=function(g){var A=g===K._if||g===K._for||g===K._with||g===K._while;this.context.push(A?Na.p_stat:Na.p_expr),this.exprAllowed=!0},K.incDec.updateContext=function(){},K._function.updateContext=K._class.updateContext=function(g){g.beforeExpr&&g!==K.semi&&g!==K._else&&!(g===K._return&&Ht.test(this.input.slice(this.lastTokEnd,this.start)))&&!((g===K.colon||g===K.braceL)&&this.curContext()===Na.b_stat)?this.context.push(Na.f_expr):this.context.push(Na.f_stat),this.exprAllowed=!1},K.backQuote.updateContext=function(){this.curContext()===Na.q_tmpl?this.context.pop():this.context.push(Na.q_tmpl),this.exprAllowed=!1},K.star.updateContext=function(g){if(g===K._function){var A=this.context.length-1;this.context[A]===Na.f_expr?this.context[A]=Na.f_expr_gen:this.context[A]=Na.f_gen}this.exprAllowed=!0},K.name.updateContext=function(g){var A=!1;this.options.ecmaVersion>=6&&g!==K.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(A=!0),this.exprAllowed=A};var G="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",Q=G+" Extended_Pictographic",oe=Q,ge={9:G,10:Q,11:oe},Pe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ge="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",et=Ge+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",fe=et+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",ke={9:Ge,10:et,11:fe},vt={};function hr(g){var A=vt[g]={binary:we(ge[g]+" "+Pe),nonBinary:{General_Category:we(Pe),Script:we(ke[g])}};A.nonBinary.Script_Extensions=A.nonBinary.Script,A.nonBinary.gc=A.nonBinary.General_Category,A.nonBinary.sc=A.nonBinary.Script,A.nonBinary.scx=A.nonBinary.Script_Extensions}hr(9),hr(10),hr(11);var Pt=bi.prototype,Dt=function(A){this.parser=A,this.validFlags="gim"+(A.options.ecmaVersion>=6?"uy":"")+(A.options.ecmaVersion>=9?"s":""),this.unicodeProperties=vt[A.options.ecmaVersion>=11?11:A.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Dt.prototype.reset=function(A,N,O){var q=O.indexOf("u")!==-1;this.start=A|0,this.source=N+"",this.flags=O,this.switchU=q&&this.parser.options.ecmaVersion>=6,this.switchN=q&&this.parser.options.ecmaVersion>=9},Dt.prototype.raise=function(A){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+A)},Dt.prototype.at=function(A,N){N===void 0&&(N=!1);var O=this.source,q=O.length;if(A>=q)return-1;var _e=O.charCodeAt(A);if(!(N||this.switchU)||_e<=55295||_e>=57344||A+1>=q)return _e;var Xe=O.charCodeAt(A+1);return Xe>=56320&&Xe<=57343?(_e<<10)+Xe-56613888:_e},Dt.prototype.nextIndex=function(A,N){N===void 0&&(N=!1);var O=this.source,q=O.length;if(A>=q)return q;var _e=O.charCodeAt(A),Xe;return!(N||this.switchU)||_e<=55295||_e>=57344||A+1>=q||(Xe=O.charCodeAt(A+1))<56320||Xe>57343?A+1:A+2},Dt.prototype.current=function(A){return A===void 0&&(A=!1),this.at(this.pos,A)},Dt.prototype.lookahead=function(A){return A===void 0&&(A=!1),this.at(this.nextIndex(this.pos,A),A)},Dt.prototype.advance=function(A){A===void 0&&(A=!1),this.pos=this.nextIndex(this.pos,A)},Dt.prototype.eat=function(A,N){return N===void 0&&(N=!1),this.current(N)===A?(this.advance(N),!0):!1};function pr(g){return g<=65535?String.fromCharCode(g):(g-=65536,String.fromCharCode((g>>10)+55296,(g&1023)+56320))}Pt.validateRegExpFlags=function(g){for(var A=g.validFlags,N=g.flags,O=0;O<N.length;O++){var q=N.charAt(O);A.indexOf(q)===-1&&this.raise(g.start,"Invalid regular expression flag"),N.indexOf(q,O+1)>-1&&this.raise(g.start,"Duplicate regular expression flag")}},Pt.validateRegExpPattern=function(g){this.regexp_pattern(g),!g.switchN&&this.options.ecmaVersion>=9&&g.groupNames.length>0&&(g.switchN=!0,this.regexp_pattern(g))},Pt.regexp_pattern=function(g){g.pos=0,g.lastIntValue=0,g.lastStringValue="",g.lastAssertionIsQuantifiable=!1,g.numCapturingParens=0,g.maxBackReference=0,g.groupNames.length=0,g.backReferenceNames.length=0,this.regexp_disjunction(g),g.pos!==g.source.length&&(g.eat(41)&&g.raise("Unmatched ')'"),(g.eat(93)||g.eat(125))&&g.raise("Lone quantifier brackets")),g.maxBackReference>g.numCapturingParens&&g.raise("Invalid escape");for(var A=0,N=g.backReferenceNames;A<N.length;A+=1){var O=N[A];g.groupNames.indexOf(O)===-1&&g.raise("Invalid named capture referenced")}},Pt.regexp_disjunction=function(g){for(this.regexp_alternative(g);g.eat(124);)this.regexp_alternative(g);this.regexp_eatQuantifier(g,!0)&&g.raise("Nothing to repeat"),g.eat(123)&&g.raise("Lone quantifier brackets")},Pt.regexp_alternative=function(g){for(;g.pos<g.source.length&&this.regexp_eatTerm(g););},Pt.regexp_eatTerm=function(g){return this.regexp_eatAssertion(g)?(g.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(g)&&g.switchU&&g.raise("Invalid quantifier"),!0):(g.switchU?this.regexp_eatAtom(g):this.regexp_eatExtendedAtom(g))?(this.regexp_eatQuantifier(g),!0):!1},Pt.regexp_eatAssertion=function(g){var A=g.pos;if(g.lastAssertionIsQuantifiable=!1,g.eat(94)||g.eat(36))return!0;if(g.eat(92)){if(g.eat(66)||g.eat(98))return!0;g.pos=A}if(g.eat(40)&&g.eat(63)){var N=!1;if(this.options.ecmaVersion>=9&&(N=g.eat(60)),g.eat(61)||g.eat(33))return this.regexp_disjunction(g),g.eat(41)||g.raise("Unterminated group"),g.lastAssertionIsQuantifiable=!N,!0}return g.pos=A,!1},Pt.regexp_eatQuantifier=function(g,A){return A===void 0&&(A=!1),this.regexp_eatQuantifierPrefix(g,A)?(g.eat(63),!0):!1},Pt.regexp_eatQuantifierPrefix=function(g,A){return g.eat(42)||g.eat(43)||g.eat(63)||this.regexp_eatBracedQuantifier(g,A)},Pt.regexp_eatBracedQuantifier=function(g,A){var N=g.pos;if(g.eat(123)){var O=0,q=-1;if(this.regexp_eatDecimalDigits(g)&&(O=g.lastIntValue,g.eat(44)&&this.regexp_eatDecimalDigits(g)&&(q=g.lastIntValue),g.eat(125)))return q!==-1&&q<O&&!A&&g.raise("numbers out of order in {} quantifier"),!0;g.switchU&&!A&&g.raise("Incomplete quantifier"),g.pos=N}return!1},Pt.regexp_eatAtom=function(g){return this.regexp_eatPatternCharacters(g)||g.eat(46)||this.regexp_eatReverseSolidusAtomEscape(g)||this.regexp_eatCharacterClass(g)||this.regexp_eatUncapturingGroup(g)||this.regexp_eatCapturingGroup(g)},Pt.regexp_eatReverseSolidusAtomEscape=function(g){var A=g.pos;if(g.eat(92)){if(this.regexp_eatAtomEscape(g))return!0;g.pos=A}return!1},Pt.regexp_eatUncapturingGroup=function(g){var A=g.pos;if(g.eat(40)){if(g.eat(63)&&g.eat(58)){if(this.regexp_disjunction(g),g.eat(41))return!0;g.raise("Unterminated group")}g.pos=A}return!1},Pt.regexp_eatCapturingGroup=function(g){if(g.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(g):g.current()===63&&g.raise("Invalid group"),this.regexp_disjunction(g),g.eat(41))return g.numCapturingParens+=1,!0;g.raise("Unterminated group")}return!1},Pt.regexp_eatExtendedAtom=function(g){return g.eat(46)||this.regexp_eatReverseSolidusAtomEscape(g)||this.regexp_eatCharacterClass(g)||this.regexp_eatUncapturingGroup(g)||this.regexp_eatCapturingGroup(g)||this.regexp_eatInvalidBracedQuantifier(g)||this.regexp_eatExtendedPatternCharacter(g)},Pt.regexp_eatInvalidBracedQuantifier=function(g){return this.regexp_eatBracedQuantifier(g,!0)&&g.raise("Nothing to repeat"),!1},Pt.regexp_eatSyntaxCharacter=function(g){var A=g.current();return mn(A)?(g.lastIntValue=A,g.advance(),!0):!1};function mn(g){return g===36||g>=40&&g<=43||g===46||g===63||g>=91&&g<=94||g>=123&&g<=125}Pt.regexp_eatPatternCharacters=function(g){for(var A=g.pos,N=0;(N=g.current())!==-1&&!mn(N);)g.advance();return g.pos!==A},Pt.regexp_eatExtendedPatternCharacter=function(g){var A=g.current();return A!==-1&&A!==36&&!(A>=40&&A<=43)&&A!==46&&A!==63&&A!==91&&A!==94&&A!==124?(g.advance(),!0):!1},Pt.regexp_groupSpecifier=function(g){if(g.eat(63)){if(this.regexp_eatGroupName(g)){g.groupNames.indexOf(g.lastStringValue)!==-1&&g.raise("Duplicate capture group name"),g.groupNames.push(g.lastStringValue);return}g.raise("Invalid group")}},Pt.regexp_eatGroupName=function(g){if(g.lastStringValue="",g.eat(60)){if(this.regexp_eatRegExpIdentifierName(g)&&g.eat(62))return!0;g.raise("Invalid capture group name")}return!1},Pt.regexp_eatRegExpIdentifierName=function(g){if(g.lastStringValue="",this.regexp_eatRegExpIdentifierStart(g)){for(g.lastStringValue+=pr(g.lastIntValue);this.regexp_eatRegExpIdentifierPart(g);)g.lastStringValue+=pr(g.lastIntValue);return!0}return!1},Pt.regexp_eatRegExpIdentifierStart=function(g){var A=g.pos,N=this.options.ecmaVersion>=11,O=g.current(N);return g.advance(N),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(g,N)&&(O=g.lastIntValue),un(O)?(g.lastIntValue=O,!0):(g.pos=A,!1)};function un(g){return Rt(g,!0)||g===36||g===95}Pt.regexp_eatRegExpIdentifierPart=function(g){var A=g.pos,N=this.options.ecmaVersion>=11,O=g.current(N);return g.advance(N),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(g,N)&&(O=g.lastIntValue),Tt(O)?(g.lastIntValue=O,!0):(g.pos=A,!1)};function Tt(g){return $t(g,!0)||g===36||g===95||g===8204||g===8205}Pt.regexp_eatAtomEscape=function(g){return this.regexp_eatBackReference(g)||this.regexp_eatCharacterClassEscape(g)||this.regexp_eatCharacterEscape(g)||g.switchN&&this.regexp_eatKGroupName(g)?!0:(g.switchU&&(g.current()===99&&g.raise("Invalid unicode escape"),g.raise("Invalid escape")),!1)},Pt.regexp_eatBackReference=function(g){var A=g.pos;if(this.regexp_eatDecimalEscape(g)){var N=g.lastIntValue;if(g.switchU)return N>g.maxBackReference&&(g.maxBackReference=N),!0;if(N<=g.numCapturingParens)return!0;g.pos=A}return!1},Pt.regexp_eatKGroupName=function(g){if(g.eat(107)){if(this.regexp_eatGroupName(g))return g.backReferenceNames.push(g.lastStringValue),!0;g.raise("Invalid named reference")}return!1},Pt.regexp_eatCharacterEscape=function(g){return this.regexp_eatControlEscape(g)||this.regexp_eatCControlLetter(g)||this.regexp_eatZero(g)||this.regexp_eatHexEscapeSequence(g)||this.regexp_eatRegExpUnicodeEscapeSequence(g,!1)||!g.switchU&&this.regexp_eatLegacyOctalEscapeSequence(g)||this.regexp_eatIdentityEscape(g)},Pt.regexp_eatCControlLetter=function(g){var A=g.pos;if(g.eat(99)){if(this.regexp_eatControlLetter(g))return!0;g.pos=A}return!1},Pt.regexp_eatZero=function(g){return g.current()===48&&!Pn(g.lookahead())?(g.lastIntValue=0,g.advance(),!0):!1},Pt.regexp_eatControlEscape=function(g){var A=g.current();return A===116?(g.lastIntValue=9,g.advance(),!0):A===110?(g.lastIntValue=10,g.advance(),!0):A===118?(g.lastIntValue=11,g.advance(),!0):A===102?(g.lastIntValue=12,g.advance(),!0):A===114?(g.lastIntValue=13,g.advance(),!0):!1},Pt.regexp_eatControlLetter=function(g){var A=g.current();return $r(A)?(g.lastIntValue=A%32,g.advance(),!0):!1};function $r(g){return g>=65&&g<=90||g>=97&&g<=122}Pt.regexp_eatRegExpUnicodeEscapeSequence=function(g,A){A===void 0&&(A=!1);var N=g.pos,O=A||g.switchU;if(g.eat(117)){if(this.regexp_eatFixedHexDigits(g,4)){var q=g.lastIntValue;if(O&&q>=55296&&q<=56319){var _e=g.pos;if(g.eat(92)&&g.eat(117)&&this.regexp_eatFixedHexDigits(g,4)){var Xe=g.lastIntValue;if(Xe>=56320&&Xe<=57343)return g.lastIntValue=(q-55296)*1024+(Xe-56320)+65536,!0}g.pos=_e,g.lastIntValue=q}return!0}if(O&&g.eat(123)&&this.regexp_eatHexDigits(g)&&g.eat(125)&&Fr(g.lastIntValue))return!0;O&&g.raise("Invalid unicode escape"),g.pos=N}return!1};function Fr(g){return g>=0&&g<=1114111}Pt.regexp_eatIdentityEscape=function(g){if(g.switchU)return this.regexp_eatSyntaxCharacter(g)?!0:g.eat(47)?(g.lastIntValue=47,!0):!1;var A=g.current();return A!==99&&(!g.switchN||A!==107)?(g.lastIntValue=A,g.advance(),!0):!1},Pt.regexp_eatDecimalEscape=function(g){g.lastIntValue=0;var A=g.current();if(A>=49&&A<=57){do g.lastIntValue=10*g.lastIntValue+(A-48),g.advance();while((A=g.current())>=48&&A<=57);return!0}return!1},Pt.regexp_eatCharacterClassEscape=function(g){var A=g.current();if(Gr(A))return g.lastIntValue=-1,g.advance(),!0;if(g.switchU&&this.options.ecmaVersion>=9&&(A===80||A===112)){if(g.lastIntValue=-1,g.advance(),g.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(g)&&g.eat(125))return!0;g.raise("Invalid property name")}return!1};function Gr(g){return g===100||g===68||g===115||g===83||g===119||g===87}Pt.regexp_eatUnicodePropertyValueExpression=function(g){var A=g.pos;if(this.regexp_eatUnicodePropertyName(g)&&g.eat(61)){var N=g.lastStringValue;if(this.regexp_eatUnicodePropertyValue(g)){var O=g.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(g,N,O),!0}}if(g.pos=A,this.regexp_eatLoneUnicodePropertyNameOrValue(g)){var q=g.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(g,q),!0}return!1},Pt.regexp_validateUnicodePropertyNameAndValue=function(g,A,N){jr(g.unicodeProperties.nonBinary,A)||g.raise("Invalid property name"),g.unicodeProperties.nonBinary[A].test(N)||g.raise("Invalid property value")},Pt.regexp_validateUnicodePropertyNameOrValue=function(g,A){g.unicodeProperties.binary.test(A)||g.raise("Invalid property name")},Pt.regexp_eatUnicodePropertyName=function(g){var A=0;for(g.lastStringValue="";vi(A=g.current());)g.lastStringValue+=pr(A),g.advance();return g.lastStringValue!==""};function vi(g){return $r(g)||g===95}Pt.regexp_eatUnicodePropertyValue=function(g){var A=0;for(g.lastStringValue="";Jr(A=g.current());)g.lastStringValue+=pr(A),g.advance();return g.lastStringValue!==""};function Jr(g){return vi(g)||Pn(g)}Pt.regexp_eatLoneUnicodePropertyNameOrValue=function(g){return this.regexp_eatUnicodePropertyValue(g)},Pt.regexp_eatCharacterClass=function(g){if(g.eat(91)){if(g.eat(94),this.regexp_classRanges(g),g.eat(93))return!0;g.raise("Unterminated character class")}return!1},Pt.regexp_classRanges=function(g){for(;this.regexp_eatClassAtom(g);){var A=g.lastIntValue;if(g.eat(45)&&this.regexp_eatClassAtom(g)){var N=g.lastIntValue;g.switchU&&(A===-1||N===-1)&&g.raise("Invalid character class"),A!==-1&&N!==-1&&A>N&&g.raise("Range out of order in character class")}}},Pt.regexp_eatClassAtom=function(g){var A=g.pos;if(g.eat(92)){if(this.regexp_eatClassEscape(g))return!0;if(g.switchU){var N=g.current();(N===99||Ci(N))&&g.raise("Invalid class escape"),g.raise("Invalid escape")}g.pos=A}var O=g.current();return O!==93?(g.lastIntValue=O,g.advance(),!0):!1},Pt.regexp_eatClassEscape=function(g){var A=g.pos;if(g.eat(98))return g.lastIntValue=8,!0;if(g.switchU&&g.eat(45))return g.lastIntValue=45,!0;if(!g.switchU&&g.eat(99)){if(this.regexp_eatClassControlLetter(g))return!0;g.pos=A}return this.regexp_eatCharacterClassEscape(g)||this.regexp_eatCharacterEscape(g)},Pt.regexp_eatClassControlLetter=function(g){var A=g.current();return Pn(A)||A===95?(g.lastIntValue=A%32,g.advance(),!0):!1},Pt.regexp_eatHexEscapeSequence=function(g){var A=g.pos;if(g.eat(120)){if(this.regexp_eatFixedHexDigits(g,2))return!0;g.switchU&&g.raise("Invalid escape"),g.pos=A}return!1},Pt.regexp_eatDecimalDigits=function(g){var A=g.pos,N=0;for(g.lastIntValue=0;Pn(N=g.current());)g.lastIntValue=10*g.lastIntValue+(N-48),g.advance();return g.pos!==A};function Pn(g){return g>=48&&g<=57}Pt.regexp_eatHexDigits=function(g){var A=g.pos,N=0;for(g.lastIntValue=0;Wi(N=g.current());)g.lastIntValue=16*g.lastIntValue+pi(N),g.advance();return g.pos!==A};function Wi(g){return g>=48&&g<=57||g>=65&&g<=70||g>=97&&g<=102}function pi(g){return g>=65&&g<=70?10+(g-65):g>=97&&g<=102?10+(g-97):g-48}Pt.regexp_eatLegacyOctalEscapeSequence=function(g){if(this.regexp_eatOctalDigit(g)){var A=g.lastIntValue;if(this.regexp_eatOctalDigit(g)){var N=g.lastIntValue;A<=3&&this.regexp_eatOctalDigit(g)?g.lastIntValue=A*64+N*8+g.lastIntValue:g.lastIntValue=A*8+N}else g.lastIntValue=A;return!0}return!1},Pt.regexp_eatOctalDigit=function(g){var A=g.current();return Ci(A)?(g.lastIntValue=A-48,g.advance(),!0):(g.lastIntValue=0,!1)};function Ci(g){return g>=48&&g<=55}Pt.regexp_eatFixedHexDigits=function(g,A){var N=g.pos;g.lastIntValue=0;for(var O=0;O<A;++O){var q=g.current();if(!Wi(q))return g.pos=N,!1;g.lastIntValue=16*g.lastIntValue+pi(q),g.advance()}return!0};var _i=function(A){this.type=A.type,this.value=A.value,this.start=A.start,this.end=A.end,A.options.locations&&(this.loc=new bt(A,A.startLoc,A.endLoc)),A.options.ranges&&(this.range=[A.start,A.end])},St=bi.prototype;St.next=function(g){!g&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new _i(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},St.getToken=function(){return this.next(),new _i(this)},typeof Symbol!="undefined"&&(St[Symbol.iterator]=function(){var g=this;return{next:function(){var A=g.getToken();return{done:A.type===K.eof,value:A}}}}),St.curContext=function(){return this.context[this.context.length-1]},St.nextToken=function(){var g=this.curContext();if((!g||!g.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(K.eof);if(g.override)return g.override(this);this.readToken(this.fullCharCodeAtPos())},St.readToken=function(g){return Rt(g,this.options.ecmaVersion>=6)||g===92?this.readWord():this.getTokenFromCode(g)},St.fullCharCodeAtPos=function(){var g=this.input.charCodeAt(this.pos);if(g<=55295||g>=57344)return g;var A=this.input.charCodeAt(this.pos+1);return(g<<10)+A-56613888},St.skipBlockComment=function(){var g=this.options.onComment&&this.curPosition(),A=this.pos,N=this.input.indexOf("*/",this.pos+=2);if(N===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=N+2,this.options.locations){at.lastIndex=A;for(var O;(O=at.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(A+2,N),A,this.pos,g,this.curPosition())},St.skipLineComment=function(g){for(var A=this.pos,N=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=g);this.pos<this.input.length&&!Ye(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(A+g,this.pos),A,this.pos,N,this.curPosition())},St.skipSpace=function(){e:for(;this.pos<this.input.length;){var g=this.input.charCodeAt(this.pos);switch(g){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(g>8&&g<14||g>=5760&&ut.test(String.fromCharCode(g)))++this.pos;else break e}}},St.finishToken=function(g,A){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var N=this.type;this.type=g,this.value=A,this.updateContext(N)},St.readToken_dot=function(){var g=this.input.charCodeAt(this.pos+1);if(g>=48&&g<=57)return this.readNumber(!0);var A=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&g===46&&A===46?(this.pos+=3,this.finishToken(K.ellipsis)):(++this.pos,this.finishToken(K.dot))},St.readToken_slash=function(){var g=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):g===61?this.finishOp(K.assign,2):this.finishOp(K.slash,1)},St.readToken_mult_modulo_exp=function(g){var A=this.input.charCodeAt(this.pos+1),N=1,O=g===42?K.star:K.modulo;return this.options.ecmaVersion>=7&&g===42&&A===42&&(++N,O=K.starstar,A=this.input.charCodeAt(this.pos+2)),A===61?this.finishOp(K.assign,N+1):this.finishOp(O,N)},St.readToken_pipe_amp=function(g){var A=this.input.charCodeAt(this.pos+1);if(A===g){if(this.options.ecmaVersion>=12){var N=this.input.charCodeAt(this.pos+2);if(N===61)return this.finishOp(K.assign,3)}return this.finishOp(g===124?K.logicalOR:K.logicalAND,2)}return A===61?this.finishOp(K.assign,2):this.finishOp(g===124?K.bitwiseOR:K.bitwiseAND,1)},St.readToken_caret=function(){var g=this.input.charCodeAt(this.pos+1);return g===61?this.finishOp(K.assign,2):this.finishOp(K.bitwiseXOR,1)},St.readToken_plus_min=function(g){var A=this.input.charCodeAt(this.pos+1);return A===g?A===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Ht.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(K.incDec,2):A===61?this.finishOp(K.assign,2):this.finishOp(K.plusMin,1)},St.readToken_lt_gt=function(g){var A=this.input.charCodeAt(this.pos+1),N=1;return A===g?(N=g===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+N)===61?this.finishOp(K.assign,N+1):this.finishOp(K.bitShift,N)):A===33&&g===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(A===61&&(N=2),this.finishOp(K.relational,N))},St.readToken_eq_excl=function(g){var A=this.input.charCodeAt(this.pos+1);return A===61?this.finishOp(K.equality,this.input.charCodeAt(this.pos+2)===61?3:2):g===61&&A===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(K.arrow)):this.finishOp(g===61?K.eq:K.prefix,1)},St.readToken_question=function(){var g=this.options.ecmaVersion;if(g>=11){var A=this.input.charCodeAt(this.pos+1);if(A===46){var N=this.input.charCodeAt(this.pos+2);if(N<48||N>57)return this.finishOp(K.questionDot,2)}if(A===63){if(g>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(K.assign,3)}return this.finishOp(K.coalesce,2)}}return this.finishOp(K.question,1)},St.getTokenFromCode=function(g){switch(g){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(K.parenL);case 41:return++this.pos,this.finishToken(K.parenR);case 59:return++this.pos,this.finishToken(K.semi);case 44:return++this.pos,this.finishToken(K.comma);case 91:return++this.pos,this.finishToken(K.bracketL);case 93:return++this.pos,this.finishToken(K.bracketR);case 123:return++this.pos,this.finishToken(K.braceL);case 125:return++this.pos,this.finishToken(K.braceR);case 58:return++this.pos,this.finishToken(K.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(K.backQuote);case 48:var A=this.input.charCodeAt(this.pos+1);if(A===120||A===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(A===111||A===79)return this.readRadixNumber(8);if(A===98||A===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(g);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(g);case 124:case 38:return this.readToken_pipe_amp(g);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(g);case 60:case 62:return this.readToken_lt_gt(g);case 61:case 33:return this.readToken_eq_excl(g);case 63:return this.readToken_question();case 126:return this.finishOp(K.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ei(g)+"'")},St.finishOp=function(g,A){var N=this.input.slice(this.pos,this.pos+A);return this.pos+=A,this.finishToken(g,N)},St.readRegexp=function(){for(var g,A,N=this.pos;;){this.pos>=this.input.length&&this.raise(N,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(Ht.test(O)&&this.raise(N,"Unterminated regular expression"),g)g=!1;else{if(O==="[")A=!0;else if(O==="]"&&A)A=!1;else if(O==="/"&&!A)break;g=O==="\\"}++this.pos}var q=this.input.slice(N,this.pos);++this.pos;var _e=this.pos,Xe=this.readWord1();this.containsEsc&&this.unexpected(_e);var ft=this.regexpState||(this.regexpState=new Dt(this));ft.reset(N,q,Xe),this.validateRegExpFlags(ft),this.validateRegExpPattern(ft);var pt=null;try{pt=new RegExp(q,Xe)}catch(ir){}return this.finishToken(K.regexp,{pattern:q,flags:Xe,value:pt})},St.readInt=function(g,A,N){for(var O=this.options.ecmaVersion>=12&&A===void 0,q=N&&this.input.charCodeAt(this.pos)===48,_e=this.pos,Xe=0,ft=0,pt=0,ir=A==null?Infinity:A;pt<ir;++pt,++this.pos){var sr=this.input.charCodeAt(this.pos),wn=void 0;if(O&&sr===95){q&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ft===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),pt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ft=sr;continue}if(sr>=97?wn=sr-97+10:sr>=65?wn=sr-65+10:sr>=48&&sr<=57?wn=sr-48:wn=Infinity,wn>=g)break;ft=sr,Xe=Xe*g+wn}return O&&ft===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===_e||A!=null&&this.pos-_e!==A?null:Xe};function Kt(g,A){return A?parseInt(g,8):parseFloat(g.replace(/_/g,""))}function Ca(g){return typeof BigInt!="function"?null:BigInt(g.replace(/_/g,""))}St.readRadixNumber=function(g){var A=this.pos;this.pos+=2;var N=this.readInt(g);return N==null&&this.raise(this.start+2,"Expected number in radix "+g),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(N=Ca(this.input.slice(A,this.pos)),++this.pos):Rt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(K.num,N)},St.readNumber=function(g){var A=this.pos;!g&&this.readInt(10,void 0,!0)===null&&this.raise(A,"Invalid number");var N=this.pos-A>=2&&this.input.charCodeAt(A)===48;N&&this.strict&&this.raise(A,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!N&&!g&&this.options.ecmaVersion>=11&&O===110){var q=Ca(this.input.slice(A,this.pos));return++this.pos,Rt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(K.num,q)}N&&/[89]/.test(this.input.slice(A,this.pos))&&(N=!1),O===46&&!N&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!N&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(A,"Invalid number")),Rt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var _e=Kt(this.input.slice(A,this.pos),N);return this.finishToken(K.num,_e)},St.readCodePoint=function(){var g=this.input.charCodeAt(this.pos),A;if(g===123){this.options.ecmaVersion<6&&this.unexpected();var N=++this.pos;A=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,A>1114111&&this.invalidStringToken(N,"Code point out of bounds")}else A=this.readHexChar(4);return A};function Ei(g){return g<=65535?String.fromCharCode(g):(g-=65536,String.fromCharCode((g>>10)+55296,(g&1023)+56320))}St.readString=function(g){for(var A="",N=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===g)break;O===92?(A+=this.input.slice(N,this.pos),A+=this.readEscapedChar(!1),N=this.pos):(Ye(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return A+=this.input.slice(N,this.pos++),this.finishToken(K.string,A)};var Mi={};St.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(g){if(g===Mi)this.readInvalidTemplateToken();else throw g}this.inTemplateElement=!1},St.invalidStringToken=function(g,A){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Mi;this.raise(g,A)},St.readTmplToken=function(){for(var g="",A=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var N=this.input.charCodeAt(this.pos);if(N===96||N===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===K.template||this.type===K.invalidTemplate)?N===36?(this.pos+=2,this.finishToken(K.dollarBraceL)):(++this.pos,this.finishToken(K.backQuote)):(g+=this.input.slice(A,this.pos),this.finishToken(K.template,g));if(N===92)g+=this.input.slice(A,this.pos),g+=this.readEscapedChar(!0),A=this.pos;else if(Ye(N)){switch(g+=this.input.slice(A,this.pos),++this.pos,N){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:g+=`
`;break;default:g+=String.fromCharCode(N);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),A=this.pos}else++this.pos}},St.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(K.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},St.readEscapedChar=function(g){var A=this.input.charCodeAt(++this.pos);switch(++this.pos,A){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ei(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(g){var N=this.pos-1;return this.invalidStringToken(N,"Invalid escape sequence in template string"),null}default:if(A>=48&&A<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],q=parseInt(O,8);return q>255&&(O=O.slice(0,-1),q=parseInt(O,8)),this.pos+=O.length-1,A=this.input.charCodeAt(this.pos),(O!=="0"||A===56||A===57)&&(this.strict||g)&&this.invalidStringToken(this.pos-1-O.length,g?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(q)}return Ye(A)?"":String.fromCharCode(A)}},St.readHexChar=function(g){var A=this.pos,N=this.readInt(16,g);return N===null&&this.invalidStringToken(A,"Bad character escape sequence"),N},St.readWord1=function(){this.containsEsc=!1;for(var g="",A=!0,N=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var q=this.fullCharCodeAtPos();if($t(q,O))this.pos+=q<=65535?1:2;else if(q===92){this.containsEsc=!0,g+=this.input.slice(N,this.pos);var _e=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var Xe=this.readCodePoint();(A?Rt:$t)(Xe,O)||this.invalidStringToken(_e,"Invalid Unicode escape"),g+=Ei(Xe),N=this.pos}else break;A=!1}return g+this.input.slice(N,this.pos)},St.readWord=function(){var g=this.readWord1(),A=K.name;return this.keywords.test(g)&&(A=rt[g]),this.finishToken(A,g)};var Ui="7.4.1";bi.acorn={Parser:bi,version:Ui,defaultOptions:Lt,Position:De,SourceLocation:bt,getLineInfo:mt,Node:Oi,TokenType:ht,tokTypes:K,keywordTypes:rt,TokContext:Zo,tokContexts:Na,isIdentifierChar:$t,isIdentifierStart:Rt,Token:_i,isNewLine:Ye,lineBreak:Ht,lineBreakG:at,nonASCIIwhitespace:ut};function Wr(g,A){return bi.parse(g,A)}function Sn(g,A,N){return bi.parseExpressionAt(g,A,N)}function zt(g,A){return bi.tokenizer(g,A)}function na(g,A){g.prototype=Object.create(A.prototype),g.prototype.constructor=g,g.__proto__=A}function be(g){var A=typeof Map=="function"?new Map:void 0;return be=function(O){if(O===null||!fu(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof A!="undefined"){if(A.has(O))return A.get(O);A.set(O,q)}function q(){return Qi(O,arguments,Ma(this).constructor)}return q.prototype=Object.create(O.prototype,{constructor:{value:q,enumerable:!1,writable:!0,configurable:!0}}),Ba(q,O)},be(g)}function Ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(g){return!1}}function Qi(g,A,N){return Ko()?Qi=Reflect.construct:Qi=function(q,_e,Xe){var ft=[null];ft.push.apply(ft,_e);var pt=Function.bind.apply(q,ft),ir=new pt;return Xe&&Ba(ir,Xe.prototype),ir},Qi.apply(null,arguments)}function fu(g){return Function.toString.call(g).indexOf("[native code]")!==-1}function Ba(g,A){return Ba=Object.setPrototypeOf||function(O,q){return O.__proto__=q,O},Ba(g,A)}function Ma(g){return Ma=Object.setPrototypeOf?Object.getPrototypeOf:function(N){return N.__proto__||Object.getPrototypeOf(N)},Ma(g)}var Wa=function(g){na(A,g);function A(){return g.apply(this,arguments)||this}return A}(be(Error)),ia=function(g){na(A,g);function A(){return g.apply(this,arguments)||this}return A}(be(SyntaxError)),bo=function(g){na(A,g);function A(){return g.apply(this,arguments)||this}return A}(be(ReferenceError)),Vo=function(g){na(A,g);function A(){return g.apply(this,arguments)||this}return A}(be(TypeError)),wu=function(g){na(A,g);function A(){return g.apply(this,arguments)||this}return A}(Wa),fo=function(g){na(A,g);function A(){return g.apply(this,arguments)||this}return A}(ia),Do=function(g){na(A,g);function A(){return g.apply(this,arguments)||this}return A}(bo),aa={UnknownError:[3001,"%0",wu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",wu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Do],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Do],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Do],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Do],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Do],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Do],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Do],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Do],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Do],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Do],FunctionUndefinedReferenceError:[2001,"%0 is not a function",bo],VariableUndefinedReferenceError:[2002,"%0 is not defined",bo],IsNotConstructor:[2003,"%0 is not a constructor",Vo]};function Xa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(g){return!1}}function Fo(g,A,N){return Xa()?Fo=Reflect.construct:Fo=function(q,_e,Xe){var ft=[null];ft.push.apply(ft,_e);var pt=Function.bind.apply(q,ft),ir=new pt;return Xe&&Ya(ir,Xe.prototype),ir},Fo.apply(null,arguments)}function Ya(g,A){return Ya=Object.setPrototypeOf||function(O,q){return O.__proto__=q,O},Ya(g,A)}var Cs="0.0.3";function Sl(g,A){Object.defineProperty(g,"name",{value:A,writable:!1,enumerable:!1,configurable:!0})}var ds=Object.prototype.hasOwnProperty,ae=Symbol("Break"),xe=Symbol("Continue"),qe=Symbol("DefaultCase"),Ct=Symbol("EmptyStatementReturn"),Ir=Symbol("WithScopeName"),Tn=Symbol("SuperScopeName"),Pi=Symbol("RootScopeName"),ro=Symbol("GlobalScopeName");function ka(g){return typeof g=="function"}var za=function(){function g(N){this.interpreter=N}var A=g.prototype;return A.generator=function(){var O=this.interpreter;function q(){return this.getCurrentScope()}function _e(){return this.getGlobalScope()}function Xe(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:q.bind(O),getGlobalScope:_e.bind(O),getCurrentContext:Xe.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},g}();function jo(g,A,N){if(N===void 0&&(N=!0),!(g instanceof za))throw new Error("Illegal call");if(typeof A!="string")return A;if(!!A){var O=g.generator(),q=O.getOptions(),_e={timeout:q.timeout,_initEnv:function(){N||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},Xe=N?O.getGlobalScope():O.getCurrentScope(),ft=new _a(Xe,_e);return ft.evaluate(A)}}Object.defineProperty(jo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function vs(g){if(!(g instanceof za))throw new Error("Illegal call");for(var A=g.generator(),N=arguments.length,O=new Array(N>1?N-1:0),q=1;q<N;q++)O[q-1]=arguments[q];var _e=O.pop(),Xe=new _a(A.getGlobalScope(),A.getOptions()),ft=`
		    (function anonymous(`+O.join(",")+`){
		        `+_e+`
		    });
		    `;return Xe.evaluate(ft)}Object.defineProperty(vs,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var oo=function(A){this.value=A},Eo=function(A){this.value=A},ms=function(A){this.value=A},Ms=function(A,N,O){N===void 0&&(N=null),this.name=O,this.parent=N,this.data=A,this.labelStack=[]};function Fs(){}function eu(g,A){return g===void 0&&(g=null),new Ms(Object.create(null),g,A)}function gs(g){return Object.create(g)}var ga={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:jo,Function:vs};typeof JSON!="undefined"&&(ga.JSON=JSON),typeof Promise!="undefined"&&(ga.Promise=Promise),typeof Set!="undefined"&&(ga.Set=Set),typeof Map!="undefined"&&(ga.Map=Map),typeof Symbol!="undefined"&&(ga.Symbol=Symbol),typeof Proxy!="undefined"&&(ga.Proxy=Proxy),typeof WeakMap!="undefined"&&(ga.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ga.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ga.Reflect=Reflect);var _a=function(){function g(N,O){N===void 0&&(N=g.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||g.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?g.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=N||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var A=g.prototype;return A.initEnvironment=function(O){var q;if(O instanceof Ms)q=O;else{var _e=null,Xe=this.createSuperScope(O);this.options.rootContext&&(_e=new Ms(gs(this.options.rootContext),Xe,Pi)),q=new Ms(O,_e||Xe,ro)}this.globalScope=q,this.currentScope=this.globalScope,this.globalContext=q.data,this.currentContext=q.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ft=this.options._initEnv;ft&&ft.call(this)},A.getExecStartTime=function(){return this.execStartTime},A.getExecutionTime=function(){return this.execEndTime-this.execStartTime},A.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},A.getOptions=function(){return this.options},A.getGlobalScope=function(){return this.globalScope},A.getCurrentScope=function(){return this.currentScope},A.getCurrentContext=function(){return this.currentContext},A.isInterruptThrow=function(O){return O instanceof wu||O instanceof Do||O instanceof fo},A.createSuperScope=function(O){var q=Object.assign({},ga),_e=Object.keys(q);return _e.forEach(function(Xe){Xe in O&&delete q[Xe]}),new Ms(q,null,Tn)},A.setCurrentContext=function(O){this.currentContext=O},A.setCurrentScope=function(O){this.currentScope=O},A.evaluate=function(O){O===void 0&&(O="");var q;if(!!O)return q=Wr(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||g.ecmaVersion}),this.evaluateNode(q,O)},A.appendCode=function(O){return this.evaluate(O)},A.evaluateNode=function(O,q){var _e=this;q===void 0&&(q=""),this.value=void 0,this.source=q,this.sourceList.push(q),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Xe=this.getCurrentScope(),ft=this.getCurrentContext(),pt=Xe.labelStack.concat([]),ir=this.callStack.concat([]),sr=function(){_e.setCurrentScope(Xe),_e.setCurrentContext(ft),Xe.labelStack=pt,_e.callStack=ir};try{var wn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),wn()}catch(ri){throw ri}finally{sr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},A.createErrorMessage=function(O,q,_e){var Xe=O[1].replace("%0",String(q));return _e!==null&&(Xe+=this.getNodePosition(_e||this.lastExecNode)),Xe},A.createError=function(O,q){return new q(O)},A.createThrowError=function(O,q){return this.createError(O,q)},A.createInternalThrowError=function(O,q,_e){return this.createError(this.createErrorMessage(O,q,_e),O[2])},A.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,q=Date.now();return q-this.execStartTime>O},A.getNodePosition=function(O){if(O){var q="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+q:""}return""},A.createClosure=function(O){var q=this,_e;switch(O.type){case"BinaryExpression":_e=this.binaryExpressionHandler(O);break;case"LogicalExpression":_e=this.logicalExpressionHandler(O);break;case"UnaryExpression":_e=this.unaryExpressionHandler(O);break;case"UpdateExpression":_e=this.updateExpressionHandler(O);break;case"ObjectExpression":_e=this.objectExpressionHandler(O);break;case"ArrayExpression":_e=this.arrayExpressionHandler(O);break;case"CallExpression":_e=this.callExpressionHandler(O);break;case"NewExpression":_e=this.newExpressionHandler(O);break;case"MemberExpression":_e=this.memberExpressionHandler(O);break;case"ThisExpression":_e=this.thisExpressionHandler(O);break;case"SequenceExpression":_e=this.sequenceExpressionHandler(O);break;case"Literal":_e=this.literalHandler(O);break;case"Identifier":_e=this.identifierHandler(O);break;case"AssignmentExpression":_e=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":_e=this.functionDeclarationHandler(O);break;case"VariableDeclaration":_e=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":_e=this.programHandler(O);break;case"ExpressionStatement":_e=this.expressionStatementHandler(O);break;case"EmptyStatement":_e=this.emptyStatementHandler(O);break;case"ReturnStatement":_e=this.returnStatementHandler(O);break;case"FunctionExpression":_e=this.functionExpressionHandler(O);break;case"IfStatement":_e=this.ifStatementHandler(O);break;case"ConditionalExpression":_e=this.conditionalExpressionHandler(O);break;case"ForStatement":_e=this.forStatementHandler(O);break;case"WhileStatement":_e=this.whileStatementHandler(O);break;case"DoWhileStatement":_e=this.doWhileStatementHandler(O);break;case"ForInStatement":_e=this.forInStatementHandler(O);break;case"WithStatement":_e=this.withStatementHandler(O);break;case"ThrowStatement":_e=this.throwStatementHandler(O);break;case"TryStatement":_e=this.tryStatementHandler(O);break;case"ContinueStatement":_e=this.continueStatementHandler(O);break;case"BreakStatement":_e=this.breakStatementHandler(O);break;case"SwitchStatement":_e=this.switchStatementHandler(O);break;case"LabeledStatement":_e=this.labeledStatementHandler(O);break;case"DebuggerStatement":_e=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(aa.NodeTypeSyntaxError,O.type,O)}return function(){var Xe=q.options.timeout;if(Xe&&Xe>0&&q.checkTimeout())throw q.createInternalThrowError(aa.ExecutionTimeOutError,Xe,null);return q.lastExecNode=O,_e.apply(void 0,arguments)}},A.binaryExpressionHandler=function(O){var q=this,_e=this.createClosure(O.left),Xe=this.createClosure(O.right);return function(){var ft=_e(),pt=Xe();switch(O.operator){case"==":return ft==pt;case"!=":return ft!=pt;case"===":return ft===pt;case"!==":return ft!==pt;case"<":return ft<pt;case"<=":return ft<=pt;case">":return ft>pt;case">=":return ft>=pt;case"<<":return ft<<pt;case">>":return ft>>pt;case">>>":return ft>>>pt;case"+":return ft+pt;case"-":return ft-pt;case"*":return ft*pt;case"**":return Math.pow(ft,pt);case"/":return ft/pt;case"%":return ft%pt;case"|":return ft|pt;case"^":return ft^pt;case"&":return ft&pt;case"in":return ft in pt;case"instanceof":return ft instanceof pt;default:throw q.createInternalThrowError(aa.BinaryOperatorSyntaxError,O.operator,O)}}},A.logicalExpressionHandler=function(O){var q=this,_e=this.createClosure(O.left),Xe=this.createClosure(O.right);return function(){switch(O.operator){case"||":return _e()||Xe();case"&&":return _e()&&Xe();default:throw q.createInternalThrowError(aa.LogicalOperatorSyntaxError,O.operator,O)}}},A.unaryExpressionHandler=function(O){var q=this;switch(O.operator){case"delete":var _e=this.createObjectGetter(O.argument),Xe=this.createNameGetter(O.argument);return function(){var sr=_e(),wn=Xe();return delete sr[wn]};default:var ft;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var pt=this.createObjectGetter(O.argument),ir=this.createNameGetter(O.argument);ft=function(){return pt()[ir()]}}else ft=this.createClosure(O.argument);return function(){var sr=ft();switch(O.operator){case"-":return-sr;case"+":return+sr;case"!":return!sr;case"~":return~sr;case"void":return;case"typeof":return typeof sr;default:throw q.createInternalThrowError(aa.UnaryOperatorSyntaxError,O.operator,O)}}}},A.updateExpressionHandler=function(O){var q=this,_e=this.createObjectGetter(O.argument),Xe=this.createNameGetter(O.argument);return function(){var ft=_e(),pt=Xe();switch(q.assertVariable(ft,pt,O),O.operator){case"++":return O.prefix?++ft[pt]:ft[pt]++;case"--":return O.prefix?--ft[pt]:ft[pt]--;default:throw q.createInternalThrowError(aa.UpdateOperatorSyntaxError,O.operator,O)}}},A.objectExpressionHandler=function(O){var q=this,_e=[];function Xe(pt){return pt.type==="Identifier"?pt.name:pt.type==="Literal"?pt.value:this.throwError(aa.ObjectStructureSyntaxError,pt.type,pt)}var ft=Object.create(null);return O.properties.forEach(function(pt){var ir=pt.kind,sr=Xe(pt.key);(!ft[sr]||ir==="init")&&(ft[sr]={}),ft[sr][ir]=q.createClosure(pt.value),_e.push({key:sr,property:pt})}),function(){for(var pt={},ir=_e.length,sr=0;sr<ir;sr++){var wn=_e[sr],ri=wn.key,On=ft[ri],Xi=On.init?On.init():void 0,da=On.get?On.get():function(){},wa=On.set?On.set():function(Uu){};if("set"in On||"get"in On){var ji={configurable:!0,enumerable:!0,get:da,set:wa};Object.defineProperty(pt,ri,ji)}else{var ys=wn.property,tu=ys.kind;ys.key.type==="Identifier"&&ys.value.type==="FunctionExpression"&&tu==="init"&&!ys.value.id&&Sl(Xi,ys.key.name),pt[ri]=Xi}}return pt}},A.arrayExpressionHandler=function(O){var q=this,_e=O.elements.map(function(Xe){return Xe&&q.createClosure(Xe)});return function(){for(var Xe=_e.length,ft=Array(Xe),pt=0;pt<Xe;pt++){var ir=_e[pt];ir&&(ft[pt]=ir())}return ft}},A.safeObjectGet=function(O,q,_e){return O[q]},A.createCallFunctionGetter=function(O){var q=this;switch(O.type){case"MemberExpression":var _e=this.createClosure(O.object),Xe=this.createMemberKeyGetter(O),ft=this.source;return function(){var ir=_e(),sr=Xe(),wn=q.safeObjectGet(ir,sr,O);if(!wn||!ka(wn)){var ri=ft.slice(O.start,O.end);throw q.createInternalThrowError(aa.FunctionUndefinedReferenceError,ri,O)}return wn.__IS_EVAL_FUNC?function(On){return wn(new za(q),On,!0)}:wn.__IS_FUNCTION_FUNC?function(){for(var On=arguments.length,Xi=new Array(On),da=0;da<On;da++)Xi[da]=arguments[da];return wn.apply(void 0,[new za(q)].concat(Xi))}:wn.bind(ir)};default:var pt=this.createClosure(O);return function(){var ir="";O.type==="Identifier"&&(ir=O.name);var sr=pt();if(!sr||!ka(sr))throw q.createInternalThrowError(aa.FunctionUndefinedReferenceError,ir,O);if(O.type==="Identifier"&&sr.__IS_EVAL_FUNC&&ir==="eval")return function(On){var Xi=q.getScopeFromName(ir,q.getCurrentScope()),da=Xi.name===Tn||Xi.name===ro||Xi.name===Pi;return sr(new za(q),On,!da)};if(sr.__IS_EVAL_FUNC)return function(On){return sr(new za(q),On,!0)};if(sr.__IS_FUNCTION_FUNC)return function(){for(var On=arguments.length,Xi=new Array(On),da=0;da<On;da++)Xi[da]=arguments[da];return sr.apply(void 0,[new za(q)].concat(Xi))};var wn=q.options.globalContextInFunction;if(O.type==="Identifier"){var ri=q.getIdentifierScope(O);ri.name===Ir&&(wn=ri.data)}return sr.bind(wn)}}},A.callExpressionHandler=function(O){var q=this,_e=this.createCallFunctionGetter(O.callee),Xe=O.arguments.map(function(ft){return q.createClosure(ft)});return function(){return _e().apply(void 0,Xe.map(function(ft){return ft()}))}},A.functionExpressionHandler=function(O){var q=this,_e=this,Xe=this.source,ft=this.collectDeclVars,pt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var ir=O.id?O.id.name:"",sr=O.params.length,wn=O.params.map(function(da){return q.createParamNameGetter(da)}),ri=this.createClosure(O.body),On=this.collectDeclVars,Xi=this.collectDeclFuncs;return this.collectDeclVars=ft,this.collectDeclFuncs=pt,function(){var da=_e.getCurrentScope(),wa=function ji(){for(var ys=arguments.length,tu=new Array(ys),Uu=0;Uu<ys;Uu++)tu[Uu]=arguments[Uu];_e.callStack.push(""+ir);var tf=_e.getCurrentScope(),al=eu(da,"FunctionScope("+ir+")");_e.setCurrentScope(al),_e.addDeclarationsToScope(On,Xi,al),ir&&(al.data[ir]=ji),al.data.arguments=arguments,wn.forEach(function(Au,Cu){al.data[Au()]=tu[Cu]});var Cc=_e.getCurrentContext();_e.setCurrentContext(this);var Tu=ri();if(_e.setCurrentContext(Cc),_e.setCurrentScope(tf),_e.callStack.pop(),Tu instanceof oo)return Tu.value};return Sl(wa,ir),Object.defineProperty(wa,"length",{value:sr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(wa,"toString",{value:function(){return Xe.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(wa,"valueOf",{value:function(){return Xe.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),wa}},A.newExpressionHandler=function(O){var q=this,_e=this.source,Xe=this.createClosure(O.callee),ft=O.arguments.map(function(pt){return q.createClosure(pt)});return function(){var pt=Xe();if(!ka(pt)||pt.__IS_EVAL_FUNC){var ir=O.callee,sr=_e.slice(ir.start,ir.end);throw q.createInternalThrowError(aa.IsNotConstructor,sr,O)}return pt.__IS_FUNCTION_FUNC?pt.apply(void 0,[new za(q)].concat(ft.map(function(wn){return wn()}))):Fo(pt,ft.map(function(wn){return wn()}))}},A.memberExpressionHandler=function(O){var q=this.createClosure(O.object),_e=this.createMemberKeyGetter(O);return function(){var Xe=q(),ft=_e();return Xe[ft]}},A.thisExpressionHandler=function(O){var q=this;return function(){return q.getCurrentContext()}},A.sequenceExpressionHandler=function(O){var q=this,_e=O.expressions.map(function(Xe){return q.createClosure(Xe)});return function(){for(var Xe,ft=_e.length,pt=0;pt<ft;pt++){var ir=_e[pt];Xe=ir()}return Xe}},A.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},A.identifierHandler=function(O){var q=this;return function(){var _e=q.getCurrentScope(),Xe=q.getScopeDataFromName(O.name,_e);return q.assertVariable(Xe,O.name,O),Xe[O.name]}},A.getIdentifierScope=function(O){var q=this.getCurrentScope(),_e=this.getScopeFromName(O.name,q);return _e},A.assignmentExpressionHandler=function(O){var q=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var _e=this.createObjectGetter(O.left),Xe=this.createNameGetter(O.left),ft=this.createClosure(O.right);return function(){var pt=_e(),ir=Xe(),sr=ft();switch(O.operator!=="="&&q.assertVariable(pt,ir,O),O.operator){case"=":return pt[ir]=sr;case"+=":return pt[ir]+=sr;case"-=":return pt[ir]-=sr;case"*=":return pt[ir]*=sr;case"**=":return pt[ir]=Math.pow(pt[ir],sr);case"/=":return pt[ir]/=sr;case"%=":return pt[ir]%=sr;case"<<=":return pt[ir]<<=sr;case">>=":return pt[ir]>>=sr;case">>>=":return pt[ir]>>>=sr;case"&=":return pt[ir]&=sr;case"^=":return pt[ir]^=sr;case"|=":return pt[ir]|=sr;default:throw q.createInternalThrowError(aa.AssignmentExpressionSyntaxError,O.type,O)}}},A.functionDeclarationHandler=function(O){if(O.id){var q=this.functionExpressionHandler(O);Object.defineProperty(q,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,q)}return function(){return Ct}},A.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(aa.VariableTypeSyntaxError,O.type,O)},A.variableDeclarationHandler=function(O){for(var q=this,_e,Xe=[],ft=0;ft<O.declarations.length;ft++){var pt=O.declarations[ft];this.varDeclaration(this.getVariableName(pt.id)),pt.init&&Xe.push({type:"AssignmentExpression",operator:"=",left:pt.id,right:pt.init})}return Xe.length&&(_e=this.createClosure({type:"BlockStatement",body:Xe})),function(){if(_e){var ir=q.isVarDeclMode;q.isVarDeclMode=!0,_e(),q.isVarDeclMode=ir}return Ct}},A.assertVariable=function(O,q,_e){if(O===this.globalScope.data&&!(q in O))throw this.createInternalThrowError(aa.VariableUndefinedReferenceError,q,_e)},A.programHandler=function(O){var q=this,_e=O.body.map(function(Xe){return q.createClosure(Xe)});return function(){for(var Xe=Ct,ft=0;ft<_e.length;ft++){var pt=_e[ft],ir=q.setValue(pt());if(ir!==Ct&&(Xe=ir,Xe instanceof oo||Xe instanceof Eo||Xe instanceof ms||Xe===ae||Xe===xe))break}return Xe}},A.expressionStatementHandler=function(O){return this.createClosure(O.expression)},A.emptyStatementHandler=function(O){return function(){return Ct}},A.returnStatementHandler=function(O){var q=O.argument?this.createClosure(O.argument):Fs;return function(){return new oo(q())}},A.ifStatementHandler=function(O){var q=this.createClosure(O.test),_e=this.createClosure(O.consequent),Xe=O.alternate?this.createClosure(O.alternate):function(){return Ct};return function(){return q()?_e():Xe()}},A.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},A.forStatementHandler=function(O){var q=this,_e=Fs,Xe=O.test?this.createClosure(O.test):function(){return!0},ft=Fs,pt=this.createClosure(O.body);return O.type==="ForStatement"&&(_e=O.init?this.createClosure(O.init):_e,ft=O.update?this.createClosure(O.update):Fs),function(ir){var sr,wn=Ct,ri=O.type==="DoWhileStatement";for(ir&&ir.type==="LabeledStatement"&&(sr=ir.label.name),_e();ri||Xe();ft()){ri=!1;var On=q.setValue(pt());if(!(On===Ct||On===xe)){if(On===ae)break;if(wn=On,wn instanceof ms&&wn.value===sr){wn=Ct;continue}if(wn instanceof oo||wn instanceof Eo||wn instanceof ms)break}}return wn}},A.whileStatementHandler=function(O){return this.forStatementHandler(O)},A.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},A.forInStatementHandler=function(O){var q=this,_e=O.left,Xe=this.createClosure(O.right),ft=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),_e=O.left.declarations[0].id),function(pt){var ir,sr=Ct,wn;pt&&pt.type==="LabeledStatement"&&(ir=pt.label.name);var ri=Xe();for(wn in ri){q.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:_e,right:{type:"Literal",value:wn}})();var On=q.setValue(ft());if(!(On===Ct||On===xe)){if(On===ae)break;if(sr=On,sr instanceof ms&&sr.value===ir){sr=Ct;continue}if(sr instanceof oo||sr instanceof Eo||sr instanceof ms)break}}return sr}},A.withStatementHandler=function(O){var q=this,_e=this.createClosure(O.object),Xe=this.createClosure(O.body);return function(){var ft=_e(),pt=q.getCurrentScope(),ir=new Ms(ft,pt,Ir);q.setCurrentScope(ir);var sr=q.setValue(Xe());return q.setCurrentScope(pt),sr}},A.throwStatementHandler=function(O){var q=this,_e=this.createClosure(O.argument);return function(){throw q.setValue(void 0),_e()}},A.tryStatementHandler=function(O){var q=this,_e=this.createClosure(O.block),Xe=O.handler?this.catchClauseHandler(O.handler):null,ft=O.finalizer?this.createClosure(O.finalizer):null;return function(){var pt=q.getCurrentScope(),ir=q.getCurrentContext(),sr=pt.labelStack.concat([]),wn=q.callStack.concat([]),ri=Ct,On,Xi,da=function(){q.setCurrentScope(pt),q.setCurrentContext(ir),pt.labelStack=sr,q.callStack=wn};try{ri=q.setValue(_e()),ri instanceof oo&&(On=ri)}catch(wa){if(da(),q.isInterruptThrow(wa))throw wa;if(Xe)try{ri=q.setValue(Xe(wa)),ri instanceof oo&&(On=ri)}catch(ji){if(da(),q.isInterruptThrow(ji))throw ji;Xi=ji}}if(ft)try{ri=ft(),ri instanceof oo&&(On=ri)}catch(wa){if(da(),q.isInterruptThrow(wa))throw wa;Xi=wa}if(Xi)throw Xi;return On||ri}},A.catchClauseHandler=function(O){var q=this,_e=this.createParamNameGetter(O.param),Xe=this.createClosure(O.body);return function(ft){var pt,ir=q.getCurrentScope(),sr=ir.data,wn=_e(),ri=ds.call(sr,wn),On=sr[wn];return sr[wn]=ft,pt=Xe(),ri?sr[wn]=On:delete sr[wn],pt}},A.continueStatementHandler=function(O){return function(){return O.label?new ms(O.label.name):xe}},A.breakStatementHandler=function(O){return function(){return O.label?new Eo(O.label.name):ae}},A.switchStatementHandler=function(O){var q=this,_e=this.createClosure(O.discriminant),Xe=O.cases.map(function(ft){return q.switchCaseHandler(ft)});return function(){for(var ft=_e(),pt=!1,ir,sr,wn,ri=0;ri<Xe.length;ri++){var On=Xe[ri](),Xi=On.testClosure();if(Xi===qe){wn=On;continue}if(pt||Xi===ft){if(pt=!0,sr=q.setValue(On.bodyClosure()),sr===Ct)continue;if(sr===ae||(ir=sr,ir instanceof oo||ir instanceof Eo||ir instanceof ms||ir===xe))break}}if(!pt&&wn){sr=q.setValue(wn.bodyClosure());var da=sr===Ct||sr===ae||sr===xe;da||(ir=sr)}return ir}},A.switchCaseHandler=function(O){var q=O.test?this.createClosure(O.test):function(){return qe},_e=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:q,bodyClosure:_e}}},A.labeledStatementHandler=function(O){var q=this,_e=O.label.name,Xe=this.createClosure(O.body);return function(){var ft,pt=q.getCurrentScope();return pt.labelStack.push(_e),ft=Xe(O),ft instanceof Eo&&ft.value===_e&&(ft=Ct),pt.labelStack.pop(),ft}},A.debuggerStatementHandler=function(O){return function(){debugger;return Ct}},A.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(aa.ParamTypeSyntaxError,O.type,O)},A.createObjectKeyGetter=function(O){var q;return O.type==="Identifier"?q=function(){return O.name}:q=this.createClosure(O),function(){return q()}},A.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},A.createObjectGetter=function(O){var q=this;switch(O.type){case"Identifier":return function(){return q.getScopeDataFromName(O.name,q.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(aa.AssignmentTypeSyntaxError,O.type,O)}},A.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(aa.AssignmentTypeSyntaxError,O.type,O)}},A.varDeclaration=function(O){var q=this.collectDeclVars;q[O]=void 0},A.funcDeclaration=function(O,q){var _e=this.collectDeclFuncs;_e[O]=q},A.addDeclarationsToScope=function(O,q,_e){var Xe=_e.data;for(var ft in q){var pt=q[ft];Xe[ft]=pt&&pt()}for(var ir in O)ir in Xe||(Xe[ir]=void 0)},A.getScopeValue=function(O,q){var _e=this.getScopeFromName(O,q);return _e.data[O]},A.getScopeDataFromName=function(O,q){return this.getScopeFromName(O,q).data},A.getScopeFromName=function(O,q){var _e=q;do if(O in _e.data)return _e;while(_e=_e.parent);return this.globalScope},A.setValue=function(O){var q=this.callStack.length;return this.isVarDeclMode||q||O===Ct||O===ae||O===xe||O instanceof Eo||O instanceof ms||(this.value=O instanceof oo?O.value:O),O},A.getValue=function(){return this.value},g}();_a.version=Cs,_a.eval=jo,_a.Function=vs,_a.ecmaVersion=5,_a.globalContextInFunction=void 0,_a.global=Object.create(null);function ns(g){return g===void 0&&(g=Object.create(null)),g}function ef(g,A,N){A===void 0&&(A=[]),N===void 0&&(N={});var O=N.parsingContext,q=N.timeout===void 0?0:N.timeout,_e=`
    (function anonymous(`+A.join(",")+`){
         `+g+`
    });
    `,Xe=new _a(O,{ecmaVersion:N.ecmaVersion,timeout:q,rootContext:N.rootContext,globalContextInFunction:N.globalContextInFunction});return Xe.evaluate(_e)}function wl(g,A,N){var O=new _a(A,N);return O.evaluate(g)}var Hs=wl,Jl=function(){function g(N){this._code=N}var A=g.prototype;return A.runInContext=function(O){return wl(this._code,O)},A.runInNewContext=function(O){return wl(this._code,O)},g}(),zu=function(g,A,N){return wl(g,A,N)};function Ws(){for(var g=arguments.length,A=new Array(g),N=0;N<g;N++)A[N]=arguments[N];var O=A.pop();return ef(O||"",A)}var il=zu},20396:function(Ue,W,L){var X;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(j,m,J,F){"use strict";var $=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",re=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),ie=$||re,ne=["","webkit","Moz","MS","ms","o"],Le=ie?"":m.createElement("div"),Ie="function",He=Math.round,Rt=Math.abs,$t=Date.now;function ht(ae,xe,qe){return setTimeout(at(ae,qe),xe)}function Ut(ae,xe,qe){return Array.isArray(ae)?(dt(ae,qe[xe],qe),!0):!1}function dt(ae,xe,qe){var Ct;if(!!ae)if(ae.forEach)ae.forEach(xe,qe);else if(ae.length!==F)for(Ct=0;Ct<ae.length;)xe.call(qe,ae[Ct],Ct,ae),Ct++;else for(Ct in ae)ae.hasOwnProperty(Ct)&&xe.call(qe,ae[Ct],Ct,ae)}function nt(ae,xe,qe){var Ct="DEPRECATED METHOD: "+xe+`
`+qe+` AT 
`;return function(){var Ir=new Error("get-stack-trace"),Tn=Ir&&Ir.stack?Ir.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Pi=j.console&&(j.console.warn||j.console.log);return Pi&&Pi.call(j.console,Ct,Tn),ae.apply(this,arguments)}}var rt;typeof Object.assign!="function"?rt=function(xe){if(xe===F||xe===null)throw new TypeError("Cannot convert undefined or null to object");for(var qe=Object(xe),Ct=1;Ct<arguments.length;Ct++){var Ir=arguments[Ct];if(Ir!==F&&Ir!==null)for(var Tn in Ir)Ir.hasOwnProperty(Tn)&&(qe[Tn]=Ir[Tn])}return qe}:rt=Object.assign;var er=nt(function(xe,qe,Ct){for(var Ir=Object.keys(qe),Tn=0;Tn<Ir.length;)(!Ct||Ct&&xe[Ir[Tn]]===F)&&(xe[Ir[Tn]]=qe[Ir[Tn]]),Tn++;return xe},"extend","Use `assign`."),K=nt(function(xe,qe){return er(xe,qe,!0)},"merge","Use `assign`.");function Ht(ae,xe,qe){var Ct=xe.prototype,Ir;Ir=ae.prototype=Object.create(Ct),Ir.constructor=ae,Ir._super=Ct,qe&&rt(Ir,qe)}function at(ae,xe){return function(){return ae.apply(xe,arguments)}}function Ye(ae,xe){return typeof ae==Ie?ae.apply(xe&&xe[0]||F,xe):ae}function ut(ae,xe){return ae===F?xe:ae}function Je(ae,xe,qe){dt(jr(xe),function(Ct){ae.addEventListener(Ct,qe,!1)})}function Ot(ae,xe,qe){dt(jr(xe),function(Ct){ae.removeEventListener(Ct,qe,!1)})}function dr(ae,xe){for(;ae;){if(ae==xe)return!0;ae=ae.parentNode}return!1}function Cr(ae,xe){return ae.indexOf(xe)>-1}function jr(ae){return ae.trim().split(/\s+/g)}function T(ae,xe,qe){if(ae.indexOf&&!qe)return ae.indexOf(xe);for(var Ct=0;Ct<ae.length;){if(qe&&ae[Ct][qe]==xe||!qe&&ae[Ct]===xe)return Ct;Ct++}return-1}function we(ae){return Array.prototype.slice.call(ae,0)}function De(ae,xe,qe){for(var Ct=[],Ir=[],Tn=0;Tn<ae.length;){var Pi=xe?ae[Tn][xe]:ae[Tn];T(Ir,Pi)<0&&Ct.push(ae[Tn]),Ir[Tn]=Pi,Tn++}return qe&&(xe?Ct=Ct.sort(function(ka,za){return ka[xe]>za[xe]}):Ct=Ct.sort()),Ct}function bt(ae,xe){for(var qe,Ct,Ir=xe[0].toUpperCase()+xe.slice(1),Tn=0;Tn<ne.length;){if(qe=ne[Tn],Ct=qe?qe+Ir:xe,Ct in ae)return Ct;Tn++}return F}var mt=1;function Lt(){return mt++}function Yt(ae){var xe=ae.ownerDocument||ae;return xe.defaultView||xe.parentWindow||j}var br=/mobile|tablet|ip(ad|hone|od)|android/i,Kn="ontouchstart"in j,cn=bt(j,"PointerEvent")!==F,li=Kn&&br.test(navigator.userAgent),Vn="touch",ti="pen",ci="mouse",Hn="kinect",fi=25,ua=1,Vi=2,ki=4,Ki=8,la=1,Ai=2,ma=4,Xn=8,bi=16,zi=Ai|ma,qi=Xn|bi,ko=zi|qi,de=["x","y"],Ln=["clientX","clientY"];function Za(ae,xe){var qe=this;this.manager=ae,this.callback=xe,this.element=ae.element,this.target=ae.options.inputTarget,this.domHandler=function(Ct){Ye(ae.options.enable,[ae])&&qe.handler(Ct)},this.init()}Za.prototype={handler:function(){},init:function(){this.evEl&&Je(this.element,this.evEl,this.domHandler),this.evTarget&&Je(this.target,this.evTarget,this.domHandler),this.evWin&&Je(Yt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ot(this.element,this.evEl,this.domHandler),this.evTarget&&Ot(this.target,this.evTarget,this.domHandler),this.evWin&&Ot(Yt(this.element),this.evWin,this.domHandler)}};function rs(ae){var xe,qe=ae.options.inputClass;return qe?xe=qe:cn?xe=Pe:li?xe=Dt:Kn?xe=Tt:xe=xa,new xe(ae,kt)}function kt(ae,xe,qe){var Ct=qe.pointers.length,Ir=qe.changedPointers.length,Tn=xe&ua&&Ct-Ir==0,Pi=xe&(ki|Ki)&&Ct-Ir==0;qe.isFirst=!!Tn,qe.isFinal=!!Pi,Tn&&(ae.session={}),qe.eventType=xe,tr(ae,qe),ae.emit("hammer.input",qe),ae.recognize(qe),ae.session.prevInput=qe}function tr(ae,xe){var qe=ae.session,Ct=xe.pointers,Ir=Ct.length;qe.firstInput||(qe.firstInput=xn(xe)),Ir>1&&!qe.firstMultiple?qe.firstMultiple=xn(xe):Ir===1&&(qe.firstMultiple=!1);var Tn=qe.firstInput,Pi=qe.firstMultiple,ro=Pi?Pi.center:Tn.center,ka=xe.center=kn(Ct);xe.timeStamp=$t(),xe.deltaTime=xe.timeStamp-Tn.timeStamp,xe.angle=Di(ro,ka),xe.distance=an(ro,ka),Sr(qe,xe),xe.offsetDirection=qn(xe.deltaX,xe.deltaY);var za=hi(xe.deltaTime,xe.deltaX,xe.deltaY);xe.overallVelocityX=za.x,xe.overallVelocityY=za.y,xe.overallVelocity=Rt(za.x)>Rt(za.y)?za.x:za.y,xe.scale=Pi?to(Pi.pointers,Ct):1,xe.rotation=Pi?Oi(Pi.pointers,Ct):0,xe.maxPointers=qe.prevInput?xe.pointers.length>qe.prevInput.maxPointers?xe.pointers.length:qe.prevInput.maxPointers:xe.pointers.length,qr(qe,xe);var jo=ae.element;dr(xe.srcEvent.target,jo)&&(jo=xe.srcEvent.target),xe.target=jo}function Sr(ae,xe){var qe=xe.center,Ct=ae.offsetDelta||{},Ir=ae.prevDelta||{},Tn=ae.prevInput||{};(xe.eventType===ua||Tn.eventType===ki)&&(Ir=ae.prevDelta={x:Tn.deltaX||0,y:Tn.deltaY||0},Ct=ae.offsetDelta={x:qe.x,y:qe.y}),xe.deltaX=Ir.x+(qe.x-Ct.x),xe.deltaY=Ir.y+(qe.y-Ct.y)}function qr(ae,xe){var qe=ae.lastInterval||xe,Ct=xe.timeStamp-qe.timeStamp,Ir,Tn,Pi,ro;if(xe.eventType!=Ki&&(Ct>fi||qe.velocity===F)){var ka=xe.deltaX-qe.deltaX,za=xe.deltaY-qe.deltaY,jo=hi(Ct,ka,za);Tn=jo.x,Pi=jo.y,Ir=Rt(jo.x)>Rt(jo.y)?jo.x:jo.y,ro=qn(ka,za),ae.lastInterval=xe}else Ir=qe.velocity,Tn=qe.velocityX,Pi=qe.velocityY,ro=qe.direction;xe.velocity=Ir,xe.velocityX=Tn,xe.velocityY=Pi,xe.direction=ro}function xn(ae){for(var xe=[],qe=0;qe<ae.pointers.length;)xe[qe]={clientX:He(ae.pointers[qe].clientX),clientY:He(ae.pointers[qe].clientY)},qe++;return{timeStamp:$t(),pointers:xe,center:kn(xe),deltaX:ae.deltaX,deltaY:ae.deltaY}}function kn(ae){var xe=ae.length;if(xe===1)return{x:He(ae[0].clientX),y:He(ae[0].clientY)};for(var qe=0,Ct=0,Ir=0;Ir<xe;)qe+=ae[Ir].clientX,Ct+=ae[Ir].clientY,Ir++;return{x:He(qe/xe),y:He(Ct/xe)}}function hi(ae,xe,qe){return{x:xe/ae||0,y:qe/ae||0}}function qn(ae,xe){return ae===xe?la:Rt(ae)>=Rt(xe)?ae<0?Ai:ma:xe<0?Xn:bi}function an(ae,xe,qe){qe||(qe=de);var Ct=xe[qe[0]]-ae[qe[0]],Ir=xe[qe[1]]-ae[qe[1]];return Math.sqrt(Ct*Ct+Ir*Ir)}function Di(ae,xe,qe){qe||(qe=de);var Ct=xe[qe[0]]-ae[qe[0]],Ir=xe[qe[1]]-ae[qe[1]];return Math.atan2(Ir,Ct)*180/Math.PI}function Oi(ae,xe){return Di(xe[1],xe[0],Ln)+Di(ae[1],ae[0],Ln)}function to(ae,xe){return an(xe[0],xe[1],Ln)/an(ae[0],ae[1],Ln)}var ps={mousedown:ua,mousemove:Vi,mouseup:ki},Zo="mousedown",Na="mousemove mouseup";function xa(){this.evEl=Zo,this.evWin=Na,this.pressed=!1,Za.apply(this,arguments)}Ht(xa,Za,{handler:function(xe){var qe=ps[xe.type];qe&ua&&xe.button===0&&(this.pressed=!0),qe&Vi&&xe.which!==1&&(qe=ki),!!this.pressed&&(qe&ki&&(this.pressed=!1),this.callback(this.manager,qe,{pointers:[xe],changedPointers:[xe],pointerType:ci,srcEvent:xe}))}});var G={pointerdown:ua,pointermove:Vi,pointerup:ki,pointercancel:Ki,pointerout:Ki},Q={2:Vn,3:ti,4:ci,5:Hn},oe="pointerdown",ge="pointermove pointerup pointercancel";!ie&&j.MSPointerEvent&&!j.PointerEvent&&(oe="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel");function Pe(){this.evEl=oe,this.evWin=ge,Za.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Ht(Pe,Za,{handler:function(xe){var qe=this.store,Ct=!1,Ir=xe.type.toLowerCase().replace("ms",""),Tn=G[Ir],Pi=Q[xe.pointerType]||xe.pointerType,ro=Pi==Vn,ka=T(qe,xe.pointerId,"pointerId");Tn&ua&&(xe.button===0||ro)?ka<0&&(qe.push(xe),ka=qe.length-1):Tn&(ki|Ki)&&(Ct=!0),!(ka<0)&&(qe[ka]=xe,this.callback(this.manager,Tn,{pointers:qe,changedPointers:[xe],pointerType:Pi,srcEvent:xe}),Ct&&qe.splice(ka,1))}});var Ge={touchstart:ua,touchmove:Vi,touchend:ki,touchcancel:Ki},et="touchstart",fe="touchstart touchmove touchend touchcancel";function ke(){this.evTarget=et,this.evWin=fe,this.started=!1,Za.apply(this,arguments)}Ht(ke,Za,{handler:function(xe){var qe=Ge[xe.type];if(qe===ua&&(this.started=!0),!!this.started){var Ct=vt.call(this,xe,qe);qe&(ki|Ki)&&Ct[0].length-Ct[1].length==0&&(this.started=!1),this.callback(this.manager,qe,{pointers:Ct[0],changedPointers:Ct[1],pointerType:Vn,srcEvent:xe})}}});function vt(ae,xe){var qe=we(ae.touches),Ct=we(ae.changedTouches);return xe&(ki|Ki)&&(qe=De(qe.concat(Ct),"identifier",!0)),[qe,Ct]}var hr={touchstart:ua,touchmove:Vi,touchend:ki,touchcancel:Ki},Pt="touchstart touchmove touchend touchcancel";function Dt(){this.evTarget=Pt,this.targetIds={},Za.apply(this,arguments)}Ht(Dt,Za,{handler:function(xe){var qe=hr[xe.type],Ct=pr.call(this,xe,qe);!Ct||this.callback(this.manager,qe,{pointers:Ct[0],changedPointers:Ct[1],pointerType:Vn,srcEvent:xe})}});function pr(ae,xe){var qe=we(ae.touches),Ct=this.targetIds;if(xe&(ua|Vi)&&qe.length===1)return Ct[qe[0].identifier]=!0,[qe,qe];var Ir,Tn,Pi=we(ae.changedTouches),ro=[],ka=this.target;if(Tn=qe.filter(function(za){return dr(za.target,ka)}),xe===ua)for(Ir=0;Ir<Tn.length;)Ct[Tn[Ir].identifier]=!0,Ir++;for(Ir=0;Ir<Pi.length;)Ct[Pi[Ir].identifier]&&ro.push(Pi[Ir]),xe&(ki|Ki)&&delete Ct[Pi[Ir].identifier],Ir++;if(!!ro.length)return[De(Tn.concat(ro),"identifier",!0),ro]}var mn=2500,un=25;function Tt(){Za.apply(this,arguments);var ae=at(this.handler,this);this.touch=new Dt(this.manager,ae),this.mouse=new xa(this.manager,ae),this.primaryTouch=null,this.lastTouches=[]}Ht(Tt,Za,{handler:function(xe,qe,Ct){var Ir=Ct.pointerType==Vn,Tn=Ct.pointerType==ci;if(!(Tn&&Ct.sourceCapabilities&&Ct.sourceCapabilities.firesTouchEvents)){if(Ir)$r.call(this,qe,Ct);else if(Tn&&Gr.call(this,Ct))return;this.callback(xe,qe,Ct)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function $r(ae,xe){ae&ua?(this.primaryTouch=xe.changedPointers[0].identifier,Fr.call(this,xe)):ae&(ki|Ki)&&Fr.call(this,xe)}function Fr(ae){var xe=ae.changedPointers[0];if(xe.identifier===this.primaryTouch){var qe={x:xe.clientX,y:xe.clientY};this.lastTouches.push(qe);var Ct=this.lastTouches,Ir=function(){var Tn=Ct.indexOf(qe);Tn>-1&&Ct.splice(Tn,1)};setTimeout(Ir,mn)}}function Gr(ae){for(var xe=ae.srcEvent.clientX,qe=ae.srcEvent.clientY,Ct=0;Ct<this.lastTouches.length;Ct++){var Ir=this.lastTouches[Ct],Tn=Math.abs(xe-Ir.x),Pi=Math.abs(qe-Ir.y);if(Tn<=un&&Pi<=un)return!0}return!1}var vi=ie?F:bt(Le.style,"touchAction"),Jr=vi!==F,Pn="compute",Wi="auto",pi="manipulation",Ci="none",_i="pan-x",St="pan-y",Kt=Mi();function Ca(ae,xe){this.manager=ae,this.set(xe)}Ca.prototype={set:function(ae){ae==Pn&&(ae=this.compute()),Jr&&this.manager.element.style&&Kt[ae]&&(this.manager.element.style[vi]=ae),this.actions=ae.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ae=[];return dt(this.manager.recognizers,function(xe){Ye(xe.options.enable,[xe])&&(ae=ae.concat(xe.getTouchAction()))}),Ei(ae.join(" "))},preventDefaults:function(ae){var xe=ae.srcEvent,qe=ae.offsetDirection;if(this.manager.session.prevented){xe.preventDefault();return}var Ct=this.actions,Ir=Cr(Ct,Ci)&&!Kt[Ci],Tn=Cr(Ct,St)&&!Kt[St],Pi=Cr(Ct,_i)&&!Kt[_i];if(Ir){var ro=ae.pointers.length===1,ka=ae.distance<2,za=ae.deltaTime<250;if(ro&&ka&&za)return}if(!(Pi&&Tn)&&(Ir||Tn&&qe&zi||Pi&&qe&qi))return this.preventSrc(xe)},preventSrc:function(ae){this.manager.session.prevented=!0,ae.preventDefault()}};function Ei(ae){if(Cr(ae,Ci))return Ci;var xe=Cr(ae,_i),qe=Cr(ae,St);return xe&&qe?Ci:xe||qe?xe?_i:St:Cr(ae,pi)?pi:Wi}function Mi(){if(!Jr)return!1;var ae={};if(ie)return ae;var xe=j.CSS&&j.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(qe){ae[qe]=xe?j.CSS.supports("touch-action",qe):!0}),ae}var Ui=1,Wr=2,Sn=4,zt=8,na=zt,be=16,Ko=32;function Qi(ae){this.options=rt({},this.defaults,ae||{}),this.id=Lt(),this.manager=null,this.options.enable=ut(this.options.enable,!0),this.state=Ui,this.simultaneous={},this.requireFail=[]}Qi.prototype={defaults:{},set:function(ae){return rt(this.options,ae),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ae){if(Ut(ae,"recognizeWith",this))return this;var xe=this.simultaneous;return ae=Ma(ae,this),xe[ae.id]||(xe[ae.id]=ae,ae.recognizeWith(this)),this},dropRecognizeWith:function(ae){return Ut(ae,"dropRecognizeWith",this)?this:(ae=Ma(ae,this),delete this.simultaneous[ae.id],this)},requireFailure:function(ae){if(Ut(ae,"requireFailure",this))return this;var xe=this.requireFail;return ae=Ma(ae,this),T(xe,ae)===-1&&(xe.push(ae),ae.requireFailure(this)),this},dropRequireFailure:function(ae){if(Ut(ae,"dropRequireFailure",this))return this;ae=Ma(ae,this);var xe=T(this.requireFail,ae);return xe>-1&&this.requireFail.splice(xe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ae){return!!this.simultaneous[ae.id]},emit:function(ae){var xe=this,qe=this.state;function Ct(Ir){xe.manager.emit(Ir,ae)}qe<zt&&Ct(xe.options.event+fu(qe)),Ct(xe.options.event),ae.additionalEvent&&Ct(ae.additionalEvent),qe>=zt&&Ct(xe.options.event+fu(qe))},tryEmit:function(ae){if(this.canEmit())return this.emit(ae);this.state=Ko},canEmit:function(){for(var ae=0;ae<this.requireFail.length;){if(!(this.requireFail[ae].state&(Ko|Ui)))return!1;ae++}return!0},recognize:function(ae){var xe=rt({},ae);if(!Ye(this.options.enable,[this,xe])){this.reset(),this.state=Ko;return}this.state&(na|be|Ko)&&(this.state=Ui),this.state=this.process(xe),this.state&(Wr|Sn|zt|be)&&this.tryEmit(xe)},process:function(ae){},getTouchAction:function(){},reset:function(){}};function fu(ae){return ae&be?"cancel":ae&zt?"end":ae&Sn?"move":ae&Wr?"start":""}function Ba(ae){return ae==bi?"down":ae==Xn?"up":ae==Ai?"left":ae==ma?"right":""}function Ma(ae,xe){var qe=xe.manager;return qe?qe.get(ae):ae}function Wa(){Qi.apply(this,arguments)}Ht(Wa,Qi,{defaults:{pointers:1},attrTest:function(ae){var xe=this.options.pointers;return xe===0||ae.pointers.length===xe},process:function(ae){var xe=this.state,qe=ae.eventType,Ct=xe&(Wr|Sn),Ir=this.attrTest(ae);return Ct&&(qe&Ki||!Ir)?xe|be:Ct||Ir?qe&ki?xe|zt:xe&Wr?xe|Sn:Wr:Ko}});function ia(){Wa.apply(this,arguments),this.pX=null,this.pY=null}Ht(ia,Wa,{defaults:{event:"pan",threshold:10,pointers:1,direction:ko},getTouchAction:function(){var ae=this.options.direction,xe=[];return ae&zi&&xe.push(St),ae&qi&&xe.push(_i),xe},directionTest:function(ae){var xe=this.options,qe=!0,Ct=ae.distance,Ir=ae.direction,Tn=ae.deltaX,Pi=ae.deltaY;return Ir&xe.direction||(xe.direction&zi?(Ir=Tn===0?la:Tn<0?Ai:ma,qe=Tn!=this.pX,Ct=Math.abs(ae.deltaX)):(Ir=Pi===0?la:Pi<0?Xn:bi,qe=Pi!=this.pY,Ct=Math.abs(ae.deltaY))),ae.direction=Ir,qe&&Ct>xe.threshold&&Ir&xe.direction},attrTest:function(ae){return Wa.prototype.attrTest.call(this,ae)&&(this.state&Wr||!(this.state&Wr)&&this.directionTest(ae))},emit:function(ae){this.pX=ae.deltaX,this.pY=ae.deltaY;var xe=Ba(ae.direction);xe&&(ae.additionalEvent=this.options.event+xe),this._super.emit.call(this,ae)}});function bo(){Wa.apply(this,arguments)}Ht(bo,Wa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ci]},attrTest:function(ae){return this._super.attrTest.call(this,ae)&&(Math.abs(ae.scale-1)>this.options.threshold||this.state&Wr)},emit:function(ae){if(ae.scale!==1){var xe=ae.scale<1?"in":"out";ae.additionalEvent=this.options.event+xe}this._super.emit.call(this,ae)}});function Vo(){Qi.apply(this,arguments),this._timer=null,this._input=null}Ht(Vo,Qi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Wi]},process:function(ae){var xe=this.options,qe=ae.pointers.length===xe.pointers,Ct=ae.distance<xe.threshold,Ir=ae.deltaTime>xe.time;if(this._input=ae,!Ct||!qe||ae.eventType&(ki|Ki)&&!Ir)this.reset();else if(ae.eventType&ua)this.reset(),this._timer=ht(function(){this.state=na,this.tryEmit()},xe.time,this);else if(ae.eventType&ki)return na;return Ko},reset:function(){clearTimeout(this._timer)},emit:function(ae){this.state===na&&(ae&&ae.eventType&ki?this.manager.emit(this.options.event+"up",ae):(this._input.timeStamp=$t(),this.manager.emit(this.options.event,this._input)))}});function wu(){Wa.apply(this,arguments)}Ht(wu,Wa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ci]},attrTest:function(ae){return this._super.attrTest.call(this,ae)&&(Math.abs(ae.rotation)>this.options.threshold||this.state&Wr)}});function fo(){Wa.apply(this,arguments)}Ht(fo,Wa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:zi|qi,pointers:1},getTouchAction:function(){return ia.prototype.getTouchAction.call(this)},attrTest:function(ae){var xe=this.options.direction,qe;return xe&(zi|qi)?qe=ae.overallVelocity:xe&zi?qe=ae.overallVelocityX:xe&qi&&(qe=ae.overallVelocityY),this._super.attrTest.call(this,ae)&&xe&ae.offsetDirection&&ae.distance>this.options.threshold&&ae.maxPointers==this.options.pointers&&Rt(qe)>this.options.velocity&&ae.eventType&ki},emit:function(ae){var xe=Ba(ae.offsetDirection);xe&&this.manager.emit(this.options.event+xe,ae),this.manager.emit(this.options.event,ae)}});function Do(){Qi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Ht(Do,Qi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[pi]},process:function(ae){var xe=this.options,qe=ae.pointers.length===xe.pointers,Ct=ae.distance<xe.threshold,Ir=ae.deltaTime<xe.time;if(this.reset(),ae.eventType&ua&&this.count===0)return this.failTimeout();if(Ct&&Ir&&qe){if(ae.eventType!=ki)return this.failTimeout();var Tn=this.pTime?ae.timeStamp-this.pTime<xe.interval:!0,Pi=!this.pCenter||an(this.pCenter,ae.center)<xe.posThreshold;this.pTime=ae.timeStamp,this.pCenter=ae.center,!Pi||!Tn?this.count=1:this.count+=1,this._input=ae;var ro=this.count%xe.taps;if(ro===0)return this.hasRequireFailures()?(this._timer=ht(function(){this.state=na,this.tryEmit()},xe.interval,this),Wr):na}return Ko},failTimeout:function(){return this._timer=ht(function(){this.state=Ko},this.options.interval,this),Ko},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==na&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function aa(ae,xe){return xe=xe||{},xe.recognizers=ut(xe.recognizers,aa.defaults.preset),new Ya(ae,xe)}aa.VERSION="2.0.7",aa.defaults={domEvents:!1,touchAction:Pn,enable:!0,inputTarget:null,inputClass:null,preset:[[wu,{enable:!1}],[bo,{enable:!1},["rotate"]],[fo,{direction:zi}],[ia,{direction:zi},["swipe"]],[Do],[Do,{event:"doubletap",taps:2},["tap"]],[Vo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Xa=1,Fo=2;function Ya(ae,xe){this.options=rt({},aa.defaults,xe||{}),this.options.inputTarget=this.options.inputTarget||ae,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ae,this.input=rs(this),this.touchAction=new Ca(this,this.options.touchAction),Cs(this,!0),dt(this.options.recognizers,function(qe){var Ct=this.add(new qe[0](qe[1]));qe[2]&&Ct.recognizeWith(qe[2]),qe[3]&&Ct.requireFailure(qe[3])},this)}Ya.prototype={set:function(ae){return rt(this.options,ae),ae.touchAction&&this.touchAction.update(),ae.inputTarget&&(this.input.destroy(),this.input.target=ae.inputTarget,this.input.init()),this},stop:function(ae){this.session.stopped=ae?Fo:Xa},recognize:function(ae){var xe=this.session;if(!xe.stopped){this.touchAction.preventDefaults(ae);var qe,Ct=this.recognizers,Ir=xe.curRecognizer;(!Ir||Ir&&Ir.state&na)&&(Ir=xe.curRecognizer=null);for(var Tn=0;Tn<Ct.length;)qe=Ct[Tn],xe.stopped!==Fo&&(!Ir||qe==Ir||qe.canRecognizeWith(Ir))?qe.recognize(ae):qe.reset(),!Ir&&qe.state&(Wr|Sn|zt)&&(Ir=xe.curRecognizer=qe),Tn++}},get:function(ae){if(ae instanceof Qi)return ae;for(var xe=this.recognizers,qe=0;qe<xe.length;qe++)if(xe[qe].options.event==ae)return xe[qe];return null},add:function(ae){if(Ut(ae,"add",this))return this;var xe=this.get(ae.options.event);return xe&&this.remove(xe),this.recognizers.push(ae),ae.manager=this,this.touchAction.update(),ae},remove:function(ae){if(Ut(ae,"remove",this))return this;if(ae=this.get(ae),ae){var xe=this.recognizers,qe=T(xe,ae);qe!==-1&&(xe.splice(qe,1),this.touchAction.update())}return this},on:function(ae,xe){if(ae!==F&&xe!==F){var qe=this.handlers;return dt(jr(ae),function(Ct){qe[Ct]=qe[Ct]||[],qe[Ct].push(xe)}),this}},off:function(ae,xe){if(ae!==F){var qe=this.handlers;return dt(jr(ae),function(Ct){xe?qe[Ct]&&qe[Ct].splice(T(qe[Ct],xe),1):delete qe[Ct]}),this}},emit:function(ae,xe){this.options.domEvents&&Sl(ae,xe);var qe=this.handlers[ae]&&this.handlers[ae].slice();if(!(!qe||!qe.length)){xe.type=ae,xe.preventDefault=function(){xe.srcEvent.preventDefault()};for(var Ct=0;Ct<qe.length;)qe[Ct](xe),Ct++}},destroy:function(){this.element&&Cs(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Cs(ae,xe){var qe=ae.element;if(!!qe.style){var Ct;dt(ae.options.cssProps,function(Ir,Tn){Ct=bt(qe.style,Tn),xe?(ae.oldCssProps[Ct]=qe.style[Ct],qe.style[Ct]=Ir):qe.style[Ct]=ae.oldCssProps[Ct]||""}),xe||(ae.oldCssProps={})}}function Sl(ae,xe){if(!ie){var qe=m.createEvent("Event");qe.initEvent(ae,!0,!0),qe.gesture=xe,xe.target.dispatchEvent(qe)}}if(!ie){rt(aa,{INPUT_START:ua,INPUT_MOVE:Vi,INPUT_END:ki,INPUT_CANCEL:Ki,STATE_POSSIBLE:Ui,STATE_BEGAN:Wr,STATE_CHANGED:Sn,STATE_ENDED:zt,STATE_RECOGNIZED:na,STATE_CANCELLED:be,STATE_FAILED:Ko,DIRECTION_NONE:la,DIRECTION_LEFT:Ai,DIRECTION_RIGHT:ma,DIRECTION_UP:Xn,DIRECTION_DOWN:bi,DIRECTION_HORIZONTAL:zi,DIRECTION_VERTICAL:qi,DIRECTION_ALL:ko,Manager:Ya,Input:Za,TouchAction:Ca,TouchInput:Dt,MouseInput:xa,PointerEventInput:Pe,TouchMouseInput:Tt,SingleTouchInput:ke,Recognizer:Qi,AttrRecognizer:Wa,Tap:Do,Pan:ia,Swipe:fo,Pinch:bo,Rotate:wu,Press:Vo,on:Je,off:Ot,each:dt,merge:K,extend:er,assign:rt,inherit:Ht,bindFn:at,prefixed:bt});var ds=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ds.Hammer=aa,X=function(){return aa}.call(W,L,W,Ue),X!==F&&(Ue.exports=X)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Ue,W,L){(function(X,j){Ue.exports=j(L(18857))})(this,function(X){"use strict";var j=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},m=function(B,me){for(var Ne=Object.keys(me),It=0;It<Ne.length;++It)B[Ne[It]]=me[Ne[It]];return B},J=`
`;function F(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function $(B){var me=new Error("(regl) "+B);throw console.error(me),me}function re(B,me){B||$(me)}function ie(B){return B?": "+B:""}function ne(B,me,Ne){B in me||$("unknown parameter ("+B+")"+ie(Ne)+". possible values: "+Object.keys(me).join())}function Le(B,me){j(B)||$("invalid parameter type"+ie(me)+". must be a typed array")}function Ie(B,me){switch(me){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function He(B,me,Ne){Ie(B,me)||$("invalid parameter type"+ie(Ne)+". expected "+me+", got "+typeof B)}function Rt(B,me){B>=0&&(B|0)===B||$("invalid parameter type, ("+B+")"+ie(me)+". must be a nonnegative integer")}function $t(B,me,Ne){me.indexOf(B)<0&&$("invalid value"+ie(Ne)+". must be one of: "+me)}var ht=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Ut(B){Object.keys(B).forEach(function(me){ht.indexOf(me)<0&&$('invalid regl constructor argument "'+me+'". must be one of '+ht)})}function dt(B,me){for(B=B+"";B.length<me;)B=" "+B;return B}function nt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function rt(B,me){this.number=B,this.line=me,this.errors=[]}function er(B,me,Ne){this.file=B,this.line=me,this.message=Ne}function K(){var B=new Error,me=(B.stack||B).toString(),Ne=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(me);if(Ne)return Ne[1];var It=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(me);return It?It[1]:"unknown"}function Ht(){var B=new Error,me=(B.stack||B).toString(),Ne=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(me);if(Ne)return Ne[1];var It=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(me);return It?It[1]:"unknown"}function at(B,me){var Ne=B.split(`
`),It=1,ar=0,Mt={unknown:new nt,0:new nt};Mt.unknown.name=Mt[0].name=me||K(),Mt.unknown.lines.push(new rt(0,""));for(var Jt=0;Jt<Ne.length;++Jt){var lr=Ne[Jt],vr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(lr);if(vr)switch(vr[1]){case"line":var _r=/(\d+)(\s+\d+)?/.exec(vr[2]);_r&&(It=_r[1]|0,_r[2]&&(ar=_r[2]|0,ar in Mt||(Mt[ar]=new nt)));break;case"define":var wr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(vr[2]);wr&&(Mt[ar].name=wr[1]?F(wr[2]):wr[2]);break}Mt[ar].lines.push(new rt(It++,lr))}return Object.keys(Mt).forEach(function(Ar){var Ur=Mt[Ar];Ur.lines.forEach(function(gr){Ur.index[gr.number]=gr})}),Mt}function Ye(B){var me=[];return B.split(`
`).forEach(function(Ne){if(!(Ne.length<5)){var It=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ne);It?me.push(new er(It[1]|0,It[2]|0,It[3].trim())):Ne.length>0&&me.push(new er("unknown",0,Ne))}}),me}function ut(B,me){me.forEach(function(Ne){var It=B[Ne.file];if(It){var ar=It.index[Ne.line];if(ar){ar.errors.push(Ne),It.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(Ne)})}function Je(B,me,Ne,It,ar){if(!B.getShaderParameter(me,B.COMPILE_STATUS)){var Mt=B.getShaderInfoLog(me),Jt=It===B.FRAGMENT_SHADER?"fragment":"vertex";De(Ne,"string",Jt+" shader source must be a string",ar);var lr=at(Ne,ar),vr=Ye(Mt);ut(lr,vr),Object.keys(lr).forEach(function(_r){var wr=lr[_r];if(!wr.hasErrors)return;var Ar=[""],Ur=[""];function gr(Er,st){Ar.push(Er),Ur.push(st||"")}gr("file number "+_r+": "+wr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),wr.lines.forEach(function(Er){if(Er.errors.length>0){gr(dt(Er.number,4)+"|  ","background-color:yellow; font-weight:bold"),gr(Er.line+J,"color:red; background-color:yellow; font-weight:bold");var st=0;Er.errors.forEach(function(Zt){var yr=Zt.message,Dr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(yr);if(Dr){var ur=Dr[1];switch(yr=Dr[2],ur){case"assign":ur="=";break}st=Math.max(Er.line.indexOf(ur,st),0)}else st=0;gr(dt("| ",6)),gr(dt("^^^",st+3)+J,"font-weight:bold"),gr(dt("| ",6)),gr(yr+J,"font-weight:bold")}),gr(dt("| ",6)+J)}else gr(dt(Er.number,4)+"|  "),gr(Er.line+J,"color:red")}),typeof document!="undefined"&&!window.chrome?(Ur[0]=Ar.join("%c"),console.log.apply(console,Ur)):console.log(Ar.join(""))}),re.raise("Error compiling "+Jt+" shader, "+lr[0].name)}}function Ot(B,me,Ne,It,ar){if(!B.getProgramParameter(me,B.LINK_STATUS)){var Mt=B.getProgramInfoLog(me),Jt=at(Ne,ar),lr=at(It,ar),vr='Error linking program with vertex shader, "'+lr[0].name+'", and fragment shader "'+Jt[0].name+'"';typeof document!="undefined"?console.log("%c"+vr+J+"%c"+Mt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(vr+J+Mt),re.raise(vr)}}function dr(B){B._commandRef=K()}function Cr(B,me,Ne,It){dr(B);function ar(vr){return vr?It.id(vr):0}B._fragId=ar(B.static.frag),B._vertId=ar(B.static.vert);function Mt(vr,_r){Object.keys(_r).forEach(function(wr){vr[It.id(wr)]=!0})}var Jt=B._uniformSet={};Mt(Jt,me.static),Mt(Jt,me.dynamic);var lr=B._attributeSet={};Mt(lr,Ne.static),Mt(lr,Ne.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function jr(B,me){var Ne=Ht();$(B+" in command "+(me||K())+(Ne==="unknown"?"":" called from "+Ne))}function T(B,me,Ne){B||jr(me,Ne||K())}function we(B,me,Ne,It){B in me||jr("unknown parameter ("+B+")"+ie(Ne)+". possible values: "+Object.keys(me).join(),It||K())}function De(B,me,Ne,It){Ie(B,me)||jr("invalid parameter type"+ie(Ne)+". expected "+me+", got "+typeof B,It||K())}function bt(B){B()}function mt(B,me,Ne){B.texture?$t(B.texture._texture.internalformat,me,"unsupported texture format for attachment"):$t(B.renderbuffer._renderbuffer.format,Ne,"unsupported renderbuffer format for attachment")}var Lt=33071,Yt=9728,br=9984,Kn=9985,cn=9986,li=9987,Vn=5120,ti=5121,ci=5122,Hn=5123,fi=5124,ua=5125,Vi=5126,ki=32819,Ki=32820,la=33635,Ai=34042,ma=36193,Xn={};Xn[Vn]=Xn[ti]=1,Xn[ci]=Xn[Hn]=Xn[ma]=Xn[la]=Xn[ki]=Xn[Ki]=2,Xn[fi]=Xn[ua]=Xn[Vi]=Xn[Ai]=4;function bi(B,me){return B===Ki||B===ki||B===la?2:B===Ai?4:Xn[B]*me}function zi(B){return!(B&B-1)&&!!B}function qi(B,me,Ne){var It,ar=me.width,Mt=me.height,Jt=me.channels;re(ar>0&&ar<=Ne.maxTextureSize&&Mt>0&&Mt<=Ne.maxTextureSize,"invalid texture shape"),(B.wrapS!==Lt||B.wrapT!==Lt)&&re(zi(ar)&&zi(Mt),"incompatible wrap mode for texture, both width and height must be power of 2"),me.mipmask===1?ar!==1&&Mt!==1&&re(B.minFilter!==br&&B.minFilter!==cn&&B.minFilter!==Kn&&B.minFilter!==li,"min filter requires mipmap"):(re(zi(ar)&&zi(Mt),"texture must be a square power of 2 to support mipmapping"),re(me.mipmask===(ar<<1)-1,"missing or incomplete mipmap data")),me.type===Vi&&(Ne.extensions.indexOf("oes_texture_float_linear")<0&&re(B.minFilter===Yt&&B.magFilter===Yt,"filter not supported, must enable oes_texture_float_linear"),re(!B.genMipmaps,"mipmap generation not supported with float textures"));var lr=me.images;for(It=0;It<16;++It)if(lr[It]){var vr=ar>>It,_r=Mt>>It;re(me.mipmask&1<<It,"missing mipmap data");var wr=lr[It];if(re(wr.width===vr&&wr.height===_r,"invalid shape for mip images"),re(wr.format===me.format&&wr.internalformat===me.internalformat&&wr.type===me.type,"incompatible type for mip image"),!wr.compressed)if(wr.data){var Ar=Math.ceil(bi(wr.type,Jt)*vr/wr.unpackAlignment)*wr.unpackAlignment;re(wr.data.byteLength===Ar*_r,"invalid data for image, buffer size is inconsistent with image format")}else wr.element||wr.copy}else B.genMipmaps||re((me.mipmask&1<<It)==0,"extra mipmap data");me.compressed&&re(!B.genMipmaps,"mipmap generation for compressed images not supported")}function ko(B,me,Ne,It){var ar=B.width,Mt=B.height,Jt=B.channels;re(ar>0&&ar<=It.maxTextureSize&&Mt>0&&Mt<=It.maxTextureSize,"invalid texture shape"),re(ar===Mt,"cube map must be square"),re(me.wrapS===Lt&&me.wrapT===Lt,"wrap mode not supported by cube map");for(var lr=0;lr<Ne.length;++lr){var vr=Ne[lr];re(vr.width===ar&&vr.height===Mt,"inconsistent cube map face shape"),me.genMipmaps&&(re(!vr.compressed,"can not generate mipmap for compressed textures"),re(vr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var _r=vr.images,wr=0;wr<16;++wr){var Ar=_r[wr];if(Ar){var Ur=ar>>wr,gr=Mt>>wr;re(vr.mipmask&1<<wr,"missing mipmap data"),re(Ar.width===Ur&&Ar.height===gr,"invalid shape for mip images"),re(Ar.format===B.format&&Ar.internalformat===B.internalformat&&Ar.type===B.type,"incompatible type for mip image"),Ar.compressed||(Ar.data?re(Ar.data.byteLength===Ur*gr*Math.max(bi(Ar.type,Jt),Ar.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ar.element||Ar.copy)}}}}var de=m(re,{optional:bt,raise:$,commandRaise:jr,command:T,parameter:ne,commandParameter:we,constructor:Ut,type:He,commandType:De,isTypedArray:Le,nni:Rt,oneOf:$t,shaderError:Je,linkError:Ot,callSite:Ht,saveCommandRef:dr,saveDrawInfo:Cr,framebufferFormat:mt,guessCommand:K,texture2D:qi,textureCube:ko}),Ln=0,Za=0,rs=5,kt=6;function tr(B,me){this.id=Ln++,this.type=B,this.data=me}function Sr(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function qr(B){if(B.length===0)return[];var me=B.charAt(0),Ne=B.charAt(B.length-1);if(B.length>1&&me===Ne&&(me==='"'||me==="'"))return['"'+Sr(B.substr(1,B.length-2))+'"'];var It=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(It)return qr(B.substr(0,It.index)).concat(qr(It[1])).concat(qr(B.substr(It.index+It[0].length)));var ar=B.split(".");if(ar.length===1)return['"'+Sr(B)+'"'];for(var Mt=[],Jt=0;Jt<ar.length;++Jt)Mt=Mt.concat(qr(ar[Jt]));return Mt}function xn(B){return"["+qr(B).join("][")+"]"}function kn(B,me){return new tr(B,xn(me+""))}function hi(B){return typeof B=="function"&&!B._reglType||B instanceof tr}function qn(B,me){if(typeof B=="function")return new tr(Za,B);if(typeof B=="number"||typeof B=="boolean")return new tr(rs,B);if(Array.isArray(B))return new tr(kt,B.map(function(Ne,It){return qn(Ne,me+"["+It+"]")}));if(B instanceof tr)return B;de(!1,"invalid option type in uniform "+me)}var an={DynamicVariable:tr,define:kn,isDynamic:hi,unbox:qn,accessor:xn},Di={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},Oi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",to=Oi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ps(){var B={"":0},me=[""];return{id:function(Ne){var It=B[Ne];return It||(It=B[Ne]=me.length,me.push(Ne),It)},str:function(Ne){return me[Ne]}}}function Zo(B,me,Ne){var It=document.createElement("canvas");m(It.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),B.appendChild(It),B===document.body&&(It.style.position="absolute",m(B.style,{margin:0,padding:0}));function ar(){var lr=window.innerWidth,vr=window.innerHeight;if(B!==document.body){var _r=It.getBoundingClientRect();lr=_r.right-_r.left,vr=_r.bottom-_r.top}It.width=Ne*lr,It.height=Ne*vr}var Mt;B!==document.body&&typeof ResizeObserver=="function"?(Mt=new ResizeObserver(function(){setTimeout(ar)}),Mt.observe(B)):window.addEventListener("resize",ar,!1);function Jt(){Mt?Mt.disconnect():window.removeEventListener("resize",ar),B.removeChild(It)}return ar(),{canvas:It,onDestroy:Jt}}function Na(B,me){function Ne(It){try{return B.getContext(It,me)}catch(ar){return null}}return Ne("webgl")||Ne("experimental-webgl")||Ne("webgl-experimental")}function xa(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function G(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function Q(B){return typeof B=="string"?B.split():(de(Array.isArray(B),"invalid extension array"),B)}function oe(B){return typeof B=="string"?(de(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function ge(B){var me=B||{},Ne,It,ar,Mt,Jt={},lr=[],vr=[],_r=typeof window=="undefined"?1:window.devicePixelRatio,wr=!1,Ar=function(Er){Er&&de.raise(Er)},Ur=function(){};if(typeof me=="string"?(de(typeof document!="undefined","selector queries only supported in DOM environments"),Ne=document.querySelector(me),de(Ne,"invalid query string for element")):typeof me=="object"?xa(me)?Ne=me:G(me)?(Mt=me,ar=Mt.canvas):(de.constructor(me),"gl"in me?Mt=me.gl:"canvas"in me?ar=oe(me.canvas):"container"in me&&(It=oe(me.container)),"attributes"in me&&(Jt=me.attributes,de.type(Jt,"object","invalid context attributes")),"extensions"in me&&(lr=Q(me.extensions)),"optionalExtensions"in me&&(vr=Q(me.optionalExtensions)),"onDone"in me&&(de.type(me.onDone,"function","invalid or missing onDone callback"),Ar=me.onDone),"profile"in me&&(wr=!!me.profile),"pixelRatio"in me&&(_r=+me.pixelRatio,de(_r>0,"invalid pixel ratio"))):de.raise("invalid arguments to regl"),Ne&&(Ne.nodeName.toLowerCase()==="canvas"?ar=Ne:It=Ne),!Mt){if(!ar){de(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var gr=Zo(It||document.body,Ar,_r);if(!gr)return null;ar=gr.canvas,Ur=gr.onDestroy}Jt.premultipliedAlpha===void 0&&(Jt.premultipliedAlpha=!0),Mt=Na(ar,Jt)}return Mt?{gl:Mt,canvas:ar,container:It,extensions:lr,optionalExtensions:vr,pixelRatio:_r,profile:wr,onDone:Ar,onDestroy:Ur}:(Ur(),Ar("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Pe(B,me){var Ne={};function It(lr){de.type(lr,"string","extension name must be string");var vr=lr.toLowerCase(),_r;try{_r=Ne[vr]=ar(lr)}catch(wr){}return!!_r}function ar(lr){return B.getExtension(lr)?B.getExtension(lr):B.getExtension(lr.toLowerCase())?B.getExtension(lr.toLowerCase()):null}for(var Mt=0;Mt<me.extensions.length;++Mt){var Jt=me.extensions[Mt];if(!It(Jt))return me.onDestroy(),me.onDone('"'+Jt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return me.optionalExtensions.forEach(It),{extensions:Ne,restore:function(){Object.keys(Ne).forEach(function(lr){if(Ne[lr]&&!It(lr))throw new Error("(regl): error restoring extension "+lr)})}}}function Ge(B,me){for(var Ne=Array(B),It=0;It<B;++It)Ne[It]=me(It);return Ne}var et=5120,fe=5121,ke=5122,vt=5123,hr=5124,Pt=5125,Dt=5126;function pr(B){for(var me=16;me<=1<<28;me*=16)if(B<=me)return me;return 0}function mn(B){var me,Ne;return me=(B>65535)<<4,B>>>=me,Ne=(B>255)<<3,B>>>=Ne,me|=Ne,Ne=(B>15)<<2,B>>>=Ne,me|=Ne,Ne=(B>3)<<1,B>>>=Ne,me|=Ne,me|B>>1}function un(){var B=Ge(8,function(){return[]});function me(Mt){var Jt=pr(Mt),lr=B[mn(Jt)>>2];return lr.length>0?lr.pop():new ArrayBuffer(Jt)}function Ne(Mt){B[mn(Mt.byteLength)>>2].push(Mt)}function It(Mt,Jt){var lr=null;switch(Mt){case et:lr=new Int8Array(me(Jt),0,Jt);break;case fe:lr=new Uint8Array(me(Jt),0,Jt);break;case ke:lr=new Int16Array(me(2*Jt),0,Jt);break;case vt:lr=new Uint16Array(me(2*Jt),0,Jt);break;case hr:lr=new Int32Array(me(4*Jt),0,Jt);break;case Pt:lr=new Uint32Array(me(4*Jt),0,Jt);break;case Dt:lr=new Float32Array(me(4*Jt),0,Jt);break;default:return null}return lr.length!==Jt?lr.subarray(0,Jt):lr}function ar(Mt){Ne(Mt.buffer)}return{alloc:me,free:Ne,allocType:It,freeType:ar}}var Tt=un();Tt.zero=un();var $r=3408,Fr=3410,Gr=3411,vi=3412,Jr=3413,Pn=3414,Wi=3415,pi=33901,Ci=33902,_i=3379,St=3386,Kt=34921,Ca=36347,Ei=36348,Mi=35661,Ui=35660,Wr=34930,Sn=36349,zt=34076,na=34024,be=7936,Ko=7937,Qi=7938,fu=35724,Ba=34047,Ma=36063,Wa=34852,ia=3553,bo=34067,Vo=34069,wu=33984,fo=6408,Do=5126,aa=5121,Xa=36160,Fo=36053,Ya=36064,Cs=16384,Sl=function(B,me){var Ne=1;me.ext_texture_filter_anisotropic&&(Ne=B.getParameter(Ba));var It=1,ar=1;me.webgl_draw_buffers&&(It=B.getParameter(Wa),ar=B.getParameter(Ma));var Mt=!!me.oes_texture_float;if(Mt){var Jt=B.createTexture();B.bindTexture(ia,Jt),B.texImage2D(ia,0,fo,1,1,0,fo,Do,null);var lr=B.createFramebuffer();if(B.bindFramebuffer(Xa,lr),B.framebufferTexture2D(Xa,Ya,ia,Jt,0),B.bindTexture(ia,null),B.checkFramebufferStatus(Xa)!==Fo)Mt=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(Cs);var vr=Tt.allocType(Do,4);B.readPixels(0,0,1,1,fo,Do,vr),B.getError()?Mt=!1:(B.deleteFramebuffer(lr),B.deleteTexture(Jt),Mt=vr[0]===1),Tt.freeType(vr)}}var _r=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),wr=!0;if(!_r){var Ar=B.createTexture(),Ur=Tt.allocType(aa,36);B.activeTexture(wu),B.bindTexture(bo,Ar),B.texImage2D(Vo,0,fo,3,3,0,fo,aa,Ur),Tt.freeType(Ur),B.bindTexture(bo,null),B.deleteTexture(Ar),wr=!B.getError()}return{colorBits:[B.getParameter(Fr),B.getParameter(Gr),B.getParameter(vi),B.getParameter(Jr)],depthBits:B.getParameter(Pn),stencilBits:B.getParameter(Wi),subpixelBits:B.getParameter($r),extensions:Object.keys(me).filter(function(gr){return!!me[gr]}),maxAnisotropic:Ne,maxDrawbuffers:It,maxColorAttachments:ar,pointSizeDims:B.getParameter(pi),lineWidthDims:B.getParameter(Ci),maxViewportDims:B.getParameter(St),maxCombinedTextureUnits:B.getParameter(Mi),maxCubeMapSize:B.getParameter(zt),maxRenderbufferSize:B.getParameter(na),maxTextureUnits:B.getParameter(Wr),maxTextureSize:B.getParameter(_i),maxAttributes:B.getParameter(Kt),maxVertexUniforms:B.getParameter(Ca),maxVertexTextureUnits:B.getParameter(Ui),maxVaryingVectors:B.getParameter(Ei),maxFragmentUniforms:B.getParameter(Sn),glsl:B.getParameter(fu),renderer:B.getParameter(Ko),vendor:B.getParameter(be),version:B.getParameter(Qi),readFloat:Mt,npotTextureCube:wr}};function ds(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||j(B.data))}var ae=function(B){return Object.keys(B).map(function(me){return B[me]})},xe={shape:ro,flatten:Pi};function qe(B,me,Ne){for(var It=0;It<me;++It)Ne[It]=B[It]}function Ct(B,me,Ne,It){for(var ar=0,Mt=0;Mt<me;++Mt)for(var Jt=B[Mt],lr=0;lr<Ne;++lr)It[ar++]=Jt[lr]}function Ir(B,me,Ne,It,ar,Mt){for(var Jt=Mt,lr=0;lr<me;++lr)for(var vr=B[lr],_r=0;_r<Ne;++_r)for(var wr=vr[_r],Ar=0;Ar<It;++Ar)ar[Jt++]=wr[Ar]}function Tn(B,me,Ne,It,ar){for(var Mt=1,Jt=Ne+1;Jt<me.length;++Jt)Mt*=me[Jt];var lr=me[Ne];if(me.length-Ne==4){var vr=me[Ne+1],_r=me[Ne+2],wr=me[Ne+3];for(Jt=0;Jt<lr;++Jt)Ir(B[Jt],vr,_r,wr,It,ar),ar+=Mt}else for(Jt=0;Jt<lr;++Jt)Tn(B[Jt],me,Ne+1,It,ar),ar+=Mt}function Pi(B,me,Ne,It){var ar=1;if(me.length)for(var Mt=0;Mt<me.length;++Mt)ar*=me[Mt];else ar=0;var Jt=It||Tt.allocType(Ne,ar);switch(me.length){case 0:break;case 1:qe(B,me[0],Jt);break;case 2:Ct(B,me[0],me[1],Jt);break;case 3:Ir(B,me[0],me[1],me[2],Jt,0);break;default:Tn(B,me,0,Jt,0)}return Jt}function ro(B){for(var me=[],Ne=B;Ne.length;Ne=Ne[0])me.push(Ne.length);return me}var ka={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},za=5120,jo=5122,vs=5124,oo=5121,Eo=5123,ms=5125,Ms=5126,Fs=5126,eu={int8:za,int16:jo,int32:vs,uint8:oo,uint16:Eo,uint32:ms,float:Ms,float32:Fs},gs=35048,ga=35040,_a={dynamic:gs,stream:ga,static:35044},ns=xe.flatten,ef=xe.shape,wl=35044,Hs=35040,Jl=5121,zu=5126,Ws=[];Ws[5120]=1,Ws[5122]=2,Ws[5124]=4,Ws[5121]=1,Ws[5123]=2,Ws[5125]=4,Ws[5126]=4;function il(B){return ka[Object.prototype.toString.call(B)]|0}function g(B,me){for(var Ne=0;Ne<me.length;++Ne)B[Ne]=me[Ne]}function A(B,me,Ne,It,ar,Mt,Jt){for(var lr=0,vr=0;vr<Ne;++vr)for(var _r=0;_r<It;++_r)B[lr++]=me[ar*vr+Mt*_r+Jt]}function N(B,me,Ne,It){var ar=0,Mt={};function Jt(st){this.id=ar++,this.buffer=B.createBuffer(),this.type=st,this.usage=wl,this.byteLength=0,this.dimension=1,this.dtype=Jl,this.persistentData=null,Ne.profile&&(this.stats={size:0})}Jt.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},Jt.prototype.destroy=function(){Ur(this)};var lr=[];function vr(st,Zt){var yr=lr.pop();return yr||(yr=new Jt(st)),yr.bind(),Ar(yr,Zt,Hs,0,1,!1),yr}function _r(st){lr.push(st)}function wr(st,Zt,yr){st.byteLength=Zt.byteLength,B.bufferData(st.type,Zt,yr)}function Ar(st,Zt,yr,Dr,ur,Mr){var Xr;if(st.usage=yr,Array.isArray(Zt)){if(st.dtype=Dr||zu,Zt.length>0){var zn;if(Array.isArray(Zt[0])){Xr=ef(Zt);for(var Qt=1,rr=1;rr<Xr.length;++rr)Qt*=Xr[rr];st.dimension=Qt,zn=ns(Zt,Xr,st.dtype),wr(st,zn,yr),Mr?st.persistentData=zn:Tt.freeType(zn)}else if(typeof Zt[0]=="number"){st.dimension=ur;var gn=Tt.allocType(st.dtype,Zt.length);g(gn,Zt),wr(st,gn,yr),Mr?st.persistentData=gn:Tt.freeType(gn)}else j(Zt[0])?(st.dimension=Zt[0].length,st.dtype=Dr||il(Zt[0])||zu,zn=ns(Zt,[Zt.length,Zt[0].length],st.dtype),wr(st,zn,yr),Mr?st.persistentData=zn:Tt.freeType(zn)):de.raise("invalid buffer data")}}else if(j(Zt))st.dtype=Dr||il(Zt),st.dimension=ur,wr(st,Zt,yr),Mr&&(st.persistentData=new Uint8Array(new Uint8Array(Zt.buffer)));else if(ds(Zt)){Xr=Zt.shape;var Zr=Zt.stride,xr=Zt.offset,Yr=0,Kr=0,gi=0,ni=0;Xr.length===1?(Yr=Xr[0],Kr=1,gi=Zr[0],ni=0):Xr.length===2?(Yr=Xr[0],Kr=Xr[1],gi=Zr[0],ni=Zr[1]):de.raise("invalid shape"),st.dtype=Dr||il(Zt.data)||zu,st.dimension=Kr;var Hr=Tt.allocType(st.dtype,Yr*Kr);A(Hr,Zt.data,Yr,Kr,gi,ni,xr),wr(st,Hr,yr),Mr?st.persistentData=Hr:Tt.freeType(Hr)}else Zt instanceof ArrayBuffer?(st.dtype=Jl,st.dimension=ur,wr(st,Zt,yr),Mr&&(st.persistentData=new Uint8Array(new Uint8Array(Zt)))):de.raise("invalid buffer data")}function Ur(st){me.bufferCount--,It(st);var Zt=st.buffer;de(Zt,"buffer must not be deleted already"),B.deleteBuffer(Zt),st.buffer=null,delete Mt[st.id]}function gr(st,Zt,yr,Dr){me.bufferCount++;var ur=new Jt(Zt);Mt[ur.id]=ur;function Mr(Qt){var rr=wl,gn=null,Zr=0,xr=0,Yr=1;return Array.isArray(Qt)||j(Qt)||ds(Qt)||Qt instanceof ArrayBuffer?gn=Qt:typeof Qt=="number"?Zr=Qt|0:Qt&&(de.type(Qt,"object","buffer arguments must be an object, a number or an array"),"data"in Qt&&(de(gn===null||Array.isArray(gn)||j(gn)||ds(gn),"invalid data for buffer"),gn=Qt.data),"usage"in Qt&&(de.parameter(Qt.usage,_a,"invalid buffer usage"),rr=_a[Qt.usage]),"type"in Qt&&(de.parameter(Qt.type,eu,"invalid buffer type"),xr=eu[Qt.type]),"dimension"in Qt&&(de.type(Qt.dimension,"number","invalid dimension"),Yr=Qt.dimension|0),"length"in Qt&&(de.nni(Zr,"buffer length must be a nonnegative integer"),Zr=Qt.length|0)),ur.bind(),gn?Ar(ur,gn,rr,xr,Yr,Dr):(Zr&&B.bufferData(ur.type,Zr,rr),ur.dtype=xr||Jl,ur.usage=rr,ur.dimension=Yr,ur.byteLength=Zr),Ne.profile&&(ur.stats.size=ur.byteLength*Ws[ur.dtype]),Mr}function Xr(Qt,rr){de(rr+Qt.byteLength<=ur.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Qt.byteLength+" starting from offset "+rr+" to a buffer of size "+ur.byteLength),B.bufferSubData(ur.type,rr,Qt)}function zn(Qt,rr){var gn=(rr||0)|0,Zr;if(ur.bind(),j(Qt)||Qt instanceof ArrayBuffer)Xr(Qt,gn);else if(Array.isArray(Qt)){if(Qt.length>0)if(typeof Qt[0]=="number"){var xr=Tt.allocType(ur.dtype,Qt.length);g(xr,Qt),Xr(xr,gn),Tt.freeType(xr)}else if(Array.isArray(Qt[0])||j(Qt[0])){Zr=ef(Qt);var Yr=ns(Qt,Zr,ur.dtype);Xr(Yr,gn),Tt.freeType(Yr)}else de.raise("invalid buffer data")}else if(ds(Qt)){Zr=Qt.shape;var Kr=Qt.stride,gi=0,ni=0,Hr=0,en=0;Zr.length===1?(gi=Zr[0],ni=1,Hr=Kr[0],en=0):Zr.length===2?(gi=Zr[0],ni=Zr[1],Hr=Kr[0],en=Kr[1]):de.raise("invalid shape");var Jn=Array.isArray(Qt.data)?ur.dtype:il(Qt.data),ui=Tt.allocType(Jn,gi*ni);A(ui,Qt.data,gi,ni,Hr,en,Qt.offset),Xr(ui,gn),Tt.freeType(ui)}else de.raise("invalid data for buffer subdata");return Mr}return yr||Mr(st),Mr._reglType="buffer",Mr._buffer=ur,Mr.subdata=zn,Ne.profile&&(Mr.stats=ur.stats),Mr.destroy=function(){Ur(ur)},Mr}function Er(){ae(Mt).forEach(function(st){st.buffer=B.createBuffer(),B.bindBuffer(st.type,st.buffer),B.bufferData(st.type,st.persistentData||st.byteLength,st.usage)})}return Ne.profile&&(me.getTotalBufferSize=function(){var st=0;return Object.keys(Mt).forEach(function(Zt){st+=Mt[Zt].stats.size}),st}),{create:gr,createStream:vr,destroyStream:_r,clear:function(){ae(Mt).forEach(Ur),lr.forEach(Ur)},getBuffer:function(st){return st&&st._buffer instanceof Jt?st._buffer:null},restore:Er,_initBuffer:Ar}}var O=0,q=0,_e=1,Xe=1,ft=4,pt=4,ir={points:O,point:q,lines:_e,line:Xe,triangles:ft,triangle:pt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},sr=0,wn=1,ri=4,On=5120,Xi=5121,da=5122,wa=5123,ji=5124,ys=5125,tu=34963,Uu=35040,tf=35044;function al(B,me,Ne,It){var ar={},Mt=0,Jt={uint8:Xi,uint16:wa};me.oes_element_index_uint&&(Jt.uint32=ys);function lr(Er){this.id=Mt++,ar[this.id]=this,this.buffer=Er,this.primType=ri,this.vertCount=0,this.type=0}lr.prototype.bind=function(){this.buffer.bind()};var vr=[];function _r(Er){var st=vr.pop();return st||(st=new lr(Ne.create(null,tu,!0,!1)._buffer)),Ar(st,Er,Uu,-1,-1,0,0),st}function wr(Er){vr.push(Er)}function Ar(Er,st,Zt,yr,Dr,ur,Mr){Er.buffer.bind();var Xr;if(st){var zn=Mr;!Mr&&(!j(st)||ds(st)&&!j(st.data))&&(zn=me.oes_element_index_uint?ys:wa),Ne._initBuffer(Er.buffer,st,Zt,zn,3)}else B.bufferData(tu,ur,Zt),Er.buffer.dtype=Xr||Xi,Er.buffer.usage=Zt,Er.buffer.dimension=3,Er.buffer.byteLength=ur;if(Xr=Mr,!Mr){switch(Er.buffer.dtype){case Xi:case On:Xr=Xi;break;case wa:case da:Xr=wa;break;case ys:case ji:Xr=ys;break;default:de.raise("unsupported type for element array")}Er.buffer.dtype=Xr}Er.type=Xr,de(Xr!==ys||!!me.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Qt=Dr;Qt<0&&(Qt=Er.buffer.byteLength,Xr===wa?Qt>>=1:Xr===ys&&(Qt>>=2)),Er.vertCount=Qt;var rr=yr;if(yr<0){rr=ri;var gn=Er.buffer.dimension;gn===1&&(rr=sr),gn===2&&(rr=wn),gn===3&&(rr=ri)}Er.primType=rr}function Ur(Er){It.elementsCount--,de(Er.buffer!==null,"must not double destroy elements"),delete ar[Er.id],Er.buffer.destroy(),Er.buffer=null}function gr(Er,st){var Zt=Ne.create(null,tu,!0),yr=new lr(Zt._buffer);It.elementsCount++;function Dr(ur){if(!ur)Zt(),yr.primType=ri,yr.vertCount=0,yr.type=Xi;else if(typeof ur=="number")Zt(ur),yr.primType=ri,yr.vertCount=ur|0,yr.type=Xi;else{var Mr=null,Xr=tf,zn=-1,Qt=-1,rr=0,gn=0;Array.isArray(ur)||j(ur)||ds(ur)?Mr=ur:(de.type(ur,"object","invalid arguments for elements"),"data"in ur&&(Mr=ur.data,de(Array.isArray(Mr)||j(Mr)||ds(Mr),"invalid data for element buffer")),"usage"in ur&&(de.parameter(ur.usage,_a,"invalid element buffer usage"),Xr=_a[ur.usage]),"primitive"in ur&&(de.parameter(ur.primitive,ir,"invalid element buffer primitive"),zn=ir[ur.primitive]),"count"in ur&&(de(typeof ur.count=="number"&&ur.count>=0,"invalid vertex count for elements"),Qt=ur.count|0),"type"in ur&&(de.parameter(ur.type,Jt,"invalid buffer type"),gn=Jt[ur.type]),"length"in ur?rr=ur.length|0:(rr=Qt,gn===wa||gn===da?rr*=2:(gn===ys||gn===ji)&&(rr*=4))),Ar(yr,Mr,Xr,zn,Qt,rr,gn)}return Dr}return Dr(Er),Dr._reglType="elements",Dr._elements=yr,Dr.subdata=function(ur,Mr){return Zt.subdata(ur,Mr),Dr},Dr.destroy=function(){Ur(yr)},Dr}return{create:gr,createStream:_r,destroyStream:wr,getElements:function(Er){return typeof Er=="function"&&Er._elements instanceof lr?Er._elements:null},clear:function(){ae(ar).forEach(Ur)}}}var Cc=new Float32Array(1),Tu=new Uint32Array(Cc.buffer),Au=5123;function Cu(B){for(var me=Tt.allocType(Au,B.length),Ne=0;Ne<B.length;++Ne)if(isNaN(B[Ne]))me[Ne]=65535;else if(B[Ne]===Infinity)me[Ne]=31744;else if(B[Ne]===-Infinity)me[Ne]=64512;else{Cc[0]=B[Ne];var It=Tu[0],ar=It>>>31<<15,Mt=(It<<1>>>24)-127,Jt=It>>13&(1<<10)-1;if(Mt<-24)me[Ne]=ar;else if(Mt<-14){var lr=-14-Mt;me[Ne]=ar+(Jt+(1<<10)>>lr)}else Mt>15?me[Ne]=ar+31744:me[Ne]=ar+(Mt+15<<10)+Jt}return me}function so(B){return Array.isArray(B)||j(B)}var kf=function(B){return!(B&B-1)&&!!B},Df=34467,qo=3553,Mc=34067,Mu=34069,ru=6408,rf=6406,Tl=6407,Fi=6409,Al=6410,yh=32854,ol=32855,Pc=36194,Ff=32819,_h=32820,Nf=33635,Ic=34042,Ql=6402,ec=34041,Cl=35904,sl=35906,Ml=36193,Zu=33776,Xs=33777,nf=33778,af=33779,Bf=35986,nu=35987,tc=34798,Oc=35840,of=35841,Pl=35842,Xh=35843,sf=36196,Il=5121,uf=5123,lf=5125,Ol=5126,Rc=10242,xh=10243,bh=10497,rc=33071,Eh=33648,Rl=10240,$i=10241,nc=9728,ca=9729,Pu=9984,Yi=9985,Pa=9986,_s=9987,Lc=33170,Vu=4352,Ua=4353,ic=4354,Ll=34046,ju=3317,kc=37440,Iu=37441,ho=37443,kl=37444,ac=33984,po=[Pu,Pa,Yi,_s],fn=[0,Fi,Al,Tl,ru],uo={};uo[Fi]=uo[rf]=uo[Ql]=1,uo[ec]=uo[Al]=2,uo[Tl]=uo[Cl]=3,uo[ru]=uo[sl]=4;function Gu(B){return"[object "+B+"]"}var Da=Gu("HTMLCanvasElement"),Ys=Gu("OffscreenCanvas"),Ps=Gu("CanvasRenderingContext2D"),cf=Gu("ImageBitmap"),zr=Gu("HTMLImageElement"),oc=Gu("HTMLVideoElement"),ff=Object.keys(ka).concat([Da,Ys,Ps,cf,zr,oc]),ul=[];ul[Il]=1,ul[Ol]=4,ul[Ml]=2,ul[uf]=2,ul[lf]=4;var Ta=[];Ta[yh]=2,Ta[ol]=2,Ta[Pc]=2,Ta[ec]=4,Ta[Zu]=.5,Ta[Xs]=.5,Ta[nf]=1,Ta[af]=1,Ta[Bf]=.5,Ta[nu]=1,Ta[tc]=1,Ta[Oc]=.5,Ta[of]=.25,Ta[Pl]=.5,Ta[Xh]=.25,Ta[sf]=.5;function xs(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function hf(B){if(!Array.isArray(B))return!1;var me=B.length;return!(me===0||!so(B[0]))}function Ou(B){return Object.prototype.toString.call(B)}function Ns(B){return Ou(B)===Da}function Ru(B){return Ou(B)===Ys}function zf(B){return Ou(B)===Ps}function ll(B){return Ou(B)===cf}function Uf(B){return Ou(B)===zr}function pf(B){return Ou(B)===oc}function iu(B){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(me&&B&&B.getContext)}function Is(B){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(me&&B&&"src"in B&&"crossOrigin"in B)}function wi(B){if(!B)return!1;if(iu(B)||Is(B))return!0;var me=Ou(B);return ff.indexOf(me)>=0?!0:xs(B)||hf(B)||ds(B)}function Lu(B){return ka[Object.prototype.toString.call(B)]|0}function au(B,me){var Ne=me.length;switch(B.type){case Il:case uf:case lf:case Ol:var It=Tt.allocType(B.type,Ne);It.set(me),B.data=It;break;case Ml:B.data=Cu(me);break;default:de.raise("unsupported texture type, must specify a typed array")}}function Go(B,me){return Tt.allocType(B.type===Ml?Ol:B.type,me)}function cl(B,me){B.type===Ml?(B.data=Cu(me),Tt.freeType(me)):B.data=me}function Bs(B,me,Ne,It,ar,Mt){for(var Jt=B.width,lr=B.height,vr=B.channels,_r=Jt*lr*vr,wr=Go(B,_r),Ar=0,Ur=0;Ur<lr;++Ur)for(var gr=0;gr<Jt;++gr)for(var Er=0;Er<vr;++Er)wr[Ar++]=me[Ne*gr+It*Ur+ar*Er+Mt];cl(B,wr)}function Ks(B,me,Ne,It,ar,Mt){var Jt;if(typeof Ta[B]!="undefined"?Jt=Ta[B]:Jt=uo[B]*ul[me],Mt&&(Jt*=6),ar){for(var lr=0,vr=Ne;vr>=1;)lr+=Jt*vr*vr,vr/=2;return lr}else return Jt*Ne*It}function bs(B,me,Ne,It,ar,Mt,Jt){var lr={"don't care":Vu,"dont care":Vu,nice:ic,fast:Ua},vr={repeat:bh,clamp:rc,mirror:Eh},_r={nearest:nc,linear:ca},wr=m({mipmap:_s,"nearest mipmap nearest":Pu,"linear mipmap nearest":Yi,"nearest mipmap linear":Pa,"linear mipmap linear":_s},_r),Ar={none:0,browser:kl},Ur={uint8:Il,rgba4:Ff,rgb565:Nf,"rgb5 a1":_h},gr={alpha:rf,luminance:Fi,"luminance alpha":Al,rgb:Tl,rgba:ru,rgba4:yh,"rgb5 a1":ol,rgb565:Pc},Er={};me.ext_srgb&&(gr.srgb=Cl,gr.srgba=sl),me.oes_texture_float&&(Ur.float32=Ur.float=Ol),me.oes_texture_half_float&&(Ur.float16=Ur["half float"]=Ml),me.webgl_depth_texture&&(m(gr,{depth:Ql,"depth stencil":ec}),m(Ur,{uint16:uf,uint32:lf,"depth stencil":Ic})),me.webgl_compressed_texture_s3tc&&m(Er,{"rgb s3tc dxt1":Zu,"rgba s3tc dxt1":Xs,"rgba s3tc dxt3":nf,"rgba s3tc dxt5":af}),me.webgl_compressed_texture_atc&&m(Er,{"rgb atc":Bf,"rgba atc explicit alpha":nu,"rgba atc interpolated alpha":tc}),me.webgl_compressed_texture_pvrtc&&m(Er,{"rgb pvrtc 4bppv1":Oc,"rgb pvrtc 2bppv1":of,"rgba pvrtc 4bppv1":Pl,"rgba pvrtc 2bppv1":Xh}),me.webgl_compressed_texture_etc1&&(Er["rgb etc1"]=sf);var st=Array.prototype.slice.call(B.getParameter(Df)||new Uint32Array(0));Object.keys(Er).forEach(function(Ce){var Nt=Er[Ce];st.indexOf(Nt)>=0&&(gr[Ce]=Nt)});var Zt=Object.keys(gr);Ne.textureFormats=Zt;var yr=[];Object.keys(gr).forEach(function(Ce){var Nt=gr[Ce];yr[Nt]=Ce});var Dr=[];Object.keys(Ur).forEach(function(Ce){var Nt=Ur[Ce];Dr[Nt]=Ce});var ur=[];Object.keys(_r).forEach(function(Ce){var Nt=_r[Ce];ur[Nt]=Ce});var Mr=[];Object.keys(wr).forEach(function(Ce){var Nt=wr[Ce];Mr[Nt]=Ce});var Xr=[];Object.keys(vr).forEach(function(Ce){var Nt=vr[Ce];Xr[Nt]=Ce});var zn=Zt.reduce(function(Ce,Nt){var _t=gr[Nt];return _t===Fi||_t===rf||_t===Fi||_t===Al||_t===Ql||_t===ec||me.ext_srgb&&(_t===Cl||_t===sl)?Ce[_t]=_t:_t===ol||Nt.indexOf("rgba")>=0?Ce[_t]=ru:Ce[_t]=Tl,Ce},{});function Qt(){this.internalformat=ru,this.format=ru,this.type=Il,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=kl,this.width=0,this.height=0,this.channels=0}function rr(Ce,Nt){Ce.internalformat=Nt.internalformat,Ce.format=Nt.format,Ce.type=Nt.type,Ce.compressed=Nt.compressed,Ce.premultiplyAlpha=Nt.premultiplyAlpha,Ce.flipY=Nt.flipY,Ce.unpackAlignment=Nt.unpackAlignment,Ce.colorSpace=Nt.colorSpace,Ce.width=Nt.width,Ce.height=Nt.height,Ce.channels=Nt.channels}function gn(Ce,Nt){if(!(typeof Nt!="object"||!Nt)){if("premultiplyAlpha"in Nt&&(de.type(Nt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ce.premultiplyAlpha=Nt.premultiplyAlpha),"flipY"in Nt&&(de.type(Nt.flipY,"boolean","invalid texture flip"),Ce.flipY=Nt.flipY),"alignment"in Nt&&(de.oneOf(Nt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ce.unpackAlignment=Nt.alignment),"colorSpace"in Nt&&(de.parameter(Nt.colorSpace,Ar,"invalid colorSpace"),Ce.colorSpace=Ar[Nt.colorSpace]),"type"in Nt){var _t=Nt.type;de(me.oes_texture_float||!(_t==="float"||_t==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),de(me.oes_texture_half_float||!(_t==="half float"||_t==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),de(me.webgl_depth_texture||!(_t==="uint16"||_t==="uint32"||_t==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),de.parameter(_t,Ur,"invalid texture type"),Ce.type=Ur[_t]}var hn=Ce.width,Gi=Ce.height,Ee=Ce.channels,ue=!1;"shape"in Nt?(de(Array.isArray(Nt.shape)&&Nt.shape.length>=2,"shape must be an array"),hn=Nt.shape[0],Gi=Nt.shape[1],Nt.shape.length===3&&(Ee=Nt.shape[2],de(Ee>0&&Ee<=4,"invalid number of channels"),ue=!0),de(hn>=0&&hn<=Ne.maxTextureSize,"invalid width"),de(Gi>=0&&Gi<=Ne.maxTextureSize,"invalid height")):("radius"in Nt&&(hn=Gi=Nt.radius,de(hn>=0&&hn<=Ne.maxTextureSize,"invalid radius")),"width"in Nt&&(hn=Nt.width,de(hn>=0&&hn<=Ne.maxTextureSize,"invalid width")),"height"in Nt&&(Gi=Nt.height,de(Gi>=0&&Gi<=Ne.maxTextureSize,"invalid height")),"channels"in Nt&&(Ee=Nt.channels,de(Ee>0&&Ee<=4,"invalid number of channels"),ue=!0)),Ce.width=hn|0,Ce.height=Gi|0,Ce.channels=Ee|0;var je=!1;if("format"in Nt){var lt=Nt.format;de(me.webgl_depth_texture||!(lt==="depth"||lt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),de.parameter(lt,gr,"invalid texture format");var At=Ce.internalformat=gr[lt];Ce.format=zn[At],lt in Ur&&("type"in Nt||(Ce.type=Ur[lt])),lt in Er&&(Ce.compressed=!0),je=!0}!ue&&je?Ce.channels=uo[Ce.format]:ue&&!je?Ce.channels!==fn[Ce.format]&&(Ce.format=Ce.internalformat=fn[Ce.channels]):je&&ue&&de(Ce.channels===uo[Ce.format],"number of channels inconsistent with specified format")}}function Zr(Ce){B.pixelStorei(kc,Ce.flipY),B.pixelStorei(Iu,Ce.premultiplyAlpha),B.pixelStorei(ho,Ce.colorSpace),B.pixelStorei(ju,Ce.unpackAlignment)}function xr(){Qt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Yr(Ce,Nt){var _t=null;if(wi(Nt)?_t=Nt:Nt&&(de.type(Nt,"object","invalid pixel data type"),gn(Ce,Nt),"x"in Nt&&(Ce.xOffset=Nt.x|0),"y"in Nt&&(Ce.yOffset=Nt.y|0),wi(Nt.data)&&(_t=Nt.data)),de(!Ce.compressed||_t instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Nt.copy){de(!_t,"can not specify copy and data field for the same texture");var hn=ar.viewportWidth,Gi=ar.viewportHeight;Ce.width=Ce.width||hn-Ce.xOffset,Ce.height=Ce.height||Gi-Ce.yOffset,Ce.needsCopy=!0,de(Ce.xOffset>=0&&Ce.xOffset<hn&&Ce.yOffset>=0&&Ce.yOffset<Gi&&Ce.width>0&&Ce.width<=hn&&Ce.height>0&&Ce.height<=Gi,"copy texture read out of bounds")}else if(!_t)Ce.width=Ce.width||1,Ce.height=Ce.height||1,Ce.channels=Ce.channels||4;else if(j(_t))Ce.channels=Ce.channels||4,Ce.data=_t,!("type"in Nt)&&Ce.type===Il&&(Ce.type=Lu(_t));else if(xs(_t))Ce.channels=Ce.channels||4,au(Ce,_t),Ce.alignment=1,Ce.needsFree=!0;else if(ds(_t)){var Ee=_t.data;!Array.isArray(Ee)&&Ce.type===Il&&(Ce.type=Lu(Ee));var ue=_t.shape,je=_t.stride,lt,At,$e,Fe,tt,ye;ue.length===3?($e=ue[2],ye=je[2]):(de(ue.length===2,"invalid ndarray pixel data, must be 2 or 3D"),$e=1,ye=1),lt=ue[0],At=ue[1],Fe=je[0],tt=je[1],Ce.alignment=1,Ce.width=lt,Ce.height=At,Ce.channels=$e,Ce.format=Ce.internalformat=fn[$e],Ce.needsFree=!0,Bs(Ce,Ee,Fe,tt,ye,_t.offset)}else if(iu(_t)||Ns(_t)||Ru(_t)||zf(_t))iu(_t)||Ns(_t)||Ru(_t)?Ce.element=_t:Ce.element=_t.canvas,Ce.width=Ce.element.width,Ce.height=Ce.element.height,Ce.channels=4;else if(ll(_t))Ce.element=_t,Ce.width=_t.width,Ce.height=_t.height,Ce.channels=4;else if(Uf(_t))Ce.element=_t,Ce.width=_t.naturalWidth,Ce.height=_t.naturalHeight,Ce.channels=4;else if(Is(_t))Ce.element=_t,Ce.width=_t.width,Ce.height=_t.height,Ce.channels=4;else if(pf(_t))Ce.element=_t,Ce.width=_t.videoWidth,Ce.height=_t.videoHeight,Ce.channels=4;else if(hf(_t)){var Ze=Ce.width||_t[0].length,Se=Ce.height||_t.length,ct=Ce.channels;so(_t[0][0])?ct=ct||_t[0][0].length:ct=ct||1;for(var Et=xe.shape(_t),fr=1,Nr=0;Nr<Et.length;++Nr)fr*=Et[Nr];var Br=Go(Ce,fr);xe.flatten(_t,Et,"",Br),cl(Ce,Br),Ce.alignment=1,Ce.width=Ze,Ce.height=Se,Ce.channels=ct,Ce.format=Ce.internalformat=fn[ct],Ce.needsFree=!0}Ce.type===Ol?de(Ne.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ce.type===Ml&&de(Ne.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Kr(Ce,Nt,_t){var hn=Ce.element,Gi=Ce.data,Ee=Ce.internalformat,ue=Ce.format,je=Ce.type,lt=Ce.width,At=Ce.height;Zr(Ce),hn?B.texImage2D(Nt,_t,ue,ue,je,hn):Ce.compressed?B.compressedTexImage2D(Nt,_t,Ee,lt,At,0,Gi):Ce.needsCopy?(It(),B.copyTexImage2D(Nt,_t,ue,Ce.xOffset,Ce.yOffset,lt,At,0)):B.texImage2D(Nt,_t,ue,lt,At,0,ue,je,Gi||null)}function gi(Ce,Nt,_t,hn,Gi){var Ee=Ce.element,ue=Ce.data,je=Ce.internalformat,lt=Ce.format,At=Ce.type,$e=Ce.width,Fe=Ce.height;Zr(Ce),Ee?B.texSubImage2D(Nt,Gi,_t,hn,lt,At,Ee):Ce.compressed?B.compressedTexSubImage2D(Nt,Gi,_t,hn,je,$e,Fe,ue):Ce.needsCopy?(It(),B.copyTexSubImage2D(Nt,Gi,_t,hn,Ce.xOffset,Ce.yOffset,$e,Fe)):B.texSubImage2D(Nt,Gi,_t,hn,$e,Fe,lt,At,ue)}var ni=[];function Hr(){return ni.pop()||new xr}function en(Ce){Ce.needsFree&&Tt.freeType(Ce.data),xr.call(Ce),ni.push(Ce)}function Jn(){Qt.call(this),this.genMipmaps=!1,this.mipmapHint=Vu,this.mipmask=0,this.images=Array(16)}function ui(Ce,Nt,_t){var hn=Ce.images[0]=Hr();Ce.mipmask=1,hn.width=Ce.width=Nt,hn.height=Ce.height=_t,hn.channels=Ce.channels=4}function Ni(Ce,Nt){var _t=null;if(wi(Nt))_t=Ce.images[0]=Hr(),rr(_t,Ce),Yr(_t,Nt),Ce.mipmask=1;else if(gn(Ce,Nt),Array.isArray(Nt.mipmap))for(var hn=Nt.mipmap,Gi=0;Gi<hn.length;++Gi)_t=Ce.images[Gi]=Hr(),rr(_t,Ce),_t.width>>=Gi,_t.height>>=Gi,Yr(_t,hn[Gi]),Ce.mipmask|=1<<Gi;else _t=Ce.images[0]=Hr(),rr(_t,Ce),Yr(_t,Nt),Ce.mipmask=1;rr(Ce,Ce.images[0]),Ce.compressed&&(Ce.internalformat===Zu||Ce.internalformat===Xs||Ce.internalformat===nf||Ce.internalformat===af)&&de(Ce.width%4==0&&Ce.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function qa(Ce,Nt){for(var _t=Ce.images,hn=0;hn<_t.length;++hn){if(!_t[hn])return;Kr(_t[hn],Nt,hn)}}var io=[];function Ri(){var Ce=io.pop()||new Jn;Qt.call(Ce),Ce.mipmask=0;for(var Nt=0;Nt<16;++Nt)Ce.images[Nt]=null;return Ce}function Jo(Ce){for(var Nt=Ce.images,_t=0;_t<Nt.length;++_t)Nt[_t]&&en(Nt[_t]),Nt[_t]=null;io.push(Ce)}function ja(){this.minFilter=nc,this.magFilter=nc,this.wrapS=rc,this.wrapT=rc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Vu}function Wo(Ce,Nt){if("min"in Nt){var _t=Nt.min;de.parameter(_t,wr),Ce.minFilter=wr[_t],po.indexOf(Ce.minFilter)>=0&&!("faces"in Nt)&&(Ce.genMipmaps=!0)}if("mag"in Nt){var hn=Nt.mag;de.parameter(hn,_r),Ce.magFilter=_r[hn]}var Gi=Ce.wrapS,Ee=Ce.wrapT;if("wrap"in Nt){var ue=Nt.wrap;typeof ue=="string"?(de.parameter(ue,vr),Gi=Ee=vr[ue]):Array.isArray(ue)&&(de.parameter(ue[0],vr),de.parameter(ue[1],vr),Gi=vr[ue[0]],Ee=vr[ue[1]])}else{if("wrapS"in Nt){var je=Nt.wrapS;de.parameter(je,vr),Gi=vr[je]}if("wrapT"in Nt){var lt=Nt.wrapT;de.parameter(lt,vr),Ee=vr[lt]}}if(Ce.wrapS=Gi,Ce.wrapT=Ee,"anisotropic"in Nt){var At=Nt.anisotropic;de(typeof At=="number"&&At>=1&&At<=Ne.maxAnisotropic,"aniso samples must be between 1 and "),Ce.anisotropic=Nt.anisotropic}if("mipmap"in Nt){var $e=!1;switch(typeof Nt.mipmap){case"string":de.parameter(Nt.mipmap,lr,"invalid mipmap hint"),Ce.mipmapHint=lr[Nt.mipmap],Ce.genMipmaps=!0,$e=!0;break;case"boolean":$e=Ce.genMipmaps=Nt.mipmap;break;case"object":de(Array.isArray(Nt.mipmap),"invalid mipmap type"),Ce.genMipmaps=!1,$e=!0;break;default:de.raise("invalid mipmap type")}$e&&!("min"in Nt)&&(Ce.minFilter=Pu)}}function Rn(Ce,Nt){B.texParameteri(Nt,$i,Ce.minFilter),B.texParameteri(Nt,Rl,Ce.magFilter),B.texParameteri(Nt,Rc,Ce.wrapS),B.texParameteri(Nt,xh,Ce.wrapT),me.ext_texture_filter_anisotropic&&B.texParameteri(Nt,Ll,Ce.anisotropic),Ce.genMipmaps&&(B.hint(Lc,Ce.mipmapHint),B.generateMipmap(Nt))}var Fn=0,Ao={},Ss=Ne.maxTextureUnits,co=Array(Ss).map(function(){return null});function xi(Ce){Qt.call(this),this.mipmask=0,this.internalformat=ru,this.id=Fn++,this.refCount=1,this.target=Ce,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ja,Jt.profile&&(this.stats={size:0})}function Xo(Ce){B.activeTexture(ac),B.bindTexture(Ce.target,Ce.texture)}function sa(){var Ce=co[0];Ce?B.bindTexture(Ce.target,Ce.texture):B.bindTexture(qo,null)}function ls(Ce){var Nt=Ce.texture;de(Nt,"must not double destroy texture");var _t=Ce.unit,hn=Ce.target;_t>=0&&(B.activeTexture(ac+_t),B.bindTexture(hn,null),co[_t]=null),B.deleteTexture(Nt),Ce.texture=null,Ce.params=null,Ce.pixels=null,Ce.refCount=0,delete Ao[Ce.id],Mt.textureCount--}m(xi.prototype,{bind:function(){var Ce=this;Ce.bindCount+=1;var Nt=Ce.unit;if(Nt<0){for(var _t=0;_t<Ss;++_t){var hn=co[_t];if(hn){if(hn.bindCount>0)continue;hn.unit=-1}co[_t]=Ce,Nt=_t;break}Nt>=Ss&&de.raise("insufficient number of texture units"),Jt.profile&&Mt.maxTextureUnits<Nt+1&&(Mt.maxTextureUnits=Nt+1),Ce.unit=Nt,B.activeTexture(ac+Nt),B.bindTexture(Ce.target,Ce.texture)}return Nt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ls(this)}});function ii(Ce,Nt){var _t=new xi(qo);Ao[_t.id]=_t,Mt.textureCount++;function hn(ue,je){var lt=_t.texInfo;ja.call(lt);var At=Ri();return typeof ue=="number"?typeof je=="number"?ui(At,ue|0,je|0):ui(At,ue|0,ue|0):ue?(de.type(ue,"object","invalid arguments to regl.texture"),Wo(lt,ue),Ni(At,ue)):ui(At,1,1),lt.genMipmaps&&(At.mipmask=(At.width<<1)-1),_t.mipmask=At.mipmask,rr(_t,At),de.texture2D(lt,At,Ne),_t.internalformat=At.internalformat,hn.width=At.width,hn.height=At.height,Xo(_t),qa(At,qo),Rn(lt,qo),sa(),Jo(At),Jt.profile&&(_t.stats.size=Ks(_t.internalformat,_t.type,At.width,At.height,lt.genMipmaps,!1)),hn.format=yr[_t.internalformat],hn.type=Dr[_t.type],hn.mag=ur[lt.magFilter],hn.min=Mr[lt.minFilter],hn.wrapS=Xr[lt.wrapS],hn.wrapT=Xr[lt.wrapT],hn}function Gi(ue,je,lt,At){de(!!ue,"must specify image data");var $e=je|0,Fe=lt|0,tt=At|0,ye=Hr();return rr(ye,_t),ye.width=0,ye.height=0,Yr(ye,ue),ye.width=ye.width||(_t.width>>tt)-$e,ye.height=ye.height||(_t.height>>tt)-Fe,de(_t.type===ye.type&&_t.format===ye.format&&_t.internalformat===ye.internalformat,"incompatible format for texture.subimage"),de($e>=0&&Fe>=0&&$e+ye.width<=_t.width&&Fe+ye.height<=_t.height,"texture.subimage write out of bounds"),de(_t.mipmask&1<<tt,"missing mipmap data"),de(ye.data||ye.element||ye.needsCopy,"missing image data"),Xo(_t),gi(ye,qo,$e,Fe,tt),sa(),en(ye),hn}function Ee(ue,je){var lt=ue|0,At=je|0||lt;if(lt===_t.width&&At===_t.height)return hn;hn.width=_t.width=lt,hn.height=_t.height=At,Xo(_t);for(var $e=0;_t.mipmask>>$e;++$e){var Fe=lt>>$e,tt=At>>$e;if(!Fe||!tt)break;B.texImage2D(qo,$e,_t.format,Fe,tt,0,_t.format,_t.type,null)}return sa(),Jt.profile&&(_t.stats.size=Ks(_t.internalformat,_t.type,lt,At,!1,!1)),hn}return hn(Ce,Nt),hn.subimage=Gi,hn.resize=Ee,hn._reglType="texture2d",hn._texture=_t,Jt.profile&&(hn.stats=_t.stats),hn.destroy=function(){_t.decRef()},hn}function Zi(Ce,Nt,_t,hn,Gi,Ee){var ue=new xi(Mc);Ao[ue.id]=ue,Mt.cubeCount++;var je=new Array(6);function lt(Fe,tt,ye,Ze,Se,ct){var Et,fr=ue.texInfo;for(ja.call(fr),Et=0;Et<6;++Et)je[Et]=Ri();if(typeof Fe=="number"||!Fe){var Nr=Fe|0||1;for(Et=0;Et<6;++Et)ui(je[Et],Nr,Nr)}else if(typeof Fe=="object")if(tt)Ni(je[0],Fe),Ni(je[1],tt),Ni(je[2],ye),Ni(je[3],Ze),Ni(je[4],Se),Ni(je[5],ct);else if(Wo(fr,Fe),gn(ue,Fe),"faces"in Fe){var Br=Fe.faces;for(de(Array.isArray(Br)&&Br.length===6,"cube faces must be a length 6 array"),Et=0;Et<6;++Et)de(typeof Br[Et]=="object"&&!!Br[Et],"invalid input for cube map face"),rr(je[Et],ue),Ni(je[Et],Br[Et])}else for(Et=0;Et<6;++Et)Ni(je[Et],Fe);else de.raise("invalid arguments to cube map");for(rr(ue,je[0]),de.optional(function(){Ne.npotTextureCube||de(kf(ue.width)&&kf(ue.height),"your browser does not support non power or two texture dimensions")}),fr.genMipmaps?ue.mipmask=(je[0].width<<1)-1:ue.mipmask=je[0].mipmask,de.textureCube(ue,fr,je,Ne),ue.internalformat=je[0].internalformat,lt.width=je[0].width,lt.height=je[0].height,Xo(ue),Et=0;Et<6;++Et)qa(je[Et],Mu+Et);for(Rn(fr,Mc),sa(),Jt.profile&&(ue.stats.size=Ks(ue.internalformat,ue.type,lt.width,lt.height,fr.genMipmaps,!0)),lt.format=yr[ue.internalformat],lt.type=Dr[ue.type],lt.mag=ur[fr.magFilter],lt.min=Mr[fr.minFilter],lt.wrapS=Xr[fr.wrapS],lt.wrapT=Xr[fr.wrapT],Et=0;Et<6;++Et)Jo(je[Et]);return lt}function At(Fe,tt,ye,Ze,Se){de(!!tt,"must specify image data"),de(typeof Fe=="number"&&Fe===(Fe|0)&&Fe>=0&&Fe<6,"invalid face");var ct=ye|0,Et=Ze|0,fr=Se|0,Nr=Hr();return rr(Nr,ue),Nr.width=0,Nr.height=0,Yr(Nr,tt),Nr.width=Nr.width||(ue.width>>fr)-ct,Nr.height=Nr.height||(ue.height>>fr)-Et,de(ue.type===Nr.type&&ue.format===Nr.format&&ue.internalformat===Nr.internalformat,"incompatible format for texture.subimage"),de(ct>=0&&Et>=0&&ct+Nr.width<=ue.width&&Et+Nr.height<=ue.height,"texture.subimage write out of bounds"),de(ue.mipmask&1<<fr,"missing mipmap data"),de(Nr.data||Nr.element||Nr.needsCopy,"missing image data"),Xo(ue),gi(Nr,Mu+Fe,ct,Et,fr),sa(),en(Nr),lt}function $e(Fe){var tt=Fe|0;if(tt!==ue.width){lt.width=ue.width=tt,lt.height=ue.height=tt,Xo(ue);for(var ye=0;ye<6;++ye)for(var Ze=0;ue.mipmask>>Ze;++Ze)B.texImage2D(Mu+ye,Ze,ue.format,tt>>Ze,tt>>Ze,0,ue.format,ue.type,null);return sa(),Jt.profile&&(ue.stats.size=Ks(ue.internalformat,ue.type,lt.width,lt.height,!1,!0)),lt}}return lt(Ce,Nt,_t,hn,Gi,Ee),lt.subimage=At,lt.resize=$e,lt._reglType="textureCube",lt._texture=ue,Jt.profile&&(lt.stats=ue.stats),lt.destroy=function(){ue.decRef()},lt}function ya(){for(var Ce=0;Ce<Ss;++Ce)B.activeTexture(ac+Ce),B.bindTexture(qo,null),co[Ce]=null;ae(Ao).forEach(ls),Mt.cubeCount=0,Mt.textureCount=0}Jt.profile&&(Mt.getTotalTextureSize=function(){var Ce=0;return Object.keys(Ao).forEach(function(Nt){Ce+=Ao[Nt].stats.size}),Ce});function Co(){for(var Ce=0;Ce<Ss;++Ce){var Nt=co[Ce];Nt&&(Nt.bindCount=0,Nt.unit=-1,co[Ce]=null)}ae(Ao).forEach(function(_t){_t.texture=B.createTexture(),B.bindTexture(_t.target,_t.texture);for(var hn=0;hn<32;++hn)if((_t.mipmask&1<<hn)!=0)if(_t.target===qo)B.texImage2D(qo,hn,_t.internalformat,_t.width>>hn,_t.height>>hn,0,_t.internalformat,_t.type,null);else for(var Gi=0;Gi<6;++Gi)B.texImage2D(Mu+Gi,hn,_t.internalformat,_t.width>>hn,_t.height>>hn,0,_t.internalformat,_t.type,null);Rn(_t.texInfo,_t.target)})}function Zl(){for(var Ce=0;Ce<Ss;++Ce){var Nt=co[Ce];Nt&&(Nt.bindCount=0,Nt.unit=-1,co[Ce]=null),B.activeTexture(ac+Ce),B.bindTexture(qo,null),B.bindTexture(Mc,null)}}return{create2D:ii,createCube:Zi,clear:ya,getTexture:function(Ce){return null},restore:Co,refresh:Zl}}var hu=36161,Cn=32854,bn=32855,Dc=36194,is=33189,as=36168,No=34041,Fa=35907,Hu=34836,Wu=34842,oa=34843,ba=[];ba[Cn]=2,ba[bn]=2,ba[Dc]=2,ba[is]=2,ba[as]=1,ba[No]=4,ba[Fa]=4,ba[Hu]=16,ba[Wu]=8,ba[oa]=6;function sc(B,me,Ne){return ba[B]*me*Ne}var fl=function(B,me,Ne,It,ar){var Mt={rgba4:Cn,rgb565:Dc,"rgb5 a1":bn,depth:is,stencil:as,"depth stencil":No};me.ext_srgb&&(Mt.srgba=Fa),me.ext_color_buffer_half_float&&(Mt.rgba16f=Wu,Mt.rgb16f=oa),me.webgl_color_buffer_float&&(Mt.rgba32f=Hu);var Jt=[];Object.keys(Mt).forEach(function(gr){var Er=Mt[gr];Jt[Er]=gr});var lr=0,vr={};function _r(gr){this.id=lr++,this.refCount=1,this.renderbuffer=gr,this.format=Cn,this.width=0,this.height=0,ar.profile&&(this.stats={size:0})}_r.prototype.decRef=function(){--this.refCount<=0&&wr(this)};function wr(gr){var Er=gr.renderbuffer;de(Er,"must not double destroy renderbuffer"),B.bindRenderbuffer(hu,null),B.deleteRenderbuffer(Er),gr.renderbuffer=null,gr.refCount=0,delete vr[gr.id],It.renderbufferCount--}function Ar(gr,Er){var st=new _r(B.createRenderbuffer());vr[st.id]=st,It.renderbufferCount++;function Zt(Dr,ur){var Mr=0,Xr=0,zn=Cn;if(typeof Dr=="object"&&Dr){var Qt=Dr;if("shape"in Qt){var rr=Qt.shape;de(Array.isArray(rr)&&rr.length>=2,"invalid renderbuffer shape"),Mr=rr[0]|0,Xr=rr[1]|0}else"radius"in Qt&&(Mr=Xr=Qt.radius|0),"width"in Qt&&(Mr=Qt.width|0),"height"in Qt&&(Xr=Qt.height|0);"format"in Qt&&(de.parameter(Qt.format,Mt,"invalid renderbuffer format"),zn=Mt[Qt.format])}else typeof Dr=="number"?(Mr=Dr|0,typeof ur=="number"?Xr=ur|0:Xr=Mr):Dr?de.raise("invalid arguments to renderbuffer constructor"):Mr=Xr=1;if(de(Mr>0&&Xr>0&&Mr<=Ne.maxRenderbufferSize&&Xr<=Ne.maxRenderbufferSize,"invalid renderbuffer size"),!(Mr===st.width&&Xr===st.height&&zn===st.format))return Zt.width=st.width=Mr,Zt.height=st.height=Xr,st.format=zn,B.bindRenderbuffer(hu,st.renderbuffer),B.renderbufferStorage(hu,zn,Mr,Xr),de(B.getError()===0,"invalid render buffer format"),ar.profile&&(st.stats.size=sc(st.format,st.width,st.height)),Zt.format=Jt[st.format],Zt}function yr(Dr,ur){var Mr=Dr|0,Xr=ur|0||Mr;return Mr===st.width&&Xr===st.height||(de(Mr>0&&Xr>0&&Mr<=Ne.maxRenderbufferSize&&Xr<=Ne.maxRenderbufferSize,"invalid renderbuffer size"),Zt.width=st.width=Mr,Zt.height=st.height=Xr,B.bindRenderbuffer(hu,st.renderbuffer),B.renderbufferStorage(hu,st.format,Mr,Xr),de(B.getError()===0,"invalid render buffer format"),ar.profile&&(st.stats.size=sc(st.format,st.width,st.height))),Zt}return Zt(gr,Er),Zt.resize=yr,Zt._reglType="renderbuffer",Zt._renderbuffer=st,ar.profile&&(Zt.stats=st.stats),Zt.destroy=function(){st.decRef()},Zt}ar.profile&&(It.getTotalRenderbufferSize=function(){var gr=0;return Object.keys(vr).forEach(function(Er){gr+=vr[Er].stats.size}),gr});function Ur(){ae(vr).forEach(function(gr){gr.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(hu,gr.renderbuffer),B.renderbufferStorage(hu,gr.format,gr.width,gr.height)}),B.bindRenderbuffer(hu,null)}return{create:Ar,clear:function(){ae(vr).forEach(wr)},restore:Ur}},pu=36160,du=36161,So=3553,Xu=34069,vu=36064,Dl=36096,Yu=36128,uc=33306,Fc=36053,lc=36054,Fl=36055,Zf=36057,hl=36061,pl=36193,zs=5121,dl=5126,Ho=6407,df=6408,Nl=6402,Nc=[Ho,df],cc=[];cc[df]=4,cc[Ho]=3;var l=[];l[zs]=1,l[dl]=4,l[pl]=2;var f=32854,c=32855,p=36194,b=33189,w=36168,C=34041,R=35907,U=34836,Y=34842,ce=34843,he=[f,c,p,R,Y,ce,U],pe={};pe[Fc]="complete",pe[lc]="incomplete attachment",pe[Zf]="incomplete dimensions",pe[Fl]="incomplete, missing attachment",pe[hl]="unsupported";function Ae(B,me,Ne,It,ar,Mt){var Jt={cur:null,next:null,dirty:!1,setFBO:null},lr=["rgba"],vr=["rgba4","rgb565","rgb5 a1"];me.ext_srgb&&vr.push("srgba"),me.ext_color_buffer_half_float&&vr.push("rgba16f","rgb16f"),me.webgl_color_buffer_float&&vr.push("rgba32f");var _r=["uint8"];me.oes_texture_half_float&&_r.push("half float","float16"),me.oes_texture_float&&_r.push("float","float32");function wr(xr,Yr,Kr){this.target=xr,this.texture=Yr,this.renderbuffer=Kr;var gi=0,ni=0;Yr?(gi=Yr.width,ni=Yr.height):Kr&&(gi=Kr.width,ni=Kr.height),this.width=gi,this.height=ni}function Ar(xr){xr&&(xr.texture&&xr.texture._texture.decRef(),xr.renderbuffer&&xr.renderbuffer._renderbuffer.decRef())}function Ur(xr,Yr,Kr){if(!!xr)if(xr.texture){var gi=xr.texture._texture,ni=Math.max(1,gi.width),Hr=Math.max(1,gi.height);de(ni===Yr&&Hr===Kr,"inconsistent width/height for supplied texture"),gi.refCount+=1}else{var en=xr.renderbuffer._renderbuffer;de(en.width===Yr&&en.height===Kr,"inconsistent width/height for renderbuffer"),en.refCount+=1}}function gr(xr,Yr){Yr&&(Yr.texture?B.framebufferTexture2D(pu,xr,Yr.target,Yr.texture._texture.texture,0):B.framebufferRenderbuffer(pu,xr,du,Yr.renderbuffer._renderbuffer.renderbuffer))}function Er(xr){var Yr=So,Kr=null,gi=null,ni=xr;typeof xr=="object"&&(ni=xr.data,"target"in xr&&(Yr=xr.target|0)),de.type(ni,"function","invalid attachment data");var Hr=ni._reglType;return Hr==="texture2d"?(Kr=ni,de(Yr===So)):Hr==="textureCube"?(Kr=ni,de(Yr>=Xu&&Yr<Xu+6,"invalid cube map target")):Hr==="renderbuffer"?(gi=ni,Yr=du):de.raise("invalid regl object for attachment"),new wr(Yr,Kr,gi)}function st(xr,Yr,Kr,gi,ni){if(Kr){var Hr=It.create2D({width:xr,height:Yr,format:gi,type:ni});return Hr._texture.refCount=0,new wr(So,Hr,null)}else{var en=ar.create({width:xr,height:Yr,format:gi});return en._renderbuffer.refCount=0,new wr(du,null,en)}}function Zt(xr){return xr&&(xr.texture||xr.renderbuffer)}function yr(xr,Yr,Kr){xr&&(xr.texture?xr.texture.resize(Yr,Kr):xr.renderbuffer&&xr.renderbuffer.resize(Yr,Kr),xr.width=Yr,xr.height=Kr)}var Dr=0,ur={};function Mr(){this.id=Dr++,ur[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Xr(xr){xr.colorAttachments.forEach(Ar),Ar(xr.depthAttachment),Ar(xr.stencilAttachment),Ar(xr.depthStencilAttachment)}function zn(xr){var Yr=xr.framebuffer;de(Yr,"must not double destroy framebuffer"),B.deleteFramebuffer(Yr),xr.framebuffer=null,Mt.framebufferCount--,delete ur[xr.id]}function Qt(xr){var Yr;B.bindFramebuffer(pu,xr.framebuffer);var Kr=xr.colorAttachments;for(Yr=0;Yr<Kr.length;++Yr)gr(vu+Yr,Kr[Yr]);for(Yr=Kr.length;Yr<Ne.maxColorAttachments;++Yr)B.framebufferTexture2D(pu,vu+Yr,So,null,0);B.framebufferTexture2D(pu,uc,So,null,0),B.framebufferTexture2D(pu,Dl,So,null,0),B.framebufferTexture2D(pu,Yu,So,null,0),gr(Dl,xr.depthAttachment),gr(Yu,xr.stencilAttachment),gr(uc,xr.depthStencilAttachment);var gi=B.checkFramebufferStatus(pu);!B.isContextLost()&&gi!==Fc&&de.raise("framebuffer configuration not supported, status = "+pe[gi]),B.bindFramebuffer(pu,Jt.next?Jt.next.framebuffer:null),Jt.cur=Jt.next,B.getError()}function rr(xr,Yr){var Kr=new Mr;Mt.framebufferCount++;function gi(Hr,en){var Jn;de(Jt.next!==Kr,"can not update framebuffer which is currently in use");var ui=0,Ni=0,qa=!0,io=!0,Ri=null,Jo=!0,ja="rgba",Wo="uint8",Rn=1,Fn=null,Ao=null,Ss=null,co=!1;if(typeof Hr=="number")ui=Hr|0,Ni=en|0||ui;else if(!Hr)ui=Ni=1;else{de.type(Hr,"object","invalid arguments for framebuffer");var xi=Hr;if("shape"in xi){var Xo=xi.shape;de(Array.isArray(Xo)&&Xo.length>=2,"invalid shape for framebuffer"),ui=Xo[0],Ni=Xo[1]}else"radius"in xi&&(ui=Ni=xi.radius),"width"in xi&&(ui=xi.width),"height"in xi&&(Ni=xi.height);("color"in xi||"colors"in xi)&&(Ri=xi.color||xi.colors,Array.isArray(Ri)&&de(Ri.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),Ri||("colorCount"in xi&&(Rn=xi.colorCount|0,de(Rn>0,"invalid color buffer count")),"colorTexture"in xi&&(Jo=!!xi.colorTexture,ja="rgba4"),"colorType"in xi&&(Wo=xi.colorType,Jo?(de(me.oes_texture_float||!(Wo==="float"||Wo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),de(me.oes_texture_half_float||!(Wo==="half float"||Wo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Wo==="half float"||Wo==="float16"?(de(me.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ja="rgba16f"):(Wo==="float"||Wo==="float32")&&(de(me.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ja="rgba32f"),de.oneOf(Wo,_r,"invalid color type")),"colorFormat"in xi&&(ja=xi.colorFormat,lr.indexOf(ja)>=0?Jo=!0:vr.indexOf(ja)>=0?Jo=!1:de.optional(function(){Jo?de.oneOf(xi.colorFormat,lr,"invalid color format for texture"):de.oneOf(xi.colorFormat,vr,"invalid color format for renderbuffer")}))),("depthTexture"in xi||"depthStencilTexture"in xi)&&(co=!!(xi.depthTexture||xi.depthStencilTexture),de(!co||me.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in xi&&(typeof xi.depth=="boolean"?qa=xi.depth:(Fn=xi.depth,io=!1)),"stencil"in xi&&(typeof xi.stencil=="boolean"?io=xi.stencil:(Ao=xi.stencil,qa=!1)),"depthStencil"in xi&&(typeof xi.depthStencil=="boolean"?qa=io=xi.depthStencil:(Ss=xi.depthStencil,qa=!1,io=!1))}var sa=null,ls=null,ii=null,Zi=null;if(Array.isArray(Ri))sa=Ri.map(Er);else if(Ri)sa=[Er(Ri)];else for(sa=new Array(Rn),Jn=0;Jn<Rn;++Jn)sa[Jn]=st(ui,Ni,Jo,ja,Wo);de(me.webgl_draw_buffers||sa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),de(sa.length<=Ne.maxColorAttachments,"too many color attachments, not supported"),ui=ui||sa[0].width,Ni=Ni||sa[0].height,Fn?ls=Er(Fn):qa&&!io&&(ls=st(ui,Ni,co,"depth","uint32")),Ao?ii=Er(Ao):io&&!qa&&(ii=st(ui,Ni,!1,"stencil","uint8")),Ss?Zi=Er(Ss):!Fn&&!Ao&&io&&qa&&(Zi=st(ui,Ni,co,"depth stencil","depth stencil")),de(!!Fn+!!Ao+!!Ss<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ya=null;for(Jn=0;Jn<sa.length;++Jn)if(Ur(sa[Jn],ui,Ni),de(!sa[Jn]||sa[Jn].texture&&Nc.indexOf(sa[Jn].texture._texture.format)>=0||sa[Jn].renderbuffer&&he.indexOf(sa[Jn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Jn+" is invalid"),sa[Jn]&&sa[Jn].texture){var Co=cc[sa[Jn].texture._texture.format]*l[sa[Jn].texture._texture.type];ya===null?ya=Co:de(ya===Co,"all color attachments much have the same number of bits per pixel.")}return Ur(ls,ui,Ni),de(!ls||ls.texture&&ls.texture._texture.format===Nl||ls.renderbuffer&&ls.renderbuffer._renderbuffer.format===b,"invalid depth attachment for framebuffer object"),Ur(ii,ui,Ni),de(!ii||ii.renderbuffer&&ii.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),Ur(Zi,ui,Ni),de(!Zi||Zi.texture&&Zi.texture._texture.format===C||Zi.renderbuffer&&Zi.renderbuffer._renderbuffer.format===C,"invalid depth-stencil attachment for framebuffer object"),Xr(Kr),Kr.width=ui,Kr.height=Ni,Kr.colorAttachments=sa,Kr.depthAttachment=ls,Kr.stencilAttachment=ii,Kr.depthStencilAttachment=Zi,gi.color=sa.map(Zt),gi.depth=Zt(ls),gi.stencil=Zt(ii),gi.depthStencil=Zt(Zi),gi.width=Kr.width,gi.height=Kr.height,Qt(Kr),gi}function ni(Hr,en){de(Jt.next!==Kr,"can not resize a framebuffer which is currently in use");var Jn=Math.max(Hr|0,1),ui=Math.max(en|0||Jn,1);if(Jn===Kr.width&&ui===Kr.height)return gi;for(var Ni=Kr.colorAttachments,qa=0;qa<Ni.length;++qa)yr(Ni[qa],Jn,ui);return yr(Kr.depthAttachment,Jn,ui),yr(Kr.stencilAttachment,Jn,ui),yr(Kr.depthStencilAttachment,Jn,ui),Kr.width=gi.width=Jn,Kr.height=gi.height=ui,Qt(Kr),gi}return gi(xr,Yr),m(gi,{resize:ni,_reglType:"framebuffer",_framebuffer:Kr,destroy:function(){zn(Kr),Xr(Kr)},use:function(Hr){Jt.setFBO({framebuffer:gi},Hr)}})}function gn(xr){var Yr=Array(6);function Kr(ni){var Hr;de(Yr.indexOf(Jt.next)<0,"can not update framebuffer which is currently in use");var en={color:null},Jn=0,ui=null,Ni="rgba",qa="uint8",io=1;if(typeof ni=="number")Jn=ni|0;else if(!ni)Jn=1;else{de.type(ni,"object","invalid arguments for framebuffer");var Ri=ni;if("shape"in Ri){var Jo=Ri.shape;de(Array.isArray(Jo)&&Jo.length>=2,"invalid shape for framebuffer"),de(Jo[0]===Jo[1],"cube framebuffer must be square"),Jn=Jo[0]}else"radius"in Ri&&(Jn=Ri.radius|0),"width"in Ri?(Jn=Ri.width|0,"height"in Ri&&de(Ri.height===Jn,"must be square")):"height"in Ri&&(Jn=Ri.height|0);("color"in Ri||"colors"in Ri)&&(ui=Ri.color||Ri.colors,Array.isArray(ui)&&de(ui.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),ui||("colorCount"in Ri&&(io=Ri.colorCount|0,de(io>0,"invalid color buffer count")),"colorType"in Ri&&(de.oneOf(Ri.colorType,_r,"invalid color type"),qa=Ri.colorType),"colorFormat"in Ri&&(Ni=Ri.colorFormat,de.oneOf(Ri.colorFormat,lr,"invalid color format for texture"))),"depth"in Ri&&(en.depth=Ri.depth),"stencil"in Ri&&(en.stencil=Ri.stencil),"depthStencil"in Ri&&(en.depthStencil=Ri.depthStencil)}var ja;if(ui)if(Array.isArray(ui))for(ja=[],Hr=0;Hr<ui.length;++Hr)ja[Hr]=ui[Hr];else ja=[ui];else{ja=Array(io);var Wo={radius:Jn,format:Ni,type:qa};for(Hr=0;Hr<io;++Hr)ja[Hr]=It.createCube(Wo)}for(en.color=Array(ja.length),Hr=0;Hr<ja.length;++Hr){var Rn=ja[Hr];de(typeof Rn=="function"&&Rn._reglType==="textureCube","invalid cube map"),Jn=Jn||Rn.width,de(Rn.width===Jn&&Rn.height===Jn,"invalid cube map shape"),en.color[Hr]={target:Xu,data:ja[Hr]}}for(Hr=0;Hr<6;++Hr){for(var Fn=0;Fn<ja.length;++Fn)en.color[Fn].target=Xu+Hr;Hr>0&&(en.depth=Yr[0].depth,en.stencil=Yr[0].stencil,en.depthStencil=Yr[0].depthStencil),Yr[Hr]?Yr[Hr](en):Yr[Hr]=rr(en)}return m(Kr,{width:Jn,height:Jn,color:ja})}function gi(ni){var Hr,en=ni|0;if(de(en>0&&en<=Ne.maxCubeMapSize,"invalid radius for cube fbo"),en===Kr.width)return Kr;var Jn=Kr.color;for(Hr=0;Hr<Jn.length;++Hr)Jn[Hr].resize(en);for(Hr=0;Hr<6;++Hr)Yr[Hr].resize(en);return Kr.width=Kr.height=en,Kr}return Kr(xr),m(Kr,{faces:Yr,resize:gi,_reglType:"framebufferCube",destroy:function(){Yr.forEach(function(ni){ni.destroy()})}})}function Zr(){Jt.cur=null,Jt.next=null,Jt.dirty=!0,ae(ur).forEach(function(xr){xr.framebuffer=B.createFramebuffer(),Qt(xr)})}return m(Jt,{getFramebuffer:function(xr){if(typeof xr=="function"&&xr._reglType==="framebuffer"){var Yr=xr._framebuffer;if(Yr instanceof Mr)return Yr}return null},create:rr,createCube:gn,clear:function(){ae(ur).forEach(zn)},restore:Zr})}var Re=5126,We=34962,Te=34963,Ve=["attributes","elements","offset","count","primitive","instances"];function Qe(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Re,this.offset=0,this.stride=0,this.divisor=0}function gt(B,me,Ne,It,ar,Mt,Jt){for(var lr=Ne.maxAttributes,vr=new Array(lr),_r=0;_r<lr;++_r)vr[_r]=new Qe;var wr=0,Ar={},Ur={Record:Qe,scope:{},state:vr,currentVAO:null,targetVAO:null,restore:Er()?Xr:function(){},createVAO:zn,getVAO:Zt,destroyBuffer:gr,setVAO:Er()?yr:Dr,clear:Er()?ur:function(){}};function gr(Qt){for(var rr=0;rr<vr.length;++rr){var gn=vr[rr];gn.buffer===Qt&&(B.disableVertexAttribArray(rr),gn.buffer=null)}}function Er(){return me.oes_vertex_array_object}function st(){return me.angle_instanced_arrays}function Zt(Qt){return typeof Qt=="function"&&Qt._vao?Qt._vao:null}function yr(Qt){if(Qt!==Ur.currentVAO){var rr=Er();Qt?rr.bindVertexArrayOES(Qt.vao):rr.bindVertexArrayOES(null),Ur.currentVAO=Qt}}function Dr(Qt){if(Qt!==Ur.currentVAO){if(Qt)Qt.bindAttrs();else{for(var rr=st(),gn=0;gn<vr.length;++gn){var Zr=vr[gn];Zr.buffer?(B.enableVertexAttribArray(gn),Zr.buffer.bind(),B.vertexAttribPointer(gn,Zr.size,Zr.type,Zr.normalized,Zr.stride,Zr.offfset),rr&&Zr.divisor&&rr.vertexAttribDivisorANGLE(gn,Zr.divisor)):(B.disableVertexAttribArray(gn),B.vertexAttrib4f(gn,Zr.x,Zr.y,Zr.z,Zr.w))}Jt.elements?B.bindBuffer(Te,Jt.elements.buffer.buffer):B.bindBuffer(Te,null)}Ur.currentVAO=Qt}}function ur(){ae(Ar).forEach(function(Qt){Qt.destroy()})}function Mr(){this.id=++wr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Qt=Er();Qt?this.vao=Qt.createVertexArrayOES():this.vao=null,Ar[this.id]=this,this.buffers=[]}Mr.prototype.bindAttrs=function(){for(var Qt=st(),rr=this.attributes,gn=0;gn<rr.length;++gn){var Zr=rr[gn];Zr.buffer?(B.enableVertexAttribArray(gn),B.bindBuffer(We,Zr.buffer.buffer),B.vertexAttribPointer(gn,Zr.size,Zr.type,Zr.normalized,Zr.stride,Zr.offset),Qt&&Zr.divisor&&Qt.vertexAttribDivisorANGLE(gn,Zr.divisor)):(B.disableVertexAttribArray(gn),B.vertexAttrib4f(gn,Zr.x,Zr.y,Zr.z,Zr.w))}for(var xr=rr.length;xr<lr;++xr)B.disableVertexAttribArray(xr);var Yr=Mt.getElements(this.elements);Yr?B.bindBuffer(Te,Yr.buffer.buffer):B.bindBuffer(Te,null)},Mr.prototype.refresh=function(){var Qt=Er();Qt&&(Qt.bindVertexArrayOES(this.vao),this.bindAttrs(),Ur.currentVAO=null,Qt.bindVertexArrayOES(null))},Mr.prototype.destroy=function(){if(this.vao){var Qt=Er();this===Ur.currentVAO&&(Ur.currentVAO=null,Qt.bindVertexArrayOES(null)),Qt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Ar[this.id]&&(delete Ar[this.id],It.vaoCount-=1)};function Xr(){var Qt=Er();Qt&&ae(Ar).forEach(function(rr){rr.refresh()})}function zn(Qt){var rr=new Mr;It.vaoCount+=1;function gn(Zr){var xr;if(Array.isArray(Zr))xr=Zr,rr.elements&&rr.ownsElements&&rr.elements.destroy(),rr.elements=null,rr.ownsElements=!1,rr.offset=0,rr.count=0,rr.instances=-1,rr.primitive=4;else{if(de(typeof Zr=="object","invalid arguments for create vao"),de("attributes"in Zr,"must specify attributes for vao"),Zr.elements){var Yr=Zr.elements;rr.ownsElements?typeof Yr=="function"&&Yr._reglType==="elements"?(rr.elements.destroy(),rr.ownsElements=!1):(rr.elements(Yr),rr.ownsElements=!1):Mt.getElements(Zr.elements)?(rr.elements=Zr.elements,rr.ownsElements=!1):(rr.elements=Mt.create(Zr.elements),rr.ownsElements=!0)}else rr.elements=null,rr.ownsElements=!1;xr=Zr.attributes,rr.offset=0,rr.count=-1,rr.instances=-1,rr.primitive=4,rr.elements&&(rr.count=rr.elements._elements.vertCount,rr.primitive=rr.elements._elements.primType),"offset"in Zr&&(rr.offset=Zr.offset|0),"count"in Zr&&(rr.count=Zr.count|0),"instances"in Zr&&(rr.instances=Zr.instances|0),"primitive"in Zr&&(de(Zr.primitive in ir,"bad primitive type: "+Zr.primitive),rr.primitive=ir[Zr.primitive]),de.optional(()=>{for(var qa=Object.keys(Zr),io=0;io<qa.length;++io)de(Ve.indexOf(qa[io])>=0,'invalid option for vao: "'+qa[io]+'" valid options are '+Ve)}),de(Array.isArray(xr),"attributes must be an array")}de(xr.length<lr,"too many attributes"),de(xr.length>0,"must specify at least one attribute");var Kr={},gi=rr.attributes;gi.length=xr.length;for(var ni=0;ni<xr.length;++ni){var Hr=xr[ni],en=gi[ni]=new Qe,Jn=Hr.data||Hr;if(Array.isArray(Jn)||j(Jn)||ds(Jn)){var ui;rr.buffers[ni]&&(ui=rr.buffers[ni],j(Jn)&&ui._buffer.byteLength>=Jn.byteLength?ui.subdata(Jn):(ui.destroy(),rr.buffers[ni]=null)),rr.buffers[ni]||(ui=rr.buffers[ni]=ar.create(Hr,We,!1,!0)),en.buffer=ar.getBuffer(ui),en.size=en.buffer.dimension|0,en.normalized=!1,en.type=en.buffer.dtype,en.offset=0,en.stride=0,en.divisor=0,en.state=1,Kr[ni]=1}else ar.getBuffer(Hr)?(en.buffer=ar.getBuffer(Hr),en.size=en.buffer.dimension|0,en.normalized=!1,en.type=en.buffer.dtype,en.offset=0,en.stride=0,en.divisor=0,en.state=1):ar.getBuffer(Hr.buffer)?(en.buffer=ar.getBuffer(Hr.buffer),en.size=(+Hr.size||en.buffer.dimension)|0,en.normalized=!!Hr.normalized||!1,"type"in Hr?(de.parameter(Hr.type,eu,"invalid buffer type"),en.type=eu[Hr.type]):en.type=en.buffer.dtype,en.offset=(Hr.offset||0)|0,en.stride=(Hr.stride||0)|0,en.divisor=(Hr.divisor||0)|0,en.state=1,de(en.size>=1&&en.size<=4,"size must be between 1 and 4"),de(en.offset>=0,"invalid offset"),de(en.stride>=0&&en.stride<=255,"stride must be between 0 and 255"),de(en.divisor>=0,"divisor must be positive"),de(!en.divisor||!!me.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Hr?(de(ni>0,"first attribute must not be a constant"),en.x=+Hr.x||0,en.y=+Hr.y||0,en.z=+Hr.z||0,en.w=+Hr.w||0,en.state=2):de(!1,"invalid attribute spec for location "+ni)}for(var Ni=0;Ni<rr.buffers.length;++Ni)!Kr[Ni]&&rr.buffers[Ni]&&(rr.buffers[Ni].destroy(),rr.buffers[Ni]=null);return rr.refresh(),gn}return gn.destroy=function(){for(var Zr=0;Zr<rr.buffers.length;++Zr)rr.buffers[Zr]&&rr.buffers[Zr].destroy();rr.buffers.length=0,rr.ownsElements&&(rr.elements.destroy(),rr.elements=null,rr.ownsElements=!1),rr.destroy()},gn._vao=rr,gn._reglType="vao",gn(Qt)}return Ur}var Gt=35632,Ft=35633,Xt=35718,cr=35721;function Rr(B,me,Ne,It){var ar={},Mt={};function Jt(st,Zt,yr,Dr){this.name=st,this.id=Zt,this.location=yr,this.info=Dr}function lr(st,Zt){for(var yr=0;yr<st.length;++yr)if(st[yr].id===Zt.id){st[yr].location=Zt.location;return}st.push(Zt)}function vr(st,Zt,yr){var Dr=st===Gt?ar:Mt,ur=Dr[Zt];if(!ur){var Mr=me.str(Zt);ur=B.createShader(st),B.shaderSource(ur,Mr),B.compileShader(ur),de.shaderError(B,ur,Mr,st,yr),Dr[Zt]=ur}return ur}var _r={},wr=[],Ar=0;function Ur(st,Zt){this.id=Ar++,this.fragId=st,this.vertId=Zt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,It.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function gr(st,Zt,yr){var Dr,ur,Mr=vr(Gt,st.fragId),Xr=vr(Ft,st.vertId),zn=st.program=B.createProgram();if(B.attachShader(zn,Mr),B.attachShader(zn,Xr),yr)for(Dr=0;Dr<yr.length;++Dr){var Qt=yr[Dr];B.bindAttribLocation(zn,Qt[0],Qt[1])}B.linkProgram(zn),de.linkError(B,zn,me.str(st.fragId),me.str(st.vertId),Zt);var rr=B.getProgramParameter(zn,Xt);It.profile&&(st.stats.uniformsCount=rr);var gn=st.uniforms;for(Dr=0;Dr<rr;++Dr)if(ur=B.getActiveUniform(zn,Dr),ur)if(ur.size>1)for(var Zr=0;Zr<ur.size;++Zr){var xr=ur.name.replace("[0]","["+Zr+"]");lr(gn,new Jt(xr,me.id(xr),B.getUniformLocation(zn,xr),ur))}else lr(gn,new Jt(ur.name,me.id(ur.name),B.getUniformLocation(zn,ur.name),ur));var Yr=B.getProgramParameter(zn,cr);It.profile&&(st.stats.attributesCount=Yr);var Kr=st.attributes;for(Dr=0;Dr<Yr;++Dr)ur=B.getActiveAttrib(zn,Dr),ur&&lr(Kr,new Jt(ur.name,me.id(ur.name),B.getAttribLocation(zn,ur.name),ur))}It.profile&&(Ne.getMaxUniformsCount=function(){var st=0;return wr.forEach(function(Zt){Zt.stats.uniformsCount>st&&(st=Zt.stats.uniformsCount)}),st},Ne.getMaxAttributesCount=function(){var st=0;return wr.forEach(function(Zt){Zt.stats.attributesCount>st&&(st=Zt.stats.attributesCount)}),st});function Er(){ar={},Mt={};for(var st=0;st<wr.length;++st)gr(wr[st],null,wr[st].attributes.map(function(Zt){return[Zt.location,Zt.name]}))}return{clear:function(){var st=B.deleteShader.bind(B);ae(ar).forEach(st),ar={},ae(Mt).forEach(st),Mt={},wr.forEach(function(Zt){B.deleteProgram(Zt.program)}),wr.length=0,_r={},Ne.shaderCount=0},program:function(st,Zt,yr,Dr){de.command(st>=0,"missing vertex shader",yr),de.command(Zt>=0,"missing fragment shader",yr);var ur=_r[Zt];ur||(ur=_r[Zt]={});var Mr=ur[st];if(Mr&&(Mr.refCount++,!Dr))return Mr;var Xr=new Ur(Zt,st);return Ne.shaderCount++,gr(Xr,yr,Dr),Mr||(ur[st]=Xr),wr.push(Xr),m(Xr,{destroy:function(){if(Xr.refCount--,Xr.refCount<=0){B.deleteProgram(Xr.program);var zn=wr.indexOf(Xr);wr.splice(zn,1),Ne.shaderCount--}ur[Xr.vertId].refCount<=0&&(B.deleteShader(Mt[Xr.vertId]),delete Mt[Xr.vertId],delete _r[Xr.fragId][Xr.vertId]),Object.keys(_r[Xr.fragId]).length||(B.deleteShader(ar[Xr.fragId]),delete ar[Xr.fragId],delete _r[Xr.fragId])}})},restore:Er,shader:vr,frag:-1,vert:-1}}var Or=6408,Qr=5121,Dn=3333,Bn=5126;function Un(B,me,Ne,It,ar,Mt,Jt){function lr(wr){var Ar;me.next===null?(de(ar.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ar=Qr):(de(me.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ar=me.next.colorAttachments[0].texture._texture.type,de.optional(function(){Mt.oes_texture_float?(de(Ar===Qr||Ar===Bn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ar===Bn&&de(Jt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):de(Ar===Qr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Ur=0,gr=0,Er=It.framebufferWidth,st=It.framebufferHeight,Zt=null;j(wr)?Zt=wr:wr&&(de.type(wr,"object","invalid arguments to regl.read()"),Ur=wr.x|0,gr=wr.y|0,de(Ur>=0&&Ur<It.framebufferWidth,"invalid x offset for regl.read"),de(gr>=0&&gr<It.framebufferHeight,"invalid y offset for regl.read"),Er=(wr.width||It.framebufferWidth-Ur)|0,st=(wr.height||It.framebufferHeight-gr)|0,Zt=wr.data||null),Zt&&(Ar===Qr?de(Zt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ar===Bn&&de(Zt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),de(Er>0&&Er+Ur<=It.framebufferWidth,"invalid width for read pixels"),de(st>0&&st+gr<=It.framebufferHeight,"invalid height for read pixels"),Ne();var yr=Er*st*4;return Zt||(Ar===Qr?Zt=new Uint8Array(yr):Ar===Bn&&(Zt=Zt||new Float32Array(yr))),de.isTypedArray(Zt,"data buffer for regl.read() must be a typedarray"),de(Zt.byteLength>=yr,"data buffer for regl.read() too small"),B.pixelStorei(Dn,4),B.readPixels(Ur,gr,Er,st,Or,Ar,Zt),Zt}function vr(wr){var Ar;return me.setFBO({framebuffer:wr.framebuffer},function(){Ar=lr(wr)}),Ar}function _r(wr){return!wr||!("framebuffer"in wr)?lr(wr):vr(wr)}return _r}function di(B){return Array.prototype.slice.call(B)}function nn(B){return di(B).join("")}function ai(){var B=0,me=[],Ne=[];function It(Ar){for(var Ur=0;Ur<Ne.length;++Ur)if(Ne[Ur]===Ar)return me[Ur];var gr="g"+B++;return me.push(gr),Ne.push(Ar),gr}function ar(){var Ar=[];function Ur(){Ar.push.apply(Ar,di(arguments))}var gr=[];function Er(){var st="v"+B++;return gr.push(st),arguments.length>0&&(Ar.push(st,"="),Ar.push.apply(Ar,di(arguments)),Ar.push(";")),st}return m(Ur,{def:Er,toString:function(){return nn([gr.length>0?"var "+gr.join(",")+";":"",nn(Ar)])}})}function Mt(){var Ar=ar(),Ur=ar(),gr=Ar.toString,Er=Ur.toString;function st(Zt,yr){Ur(Zt,yr,"=",Ar.def(Zt,yr),";")}return m(function(){Ar.apply(Ar,di(arguments))},{def:Ar.def,entry:Ar,exit:Ur,save:st,set:function(Zt,yr,Dr){st(Zt,yr),Ar(Zt,yr,"=",Dr,";")},toString:function(){return gr()+Er()}})}function Jt(){var Ar=nn(arguments),Ur=Mt(),gr=Mt(),Er=Ur.toString,st=gr.toString;return m(Ur,{then:function(){return Ur.apply(Ur,di(arguments)),this},else:function(){return gr.apply(gr,di(arguments)),this},toString:function(){var Zt=st();return Zt&&(Zt="else{"+Zt+"}"),nn(["if(",Ar,"){",Er(),"}",Zt])}})}var lr=ar(),vr={};function _r(Ar,Ur){var gr=[];function Er(){var ur="a"+gr.length;return gr.push(ur),ur}Ur=Ur||0;for(var st=0;st<Ur;++st)Er();var Zt=Mt(),yr=Zt.toString,Dr=vr[Ar]=m(Zt,{arg:Er,toString:function(){return nn(["function(",gr.join(),"){",yr(),"}"])}});return Dr}function wr(){var Ar=['"use strict";',lr,"return {"];Object.keys(vr).forEach(function(st){Ar.push('"',st,'":',vr[st].toString(),",")}),Ar.push("}");var Ur=nn(Ar).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),gr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Er=gr?X.Function.apply(null,me.concat(Ur)):Function.apply(null,me.concat(Ur));return Er.apply(null,Ne)}return{global:lr,link:It,block:ar,proc:_r,scope:Mt,cond:Jt,compile:wr}}var si="xyzw".split(""),ei=5121,Wn=1,mi=2,$n=0,jn=1,Ea=2,Ka=3,Bo=4,wo=5,Va=6,no="dither",Es="blend.enable",os="blend.color",ku="blend.equation",ss="blend.func",qs="depth.enable",$s="depth.func",fc="depth.range",Bl="depth.mask",mu="colorMask",vl="cull.enable",hc="cull.face",ou="frontFace",zl="lineWidth",gu="polygonOffset.enable",yo="polygonOffset.offset",yu="sample.alpha",Ku="sample.enable",Du="sample.coverage",Ji="stencil.enable",Us="stencil.mask",us="stencil.func",qu="stencil.opFront",Bc="stencil.opBack",zc="scissor.enable",vf="scissor.box",$o="viewport",pc="profile",su="framebuffer",ml="vert",Uc="frag",uu="elements",To="primitive",Zc="count",Vf="offset",jf="instances",mf="vao",Yh="Width",Kh="Height",dc=su+Yh,gf=su+Kh,Sh=$o+Yh,yd=$o+Kh,Lr="drawingBuffer",yf=Lr+Yh,qt=Lr+Kh,_d=[ss,ku,us,qu,Bc,Du,$o,vf,yo],_f=34962,wh=34963,Bp=35632,zp=35633,Up=3553,Th=34067,Gf=2884,xf=3042,xd=3024,_o=2960,Hf=2929,qh=3089,Wf=32823,Xf=32926,Yf=32928,Kf=5126,bf=35664,gl=35665,Ef=35666,qf=5124,Ah=35667,vc=35668,Ch=35669,$f=35670,Mh=35671,Vc=35672,Sf=35673,Zs=35674,Jf=35675,Ph=35676,Qf=35678,wf=35680,eh=4,yl=1028,mc=1029,$h=2304,Ih=2305,Zp=32775,bd=32776,Vp=519,Os=7680,jp=0,Aa=1,_u=32774,$u=513,Gp=36160,Hp=36064,_l={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},jc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Gc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ju={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Wp={frag:Bp,vert:zp},Jh={cw:$h,ccw:Ih};function xu(B){return Array.isArray(B)||j(B)||ds(B)}function Hc(B){return B.sort(function(me,Ne){return me===$o?-1:Ne===$o?1:me<Ne?-1:1})}function ea(B,me,Ne,It){this.thisDep=B,this.contextDep=me,this.propDep=Ne,this.append=It}function gc(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function lo(B){return new ea(!1,!1,!1,B)}function Rs(B,me){var Ne=B.type;if(Ne===$n){var It=B.data.length;return new ea(!0,It>=1,It>=2,me)}else if(Ne===Bo){var ar=B.data;return new ea(ar.thisDep,ar.contextDep,ar.propDep,me)}else{if(Ne===wo)return new ea(!1,!1,!1,me);if(Ne===Va){for(var Mt=!1,Jt=!1,lr=!1,vr=0;vr<B.data.length;++vr){var _r=B.data[vr];if(_r.type===jn)lr=!0;else if(_r.type===Ea)Jt=!0;else if(_r.type===Ka)Mt=!0;else if(_r.type===$n){Mt=!0;var wr=_r.data;wr>=1&&(Jt=!0),wr>=2&&(lr=!0)}else _r.type===Bo&&(Mt=Mt||_r.data.thisDep,Jt=Jt||_r.data.contextDep,lr=lr||_r.data.propDep)}return new ea(Mt,Jt,lr,me)}else return new ea(Ne===Ka,Ne===Ea,Ne===jn,me)}}var Oh=new ea(!1,!1,!1,function(){});function Qh(B,me,Ne,It,ar,Mt,Jt,lr,vr,_r,wr,Ar,Ur,gr,Er){var st=_r.Record,Zt={add:32774,subtract:32778,"reverse subtract":32779};Ne.ext_blend_minmax&&(Zt.min=Zp,Zt.max=bd);var yr=Ne.angle_instanced_arrays,Dr=Ne.webgl_draw_buffers,ur=Ne.oes_vertex_array_object,Mr={dirty:!0,profile:Er.profile},Xr={},zn=[],Qt={},rr={};function gn(Ee){return Ee.replace(".","_")}function Zr(Ee,ue,je){var lt=gn(Ee);zn.push(Ee),Xr[lt]=Mr[lt]=!!je,Qt[lt]=ue}function xr(Ee,ue,je){var lt=gn(Ee);zn.push(Ee),Array.isArray(je)?(Mr[lt]=je.slice(),Xr[lt]=je.slice()):Mr[lt]=Xr[lt]=je,rr[lt]=ue}Zr(no,xd),Zr(Es,xf),xr(os,"blendColor",[0,0,0,0]),xr(ku,"blendEquationSeparate",[_u,_u]),xr(ss,"blendFuncSeparate",[Aa,jp,Aa,jp]),Zr(qs,Hf,!0),xr($s,"depthFunc",$u),xr(fc,"depthRange",[0,1]),xr(Bl,"depthMask",!0),xr(mu,mu,[!0,!0,!0,!0]),Zr(vl,Gf),xr(hc,"cullFace",mc),xr(ou,ou,Ih),xr(zl,zl,1),Zr(gu,Wf),xr(yo,"polygonOffset",[0,0]),Zr(yu,Xf),Zr(Ku,Yf),xr(Du,"sampleCoverage",[1,!1]),Zr(Ji,_o),xr(Us,"stencilMask",-1),xr(us,"stencilFunc",[Vp,0,-1]),xr(qu,"stencilOpSeparate",[yl,Os,Os,Os]),xr(Bc,"stencilOpSeparate",[mc,Os,Os,Os]),Zr(zc,qh),xr(vf,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),xr($o,$o,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var Yr={gl:B,context:Ur,strings:me,next:Xr,current:Mr,draw:Ar,elements:Mt,buffer:ar,shader:wr,attributes:_r.state,vao:_r,uniforms:vr,framebuffer:lr,extensions:Ne,timer:gr,isBufferArgs:xu},Kr={primTypes:ir,compareFuncs:Gc,blendFuncs:_l,blendEquations:Zt,stencilOps:Ju,glTypes:eu,orientationType:Jh};de.optional(function(){Yr.isArrayLike=so}),Dr&&(Kr.backBuffer=[mc],Kr.drawBuffer=Ge(It.maxDrawbuffers,function(Ee){return Ee===0?[0]:Ge(Ee,function(ue){return Hp+ue})}));var gi=0;function ni(){var Ee=ai(),ue=Ee.link,je=Ee.global;Ee.id=gi++,Ee.batchId="0";var lt=ue(Yr),At=Ee.shared={props:"a0"};Object.keys(Yr).forEach(function(Ze){At[Ze]=je.def(lt,".",Ze)}),de.optional(function(){Ee.CHECK=ue(de),Ee.commandStr=de.guessCommand(),Ee.command=ue(Ee.commandStr),Ee.assert=function(Ze,Se,ct){Ze("if(!(",Se,"))",this.CHECK,".commandRaise(",ue(ct),",",this.command,");")},Kr.invalidBlendCombinations=jc});var $e=Ee.next={},Fe=Ee.current={};Object.keys(rr).forEach(function(Ze){Array.isArray(Mr[Ze])&&($e[Ze]=je.def(At.next,".",Ze),Fe[Ze]=je.def(At.current,".",Ze))});var tt=Ee.constants={};Object.keys(Kr).forEach(function(Ze){tt[Ze]=je.def(JSON.stringify(Kr[Ze]))}),Ee.invoke=function(Ze,Se){switch(Se.type){case $n:var ct=["this",At.context,At.props,Ee.batchId];return Ze.def(ue(Se.data),".call(",ct.slice(0,Math.max(Se.data.length+1,4)),")");case jn:return Ze.def(At.props,Se.data);case Ea:return Ze.def(At.context,Se.data);case Ka:return Ze.def("this",Se.data);case Bo:return Se.data.append(Ee,Ze),Se.data.ref;case wo:return Se.data.toString();case Va:return Se.data.map(function(Et){return Ee.invoke(Ze,Et)})}},Ee.attribCache={};var ye={};return Ee.scopeAttrib=function(Ze){var Se=me.id(Ze);if(Se in ye)return ye[Se];var ct=_r.scope[Se];ct||(ct=_r.scope[Se]=new st);var Et=ye[Se]=ue(ct);return Et},Ee}function Hr(Ee){var ue=Ee.static,je=Ee.dynamic,lt;if(pc in ue){var At=!!ue[pc];lt=lo(function(Fe,tt){return At}),lt.enable=At}else if(pc in je){var $e=je[pc];lt=Rs($e,function(Fe,tt){return Fe.invoke(tt,$e)})}return lt}function en(Ee,ue){var je=Ee.static,lt=Ee.dynamic;if(su in je){var At=je[su];return At?(At=lr.getFramebuffer(At),de.command(At,"invalid framebuffer object"),lo(function(Fe,tt){var ye=Fe.link(At),Ze=Fe.shared;tt.set(Ze.framebuffer,".next",ye);var Se=Ze.context;return tt.set(Se,"."+dc,ye+".width"),tt.set(Se,"."+gf,ye+".height"),ye})):lo(function(Fe,tt){var ye=Fe.shared;tt.set(ye.framebuffer,".next","null");var Ze=ye.context;return tt.set(Ze,"."+dc,Ze+"."+yf),tt.set(Ze,"."+gf,Ze+"."+qt),"null"})}else if(su in lt){var $e=lt[su];return Rs($e,function(Fe,tt){var ye=Fe.invoke(tt,$e),Ze=Fe.shared,Se=Ze.framebuffer,ct=tt.def(Se,".getFramebuffer(",ye,")");de.optional(function(){Fe.assert(tt,"!"+ye+"||"+ct,"invalid framebuffer object")}),tt.set(Se,".next",ct);var Et=Ze.context;return tt.set(Et,"."+dc,ct+"?"+ct+".width:"+Et+"."+yf),tt.set(Et,"."+gf,ct+"?"+ct+".height:"+Et+"."+qt),ct})}else return null}function Jn(Ee,ue,je){var lt=Ee.static,At=Ee.dynamic;function $e(ye){if(ye in lt){var Ze=lt[ye];de.commandType(Ze,"object","invalid "+ye,je.commandStr);var Se=!0,ct=Ze.x|0,Et=Ze.y|0,fr,Nr;return"width"in Ze?(fr=Ze.width|0,de.command(fr>=0,"invalid "+ye,je.commandStr)):Se=!1,"height"in Ze?(Nr=Ze.height|0,de.command(Nr>=0,"invalid "+ye,je.commandStr)):Se=!1,new ea(!Se&&ue&&ue.thisDep,!Se&&ue&&ue.contextDep,!Se&&ue&&ue.propDep,function(kr,En){var on=kr.shared.context,_n=fr;"width"in Ze||(_n=En.def(on,".",dc,"-",ct));var yn=Nr;return"height"in Ze||(yn=En.def(on,".",gf,"-",Et)),[ct,Et,_n,yn]})}else if(ye in At){var Br=At[ye],rn=Rs(Br,function(kr,En){var on=kr.invoke(En,Br);de.optional(function(){kr.assert(En,on+"&&typeof "+on+'==="object"',"invalid "+ye)});var _n=kr.shared.context,yn=En.def(on,".x|0"),pn=En.def(on,".y|0"),Qn=En.def('"width" in ',on,"?",on,".width|0:","(",_n,".",dc,"-",yn,")"),va=En.def('"height" in ',on,"?",on,".height|0:","(",_n,".",gf,"-",pn,")");return de.optional(function(){kr.assert(En,Qn+">=0&&"+va+">=0","invalid "+ye)}),[yn,pn,Qn,va]});return ue&&(rn.thisDep=rn.thisDep||ue.thisDep,rn.contextDep=rn.contextDep||ue.contextDep,rn.propDep=rn.propDep||ue.propDep),rn}else return ue?new ea(ue.thisDep,ue.contextDep,ue.propDep,function(kr,En){var on=kr.shared.context;return[0,0,En.def(on,".",dc),En.def(on,".",gf)]}):null}var Fe=$e($o);if(Fe){var tt=Fe;Fe=new ea(Fe.thisDep,Fe.contextDep,Fe.propDep,function(ye,Ze){var Se=tt.append(ye,Ze),ct=ye.shared.context;return Ze.set(ct,"."+Sh,Se[2]),Ze.set(ct,"."+yd,Se[3]),Se})}return{viewport:Fe,scissor_box:$e(vf)}}function ui(Ee,ue){var je=Ee.static,lt=typeof je[Uc]=="string"&&typeof je[ml]=="string";if(lt){if(Object.keys(ue.dynamic).length>0)return null;var At=ue.static,$e=Object.keys(At);if($e.length>0&&typeof At[$e[0]]=="number"){for(var Fe=[],tt=0;tt<$e.length;++tt)de(typeof At[$e[tt]]=="number","must specify all vertex attribute locations when using vaos"),Fe.push([At[$e[tt]]|0,$e[tt]]);return Fe}}return null}function Ni(Ee,ue,je){var lt=Ee.static,At=Ee.dynamic;function $e(Se){if(Se in lt){var ct=me.id(lt[Se]);de.optional(function(){wr.shader(Wp[Se],ct,de.guessCommand())});var Et=lo(function(){return ct});return Et.id=ct,Et}else if(Se in At){var fr=At[Se];return Rs(fr,function(Nr,Br){var rn=Nr.invoke(Br,fr),kr=Br.def(Nr.shared.strings,".id(",rn,")");return de.optional(function(){Br(Nr.shared.shader,".shader(",Wp[Se],",",kr,",",Nr.command,");")}),kr})}return null}var Fe=$e(Uc),tt=$e(ml),ye=null,Ze;return gc(Fe)&&gc(tt)?(ye=wr.program(tt.id,Fe.id,null,je),Ze=lo(function(Se,ct){return Se.link(ye)})):Ze=new ea(Fe&&Fe.thisDep||tt&&tt.thisDep,Fe&&Fe.contextDep||tt&&tt.contextDep,Fe&&Fe.propDep||tt&&tt.propDep,function(Se,ct){var Et=Se.shared.shader,fr;Fe?fr=Fe.append(Se,ct):fr=ct.def(Et,".",Uc);var Nr;tt?Nr=tt.append(Se,ct):Nr=ct.def(Et,".",ml);var Br=Et+".program("+Nr+","+fr;return de.optional(function(){Br+=","+Se.command}),ct.def(Br+")")}),{frag:Fe,vert:tt,progVar:Ze,program:ye}}function qa(Ee,ue){var je=Ee.static,lt=Ee.dynamic,At={},$e=!1;function Fe(){if(mf in je){var En=je[mf];return En!==null&&_r.getVAO(En)===null&&(En=_r.createVAO(En)),$e=!0,At.vao=En,lo(function(_n){var yn=_r.getVAO(En);return yn?_n.link(yn):"null"})}else if(mf in lt){$e=!0;var on=lt[mf];return Rs(on,function(_n,yn){var pn=_n.invoke(yn,on);return yn.def(_n.shared.vao+".getVAO("+pn+")")})}return null}var tt=Fe(),ye=!1;function Ze(){if(uu in je){var En=je[uu];if(At.elements=En,xu(En)){var on=At.elements=Mt.create(En,!0);En=Mt.getElements(on),ye=!0}else En&&(En=Mt.getElements(En),ye=!0,de.command(En,"invalid elements",ue.commandStr));var _n=lo(function(pn,Qn){if(En){var va=pn.link(En);return pn.ELEMENTS=va,va}return pn.ELEMENTS=null,null});return _n.value=En,_n}else if(uu in lt){ye=!0;var yn=lt[uu];return Rs(yn,function(pn,Qn){var va=pn.shared,Qo=va.isBufferArgs,Oa=va.elements,fa=pn.invoke(Qn,yn),Ls=Qn.def("null"),Mo=Qn.def(Qo,"(",fa,")"),Fu=pn.cond(Mo).then(Ls,"=",Oa,".createStream(",fa,");").else(Ls,"=",Oa,".getElements(",fa,");");return de.optional(function(){pn.assert(Fu.else,"!"+fa+"||"+Ls,"invalid elements")}),Qn.entry(Fu),Qn.exit(pn.cond(Mo).then(Oa,".destroyStream(",Ls,");")),pn.ELEMENTS=Ls,Ls})}else if($e)return new ea(tt.thisDep,tt.contextDep,tt.propDep,function(pn,Qn){return Qn.def(pn.shared.vao+".currentVAO?"+pn.shared.elements+".getElements("+pn.shared.vao+".currentVAO.elements):null")});return null}var Se=Ze();function ct(){if(To in je){var En=je[To];return At.primitive=En,de.commandParameter(En,ir,"invalid primitve",ue.commandStr),lo(function(_n,yn){return ir[En]})}else if(To in lt){var on=lt[To];return Rs(on,function(_n,yn){var pn=_n.constants.primTypes,Qn=_n.invoke(yn,on);return de.optional(function(){_n.assert(yn,Qn+" in "+pn,"invalid primitive, must be one of "+Object.keys(ir))}),yn.def(pn,"[",Qn,"]")})}else{if(ye)return gc(Se)?Se.value?lo(function(_n,yn){return yn.def(_n.ELEMENTS,".primType")}):lo(function(){return eh}):new ea(Se.thisDep,Se.contextDep,Se.propDep,function(_n,yn){var pn=_n.ELEMENTS;return yn.def(pn,"?",pn,".primType:",eh)});if($e)return new ea(tt.thisDep,tt.contextDep,tt.propDep,function(_n,yn){return yn.def(_n.shared.vao+".currentVAO?"+_n.shared.vao+".currentVAO.primitive:"+eh)})}return null}function Et(En,on){if(En in je){var _n=je[En]|0;return on?At.offset=_n:At.instances=_n,de.command(!on||_n>=0,"invalid "+En,ue.commandStr),lo(function(pn,Qn){return on&&(pn.OFFSET=_n),_n})}else if(En in lt){var yn=lt[En];return Rs(yn,function(pn,Qn){var va=pn.invoke(Qn,yn);return on&&(pn.OFFSET=va,de.optional(function(){pn.assert(Qn,va+">=0","invalid "+En)})),va})}else if(on){if(ye)return lo(function(pn,Qn){return pn.OFFSET=0,0});if($e)return new ea(tt.thisDep,tt.contextDep,tt.propDep,function(pn,Qn){return Qn.def(pn.shared.vao+".currentVAO?"+pn.shared.vao+".currentVAO.offset:0")})}else if($e)return new ea(tt.thisDep,tt.contextDep,tt.propDep,function(pn,Qn){return Qn.def(pn.shared.vao+".currentVAO?"+pn.shared.vao+".currentVAO.instances:-1")});return null}var fr=Et(Vf,!0);function Nr(){if(Zc in je){var En=je[Zc]|0;return At.count=En,de.command(typeof En=="number"&&En>=0,"invalid vertex count",ue.commandStr),lo(function(){return En})}else if(Zc in lt){var on=lt[Zc];return Rs(on,function(Qn,va){var Qo=Qn.invoke(va,on);return de.optional(function(){Qn.assert(va,"typeof "+Qo+'==="number"&&'+Qo+">=0&&"+Qo+"===("+Qo+"|0)","invalid vertex count")}),Qo})}else if(ye)if(gc(Se)){if(Se)return fr?new ea(fr.thisDep,fr.contextDep,fr.propDep,function(Qn,va){var Qo=va.def(Qn.ELEMENTS,".vertCount-",Qn.OFFSET);return de.optional(function(){Qn.assert(va,Qo+">=0","invalid vertex offset/element buffer too small")}),Qo}):lo(function(Qn,va){return va.def(Qn.ELEMENTS,".vertCount")});var _n=lo(function(){return-1});return de.optional(function(){_n.MISSING=!0}),_n}else{var yn=new ea(Se.thisDep||fr.thisDep,Se.contextDep||fr.contextDep,Se.propDep||fr.propDep,function(Qn,va){var Qo=Qn.ELEMENTS;return Qn.OFFSET?va.def(Qo,"?",Qo,".vertCount-",Qn.OFFSET,":-1"):va.def(Qo,"?",Qo,".vertCount:-1")});return de.optional(function(){yn.DYNAMIC=!0}),yn}else if($e){var pn=new ea(tt.thisDep,tt.contextDep,tt.propDep,function(Qn,va){return va.def(Qn.shared.vao,".currentVAO?",Qn.shared.vao,".currentVAO.count:-1")});return pn}return null}var Br=ct(),rn=Nr(),kr=Et(jf,!1);return{elements:Se,primitive:Br,count:rn,instances:kr,offset:fr,vao:tt,vaoActive:$e,elementsActive:ye,static:At}}function io(Ee,ue){var je=Ee.static,lt=Ee.dynamic,At={};return zn.forEach(function($e){var Fe=gn($e);function tt(ye,Ze){if($e in je){var Se=ye(je[$e]);At[Fe]=lo(function(){return Se})}else if($e in lt){var ct=lt[$e];At[Fe]=Rs(ct,function(Et,fr){return Ze(Et,fr,Et.invoke(fr,ct))})}}switch($e){case vl:case Es:case no:case Ji:case qs:case zc:case gu:case yu:case Ku:case Bl:return tt(function(ye){return de.commandType(ye,"boolean",$e,ue.commandStr),ye},function(ye,Ze,Se){return de.optional(function(){ye.assert(Ze,"typeof "+Se+'==="boolean"',"invalid flag "+$e,ye.commandStr)}),Se});case $s:return tt(function(ye){return de.commandParameter(ye,Gc,"invalid "+$e,ue.commandStr),Gc[ye]},function(ye,Ze,Se){var ct=ye.constants.compareFuncs;return de.optional(function(){ye.assert(Ze,Se+" in "+ct,"invalid "+$e+", must be one of "+Object.keys(Gc))}),Ze.def(ct,"[",Se,"]")});case fc:return tt(function(ye){return de.command(so(ye)&&ye.length===2&&typeof ye[0]=="number"&&typeof ye[1]=="number"&&ye[0]<=ye[1],"depth range is 2d array",ue.commandStr),ye},function(ye,Ze,Se){de.optional(function(){ye.assert(Ze,ye.shared.isArrayLike+"("+Se+")&&"+Se+".length===2&&typeof "+Se+'[0]==="number"&&typeof '+Se+'[1]==="number"&&'+Se+"[0]<="+Se+"[1]","depth range must be a 2d array")});var ct=Ze.def("+",Se,"[0]"),Et=Ze.def("+",Se,"[1]");return[ct,Et]});case ss:return tt(function(ye){de.commandType(ye,"object","blend.func",ue.commandStr);var Ze="srcRGB"in ye?ye.srcRGB:ye.src,Se="srcAlpha"in ye?ye.srcAlpha:ye.src,ct="dstRGB"in ye?ye.dstRGB:ye.dst,Et="dstAlpha"in ye?ye.dstAlpha:ye.dst;return de.commandParameter(Ze,_l,Fe+".srcRGB",ue.commandStr),de.commandParameter(Se,_l,Fe+".srcAlpha",ue.commandStr),de.commandParameter(ct,_l,Fe+".dstRGB",ue.commandStr),de.commandParameter(Et,_l,Fe+".dstAlpha",ue.commandStr),de.command(jc.indexOf(Ze+", "+ct)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ze+", "+ct+")",ue.commandStr),[_l[Ze],_l[ct],_l[Se],_l[Et]]},function(ye,Ze,Se){var ct=ye.constants.blendFuncs;de.optional(function(){ye.assert(Ze,Se+"&&typeof "+Se+'==="object"',"invalid blend func, must be an object")});function Et(on,_n){var yn=Ze.def('"',on,_n,'" in ',Se,"?",Se,".",on,_n,":",Se,".",on);return de.optional(function(){ye.assert(Ze,yn+" in "+ct,"invalid "+$e+"."+on+_n+", must be one of "+Object.keys(_l))}),yn}var fr=Et("src","RGB"),Nr=Et("dst","RGB");de.optional(function(){var on=ye.constants.invalidBlendCombinations;ye.assert(Ze,on+".indexOf("+fr+'+", "+'+Nr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Br=Ze.def(ct,"[",fr,"]"),rn=Ze.def(ct,"[",Et("src","Alpha"),"]"),kr=Ze.def(ct,"[",Nr,"]"),En=Ze.def(ct,"[",Et("dst","Alpha"),"]");return[Br,kr,rn,En]});case ku:return tt(function(ye){if(typeof ye=="string")return de.commandParameter(ye,Zt,"invalid "+$e,ue.commandStr),[Zt[ye],Zt[ye]];if(typeof ye=="object")return de.commandParameter(ye.rgb,Zt,$e+".rgb",ue.commandStr),de.commandParameter(ye.alpha,Zt,$e+".alpha",ue.commandStr),[Zt[ye.rgb],Zt[ye.alpha]];de.commandRaise("invalid blend.equation",ue.commandStr)},function(ye,Ze,Se){var ct=ye.constants.blendEquations,Et=Ze.def(),fr=Ze.def(),Nr=ye.cond("typeof ",Se,'==="string"');return de.optional(function(){function Br(rn,kr,En){ye.assert(rn,En+" in "+ct,"invalid "+kr+", must be one of "+Object.keys(Zt))}Br(Nr.then,$e,Se),ye.assert(Nr.else,Se+"&&typeof "+Se+'==="object"',"invalid "+$e),Br(Nr.else,$e+".rgb",Se+".rgb"),Br(Nr.else,$e+".alpha",Se+".alpha")}),Nr.then(Et,"=",fr,"=",ct,"[",Se,"];"),Nr.else(Et,"=",ct,"[",Se,".rgb];",fr,"=",ct,"[",Se,".alpha];"),Ze(Nr),[Et,fr]});case os:return tt(function(ye){return de.command(so(ye)&&ye.length===4,"blend.color must be a 4d array",ue.commandStr),Ge(4,function(Ze){return+ye[Ze]})},function(ye,Ze,Se){return de.optional(function(){ye.assert(Ze,ye.shared.isArrayLike+"("+Se+")&&"+Se+".length===4","blend.color must be a 4d array")}),Ge(4,function(ct){return Ze.def("+",Se,"[",ct,"]")})});case Us:return tt(function(ye){return de.commandType(ye,"number",Fe,ue.commandStr),ye|0},function(ye,Ze,Se){return de.optional(function(){ye.assert(Ze,"typeof "+Se+'==="number"',"invalid stencil.mask")}),Ze.def(Se,"|0")});case us:return tt(function(ye){de.commandType(ye,"object",Fe,ue.commandStr);var Ze=ye.cmp||"keep",Se=ye.ref||0,ct="mask"in ye?ye.mask:-1;return de.commandParameter(Ze,Gc,$e+".cmp",ue.commandStr),de.commandType(Se,"number",$e+".ref",ue.commandStr),de.commandType(ct,"number",$e+".mask",ue.commandStr),[Gc[Ze],Se,ct]},function(ye,Ze,Se){var ct=ye.constants.compareFuncs;de.optional(function(){function Br(){ye.assert(Ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Br(Se+"&&typeof ",Se,'==="object"'),Br('!("cmp" in ',Se,")||(",Se,".cmp in ",ct,")")});var Et=Ze.def('"cmp" in ',Se,"?",ct,"[",Se,".cmp]",":",Os),fr=Ze.def(Se,".ref|0"),Nr=Ze.def('"mask" in ',Se,"?",Se,".mask|0:-1");return[Et,fr,Nr]});case qu:case Bc:return tt(function(ye){de.commandType(ye,"object",Fe,ue.commandStr);var Ze=ye.fail||"keep",Se=ye.zfail||"keep",ct=ye.zpass||"keep";return de.commandParameter(Ze,Ju,$e+".fail",ue.commandStr),de.commandParameter(Se,Ju,$e+".zfail",ue.commandStr),de.commandParameter(ct,Ju,$e+".zpass",ue.commandStr),[$e===Bc?mc:yl,Ju[Ze],Ju[Se],Ju[ct]]},function(ye,Ze,Se){var ct=ye.constants.stencilOps;de.optional(function(){ye.assert(Ze,Se+"&&typeof "+Se+'==="object"',"invalid "+$e)});function Et(fr){return de.optional(function(){ye.assert(Ze,'!("'+fr+'" in '+Se+")||("+Se+"."+fr+" in "+ct+")","invalid "+$e+"."+fr+", must be one of "+Object.keys(Ju))}),Ze.def('"',fr,'" in ',Se,"?",ct,"[",Se,".",fr,"]:",Os)}return[$e===Bc?mc:yl,Et("fail"),Et("zfail"),Et("zpass")]});case yo:return tt(function(ye){de.commandType(ye,"object",Fe,ue.commandStr);var Ze=ye.factor|0,Se=ye.units|0;return de.commandType(Ze,"number",Fe+".factor",ue.commandStr),de.commandType(Se,"number",Fe+".units",ue.commandStr),[Ze,Se]},function(ye,Ze,Se){de.optional(function(){ye.assert(Ze,Se+"&&typeof "+Se+'==="object"',"invalid "+$e)});var ct=Ze.def(Se,".factor|0"),Et=Ze.def(Se,".units|0");return[ct,Et]});case hc:return tt(function(ye){var Ze=0;return ye==="front"?Ze=yl:ye==="back"&&(Ze=mc),de.command(!!Ze,Fe,ue.commandStr),Ze},function(ye,Ze,Se){return de.optional(function(){ye.assert(Ze,Se+'==="front"||'+Se+'==="back"',"invalid cull.face")}),Ze.def(Se,'==="front"?',yl,":",mc)});case zl:return tt(function(ye){return de.command(typeof ye=="number"&&ye>=It.lineWidthDims[0]&&ye<=It.lineWidthDims[1],"invalid line width, must be a positive number between "+It.lineWidthDims[0]+" and "+It.lineWidthDims[1],ue.commandStr),ye},function(ye,Ze,Se){return de.optional(function(){ye.assert(Ze,"typeof "+Se+'==="number"&&'+Se+">="+It.lineWidthDims[0]+"&&"+Se+"<="+It.lineWidthDims[1],"invalid line width")}),Se});case ou:return tt(function(ye){return de.commandParameter(ye,Jh,Fe,ue.commandStr),Jh[ye]},function(ye,Ze,Se){return de.optional(function(){ye.assert(Ze,Se+'==="cw"||'+Se+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ze.def(Se+'==="cw"?'+$h+":"+Ih)});case mu:return tt(function(ye){return de.command(so(ye)&&ye.length===4,"color.mask must be length 4 array",ue.commandStr),ye.map(function(Ze){return!!Ze})},function(ye,Ze,Se){return de.optional(function(){ye.assert(Ze,ye.shared.isArrayLike+"("+Se+")&&"+Se+".length===4","invalid color.mask")}),Ge(4,function(ct){return"!!"+Se+"["+ct+"]"})});case Du:return tt(function(ye){de.command(typeof ye=="object"&&ye,Fe,ue.commandStr);var Ze="value"in ye?ye.value:1,Se=!!ye.invert;return de.command(typeof Ze=="number"&&Ze>=0&&Ze<=1,"sample.coverage.value must be a number between 0 and 1",ue.commandStr),[Ze,Se]},function(ye,Ze,Se){de.optional(function(){ye.assert(Ze,Se+"&&typeof "+Se+'==="object"',"invalid sample.coverage")});var ct=Ze.def('"value" in ',Se,"?+",Se,".value:1"),Et=Ze.def("!!",Se,".invert");return[ct,Et]})}}),At}function Ri(Ee,ue){var je=Ee.static,lt=Ee.dynamic,At={};return Object.keys(je).forEach(function($e){var Fe=je[$e],tt;if(typeof Fe=="number"||typeof Fe=="boolean")tt=lo(function(){return Fe});else if(typeof Fe=="function"){var ye=Fe._reglType;ye==="texture2d"||ye==="textureCube"?tt=lo(function(Ze){return Ze.link(Fe)}):ye==="framebuffer"||ye==="framebufferCube"?(de.command(Fe.color.length>0,'missing color attachment for framebuffer sent to uniform "'+$e+'"',ue.commandStr),tt=lo(function(Ze){return Ze.link(Fe.color[0])})):de.commandRaise('invalid data for uniform "'+$e+'"',ue.commandStr)}else so(Fe)?tt=lo(function(Ze){var Se=Ze.global.def("[",Ge(Fe.length,function(ct){return de.command(typeof Fe[ct]=="number"||typeof Fe[ct]=="boolean","invalid uniform "+$e,Ze.commandStr),Fe[ct]}),"]");return Se}):de.commandRaise('invalid or missing data for uniform "'+$e+'"',ue.commandStr);tt.value=Fe,At[$e]=tt}),Object.keys(lt).forEach(function($e){var Fe=lt[$e];At[$e]=Rs(Fe,function(tt,ye){return tt.invoke(ye,Fe)})}),At}function Jo(Ee,ue){var je=Ee.static,lt=Ee.dynamic,At={};return Object.keys(je).forEach(function($e){var Fe=je[$e],tt=me.id($e),ye=new st;if(xu(Fe))ye.state=Wn,ye.buffer=ar.getBuffer(ar.create(Fe,_f,!1,!0)),ye.type=0;else{var Ze=ar.getBuffer(Fe);if(Ze)ye.state=Wn,ye.buffer=Ze,ye.type=0;else if(de.command(typeof Fe=="object"&&Fe,"invalid data for attribute "+$e,ue.commandStr),"constant"in Fe){var Se=Fe.constant;ye.buffer="null",ye.state=mi,typeof Se=="number"?ye.x=Se:(de.command(so(Se)&&Se.length>0&&Se.length<=4,"invalid constant for attribute "+$e,ue.commandStr),si.forEach(function(kr,En){En<Se.length&&(ye[kr]=Se[En])}))}else{xu(Fe.buffer)?Ze=ar.getBuffer(ar.create(Fe.buffer,_f,!1,!0)):Ze=ar.getBuffer(Fe.buffer),de.command(!!Ze,'missing buffer for attribute "'+$e+'"',ue.commandStr);var ct=Fe.offset|0;de.command(ct>=0,'invalid offset for attribute "'+$e+'"',ue.commandStr);var Et=Fe.stride|0;de.command(Et>=0&&Et<256,'invalid stride for attribute "'+$e+'", must be integer betweeen [0, 255]',ue.commandStr);var fr=Fe.size|0;de.command(!("size"in Fe)||fr>0&&fr<=4,'invalid size for attribute "'+$e+'", must be 1,2,3,4',ue.commandStr);var Nr=!!Fe.normalized,Br=0;"type"in Fe&&(de.commandParameter(Fe.type,eu,"invalid type for attribute "+$e,ue.commandStr),Br=eu[Fe.type]);var rn=Fe.divisor|0;de.optional(function(){"divisor"in Fe&&(de.command(rn===0||yr,'cannot specify divisor for attribute "'+$e+'", instancing not supported',ue.commandStr),de.command(rn>=0,'invalid divisor for attribute "'+$e+'"',ue.commandStr));var kr=ue.commandStr,En=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Fe).forEach(function(on){de.command(En.indexOf(on)>=0,'unknown parameter "'+on+'" for attribute pointer "'+$e+'" (valid parameters are '+En+")",kr)})}),ye.buffer=Ze,ye.state=Wn,ye.size=fr,ye.normalized=Nr,ye.type=Br||Ze.dtype,ye.offset=ct,ye.stride=Et,ye.divisor=rn}}At[$e]=lo(function(kr,En){var on=kr.attribCache;if(tt in on)return on[tt];var _n={isStream:!1};return Object.keys(ye).forEach(function(yn){_n[yn]=ye[yn]}),ye.buffer&&(_n.buffer=kr.link(ye.buffer),_n.type=_n.type||_n.buffer+".dtype"),on[tt]=_n,_n})}),Object.keys(lt).forEach(function($e){var Fe=lt[$e];function tt(ye,Ze){var Se=ye.invoke(Ze,Fe),ct=ye.shared,Et=ye.constants,fr=ct.isBufferArgs,Nr=ct.buffer;de.optional(function(){ye.assert(Ze,Se+"&&(typeof "+Se+'==="object"||typeof '+Se+'==="function")&&('+fr+"("+Se+")||"+Nr+".getBuffer("+Se+")||"+Nr+".getBuffer("+Se+".buffer)||"+fr+"("+Se+'.buffer)||("constant" in '+Se+"&&(typeof "+Se+'.constant==="number"||'+ct.isArrayLike+"("+Se+".constant))))",'invalid dynamic attribute "'+$e+'"')});var Br={isStream:Ze.def(!1)},rn=new st;rn.state=Wn,Object.keys(rn).forEach(function(_n){Br[_n]=Ze.def(""+rn[_n])});var kr=Br.buffer,En=Br.type;Ze("if(",fr,"(",Se,")){",Br.isStream,"=true;",kr,"=",Nr,".createStream(",_f,",",Se,");",En,"=",kr,".dtype;","}else{",kr,"=",Nr,".getBuffer(",Se,");","if(",kr,"){",En,"=",kr,".dtype;",'}else if("constant" in ',Se,"){",Br.state,"=",mi,";","if(typeof "+Se+'.constant === "number"){',Br[si[0]],"=",Se,".constant;",si.slice(1).map(function(_n){return Br[_n]}).join("="),"=0;","}else{",si.map(function(_n,yn){return Br[_n]+"="+Se+".constant.length>"+yn+"?"+Se+".constant["+yn+"]:0;"}).join(""),"}}else{","if(",fr,"(",Se,".buffer)){",kr,"=",Nr,".createStream(",_f,",",Se,".buffer);","}else{",kr,"=",Nr,".getBuffer(",Se,".buffer);","}",En,'="type" in ',Se,"?",Et.glTypes,"[",Se,".type]:",kr,".dtype;",Br.normalized,"=!!",Se,".normalized;");function on(_n){Ze(Br[_n],"=",Se,".",_n,"|0;")}return on("size"),on("offset"),on("stride"),on("divisor"),Ze("}}"),Ze.exit("if(",Br.isStream,"){",Nr,".destroyStream(",kr,");","}"),Br}At[$e]=Rs(Fe,tt)}),At}function ja(Ee){var ue=Ee.static,je=Ee.dynamic,lt={};return Object.keys(ue).forEach(function(At){var $e=ue[At];lt[At]=lo(function(Fe,tt){return typeof $e=="number"||typeof $e=="boolean"?""+$e:Fe.link($e)})}),Object.keys(je).forEach(function(At){var $e=je[At];lt[At]=Rs($e,function(Fe,tt){return Fe.invoke(tt,$e)})}),lt}function Wo(Ee,ue,je,lt,At){var $e=Ee.static,Fe=Ee.dynamic;de.optional(function(){var on=[su,ml,Uc,uu,To,Vf,Zc,jf,pc,mf].concat(zn);function _n(yn){Object.keys(yn).forEach(function(pn){de.command(on.indexOf(pn)>=0,'unknown parameter "'+pn+'"',At.commandStr)})}_n($e),_n(Fe)});var tt=ui(Ee,ue),ye=en(Ee,At),Ze=Jn(Ee,ye,At),Se=qa(Ee,At),ct=io(Ee,At),Et=Ni(Ee,At,tt);function fr(on){var _n=Ze[on];_n&&(ct[on]=_n)}fr($o),fr(gn(vf));var Nr=Object.keys(ct).length>0,Br={framebuffer:ye,draw:Se,shader:Et,state:ct,dirty:Nr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Br.profile=Hr(Ee,At),Br.uniforms=Ri(je,At),Br.drawVAO=Br.scopeVAO=Se.vao,!Br.drawVAO&&Et.program&&!tt&&Ne.angle_instanced_arrays&&Se.static.elements){var rn=!0,kr=Et.program.attributes.map(function(on){var _n=ue.static[on];return rn=rn&&!!_n,_n});if(rn&&kr.length>0){var En=_r.getVAO(_r.createVAO({attributes:kr,elements:Se.static.elements}));Br.drawVAO=new ea(null,null,null,function(on,_n){return on.link(En)}),Br.useVAO=!0}}return tt?Br.useVAO=!0:Br.attributes=Jo(ue,At),Br.context=ja(lt,At),Br}function Rn(Ee,ue,je){var lt=Ee.shared,At=lt.context,$e=Ee.scope();Object.keys(je).forEach(function(Fe){ue.save(At,"."+Fe);var tt=je[Fe],ye=tt.append(Ee,ue);Array.isArray(ye)?$e(At,".",Fe,"=[",ye.join(),"];"):$e(At,".",Fe,"=",ye,";")}),ue($e)}function Fn(Ee,ue,je,lt){var At=Ee.shared,$e=At.gl,Fe=At.framebuffer,tt;Dr&&(tt=ue.def(At.extensions,".webgl_draw_buffers"));var ye=Ee.constants,Ze=ye.drawBuffer,Se=ye.backBuffer,ct;je?ct=je.append(Ee,ue):ct=ue.def(Fe,".next"),lt||ue("if(",ct,"!==",Fe,".cur){"),ue("if(",ct,"){",$e,".bindFramebuffer(",Gp,",",ct,".framebuffer);"),Dr&&ue(tt,".drawBuffersWEBGL(",Ze,"[",ct,".colorAttachments.length]);"),ue("}else{",$e,".bindFramebuffer(",Gp,",null);"),Dr&&ue(tt,".drawBuffersWEBGL(",Se,");"),ue("}",Fe,".cur=",ct,";"),lt||ue("}")}function Ao(Ee,ue,je){var lt=Ee.shared,At=lt.gl,$e=Ee.current,Fe=Ee.next,tt=lt.current,ye=lt.next,Ze=Ee.cond(tt,".dirty");zn.forEach(function(Se){var ct=gn(Se);if(!(ct in je.state)){var Et,fr;if(ct in Fe){Et=Fe[ct],fr=$e[ct];var Nr=Ge(Mr[ct].length,function(rn){return Ze.def(Et,"[",rn,"]")});Ze(Ee.cond(Nr.map(function(rn,kr){return rn+"!=="+fr+"["+kr+"]"}).join("||")).then(At,".",rr[ct],"(",Nr,");",Nr.map(function(rn,kr){return fr+"["+kr+"]="+rn}).join(";"),";"))}else{Et=Ze.def(ye,".",ct);var Br=Ee.cond(Et,"!==",tt,".",ct);Ze(Br),ct in Qt?Br(Ee.cond(Et).then(At,".enable(",Qt[ct],");").else(At,".disable(",Qt[ct],");"),tt,".",ct,"=",Et,";"):Br(At,".",rr[ct],"(",Et,");",tt,".",ct,"=",Et,";")}}}),Object.keys(je.state).length===0&&Ze(tt,".dirty=false;"),ue(Ze)}function Ss(Ee,ue,je,lt){var At=Ee.shared,$e=Ee.current,Fe=At.current,tt=At.gl;Hc(Object.keys(je)).forEach(function(ye){var Ze=je[ye];if(!(lt&&!lt(Ze))){var Se=Ze.append(Ee,ue);if(Qt[ye]){var ct=Qt[ye];gc(Ze)?Se?ue(tt,".enable(",ct,");"):ue(tt,".disable(",ct,");"):ue(Ee.cond(Se).then(tt,".enable(",ct,");").else(tt,".disable(",ct,");")),ue(Fe,".",ye,"=",Se,";")}else if(so(Se)){var Et=$e[ye];ue(tt,".",rr[ye],"(",Se,");",Se.map(function(fr,Nr){return Et+"["+Nr+"]="+fr}).join(";"),";")}else ue(tt,".",rr[ye],"(",Se,");",Fe,".",ye,"=",Se,";")}})}function co(Ee,ue){yr&&(Ee.instancing=ue.def(Ee.shared.extensions,".angle_instanced_arrays"))}function xi(Ee,ue,je,lt,At){var $e=Ee.shared,Fe=Ee.stats,tt=$e.current,ye=$e.timer,Ze=je.profile;function Se(){var on=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return on||typeof performance=="undefined"?"Date.now()":"performance.now()"}var ct,Et;function fr(on){ct=ue.def(),on(ct,"=",Se(),";"),typeof At=="string"?on(Fe,".count+=",At,";"):on(Fe,".count++;"),gr&&(lt?(Et=ue.def(),on(Et,"=",ye,".getNumPendingQueries();")):on(ye,".beginQuery(",Fe,");"))}function Nr(on){on(Fe,".cpuTime+=",Se(),"-",ct,";"),gr&&(lt?on(ye,".pushScopeStats(",Et,",",ye,".getNumPendingQueries(),",Fe,");"):on(ye,".endQuery();"))}function Br(on){var _n=ue.def(tt,".profile");ue(tt,".profile=",on,";"),ue.exit(tt,".profile=",_n,";")}var rn;if(Ze){if(gc(Ze)){Ze.enable?(fr(ue),Nr(ue.exit),Br("true")):Br("false");return}rn=Ze.append(Ee,ue),Br(rn)}else rn=ue.def(tt,".profile");var kr=Ee.block();fr(kr),ue("if(",rn,"){",kr,"}");var En=Ee.block();Nr(En),ue.exit("if(",rn,"){",En,"}")}function Xo(Ee,ue,je,lt,At){var $e=Ee.shared;function Fe(ye){switch(ye){case bf:case Ah:case Mh:return 2;case gl:case vc:case Vc:return 3;case Ef:case Ch:case Sf:return 4;default:return 1}}function tt(ye,Ze,Se){var ct=$e.gl,Et=ue.def(ye,".location"),fr=ue.def($e.attributes,"[",Et,"]"),Nr=Se.state,Br=Se.buffer,rn=[Se.x,Se.y,Se.z,Se.w],kr=["buffer","normalized","offset","stride"];function En(){ue("if(!",fr,".buffer){",ct,".enableVertexAttribArray(",Et,");}");var _n=Se.type,yn;if(Se.size?yn=ue.def(Se.size,"||",Ze):yn=Ze,ue("if(",fr,".type!==",_n,"||",fr,".size!==",yn,"||",kr.map(function(Qn){return fr+"."+Qn+"!=="+Se[Qn]}).join("||"),"){",ct,".bindBuffer(",_f,",",Br,".buffer);",ct,".vertexAttribPointer(",[Et,yn,_n,Se.normalized,Se.stride,Se.offset],");",fr,".type=",_n,";",fr,".size=",yn,";",kr.map(function(Qn){return fr+"."+Qn+"="+Se[Qn]+";"}).join(""),"}"),yr){var pn=Se.divisor;ue("if(",fr,".divisor!==",pn,"){",Ee.instancing,".vertexAttribDivisorANGLE(",[Et,pn],");",fr,".divisor=",pn,";}")}}function on(){ue("if(",fr,".buffer){",ct,".disableVertexAttribArray(",Et,");",fr,".buffer=null;","}if(",si.map(function(_n,yn){return fr+"."+_n+"!=="+rn[yn]}).join("||"),"){",ct,".vertexAttrib4f(",Et,",",rn,");",si.map(function(_n,yn){return fr+"."+_n+"="+rn[yn]+";"}).join(""),"}")}Nr===Wn?En():Nr===mi?on():(ue("if(",Nr,"===",Wn,"){"),En(),ue("}else{"),on(),ue("}"))}lt.forEach(function(ye){var Ze=ye.name,Se=je.attributes[Ze],ct;if(Se){if(!At(Se))return;ct=Se.append(Ee,ue)}else{if(!At(Oh))return;var Et=Ee.scopeAttrib(Ze);de.optional(function(){Ee.assert(ue,Et+".state","missing attribute "+Ze)}),ct={},Object.keys(new st).forEach(function(fr){ct[fr]=ue.def(Et,".",fr)})}tt(Ee.link(ye),Fe(ye.info.type),ct)})}function sa(Ee,ue,je,lt,At,$e){for(var Fe=Ee.shared,tt=Fe.gl,ye,Ze=0;Ze<lt.length;++Ze){var Se=lt[Ze],ct=Se.name,Et=Se.info.type,fr=je.uniforms[ct],Nr=Ee.link(Se),Br=Nr+".location",rn;if(fr){if(!At(fr))continue;if(gc(fr)){var kr=fr.value;if(de.command(kr!==null&&typeof kr!="undefined",'missing uniform "'+ct+'"',Ee.commandStr),Et===Qf||Et===wf){de.command(typeof kr=="function"&&(Et===Qf&&(kr._reglType==="texture2d"||kr._reglType==="framebuffer")||Et===wf&&(kr._reglType==="textureCube"||kr._reglType==="framebufferCube")),"invalid texture for uniform "+ct,Ee.commandStr);var En=Ee.link(kr._texture||kr.color[0]._texture);ue(tt,".uniform1i(",Br,",",En+".bind());"),ue.exit(En,".unbind();")}else if(Et===Zs||Et===Jf||Et===Ph){de.optional(function(){de.command(so(kr),"invalid matrix for uniform "+ct,Ee.commandStr),de.command(Et===Zs&&kr.length===4||Et===Jf&&kr.length===9||Et===Ph&&kr.length===16,"invalid length for matrix uniform "+ct,Ee.commandStr)});var on=Ee.global.def("new Float32Array(["+Array.prototype.slice.call(kr)+"])"),_n=2;Et===Jf?_n=3:Et===Ph&&(_n=4),ue(tt,".uniformMatrix",_n,"fv(",Br,",false,",on,");")}else{switch(Et){case Kf:de.commandType(kr,"number","uniform "+ct,Ee.commandStr),ye="1f";break;case bf:de.command(so(kr)&&kr.length===2,"uniform "+ct,Ee.commandStr),ye="2f";break;case gl:de.command(so(kr)&&kr.length===3,"uniform "+ct,Ee.commandStr),ye="3f";break;case Ef:de.command(so(kr)&&kr.length===4,"uniform "+ct,Ee.commandStr),ye="4f";break;case $f:de.commandType(kr,"boolean","uniform "+ct,Ee.commandStr),ye="1i";break;case qf:de.commandType(kr,"number","uniform "+ct,Ee.commandStr),ye="1i";break;case Mh:de.command(so(kr)&&kr.length===2,"uniform "+ct,Ee.commandStr),ye="2i";break;case Ah:de.command(so(kr)&&kr.length===2,"uniform "+ct,Ee.commandStr),ye="2i";break;case Vc:de.command(so(kr)&&kr.length===3,"uniform "+ct,Ee.commandStr),ye="3i";break;case vc:de.command(so(kr)&&kr.length===3,"uniform "+ct,Ee.commandStr),ye="3i";break;case Sf:de.command(so(kr)&&kr.length===4,"uniform "+ct,Ee.commandStr),ye="4i";break;case Ch:de.command(so(kr)&&kr.length===4,"uniform "+ct,Ee.commandStr),ye="4i";break}ue(tt,".uniform",ye,"(",Br,",",so(kr)?Array.prototype.slice.call(kr):kr,");")}continue}else rn=fr.append(Ee,ue)}else{if(!At(Oh))continue;rn=ue.def(Fe.uniforms,"[",me.id(ct),"]")}Et===Qf?(de(!Array.isArray(rn),"must specify a scalar prop for textures"),ue("if(",rn,"&&",rn,'._reglType==="framebuffer"){',rn,"=",rn,".color[0];","}")):Et===wf&&(de(!Array.isArray(rn),"must specify a scalar prop for cube maps"),ue("if(",rn,"&&",rn,'._reglType==="framebufferCube"){',rn,"=",rn,".color[0];","}")),de.optional(function(){function Mo(Js,Vl){Ee.assert(ue,Js,'bad data or missing for uniform "'+ct+'".  '+Vl)}function Fu(Js){de(!Array.isArray(rn),"must not specify an array type for uniform"),Mo("typeof "+rn+'==="'+Js+'"',"invalid type, expected "+Js)}function lu(Js,Vl){Array.isArray(rn)?de(rn.length===Js,"must have length "+Js):Mo(Fe.isArrayLike+"("+rn+")&&"+rn+".length==="+Js,"invalid vector, should have length "+Js,Ee.commandStr)}function Lh(Js){de(!Array.isArray(rn),"must not specify a value type"),Mo("typeof "+rn+'==="function"&&'+rn+'._reglType==="texture'+(Js===Up?"2d":"Cube")+'"',"invalid texture type",Ee.commandStr)}switch(Et){case qf:Fu("number");break;case Ah:lu(2,"number");break;case vc:lu(3,"number");break;case Ch:lu(4,"number");break;case Kf:Fu("number");break;case bf:lu(2,"number");break;case gl:lu(3,"number");break;case Ef:lu(4,"number");break;case $f:Fu("boolean");break;case Mh:lu(2,"boolean");break;case Vc:lu(3,"boolean");break;case Sf:lu(4,"boolean");break;case Zs:lu(4,"number");break;case Jf:lu(9,"number");break;case Ph:lu(16,"number");break;case Qf:Lh(Up);break;case wf:Lh(Th);break}});var yn=1;switch(Et){case Qf:case wf:var pn=ue.def(rn,"._texture");ue(tt,".uniform1i(",Br,",",pn,".bind());"),ue.exit(pn,".unbind();");continue;case qf:case $f:ye="1i";break;case Ah:case Mh:ye="2i",yn=2;break;case vc:case Vc:ye="3i",yn=3;break;case Ch:case Sf:ye="4i",yn=4;break;case Kf:ye="1f";break;case bf:ye="2f",yn=2;break;case gl:ye="3f",yn=3;break;case Ef:ye="4f",yn=4;break;case Zs:ye="Matrix2fv";break;case Jf:ye="Matrix3fv";break;case Ph:ye="Matrix4fv";break}if(ye.charAt(0)==="M"){ue(tt,".uniform",ye,"(",Br,",");var Qn=Math.pow(Et-Zs+2,2),va=Ee.global.def("new Float32Array(",Qn,")");Array.isArray(rn)?ue("false,(",Ge(Qn,function(Mo){return va+"["+Mo+"]="+rn[Mo]}),",",va,")"):ue("false,(Array.isArray(",rn,")||",rn," instanceof Float32Array)?",rn,":(",Ge(Qn,function(Mo){return va+"["+Mo+"]="+rn+"["+Mo+"]"}),",",va,")"),ue(");")}else if(yn>1){for(var Qo=[],Oa=[],fa=0;fa<yn;++fa)Array.isArray(rn)?Oa.push(rn[fa]):Oa.push(ue.def(rn+"["+fa+"]")),$e&&Qo.push(ue.def());$e&&ue("if(!",Ee.batchId,"||",Qo.map(function(Mo,Fu){return Mo+"!=="+Oa[Fu]}).join("||"),"){",Qo.map(function(Mo,Fu){return Mo+"="+Oa[Fu]+";"}).join("")),ue(tt,".uniform",ye,"(",Br,",",Oa.join(","),");"),$e&&ue("}")}else{if(de(!Array.isArray(rn),"uniform value must not be an array"),$e){var Ls=ue.def();ue("if(!",Ee.batchId,"||",Ls,"!==",rn,"){",Ls,"=",rn,";")}ue(tt,".uniform",ye,"(",Br,",",rn,");"),$e&&ue("}")}}}function ls(Ee,ue,je,lt){var At=Ee.shared,$e=At.gl,Fe=At.draw,tt=lt.draw;function ye(){var yn=tt.elements,pn,Qn=ue;return yn?((yn.contextDep&&lt.contextDynamic||yn.propDep)&&(Qn=je),pn=yn.append(Ee,Qn),tt.elementsActive&&Qn("if("+pn+")"+$e+".bindBuffer("+wh+","+pn+".buffer.buffer);")):(pn=Qn.def(),Qn(pn,"=",Fe,".",uu,";","if(",pn,"){",$e,".bindBuffer(",wh,",",pn,".buffer.buffer);}","else if(",At.vao,".currentVAO){",pn,"=",Ee.shared.elements+".getElements("+At.vao,".currentVAO.elements);",ur?"":"if("+pn+")"+$e+".bindBuffer("+wh+","+pn+".buffer.buffer);","}")),pn}function Ze(){var yn=tt.count,pn,Qn=ue;return yn?((yn.contextDep&&lt.contextDynamic||yn.propDep)&&(Qn=je),pn=yn.append(Ee,Qn),de.optional(function(){yn.MISSING&&Ee.assert(ue,"false","missing vertex count"),yn.DYNAMIC&&Ee.assert(Qn,pn+">=0","missing vertex count")})):(pn=Qn.def(Fe,".",Zc),de.optional(function(){Ee.assert(Qn,pn+">=0","missing vertex count")})),pn}var Se=ye();function ct(yn){var pn=tt[yn];return pn?pn.contextDep&&lt.contextDynamic||pn.propDep?pn.append(Ee,je):pn.append(Ee,ue):ue.def(Fe,".",yn)}var Et=ct(To),fr=ct(Vf),Nr=Ze();if(typeof Nr=="number"){if(Nr===0)return}else je("if(",Nr,"){"),je.exit("}");var Br,rn;yr&&(Br=ct(jf),rn=Ee.instancing);var kr=Se+".type",En=tt.elements&&gc(tt.elements)&&!tt.vaoActive;function on(){function yn(){je(rn,".drawElementsInstancedANGLE(",[Et,Nr,kr,fr+"<<(("+kr+"-"+ei+")>>1)",Br],");")}function pn(){je(rn,".drawArraysInstancedANGLE(",[Et,fr,Nr,Br],");")}Se&&Se!=="null"?En?yn():(je("if(",Se,"){"),yn(),je("}else{"),pn(),je("}")):pn()}function _n(){function yn(){je($e+".drawElements("+[Et,Nr,kr,fr+"<<(("+kr+"-"+ei+")>>1)"]+");")}function pn(){je($e+".drawArrays("+[Et,fr,Nr]+");")}Se&&Se!=="null"?En?yn():(je("if(",Se,"){"),yn(),je("}else{"),pn(),je("}")):pn()}yr&&(typeof Br!="number"||Br>=0)?typeof Br=="string"?(je("if(",Br,">0){"),on(),je("}else if(",Br,"<0){"),_n(),je("}")):on():_n()}function ii(Ee,ue,je,lt,At){var $e=ni(),Fe=$e.proc("body",At);return de.optional(function(){$e.commandStr=ue.commandStr,$e.command=$e.link(ue.commandStr)}),yr&&($e.instancing=Fe.def($e.shared.extensions,".angle_instanced_arrays")),Ee($e,Fe,je,lt),$e.compile().body}function Zi(Ee,ue,je,lt){co(Ee,ue),je.useVAO?je.drawVAO?ue(Ee.shared.vao,".setVAO(",je.drawVAO.append(Ee,ue),");"):ue(Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"):(ue(Ee.shared.vao,".setVAO(null);"),Xo(Ee,ue,je,lt.attributes,function(){return!0})),sa(Ee,ue,je,lt.uniforms,function(){return!0},!1),ls(Ee,ue,ue,je)}function ya(Ee,ue){var je=Ee.proc("draw",1);co(Ee,je),Rn(Ee,je,ue.context),Fn(Ee,je,ue.framebuffer),Ao(Ee,je,ue),Ss(Ee,je,ue.state),xi(Ee,je,ue,!1,!0);var lt=ue.shader.progVar.append(Ee,je);if(je(Ee.shared.gl,".useProgram(",lt,".program);"),ue.shader.program)Zi(Ee,je,ue,ue.shader.program);else{je(Ee.shared.vao,".setVAO(null);");var At=Ee.global.def("{}"),$e=je.def(lt,".id"),Fe=je.def(At,"[",$e,"]");je(Ee.cond(Fe).then(Fe,".call(this,a0);").else(Fe,"=",At,"[",$e,"]=",Ee.link(function(tt){return ii(Zi,Ee,ue,tt,1)}),"(",lt,");",Fe,".call(this,a0);"))}Object.keys(ue.state).length>0&&je(Ee.shared.current,".dirty=true;"),Ee.shared.vao&&je(Ee.shared.vao,".setVAO(null);")}function Co(Ee,ue,je,lt){Ee.batchId="a1",co(Ee,ue);function At(){return!0}Xo(Ee,ue,je,lt.attributes,At),sa(Ee,ue,je,lt.uniforms,At,!1),ls(Ee,ue,ue,je)}function Zl(Ee,ue,je,lt){co(Ee,ue);var At=je.contextDep,$e=ue.def(),Fe="a0",tt="a1",ye=ue.def();Ee.shared.props=ye,Ee.batchId=$e;var Ze=Ee.scope(),Se=Ee.scope();ue(Ze.entry,"for(",$e,"=0;",$e,"<",tt,";++",$e,"){",ye,"=",Fe,"[",$e,"];",Se,"}",Ze.exit);function ct(kr){return kr.contextDep&&At||kr.propDep}function Et(kr){return!ct(kr)}if(je.needsContext&&Rn(Ee,Se,je.context),je.needsFramebuffer&&Fn(Ee,Se,je.framebuffer),Ss(Ee,Se,je.state,ct),je.profile&&ct(je.profile)&&xi(Ee,Se,je,!1,!0),lt)je.useVAO?je.drawVAO?ct(je.drawVAO)?Se(Ee.shared.vao,".setVAO(",je.drawVAO.append(Ee,Se),");"):Ze(Ee.shared.vao,".setVAO(",je.drawVAO.append(Ee,Ze),");"):Ze(Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"):(Ze(Ee.shared.vao,".setVAO(null);"),Xo(Ee,Ze,je,lt.attributes,Et),Xo(Ee,Se,je,lt.attributes,ct)),sa(Ee,Ze,je,lt.uniforms,Et,!1),sa(Ee,Se,je,lt.uniforms,ct,!0),ls(Ee,Ze,Se,je);else{var fr=Ee.global.def("{}"),Nr=je.shader.progVar.append(Ee,Se),Br=Se.def(Nr,".id"),rn=Se.def(fr,"[",Br,"]");Se(Ee.shared.gl,".useProgram(",Nr,".program);","if(!",rn,"){",rn,"=",fr,"[",Br,"]=",Ee.link(function(kr){return ii(Co,Ee,je,kr,2)}),"(",Nr,");}",rn,".call(this,a0[",$e,"],",$e,");")}}function Ce(Ee,ue){var je=Ee.proc("batch",2);Ee.batchId="0",co(Ee,je);var lt=!1,At=!0;Object.keys(ue.context).forEach(function(fr){lt=lt||ue.context[fr].propDep}),lt||(Rn(Ee,je,ue.context),At=!1);var $e=ue.framebuffer,Fe=!1;$e?($e.propDep?lt=Fe=!0:$e.contextDep&&lt&&(Fe=!0),Fe||Fn(Ee,je,$e)):Fn(Ee,je,null),ue.state.viewport&&ue.state.viewport.propDep&&(lt=!0);function tt(fr){return fr.contextDep&&lt||fr.propDep}Ao(Ee,je,ue),Ss(Ee,je,ue.state,function(fr){return!tt(fr)}),(!ue.profile||!tt(ue.profile))&&xi(Ee,je,ue,!1,"a1"),ue.contextDep=lt,ue.needsContext=At,ue.needsFramebuffer=Fe;var ye=ue.shader.progVar;if(ye.contextDep&&lt||ye.propDep)Zl(Ee,je,ue,null);else{var Ze=ye.append(Ee,je);if(je(Ee.shared.gl,".useProgram(",Ze,".program);"),ue.shader.program)Zl(Ee,je,ue,ue.shader.program);else{je(Ee.shared.vao,".setVAO(null);");var Se=Ee.global.def("{}"),ct=je.def(Ze,".id"),Et=je.def(Se,"[",ct,"]");je(Ee.cond(Et).then(Et,".call(this,a0,a1);").else(Et,"=",Se,"[",ct,"]=",Ee.link(function(fr){return ii(Zl,Ee,ue,fr,2)}),"(",Ze,");",Et,".call(this,a0,a1);"))}}Object.keys(ue.state).length>0&&je(Ee.shared.current,".dirty=true;"),Ee.shared.vao&&je(Ee.shared.vao,".setVAO(null);")}function Nt(Ee,ue){var je=Ee.proc("scope",3);Ee.batchId="a2";var lt=Ee.shared,At=lt.current;Rn(Ee,je,ue.context),ue.framebuffer&&ue.framebuffer.append(Ee,je),Hc(Object.keys(ue.state)).forEach(function(Fe){var tt=ue.state[Fe],ye=tt.append(Ee,je);so(ye)?ye.forEach(function(Ze,Se){je.set(Ee.next[Fe],"["+Se+"]",Ze)}):je.set(lt.next,"."+Fe,ye)}),xi(Ee,je,ue,!0,!0),[uu,Vf,Zc,jf,To].forEach(function(Fe){var tt=ue.draw[Fe];!tt||je.set(lt.draw,"."+Fe,""+tt.append(Ee,je))}),Object.keys(ue.uniforms).forEach(function(Fe){var tt=ue.uniforms[Fe].append(Ee,je);Array.isArray(tt)&&(tt="["+tt.join()+"]"),je.set(lt.uniforms,"["+me.id(Fe)+"]",tt)}),Object.keys(ue.attributes).forEach(function(Fe){var tt=ue.attributes[Fe].append(Ee,je),ye=Ee.scopeAttrib(Fe);Object.keys(new st).forEach(function(Ze){je.set(ye,"."+Ze,tt[Ze])})}),ue.scopeVAO&&je.set(lt.vao,".targetVAO",ue.scopeVAO.append(Ee,je));function $e(Fe){var tt=ue.shader[Fe];tt&&je.set(lt.shader,"."+Fe,tt.append(Ee,je))}$e(ml),$e(Uc),Object.keys(ue.state).length>0&&(je(At,".dirty=true;"),je.exit(At,".dirty=true;")),je("a1(",Ee.shared.context,",a0,",Ee.batchId,");")}function _t(Ee){if(!(typeof Ee!="object"||so(Ee))){for(var ue=Object.keys(Ee),je=0;je<ue.length;++je)if(an.isDynamic(Ee[ue[je]]))return!0;return!1}}function hn(Ee,ue,je){var lt=ue.static[je];if(!lt||!_t(lt))return;var At=Ee.global,$e=Object.keys(lt),Fe=!1,tt=!1,ye=!1,Ze=Ee.global.def("{}");$e.forEach(function(ct){var Et=lt[ct];if(an.isDynamic(Et)){typeof Et=="function"&&(Et=lt[ct]=an.unbox(Et));var fr=Rs(Et,null);Fe=Fe||fr.thisDep,ye=ye||fr.propDep,tt=tt||fr.contextDep}else{switch(At(Ze,".",ct,"="),typeof Et){case"number":At(Et);break;case"string":At('"',Et,'"');break;case"object":Array.isArray(Et)&&At("[",Et.join(),"]");break;default:At(Ee.link(Et));break}At(";")}});function Se(ct,Et){$e.forEach(function(fr){var Nr=lt[fr];if(!!an.isDynamic(Nr)){var Br=ct.invoke(Et,Nr);Et(Ze,".",fr,"=",Br,";")}})}ue.dynamic[je]=new an.DynamicVariable(Bo,{thisDep:Fe,contextDep:tt,propDep:ye,ref:Ze,append:Se}),delete ue.static[je]}function Gi(Ee,ue,je,lt,At){var $e=ni();$e.stats=$e.link(At),Object.keys(ue.static).forEach(function(tt){hn($e,ue,tt)}),_d.forEach(function(tt){hn($e,Ee,tt)});var Fe=Wo(Ee,ue,je,lt,$e);return ya($e,Fe),Nt($e,Fe),Ce($e,Fe),m($e.compile(),{destroy:function(){Fe.shader.program.destroy()}})}return{next:Xr,current:Mr,procs:function(){var Ee=ni(),ue=Ee.proc("poll"),je=Ee.proc("refresh"),lt=Ee.block();ue(lt),je(lt);var At=Ee.shared,$e=At.gl,Fe=At.next,tt=At.current;lt(tt,".dirty=false;"),Fn(Ee,ue),Fn(Ee,je,null,!0);var ye;yr&&(ye=Ee.link(yr)),Ne.oes_vertex_array_object&&je(Ee.link(Ne.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ze=0;Ze<It.maxAttributes;++Ze){var Se=je.def(At.attributes,"[",Ze,"]"),ct=Ee.cond(Se,".buffer");ct.then($e,".enableVertexAttribArray(",Ze,");",$e,".bindBuffer(",_f,",",Se,".buffer.buffer);",$e,".vertexAttribPointer(",Ze,",",Se,".size,",Se,".type,",Se,".normalized,",Se,".stride,",Se,".offset);").else($e,".disableVertexAttribArray(",Ze,");",$e,".vertexAttrib4f(",Ze,",",Se,".x,",Se,".y,",Se,".z,",Se,".w);",Se,".buffer=null;"),je(ct),yr&&je(ye,".vertexAttribDivisorANGLE(",Ze,",",Se,".divisor);")}return je(Ee.shared.vao,".currentVAO=null;",Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"),Object.keys(Qt).forEach(function(Et){var fr=Qt[Et],Nr=lt.def(Fe,".",Et),Br=Ee.block();Br("if(",Nr,"){",$e,".enable(",fr,")}else{",$e,".disable(",fr,")}",tt,".",Et,"=",Nr,";"),je(Br),ue("if(",Nr,"!==",tt,".",Et,"){",Br,"}")}),Object.keys(rr).forEach(function(Et){var fr=rr[Et],Nr=Mr[Et],Br,rn,kr=Ee.block();if(kr($e,".",fr,"("),so(Nr)){var En=Nr.length;Br=Ee.global.def(Fe,".",Et),rn=Ee.global.def(tt,".",Et),kr(Ge(En,function(on){return Br+"["+on+"]"}),");",Ge(En,function(on){return rn+"["+on+"]="+Br+"["+on+"];"}).join("")),ue("if(",Ge(En,function(on){return Br+"["+on+"]!=="+rn+"["+on+"]"}).join("||"),"){",kr,"}")}else Br=lt.def(Fe,".",Et),rn=lt.def(tt,".",Et),kr(Br,");",tt,".",Et,"=",Br,";"),ue("if(",Br,"!==",rn,"){",kr,"}");je(kr)}),Ee.compile()}(),compile:Gi}}function Ed(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Sd=34918,wd=34919,ep=35007,Td=function(B,me){if(!me.ext_disjoint_timer_query)return null;var Ne=[];function It(){return Ne.pop()||me.ext_disjoint_timer_query.createQueryEXT()}function ar(yr){Ne.push(yr)}var Mt=[];function Jt(yr){var Dr=It();me.ext_disjoint_timer_query.beginQueryEXT(ep,Dr),Mt.push(Dr),gr(Mt.length-1,Mt.length,yr)}function lr(){me.ext_disjoint_timer_query.endQueryEXT(ep)}function vr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var _r=[];function wr(){return _r.pop()||new vr}function Ar(yr){_r.push(yr)}var Ur=[];function gr(yr,Dr,ur){var Mr=wr();Mr.startQueryIndex=yr,Mr.endQueryIndex=Dr,Mr.sum=0,Mr.stats=ur,Ur.push(Mr)}var Er=[],st=[];function Zt(){var yr,Dr,ur=Mt.length;if(ur!==0){st.length=Math.max(st.length,ur+1),Er.length=Math.max(Er.length,ur+1),Er[0]=0,st[0]=0;var Mr=0;for(yr=0,Dr=0;Dr<Mt.length;++Dr){var Xr=Mt[Dr];me.ext_disjoint_timer_query.getQueryObjectEXT(Xr,wd)?(Mr+=me.ext_disjoint_timer_query.getQueryObjectEXT(Xr,Sd),ar(Xr)):Mt[yr++]=Xr,Er[Dr+1]=Mr,st[Dr+1]=yr}for(Mt.length=yr,yr=0,Dr=0;Dr<Ur.length;++Dr){var zn=Ur[Dr],Qt=zn.startQueryIndex,rr=zn.endQueryIndex;zn.sum+=Er[rr]-Er[Qt];var gn=st[Qt],Zr=st[rr];Zr===gn?(zn.stats.gpuTime+=zn.sum/1e6,Ar(zn)):(zn.startQueryIndex=gn,zn.endQueryIndex=Zr,Ur[yr++]=zn)}Ur.length=yr}}return{beginQuery:Jt,endQuery:lr,pushScopeStats:gr,update:Zt,getNumPendingQueries:function(){return Mt.length},clear:function(){Ne.push.apply(Ne,Mt);for(var yr=0;yr<Ne.length;yr++)me.ext_disjoint_timer_query.deleteQueryEXT(Ne[yr]);Mt.length=0,Ne.length=0},restore:function(){Mt.length=0,Ne.length=0}}},Xp=16384,th=256,Yp=1024,tp=34962,rh="webglcontextlost",Ia="webglcontextrestored",rp=1,Ul=2,Tf=3;function Rh(B,me){for(var Ne=0;Ne<B.length;++Ne)if(B[Ne]===me)return Ne;return-1}function Kp(B){var me=ge(B);if(!me)return null;var Ne=me.gl,It=Ne.getContextAttributes(),ar=Ne.isContextLost(),Mt=Pe(Ne,me);if(!Mt)return null;var Jt=ps(),lr=Ed(),vr=Mt.extensions,_r=Td(Ne,vr),wr=to(),Ar=Ne.drawingBufferWidth,Ur=Ne.drawingBufferHeight,gr={tick:0,time:0,viewportWidth:Ar,viewportHeight:Ur,framebufferWidth:Ar,framebufferHeight:Ur,drawingBufferWidth:Ar,drawingBufferHeight:Ur,pixelRatio:me.pixelRatio},Er={},st={elements:null,primitive:4,count:-1,offset:0,instances:-1},Zt=Sl(Ne,vr),yr=N(Ne,lr,me,Mr),Dr=al(Ne,vr,yr,lr),ur=gt(Ne,vr,Zt,lr,yr,Dr,st);function Mr(ii){return ur.destroyBuffer(ii)}var Xr=Rr(Ne,Jt,lr,me),zn=bs(Ne,vr,Zt,function(){gn.procs.poll()},gr,lr,me),Qt=fl(Ne,vr,Zt,lr,me),rr=Ae(Ne,vr,Zt,zn,Qt,lr),gn=Qh(Ne,Jt,vr,Zt,yr,Dr,zn,rr,Er,ur,Xr,st,gr,_r,me),Zr=Un(Ne,rr,gn.procs.poll,gr,It,vr,Zt),xr=gn.next,Yr=Ne.canvas,Kr=[],gi=[],ni=[],Hr=[me.onDestroy],en=null;function Jn(){if(Kr.length===0){_r&&_r.update(),en=null;return}en=Di.next(Jn),co();for(var ii=Kr.length-1;ii>=0;--ii){var Zi=Kr[ii];Zi&&Zi(gr,null,0)}Ne.flush(),_r&&_r.update()}function ui(){!en&&Kr.length>0&&(en=Di.next(Jn))}function Ni(){en&&(Di.cancel(Jn),en=null)}function qa(ii){ii.preventDefault(),ar=!0,Ni(),gi.forEach(function(Zi){Zi()})}function io(ii){Ne.getError(),ar=!1,Mt.restore(),Xr.restore(),yr.restore(),zn.restore(),Qt.restore(),rr.restore(),ur.restore(),_r&&_r.restore(),gn.procs.refresh(),ui(),ni.forEach(function(Zi){Zi()})}var Ri=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!Ri&&Yr&&(Yr.addEventListener(rh,qa,!1),Yr.addEventListener(Ia,io,!1));function Jo(){Kr.length=0,Ni(),!Ri&&Yr&&(Yr.removeEventListener(rh,qa),Yr.removeEventListener(Ia,io)),Xr.clear(),rr.clear(),Qt.clear(),ur.clear(),zn.clear(),Dr.clear(),yr.clear(),_r&&_r.clear(),Hr.forEach(function(ii){ii()})}function ja(ii){de(!!ii,"invalid args to regl({...})"),de.type(ii,"object","invalid args to regl({...})");function Zi($e){var Fe=m({},$e);delete Fe.uniforms,delete Fe.attributes,delete Fe.context,delete Fe.vao,"stencil"in Fe&&Fe.stencil.op&&(Fe.stencil.opBack=Fe.stencil.opFront=Fe.stencil.op,delete Fe.stencil.op);function tt(ye){if(ye in Fe){var Ze=Fe[ye];delete Fe[ye],Object.keys(Ze).forEach(function(Se){Fe[ye+"."+Se]=Ze[Se]})}}return tt("blend"),tt("depth"),tt("cull"),tt("stencil"),tt("polygonOffset"),tt("scissor"),tt("sample"),"vao"in $e&&(Fe.vao=$e.vao),Fe}function ya($e,Fe){var tt={},ye={};return Object.keys($e).forEach(function(Ze){var Se=$e[Ze];if(an.isDynamic(Se)){ye[Ze]=an.unbox(Se,Ze);return}else if(Fe&&Array.isArray(Se)){for(var ct=0;ct<Se.length;++ct)if(an.isDynamic(Se[ct])){ye[Ze]=an.unbox(Se,Ze);return}}tt[Ze]=Se}),{dynamic:ye,static:tt}}var Co=ya(ii.context||{},!0),Zl=ya(ii.uniforms||{},!0),Ce=ya(ii.attributes||{},!1),Nt=ya(Zi(ii),!1),_t={gpuTime:0,cpuTime:0,count:0},hn=gn.compile(Nt,Ce,Zl,Co,_t),Gi=hn.draw,Ee=hn.batch,ue=hn.scope,je=[];function lt($e){for(;je.length<$e;)je.push(null);return je}function At($e,Fe){var tt;if(ar&&de.raise("context lost"),typeof $e=="function")return ue.call(this,null,$e,0);if(typeof Fe=="function")if(typeof $e=="number")for(tt=0;tt<$e;++tt)ue.call(this,null,Fe,tt);else if(Array.isArray($e))for(tt=0;tt<$e.length;++tt)ue.call(this,$e[tt],Fe,tt);else return ue.call(this,$e,Fe,0);else if(typeof $e=="number"){if($e>0)return Ee.call(this,lt($e|0),$e|0)}else if(Array.isArray($e)){if($e.length)return Ee.call(this,$e,$e.length)}else return Gi.call(this,$e)}return m(At,{stats:_t,destroy:function(){hn.destroy()}})}var Wo=rr.setFBO=ja({framebuffer:an.define.call(null,rp,"framebuffer")});function Rn(ii,Zi){var ya=0;gn.procs.poll();var Co=Zi.color;Co&&(Ne.clearColor(+Co[0]||0,+Co[1]||0,+Co[2]||0,+Co[3]||0),ya|=Xp),"depth"in Zi&&(Ne.clearDepth(+Zi.depth),ya|=th),"stencil"in Zi&&(Ne.clearStencil(Zi.stencil|0),ya|=Yp),de(!!ya,"called regl.clear with no buffer specified"),Ne.clear(ya)}function Fn(ii){if(de(typeof ii=="object"&&ii,"regl.clear() takes an object as input"),"framebuffer"in ii)if(ii.framebuffer&&ii.framebuffer_reglType==="framebufferCube")for(var Zi=0;Zi<6;++Zi)Wo(m({framebuffer:ii.framebuffer.faces[Zi]},ii),Rn);else Wo(ii,Rn);else Rn(null,ii)}function Ao(ii){de.type(ii,"function","regl.frame() callback must be a function"),Kr.push(ii);function Zi(){var ya=Rh(Kr,ii);de(ya>=0,"cannot cancel a frame twice");function Co(){var Zl=Rh(Kr,Co);Kr[Zl]=Kr[Kr.length-1],Kr.length-=1,Kr.length<=0&&Ni()}Kr[ya]=Co}return ui(),{cancel:Zi}}function Ss(){var ii=xr.viewport,Zi=xr.scissor_box;ii[0]=ii[1]=Zi[0]=Zi[1]=0,gr.viewportWidth=gr.framebufferWidth=gr.drawingBufferWidth=ii[2]=Zi[2]=Ne.drawingBufferWidth,gr.viewportHeight=gr.framebufferHeight=gr.drawingBufferHeight=ii[3]=Zi[3]=Ne.drawingBufferHeight}function co(){gr.tick+=1,gr.time=Xo(),Ss(),gn.procs.poll()}function xi(){zn.refresh(),Ss(),gn.procs.refresh(),_r&&_r.update()}function Xo(){return(to()-wr)/1e3}xi();function sa(ii,Zi){de.type(Zi,"function","listener callback must be a function");var ya;switch(ii){case"frame":return Ao(Zi);case"lost":ya=gi;break;case"restore":ya=ni;break;case"destroy":ya=Hr;break;default:de.raise("invalid event, must be one of frame,lost,restore,destroy")}return ya.push(Zi),{cancel:function(){for(var Co=0;Co<ya.length;++Co)if(ya[Co]===Zi){ya[Co]=ya[ya.length-1],ya.pop();return}}}}var ls=m(ja,{clear:Fn,prop:an.define.bind(null,rp),context:an.define.bind(null,Ul),this:an.define.bind(null,Tf),draw:ja({}),buffer:function(ii){return yr.create(ii,tp,!1,!1)},elements:function(ii){return Dr.create(ii,!1)},texture:zn.create2D,cube:zn.createCube,renderbuffer:Qt.create,framebuffer:rr.create,framebufferCube:rr.createCube,vao:ur.createVAO,attributes:It,frame:Ao,on:sa,limits:Zt,hasExtension:function(ii){return Zt.extensions.indexOf(ii.toLowerCase())>=0},read:Zr,destroy:Jo,_gl:Ne,_refresh:xi,poll:function(){co(),_r&&_r.update()},now:Xo,stats:lr});return me.onDone(null,ls),ls}return Kp})},58380:function(Ue){function W(L,X,j){switch(j.length){case 0:return L.call(X);case 1:return L.call(X,j[0]);case 2:return L.call(X,j[0],j[1]);case 3:return L.call(X,j[0],j[1],j[2])}return L.apply(X,j)}Ue.exports=W},77412:function(Ue){function W(L,X){for(var j=-1,m=L==null?0:L.length;++j<m&&X(L[j],j,L)!==!1;);return L}Ue.exports=W},47443:function(Ue,W,L){var X=L(42118);function j(m,J){var F=m==null?0:m.length;return!!F&&X(m,J,0)>-1}Ue.exports=j},1196:function(Ue){function W(L,X,j){for(var m=-1,J=L==null?0:L.length;++m<J;)if(j(X,L[m]))return!0;return!1}Ue.exports=W},29932:function(Ue){function W(L,X){for(var j=-1,m=L==null?0:L.length,J=Array(m);++j<m;)J[j]=X(L[j],j,L);return J}Ue.exports=W},62663:function(Ue){function W(L,X,j,m){var J=-1,F=L==null?0:L.length;for(m&&F&&(j=L[++J]);++J<F;)j=X(j,L[J],J,L);return j}Ue.exports=W},49029:function(Ue){var W=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function L(X){return X.match(W)||[]}Ue.exports=L},86556:function(Ue,W,L){var X=L(89465),j=L(77813);function m(J,F,$){($!==void 0&&!j(J[F],$)||$===void 0&&!(F in J))&&X(J,F,$)}Ue.exports=m},34865:function(Ue,W,L){var X=L(89465),j=L(77813),m=Object.prototype,J=m.hasOwnProperty;function F($,re,ie){var ne=$[re];(!(J.call($,re)&&j(ne,ie))||ie===void 0&&!(re in $))&&X($,re,ie)}Ue.exports=F},44037:function(Ue,W,L){var X=L(98363),j=L(3674);function m(J,F){return J&&X(F,j(F),J)}Ue.exports=m},63886:function(Ue,W,L){var X=L(98363),j=L(81704);function m(J,F){return J&&X(F,j(F),J)}Ue.exports=m},89465:function(Ue,W,L){var X=L(38777);function j(m,J,F){J=="__proto__"&&X?X(m,J,{configurable:!0,enumerable:!0,value:F,writable:!0}):m[J]=F}Ue.exports=j},29750:function(Ue){function W(L,X,j){return L===L&&(j!==void 0&&(L=L<=j?L:j),X!==void 0&&(L=L>=X?L:X)),L}Ue.exports=W},85990:function(Ue,W,L){var X=L(46384),j=L(77412),m=L(34865),J=L(44037),F=L(63886),$=L(64626),re=L(278),ie=L(18805),ne=L(1911),Le=L(58234),Ie=L(46904),He=L(64160),Rt=L(43824),$t=L(29148),ht=L(38517),Ut=L(1469),dt=L(44144),nt=L(56688),rt=L(13218),er=L(72928),K=L(3674),Ht=L(81704),at=1,Ye=2,ut=4,Je="[object Arguments]",Ot="[object Array]",dr="[object Boolean]",Cr="[object Date]",jr="[object Error]",T="[object Function]",we="[object GeneratorFunction]",De="[object Map]",bt="[object Number]",mt="[object Object]",Lt="[object RegExp]",Yt="[object Set]",br="[object String]",Kn="[object Symbol]",cn="[object WeakMap]",li="[object ArrayBuffer]",Vn="[object DataView]",ti="[object Float32Array]",ci="[object Float64Array]",Hn="[object Int8Array]",fi="[object Int16Array]",ua="[object Int32Array]",Vi="[object Uint8Array]",ki="[object Uint8ClampedArray]",Ki="[object Uint16Array]",la="[object Uint32Array]",Ai={};Ai[Je]=Ai[Ot]=Ai[li]=Ai[Vn]=Ai[dr]=Ai[Cr]=Ai[ti]=Ai[ci]=Ai[Hn]=Ai[fi]=Ai[ua]=Ai[De]=Ai[bt]=Ai[mt]=Ai[Lt]=Ai[Yt]=Ai[br]=Ai[Kn]=Ai[Vi]=Ai[ki]=Ai[Ki]=Ai[la]=!0,Ai[jr]=Ai[T]=Ai[cn]=!1;function ma(Xn,bi,zi,qi,ko,de){var Ln,Za=bi&at,rs=bi&Ye,kt=bi&ut;if(zi&&(Ln=ko?zi(Xn,qi,ko,de):zi(Xn)),Ln!==void 0)return Ln;if(!rt(Xn))return Xn;var tr=Ut(Xn);if(tr){if(Ln=Rt(Xn),!Za)return re(Xn,Ln)}else{var Sr=He(Xn),qr=Sr==T||Sr==we;if(dt(Xn))return $(Xn,Za);if(Sr==mt||Sr==Je||qr&&!ko){if(Ln=rs||qr?{}:ht(Xn),!Za)return rs?ne(Xn,F(Ln,Xn)):ie(Xn,J(Ln,Xn))}else{if(!Ai[Sr])return ko?Xn:{};Ln=$t(Xn,Sr,Za)}}de||(de=new X);var xn=de.get(Xn);if(xn)return xn;de.set(Xn,Ln),er(Xn)?Xn.forEach(function(qn){Ln.add(ma(qn,bi,zi,qn,Xn,de))}):nt(Xn)&&Xn.forEach(function(qn,an){Ln.set(an,ma(qn,bi,zi,an,Xn,de))});var kn=kt?rs?Ie:Le:rs?Ht:K,hi=tr?void 0:kn(Xn);return j(hi||Xn,function(qn,an){hi&&(an=qn,qn=Xn[an]),m(Ln,an,ma(qn,bi,zi,an,Xn,de))}),Ln}Ue.exports=ma},3118:function(Ue,W,L){var X=L(13218),j=Object.create,m=function(){function J(){}return function(F){if(!X(F))return{};if(j)return j(F);J.prototype=F;var $=new J;return J.prototype=void 0,$}}();Ue.exports=m},41848:function(Ue){function W(L,X,j,m){for(var J=L.length,F=j+(m?1:-1);m?F--:++F<J;)if(X(L[F],F,L))return F;return-1}Ue.exports=W},28483:function(Ue,W,L){var X=L(25063),j=X();Ue.exports=j},42118:function(Ue,W,L){var X=L(41848),j=L(62722),m=L(42351);function J(F,$,re){return $===$?m(F,$,re):X(F,j,re)}Ue.exports=J},25588:function(Ue,W,L){var X=L(64160),j=L(37005),m="[object Map]";function J(F){return j(F)&&X(F)==m}Ue.exports=J},62722:function(Ue){function W(L){return L!==L}Ue.exports=W},29221:function(Ue,W,L){var X=L(64160),j=L(37005),m="[object Set]";function J(F){return j(F)&&X(F)==m}Ue.exports=J},10313:function(Ue,W,L){var X=L(13218),j=L(25726),m=L(33498),J=Object.prototype,F=J.hasOwnProperty;function $(re){if(!X(re))return m(re);var ie=j(re),ne=[];for(var Le in re)Le=="constructor"&&(ie||!F.call(re,Le))||ne.push(Le);return ne}Ue.exports=$},42980:function(Ue,W,L){var X=L(46384),j=L(86556),m=L(28483),J=L(59783),F=L(13218),$=L(81704),re=L(36390);function ie(ne,Le,Ie,He,Rt){ne!==Le&&m(Le,function($t,ht){if(Rt||(Rt=new X),F($t))J(ne,Le,ht,Ie,ie,He,Rt);else{var Ut=He?He(re(ne,ht),$t,ht+"",ne,Le,Rt):void 0;Ut===void 0&&(Ut=$t),j(ne,ht,Ut)}},$)}Ue.exports=ie},59783:function(Ue,W,L){var X=L(86556),j=L(64626),m=L(77133),J=L(278),F=L(38517),$=L(35694),re=L(1469),ie=L(29246),ne=L(44144),Le=L(23560),Ie=L(13218),He=L(68630),Rt=L(36719),$t=L(36390),ht=L(59881);function Ut(dt,nt,rt,er,K,Ht,at){var Ye=$t(dt,rt),ut=$t(nt,rt),Je=at.get(ut);if(Je){X(dt,rt,Je);return}var Ot=Ht?Ht(Ye,ut,rt+"",dt,nt,at):void 0,dr=Ot===void 0;if(dr){var Cr=re(ut),jr=!Cr&&ne(ut),T=!Cr&&!jr&&Rt(ut);Ot=ut,Cr||jr||T?re(Ye)?Ot=Ye:ie(Ye)?Ot=J(Ye):jr?(dr=!1,Ot=j(ut,!0)):T?(dr=!1,Ot=m(ut,!0)):Ot=[]:He(ut)||$(ut)?(Ot=Ye,$(Ye)?Ot=ht(Ye):(!Ie(Ye)||Le(Ye))&&(Ot=F(ut))):dr=!1}dr&&(at.set(ut,Ot),K(Ot,ut,er,Ht,at),at.delete(ut)),X(dt,rt,Ot)}Ue.exports=Ut},40371:function(Ue){function W(L){return function(X){return X==null?void 0:X[L]}}Ue.exports=W},18674:function(Ue){function W(L){return function(X){return L==null?void 0:L[X]}}Ue.exports=W},5976:function(Ue,W,L){var X=L(6557),j=L(45357),m=L(30061);function J(F,$){return m(j(F,$,X),F+"")}Ue.exports=J},56560:function(Ue,W,L){var X=L(75703),j=L(38777),m=L(6557),J=j?function(F,$){return j(F,"toString",{configurable:!0,enumerable:!1,value:X($),writable:!0})}:m;Ue.exports=J},80531:function(Ue,W,L){var X=L(62705),j=L(29932),m=L(1469),J=L(33448),F=1/0,$=X?X.prototype:void 0,re=$?$.toString:void 0;function ie(ne){if(typeof ne=="string")return ne;if(m(ne))return j(ne,ie)+"";if(J(ne))return re?re.call(ne):"";var Le=ne+"";return Le=="0"&&1/ne==-F?"-0":Le}Ue.exports=ie},45652:function(Ue,W,L){var X=L(88668),j=L(47443),m=L(1196),J=L(74757),F=L(23593),$=L(21814),re=200;function ie(ne,Le,Ie){var He=-1,Rt=j,$t=ne.length,ht=!0,Ut=[],dt=Ut;if(Ie)ht=!1,Rt=m;else if($t>=re){var nt=Le?null:F(ne);if(nt)return $(nt);ht=!1,Rt=J,dt=new X}else dt=Le?[]:Ut;e:for(;++He<$t;){var rt=ne[He],er=Le?Le(rt):rt;if(rt=Ie||rt!==0?rt:0,ht&&er===er){for(var K=dt.length;K--;)if(dt[K]===er)continue e;Le&&dt.push(er),Ut.push(rt)}else Rt(dt,er,Ie)||(dt!==Ut&&dt.push(er),Ut.push(rt))}return Ut}Ue.exports=ie},74318:function(Ue,W,L){var X=L(11149);function j(m){var J=new m.constructor(m.byteLength);return new X(J).set(new X(m)),J}Ue.exports=j},64626:function(Ue,W,L){Ue=L.nmd(Ue);var X=L(55639),j=W&&!W.nodeType&&W,m=j&&!0&&Ue&&!Ue.nodeType&&Ue,J=m&&m.exports===j,F=J?X.Buffer:void 0,$=F?F.allocUnsafe:void 0;function re(ie,ne){if(ne)return ie.slice();var Le=ie.length,Ie=$?$(Le):new ie.constructor(Le);return ie.copy(Ie),Ie}Ue.exports=re},57157:function(Ue,W,L){var X=L(74318);function j(m,J){var F=J?X(m.buffer):m.buffer;return new m.constructor(F,m.byteOffset,m.byteLength)}Ue.exports=j},93147:function(Ue){var W=/\w*$/;function L(X){var j=new X.constructor(X.source,W.exec(X));return j.lastIndex=X.lastIndex,j}Ue.exports=L},40419:function(Ue,W,L){var X=L(62705),j=X?X.prototype:void 0,m=j?j.valueOf:void 0;function J(F){return m?Object(m.call(F)):{}}Ue.exports=J},77133:function(Ue,W,L){var X=L(74318);function j(m,J){var F=J?X(m.buffer):m.buffer;return new m.constructor(F,m.byteOffset,m.length)}Ue.exports=j},278:function(Ue){function W(L,X){var j=-1,m=L.length;for(X||(X=Array(m));++j<m;)X[j]=L[j];return X}Ue.exports=W},98363:function(Ue,W,L){var X=L(34865),j=L(89465);function m(J,F,$,re){var ie=!$;$||($={});for(var ne=-1,Le=F.length;++ne<Le;){var Ie=F[ne],He=re?re($[Ie],J[Ie],Ie,$,J):void 0;He===void 0&&(He=J[Ie]),ie?j($,Ie,He):X($,Ie,He)}return $}Ue.exports=m},18805:function(Ue,W,L){var X=L(98363),j=L(99551);function m(J,F){return X(J,j(J),F)}Ue.exports=m},1911:function(Ue,W,L){var X=L(98363),j=L(51442);function m(J,F){return X(J,j(J),F)}Ue.exports=m},21463:function(Ue,W,L){var X=L(5976),j=L(16612);function m(J){return X(function(F,$){var re=-1,ie=$.length,ne=ie>1?$[ie-1]:void 0,Le=ie>2?$[2]:void 0;for(ne=J.length>3&&typeof ne=="function"?(ie--,ne):void 0,Le&&j($[0],$[1],Le)&&(ne=ie<3?void 0:ne,ie=1),F=Object(F);++re<ie;){var Ie=$[re];Ie&&J(F,Ie,re,ne)}return F})}Ue.exports=m},25063:function(Ue){function W(L){return function(X,j,m){for(var J=-1,F=Object(X),$=m(X),re=$.length;re--;){var ie=$[L?re:++J];if(j(F[ie],ie,F)===!1)break}return X}}Ue.exports=W},98805:function(Ue,W,L){var X=L(40180),j=L(62689),m=L(83140),J=L(79833);function F($){return function(re){re=J(re);var ie=j(re)?m(re):void 0,ne=ie?ie[0]:re.charAt(0),Le=ie?X(ie,1).join(""):re.slice(1);return ne[$]()+Le}}Ue.exports=F},35393:function(Ue,W,L){var X=L(62663),j=L(53816),m=L(58748),J="['\u2019]",F=RegExp(J,"g");function $(re){return function(ie){return X(m(j(ie).replace(F,"")),re,"")}}Ue.exports=$},23593:function(Ue,W,L){var X=L(58525),j=L(50308),m=L(21814),J=1/0,F=X&&1/m(new X([,-0]))[1]==J?function($){return new X($)}:j;Ue.exports=F},69389:function(Ue,W,L){var X=L(18674),j={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},m=X(j);Ue.exports=m},38777:function(Ue,W,L){var X=L(10852),j=function(){try{var m=X(Object,"defineProperty");return m({},"",{}),m}catch(J){}}();Ue.exports=j},46904:function(Ue,W,L){var X=L(68866),j=L(51442),m=L(81704);function J(F){return X(F,m,j)}Ue.exports=J},85924:function(Ue,W,L){var X=L(5569),j=X(Object.getPrototypeOf,Object);Ue.exports=j},51442:function(Ue,W,L){var X=L(62488),j=L(85924),m=L(99551),J=L(70479),F=Object.getOwnPropertySymbols,$=F?function(re){for(var ie=[];re;)X(ie,m(re)),re=j(re);return ie}:J;Ue.exports=$},93157:function(Ue){var W=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function L(X){return W.test(X)}Ue.exports=L},43824:function(Ue){var W=Object.prototype,L=W.hasOwnProperty;function X(j){var m=j.length,J=new j.constructor(m);return m&&typeof j[0]=="string"&&L.call(j,"index")&&(J.index=j.index,J.input=j.input),J}Ue.exports=X},29148:function(Ue,W,L){var X=L(74318),j=L(57157),m=L(93147),J=L(40419),F=L(77133),$="[object Boolean]",re="[object Date]",ie="[object Map]",ne="[object Number]",Le="[object RegExp]",Ie="[object Set]",He="[object String]",Rt="[object Symbol]",$t="[object ArrayBuffer]",ht="[object DataView]",Ut="[object Float32Array]",dt="[object Float64Array]",nt="[object Int8Array]",rt="[object Int16Array]",er="[object Int32Array]",K="[object Uint8Array]",Ht="[object Uint8ClampedArray]",at="[object Uint16Array]",Ye="[object Uint32Array]";function ut(Je,Ot,dr){var Cr=Je.constructor;switch(Ot){case $t:return X(Je);case $:case re:return new Cr(+Je);case ht:return j(Je,dr);case Ut:case dt:case nt:case rt:case er:case K:case Ht:case at:case Ye:return F(Je,dr);case ie:return new Cr;case ne:case He:return new Cr(Je);case Le:return m(Je);case Ie:return new Cr;case Rt:return J(Je)}}Ue.exports=ut},38517:function(Ue,W,L){var X=L(3118),j=L(85924),m=L(25726);function J(F){return typeof F.constructor=="function"&&!m(F)?X(j(F)):{}}Ue.exports=J},16612:function(Ue,W,L){var X=L(77813),j=L(98612),m=L(65776),J=L(13218);function F($,re,ie){if(!J(ie))return!1;var ne=typeof re;return(ne=="number"?j(ie)&&m(re,ie.length):ne=="string"&&re in ie)?X(ie[re],$):!1}Ue.exports=F},33498:function(Ue){function W(L){var X=[];if(L!=null)for(var j in Object(L))X.push(j);return X}Ue.exports=W},45357:function(Ue,W,L){var X=L(58380),j=Math.max;function m(J,F,$){return F=j(F===void 0?J.length-1:F,0),function(){for(var re=arguments,ie=-1,ne=j(re.length-F,0),Le=Array(ne);++ie<ne;)Le[ie]=re[F+ie];ie=-1;for(var Ie=Array(F+1);++ie<F;)Ie[ie]=re[ie];return Ie[F]=$(Le),X(J,this,Ie)}}Ue.exports=m},36390:function(Ue){function W(L,X){if(!(X==="constructor"&&typeof L[X]=="function")&&X!="__proto__")return L[X]}Ue.exports=W},30061:function(Ue,W,L){var X=L(56560),j=L(21275),m=j(X);Ue.exports=m},21275:function(Ue){var W=800,L=16,X=Date.now;function j(m){var J=0,F=0;return function(){var $=X(),re=L-($-F);if(F=$,re>0){if(++J>=W)return arguments[0]}else J=0;return m.apply(void 0,arguments)}}Ue.exports=j},42351:function(Ue){function W(L,X,j){for(var m=j-1,J=L.length;++m<J;)if(L[m]===X)return m;return-1}Ue.exports=W},2757:function(Ue){var W="\\ud800-\\udfff",L="\\u0300-\\u036f",X="\\ufe20-\\ufe2f",j="\\u20d0-\\u20ff",m=L+X+j,J="\\u2700-\\u27bf",F="a-z\\xdf-\\xf6\\xf8-\\xff",$="\\xac\\xb1\\xd7\\xf7",re="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ie="\\u2000-\\u206f",ne=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Le="A-Z\\xc0-\\xd6\\xd8-\\xde",Ie="\\ufe0e\\ufe0f",He=$+re+ie+ne,Rt="['\u2019]",$t="["+He+"]",ht="["+m+"]",Ut="\\d+",dt="["+J+"]",nt="["+F+"]",rt="[^"+W+He+Ut+J+F+Le+"]",er="\\ud83c[\\udffb-\\udfff]",K="(?:"+ht+"|"+er+")",Ht="[^"+W+"]",at="(?:\\ud83c[\\udde6-\\uddff]){2}",Ye="[\\ud800-\\udbff][\\udc00-\\udfff]",ut="["+Le+"]",Je="\\u200d",Ot="(?:"+nt+"|"+rt+")",dr="(?:"+ut+"|"+rt+")",Cr="(?:"+Rt+"(?:d|ll|m|re|s|t|ve))?",jr="(?:"+Rt+"(?:D|LL|M|RE|S|T|VE))?",T=K+"?",we="["+Ie+"]?",De="(?:"+Je+"(?:"+[Ht,at,Ye].join("|")+")"+we+T+")*",bt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",mt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Lt=we+T+De,Yt="(?:"+[dt,at,Ye].join("|")+")"+Lt,br=RegExp([ut+"?"+nt+"+"+Cr+"(?="+[$t,ut,"$"].join("|")+")",dr+"+"+jr+"(?="+[$t,ut+Ot,"$"].join("|")+")",ut+"?"+Ot+"+"+Cr,ut+"+"+jr,mt,bt,Ut,Yt].join("|"),"g");function Kn(cn){return cn.match(br)||[]}Ue.exports=Kn},68929:function(Ue,W,L){var X=L(48403),j=L(35393),m=j(function(J,F,$){return F=F.toLowerCase(),J+($?X(F):F)});Ue.exports=m},48403:function(Ue,W,L){var X=L(79833),j=L(11700);function m(J){return j(X(J).toLowerCase())}Ue.exports=m},74691:function(Ue,W,L){var X=L(29750),j=L(14841);function m(J,F,$){return $===void 0&&($=F,F=void 0),$!==void 0&&($=j($),$=$===$?$:0),F!==void 0&&(F=j(F),F=F===F?F:0),X(j(J),F,$)}Ue.exports=m},50361:function(Ue,W,L){var X=L(85990),j=1,m=4;function J(F){return X(F,j|m)}Ue.exports=J},75703:function(Ue){function W(L){return function(){return L}}Ue.exports=W},53816:function(Ue,W,L){var X=L(69389),j=L(79833),m=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,J="\\u0300-\\u036f",F="\\ufe20-\\ufe2f",$="\\u20d0-\\u20ff",re=J+F+$,ie="["+re+"]",ne=RegExp(ie,"g");function Le(Ie){return Ie=j(Ie),Ie&&Ie.replace(m,X).replace(ne,"")}Ue.exports=Le},6557:function(Ue){function W(L){return L}Ue.exports=W},29246:function(Ue,W,L){var X=L(98612),j=L(37005);function m(J){return j(J)&&X(J)}Ue.exports=m},56688:function(Ue,W,L){var X=L(25588),j=L(7518),m=L(31167),J=m&&m.isMap,F=J?j(J):X;Ue.exports=F},14293:function(Ue){function W(L){return L==null}Ue.exports=W},81763:function(Ue,W,L){var X=L(44239),j=L(37005),m="[object Number]";function J(F){return typeof F=="number"||j(F)&&X(F)==m}Ue.exports=J},68630:function(Ue,W,L){var X=L(44239),j=L(85924),m=L(37005),J="[object Object]",F=Function.prototype,$=Object.prototype,re=F.toString,ie=$.hasOwnProperty,ne=re.call(Object);function Le(Ie){if(!m(Ie)||X(Ie)!=J)return!1;var He=j(Ie);if(He===null)return!0;var Rt=ie.call(He,"constructor")&&He.constructor;return typeof Rt=="function"&&Rt instanceof Rt&&re.call(Rt)==ne}Ue.exports=Le},72928:function(Ue,W,L){var X=L(29221),j=L(7518),m=L(31167),J=m&&m.isSet,F=J?j(J):X;Ue.exports=F},47037:function(Ue,W,L){var X=L(44239),j=L(1469),m=L(37005),J="[object String]";function F($){return typeof $=="string"||!j($)&&m($)&&X($)==J}Ue.exports=F},81704:function(Ue,W,L){var X=L(14636),j=L(10313),m=L(98612);function J(F){return m(F)?X(F,!0):j(F)}Ue.exports=J},82492:function(Ue,W,L){var X=L(42980),j=L(21463),m=j(function(J,F,$){X(J,F,$)});Ue.exports=m},30236:function(Ue,W,L){var X=L(42980),j=L(21463),m=j(function(J,F,$,re){X(J,F,$,re)});Ue.exports=m},50308:function(Ue){function W(){}Ue.exports=W},59881:function(Ue,W,L){var X=L(98363),j=L(81704);function m(J){return X(J,j(J))}Ue.exports=m},79833:function(Ue,W,L){var X=L(80531);function j(m){return m==null?"":X(m)}Ue.exports=j},44908:function(Ue,W,L){var X=L(45652);function j(m){return m&&m.length?X(m):[]}Ue.exports=j},11700:function(Ue,W,L){var X=L(98805),j=X("toUpperCase");Ue.exports=j},58748:function(Ue,W,L){var X=L(49029),j=L(93157),m=L(79833),J=L(2757);function F($,re,ie){return $=m($),re=ie?void 0:re,re===void 0?j($)?J($):X($):$.match(re)||[]}Ue.exports=F},6158:function(Ue){(function(W,L){Ue.exports=L()})(this,function(){"use strict";var W,L,X;function j(m,J){if(!W)W=J;else if(!L)L=J;else{var F="var sharedChunk = {}; ("+W+")(sharedChunk); ("+L+")(sharedChunk);",$={};W($),X=J($),typeof window!="undefined"&&(X.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}return j(["exports"],function(m){"use strict";function J(t,a){return t(a={exports:{}},a.exports),a.exports}var F=$;function $(t,a,s,h){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(h-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=s,this.p2y=h}$.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},$.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},$.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},$.prototype.solveCurveX=function(t,a){var s,h,d,_,S;for(a===void 0&&(a=1e-6),d=t,S=0;S<8;S++){if(_=this.sampleCurveX(d)-t,Math.abs(_)<a)return d;var M=this.sampleCurveDerivativeX(d);if(Math.abs(M)<1e-6)break;d-=_/M}if((d=t)<(s=0))return s;if(d>(h=1))return h;for(;s<h;){if(_=this.sampleCurveX(d),Math.abs(_-t)<a)return d;t>_?s=d:h=d,d=.5*(h-s)+s}return d},$.prototype.solve=function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))};var re=ie;function ie(t,a){this.x=t,this.y=a}ie.prototype={clone:function(){return new ie(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,a){return this.clone()._rotateAround(t,a)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var a=t.x-this.x,s=t.y-this.y;return a*a+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,a){return Math.atan2(this.x*a-this.y*t,this.x*t+this.y*a)},_matMult:function(t){var a=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=a,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var a=Math.cos(t),s=Math.sin(t),h=s*this.x+a*this.y;return this.x=a*this.x-s*this.y,this.y=h,this},_rotateAround:function(t,a){var s=Math.cos(t),h=Math.sin(t),d=a.y+h*(this.x-a.x)+s*(this.y-a.y);return this.x=a.x+s*(this.x-a.x)-h*(this.y-a.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ie.convert=function(t){return t instanceof ie?t:Array.isArray(t)?new ie(t[0],t[1]):t};var ne=typeof self!="undefined"?self:{},Le=Math.pow(2,53)-1;function Ie(t,a,s,h){var d=new F(t,a,s,h);return function(_){return d.solve(_)}}var He=Ie(.25,.1,.25,1);function Rt(t,a,s){return Math.min(s,Math.max(a,t))}function $t(t,a,s){var h=s-a,d=((t-a)%h+h)%h+a;return d===a?s:d}function ht(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var h=0,d=a;h<d.length;h+=1){var _=d[h];for(var S in _)t[S]=_[S]}return t}var Ut=1;function dt(){return Ut++}function nt(){return function t(a){return a?(a^16*Math.random()>>a/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function rt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function er(t,a){t.forEach(function(s){a[s]&&(a[s]=a[s].bind(a))})}function K(t,a){return t.indexOf(a,t.length-a.length)!==-1}function Ht(t,a,s){var h={};for(var d in t)h[d]=a.call(s||this,t[d],d,t);return h}function at(t,a,s){var h={};for(var d in t)a.call(s||this,t[d],d,t)&&(h[d]=t[d]);return h}function Ye(t){return Array.isArray(t)?t.map(Ye):typeof t=="object"&&t?Ht(t,Ye):t}var ut={};function Je(t){ut[t]||(typeof console!="undefined"&&console.warn(t),ut[t]=!0)}function Ot(t,a,s){return(s.y-t.y)*(a.x-t.x)>(a.y-t.y)*(s.x-t.x)}function dr(t){for(var a=0,s=0,h=t.length,d=h-1,_=void 0,S=void 0;s<h;d=s++)a+=((S=t[d]).x-(_=t[s]).x)*(_.y+S.y);return a}function Cr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function jr(t){var a={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,d,_,S){var M=_||S;return a[d]=!M||M.toLowerCase(),""}),a["max-age"]){var s=parseInt(a["max-age"],10);isNaN(s)?delete a["max-age"]:a["max-age"]=s}return a}var T=null;function we(t){if(T==null){var a=t.navigator?t.navigator.userAgent:null;T=!!t.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return T}function De(t){try{var a=ne[t];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch(s){return!1}}var bt,mt,Lt,Yt,br=ne.performance&&ne.performance.now?ne.performance.now.bind(ne.performance):Date.now.bind(Date),Kn=ne.requestAnimationFrame||ne.mozRequestAnimationFrame||ne.webkitRequestAnimationFrame||ne.msRequestAnimationFrame,cn=ne.cancelAnimationFrame||ne.mozCancelAnimationFrame||ne.webkitCancelAnimationFrame||ne.msCancelAnimationFrame,li={now:br,frame:function(t){var a=Kn(t);return{cancel:function(){return cn(a)}}},getImageData:function(t,a){a===void 0&&(a=0);var s=ne.document.createElement("canvas"),h=s.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return s.width=t.width,s.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-a,-a,t.width+2*a,t.height+2*a)},resolveURL:function(t){return bt||(bt=ne.document.createElement("a")),bt.href=t,bt.href},hardwareConcurrency:ne.navigator&&ne.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ne.devicePixelRatio},get prefersReducedMotion(){return!!ne.matchMedia&&(mt==null&&(mt=ne.matchMedia("(prefers-reduced-motion: reduce)")),mt.matches)}},Vn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ti={supported:!1,testSupport:function(t){!ci&&Yt&&(Hn?fi(t):Lt=t)}},ci=!1,Hn=!1;function fi(t){var a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Yt),t.isContextLost())return;ti.supported=!0}catch(s){}t.deleteTexture(a),ci=!0}ne.document&&((Yt=ne.document.createElement("img")).onload=function(){Lt&&fi(Lt),Lt=null,Hn=!0},Yt.onerror=function(){ci=!0,Lt=null},Yt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ua="01",Vi=function(t,a){this._transformRequestFn=t,this._customAccessToken=a,this._createSkuToken()};function ki(t){return t.indexOf("mapbox:")===0}Vi.prototype._createSkuToken=function(){var t=function(){for(var a="",s=0;s<10;s++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ua,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Vi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Vi.prototype.transformRequest=function(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}},Vi.prototype.normalizeStyleURL=function(t,a){if(!ki(t))return t;var s=ma(t);return s.path="/styles/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Vi.prototype.normalizeGlyphsURL=function(t,a){if(!ki(t))return t;var s=ma(t);return s.path="/fonts/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Vi.prototype.normalizeSourceURL=function(t,a){if(!ki(t))return t;var s=ma(t);return s.path="/v4/"+s.authority+".json",s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||a)},Vi.prototype.normalizeSpriteURL=function(t,a,s,h){var d=ma(t);return ki(t)?(d.path="/styles/v1"+d.path+"/sprite"+a+s,this._makeAPIURL(d,this._customAccessToken||h)):(d.path+=""+a+s,Xn(d))},Vi.prototype.normalizeTileURL=function(t,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ki(t))return t;var s=ma(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,(li.devicePixelRatio>=2||a===512?"@2x":"")+(ti.supported?".webp":"$1")),s.path=s.path.replace(/^.+\/v4\//,"/"),s.path="/v4"+s.path;var h=this._customAccessToken||function(d){for(var _=0,S=d;_<S.length;_+=1){var M=S[_].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(s.params)||Vn.ACCESS_TOKEN;return Vn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push("sku="+this._skuToken),this._makeAPIURL(s,h)},Vi.prototype.canonicalizeTileURL=function(t,a){var s=ma(t);if(!s.path.match(/(^\/v4\/)/)||!s.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=s.path.replace("/v4/","");var d=s.params;return a&&(d=d.filter(function(_){return!_.match(/^access_token=/)})),d.length&&(h+="?"+d.join("&")),h},Vi.prototype.canonicalizeTileset=function(t,a){for(var s=!!a&&ki(a),h=[],d=0,_=t.tiles||[];d<_.length;d+=1){var S=_[d];la(S)?h.push(this.canonicalizeTileURL(S,s)):h.push(S)}return h},Vi.prototype._makeAPIURL=function(t,a){var s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=ma(Vn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var d=t.params.indexOf("secure");d>=0&&t.params.splice(d,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Vn.REQUIRE_ACCESS_TOKEN)return Xn(t);if(!(a=a||Vn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+s);if(a[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+s);return t.params=t.params.filter(function(_){return _.indexOf("access_token")===-1}),t.params.push("access_token="+a),Xn(t)};var Ki=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function la(t){return Ki.test(t)}var Ai=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ma(t){var a=t.match(Ai);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function Xn(t){var a=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+a}function bi(t){if(!t)return null;var a=t.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(decodeURIComponent(ne.atob(a[1]).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(s){return null}}var zi=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};zi.prototype.getStorageKey=function(t){var a,s=bi(Vn.ACCESS_TOKEN);return a=s&&s.u?ne.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,function(h,d){return String.fromCharCode(Number("0x"+d))})):Vn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+a:"mapbox.eventData:"+a},zi.prototype.fetchEventData=function(){var t=De("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{var h=ne.localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));var d=ne.localStorage.getItem(s);d&&(this.anonId=d)}catch(_){Je("Unable to read from LocalStorage")}},zi.prototype.saveEventData=function(){var t=De("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{ne.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&ne.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(h){Je("Unable to write to LocalStorage")}},zi.prototype.processRequests=function(t){},zi.prototype.postEvent=function(t,a,s,h){var d=this;if(Vn.EVENTS_URL){var _=ma(Vn.EVENTS_URL);_.params.push("access_token="+(h||Vn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:ua,userId:this.anonId},M=a?ht(S,a):S,k={url:Xn(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=xa(k,function(z){d.pendingRequest=null,s(z),d.saveEventData(),d.processRequests(h)})}},zi.prototype.queueRequest=function(t,a){this.queue.push(t),this.processRequests(a)};var qi,ko,de=function(t){function a(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postMapLoadEvent=function(s,h,d,_){this.skuToken=d,(Vn.EVENTS_URL&&_||Vn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(S){return ki(S)||la(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},_)},a.prototype.processRequests=function(s){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var d=this.queue.shift(),_=d.id,S=d.timestamp;_&&this.success[_]||(this.anonId||this.fetchEventData(),rt(this.anonId)||(this.anonId=nt()),this.postEvent(S,{skuToken:this.skuToken},function(M){M||_&&(h.success[_]=!0)},s))}},a}(zi),Ln=new(function(t){function a(s){t.call(this,"appUserTurnstile"),this._customAccessToken=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postTurnstileEvent=function(s,h){Vn.EVENTS_URL&&Vn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(d){return ki(d)||la(d)})&&this.queueRequest(Date.now(),h)},a.prototype.processRequests=function(s){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var d=bi(Vn.ACCESS_TOKEN),_=d?d.u:Vn.ACCESS_TOKEN,S=_!==this.eventData.tokenU;rt(this.anonId)||(this.anonId=nt(),S=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),z=new Date(M),V=(M-this.eventData.lastSuccess)/864e5;S=S||V>=1||V<-1||k.getDate()!==z.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(H){H||(h.eventData.lastSuccess=M,h.eventData.tokenU=_)},s)}},a}(zi)),Za=Ln.postTurnstileEvent.bind(Ln),rs=new de,kt=rs.postMapLoadEvent.bind(rs),tr=500,Sr=50;function qr(){ne.caches&&!qi&&(qi=ne.caches.open("mapbox-tiles"))}function xn(t){var a=t.indexOf("?");return a<0?t:t.slice(0,a)}var kn,hi=1/0;function qn(){return kn==null&&(kn=ne.OffscreenCanvas&&new ne.OffscreenCanvas(1,1).getContext("2d")&&typeof ne.createImageBitmap=="function"),kn}var an={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(an);var Di=function(t){function a(s,h,d){h===401&&la(d)&&(s+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,s),this.status=h,this.url=d,this.name=this.constructor.name,this.message=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},a}(Error),Oi=Cr()?function(){return self.worker&&self.worker.referrer}:function(){return(ne.location.protocol==="blob:"?ne.parent:ne).location.href},to,ps,Zo=function(t,a){if(!(/^file:/.test(s=t.url)||/^file:/.test(Oi())&&!/^\w+:/.test(s))){if(ne.fetch&&ne.Request&&ne.AbortController&&ne.Request.prototype.hasOwnProperty("signal"))return function(h,d){var _,S=new ne.AbortController,M=new ne.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Oi(),signal:S.signal}),k=!1,z=!1,V=(_=M.url).indexOf("sku=")>0&&la(_);h.type==="json"&&M.headers.set("Accept","application/json");var H=function(se,Me,Oe){if(!z){if(se&&se.message!=="SecurityError"&&Je(se),Me&&Oe)return ee(Me);var Ke=Date.now();ne.fetch(M).then(function(ze){if(ze.ok){var ot=V?ze.clone():null;return ee(ze,ot,Ke)}return d(new Di(ze.statusText,ze.status,h.url))}).catch(function(ze){ze.code!==20&&d(new Error(ze.message))})}},ee=function(se,Me,Oe){(h.type==="arrayBuffer"?se.arrayBuffer():h.type==="json"?se.json():se.text()).then(function(Ke){z||(Me&&Oe&&function(ze,ot,xt){if(qr(),qi){var Bt={status:ot.status,statusText:ot.statusText,headers:new ne.Headers};ot.headers.forEach(function(or,Tr){return Bt.headers.set(Tr,or)});var Vt=jr(ot.headers.get("Cache-Control")||"");Vt["no-store"]||(Vt["max-age"]&&Bt.headers.set("Expires",new Date(xt+1e3*Vt["max-age"]).toUTCString()),new Date(Bt.headers.get("Expires")).getTime()-xt<42e4||function(or,Tr){if(ko===void 0)try{new Response(new ReadableStream),ko=!0}catch(Vr){ko=!1}ko?Tr(or.body):or.blob().then(Tr)}(ot,function(or){var Tr=new ne.Response(or,Bt);qr(),qi&&qi.then(function(Vr){return Vr.put(xn(ze.url),Tr)}).catch(function(Vr){return Je(Vr.message)})}))}}(M,Me,Oe),k=!0,d(null,Ke,se.headers.get("Cache-Control"),se.headers.get("Expires")))}).catch(function(Ke){z||d(new Error(Ke.message))})};return V?function(se,Me){if(qr(),!qi)return Me(null);var Oe=xn(se.url);qi.then(function(Ke){Ke.match(Oe).then(function(ze){var ot=function(xt){if(!xt)return!1;var Bt=new Date(xt.headers.get("Expires")||0),Vt=jr(xt.headers.get("Cache-Control")||"");return Bt>Date.now()&&!Vt["no-cache"]}(ze);Ke.delete(Oe),ot&&Ke.put(Oe,ze.clone()),Me(null,ze,ot)}).catch(Me)}).catch(Me)}(M,H):H(null,null),{cancel:function(){z=!0,k||S.abort()}}}(t,a);if(Cr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,a,void 0,!0)}var s;return function(h,d){var _=new ne.XMLHttpRequest;for(var S in _.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(_.responseType="arraybuffer"),h.headers)_.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=h.credentials==="include",_.onerror=function(){d(new Error(_.statusText))},_.onload=function(){if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){var M=_.response;if(h.type==="json")try{M=JSON.parse(_.response)}catch(k){return d(k)}d(null,M,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else d(new Di(_.statusText,_.status,h.url))},_.send(h.body),{cancel:function(){return _.abort()}}}(t,a)},Na=function(t,a){return Zo(ht(t,{type:"arrayBuffer"}),a)},xa=function(t,a){return Zo(ht(t,{method:"POST"}),a)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";to=[],ps=0;var Q=function(t,a){if(ti.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ps>=Vn.MAX_PARALLEL_IMAGE_REQUESTS){var s={requestParameters:t,callback:a,cancelled:!1,cancel:function(){this.cancelled=!0}};return to.push(s),s}ps++;var h=!1,d=function(){if(!h)for(h=!0,ps--;to.length&&ps<Vn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=to.shift();S.cancelled||(S.cancel=Q(S.requestParameters,S.callback).cancel)}},_=Na(t,function(S,M,k,z){d(),S?a(S):M&&(qn()?function(V,H){var ee=new ne.Blob([new Uint8Array(V)],{type:"image/png"});ne.createImageBitmap(ee).then(function(se){H(null,se)}).catch(function(se){H(new Error("Could not load image because of "+se.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,a):function(V,H,ee,se){var Me=new ne.Image,Oe=ne.URL;Me.onload=function(){H(null,Me),Oe.revokeObjectURL(Me.src),Me.onload=null,ne.requestAnimationFrame(function(){Me.src=G})},Me.onerror=function(){return H(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ke=new ne.Blob([new Uint8Array(V)],{type:"image/png"});Me.cacheControl=ee,Me.expires=se,Me.src=V.byteLength?Oe.createObjectURL(Ke):G}(M,a,k,z))});return{cancel:function(){_.cancel(),d()}}};function oe(t,a,s){s[t]&&s[t].indexOf(a)!==-1||(s[t]=s[t]||[],s[t].push(a))}function ge(t,a,s){if(s&&s[t]){var h=s[t].indexOf(a);h!==-1&&s[t].splice(h,1)}}var Pe=function(t,a){a===void 0&&(a={}),ht(this,a),this.type=t},Ge=function(t){function a(s,h){h===void 0&&(h={}),t.call(this,"error",ht({error:s},h))}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Pe),et=function(){};et.prototype.on=function(t,a){return this._listeners=this._listeners||{},oe(t,a,this._listeners),this},et.prototype.off=function(t,a){return ge(t,a,this._listeners),ge(t,a,this._oneTimeListeners),this},et.prototype.once=function(t,a){return this._oneTimeListeners=this._oneTimeListeners||{},oe(t,a,this._oneTimeListeners),this},et.prototype.fire=function(t,a){typeof t=="string"&&(t=new Pe(t,a||{}));var s=t.type;if(this.listens(s)){t.target=this;for(var h=0,d=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];h<d.length;h+=1)d[h].call(this,t);for(var _=0,S=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];_<S.length;_+=1){var M=S[_];ge(s,M,this._oneTimeListeners),M.call(this,t)}var k=this._eventedParent;k&&(ht(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(t))}else t instanceof Ge&&console.error(t.error);return this},et.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},et.prototype.setEventedParent=function(t,a){return this._eventedParent=t,this._eventedParentData=a,this};var fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},ke=function(t,a,s,h){this.message=(t?t+": ":"")+s,h&&(this.identifier=h),a!=null&&a.__line__&&(this.line=a.__line__)};function vt(t){var a=t.value;return a?[new ke(t.key,a,"constants have been deprecated as of v8")]:[]}function hr(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var h=0,d=a;h<d.length;h+=1){var _=d[h];for(var S in _)t[S]=_[S]}return t}function Pt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Dt(t){if(Array.isArray(t))return t.map(Dt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var a={};for(var s in t)a[s]=Dt(t[s]);return a}return Pt(t)}var pr=function(t){function a(s,h){t.call(this,h),this.message=h,this.key=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Error),mn=function(t,a){a===void 0&&(a=[]),this.parent=t,this.bindings={};for(var s=0,h=a;s<h.length;s+=1){var d=h[s];this.bindings[d[0]]=d[1]}};mn.prototype.concat=function(t){return new mn(this,t)},mn.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},mn.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var un={kind:"null"},Tt={kind:"number"},$r={kind:"string"},Fr={kind:"boolean"},Gr={kind:"color"},vi={kind:"object"},Jr={kind:"value"},Pn={kind:"collator"},Wi={kind:"formatted"},pi={kind:"resolvedImage"};function Ci(t,a){return{kind:"array",itemType:t,N:a}}function _i(t){if(t.kind==="array"){var a=_i(t.itemType);return typeof t.N=="number"?"array<"+a+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+a+">"}return t.kind}var St=[un,Tt,$r,Fr,Gr,Wi,vi,Ci(Jr),pi];function Kt(t,a){if(a.kind==="error")return null;if(t.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Kt(t.itemType,a.itemType))&&(typeof t.N!="number"||t.N===a.N))return null}else{if(t.kind===a.kind)return null;if(t.kind==="value"){for(var s=0,h=St;s<h.length;s+=1)if(!Kt(h[s],a))return null}}return"Expected "+_i(t)+" but found "+_i(a)+" instead."}function Ca(t,a){return a.some(function(s){return s.kind===t.kind})}function Ei(t,a){return a.some(function(s){return s==="null"?t===null:s==="array"?Array.isArray(t):s==="object"?t&&!Array.isArray(t)&&typeof t=="object":s===typeof t})}var Mi=J(function(t,a){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(M){return(M=Math.round(M))<0?0:M>255?255:M}function d(M){return h(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function _(M){return(k=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:k>1?1:k;var k}function S(M,k,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?M+(k-M)*z*6:2*z<1?k:3*z<2?M+(k-M)*(2/3-z)*6:M}try{a.parseCSSColor=function(M){var k,z=M.replace(/ /g,"").toLowerCase();if(z in s)return s[z].slice();if(z[0]==="#")return z.length===4?(k=parseInt(z.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:z.length===7&&(k=parseInt(z.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var V=z.indexOf("("),H=z.indexOf(")");if(V!==-1&&H+1===z.length){var ee=z.substr(0,V),se=z.substr(V+1,H-(V+1)).split(","),Me=1;switch(ee){case"rgba":if(se.length!==4)return null;Me=_(se.pop());case"rgb":return se.length!==3?null:[d(se[0]),d(se[1]),d(se[2]),Me];case"hsla":if(se.length!==4)return null;Me=_(se.pop());case"hsl":if(se.length!==3)return null;var Oe=(parseFloat(se[0])%360+360)%360/360,Ke=_(se[1]),ze=_(se[2]),ot=ze<=.5?ze*(Ke+1):ze+Ke-ze*Ke,xt=2*ze-ot;return[h(255*S(xt,ot,Oe+1/3)),h(255*S(xt,ot,Oe)),h(255*S(xt,ot,Oe-1/3)),Me];default:return null}}return null}}catch(M){}}).parseCSSColor,Ui=function(t,a,s,h){h===void 0&&(h=1),this.r=t,this.g=a,this.b=s,this.a=h};Ui.parse=function(t){if(t){if(t instanceof Ui)return t;if(typeof t=="string"){var a=Mi(t);if(a)return new Ui(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3])}}},Ui.prototype.toString=function(){var t=this.toArray(),a=t[1],s=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(a)+","+Math.round(s)+","+h+")"},Ui.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Ui.black=new Ui(0,0,0,1),Ui.white=new Ui(1,1,1,1),Ui.transparent=new Ui(0,0,0,0),Ui.red=new Ui(1,0,0,1);var Wr=function(t,a,s){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Wr.prototype.compare=function(t,a){return this.collator.compare(t,a)},Wr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Sn=function(t,a,s,h,d){this.text=t,this.image=a,this.scale=s,this.fontStack=h,this.textColor=d},zt=function(t){this.sections=t};zt.fromString=function(t){return new zt([new Sn(t,null,null,null,null)])},zt.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},zt.factory=function(t){return t instanceof zt?t:zt.fromString(t)},zt.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},zt.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var h=s[a];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var d={};h.fontStack&&(d["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(d["font-scale"]=h.scale),h.textColor&&(d["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(d)}}return t};var na=function(t){this.name=t.name,this.available=t.available};function be(t,a,s,h){return typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,a,s,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,a,s,h]:[t,a,s]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ko(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Ui||t instanceof Wr||t instanceof zt||t instanceof na)return!0;if(Array.isArray(t)){for(var a=0,s=t;a<s.length;a+=1)if(!Ko(s[a]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!Ko(t[h]))return!1;return!0}return!1}function Qi(t){if(t===null)return un;if(typeof t=="string")return $r;if(typeof t=="boolean")return Fr;if(typeof t=="number")return Tt;if(t instanceof Ui)return Gr;if(t instanceof Wr)return Pn;if(t instanceof zt)return Wi;if(t instanceof na)return pi;if(Array.isArray(t)){for(var a,s=t.length,h=0,d=t;h<d.length;h+=1){var _=Qi(d[h]);if(a){if(a===_)continue;a=Jr;break}a=_}return Ci(a||Jr,s)}return vi}function fu(t){var a=typeof t;return t===null?"":a==="string"||a==="number"||a==="boolean"?String(t):t instanceof Ui||t instanceof zt||t instanceof na?t.toString():JSON.stringify(t)}na.prototype.toString=function(){return this.name},na.fromString=function(t){return t?new na({name:t,available:!1}):null},na.prototype.serialize=function(){return["image",this.name]};var Ba=function(t,a){this.type=t,this.value=a};Ba.parse=function(t,a){if(t.length!==2)return a.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!Ko(t[1]))return a.error("invalid value");var s=t[1],h=Qi(s),d=a.expectedType;return h.kind!=="array"||h.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(h=d),new Ba(h,s)},Ba.prototype.evaluate=function(){return this.value},Ba.prototype.eachChild=function(){},Ba.prototype.outputDefined=function(){return!0},Ba.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ui?["rgba"].concat(this.value.toArray()):this.value instanceof zt?this.value.serialize():this.value};var Ma=function(t){this.name="ExpressionEvaluationError",this.message=t};Ma.prototype.toJSON=function(){return this.message};var Wa={string:$r,number:Tt,boolean:Fr,object:vi},ia=function(t,a){this.type=t,this.args=a};ia.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s,h=1,d=t[0];if(d==="array"){var _,S;if(t.length>2){var M=t[1];if(typeof M!="string"||!(M in Wa)||M==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);_=Wa[M],h++}else _=Jr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}s=Ci(_,S)}else s=Wa[d];for(var k=[];h<t.length;h++){var z=a.parse(t[h],h,Jr);if(!z)return null;k.push(z)}return new ia(s,k)},ia.prototype.evaluate=function(t){for(var a=0;a<this.args.length;a++){var s=this.args[a].evaluate(t);if(!Kt(this.type,Qi(s)))return s;if(a===this.args.length-1)throw new Ma("Expected value to be of type "+_i(this.type)+", but found "+_i(Qi(s))+" instead.")}return null},ia.prototype.eachChild=function(t){this.args.forEach(t)},ia.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ia.prototype.serialize=function(){var t=this.type,a=[t.kind];if(t.kind==="array"){var s=t.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){a.push(s.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(function(d){return d.serialize()}))};var bo=function(t){this.type=Wi,this.sections=t};bo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[1];if(!Array.isArray(s)&&typeof s=="object")return a.error("First argument must be an image or text section.");for(var h=[],d=!1,_=1;_<=t.length-1;++_){var S=t[_];if(d&&typeof S=="object"&&!Array.isArray(S)){d=!1;var M=null;if(S["font-scale"]&&!(M=a.parse(S["font-scale"],1,Tt)))return null;var k=null;if(S["text-font"]&&!(k=a.parse(S["text-font"],1,Ci($r))))return null;var z=null;if(S["text-color"]&&!(z=a.parse(S["text-color"],1,Gr)))return null;var V=h[h.length-1];V.scale=M,V.font=k,V.textColor=z}else{var H=a.parse(t[_],1,Jr);if(!H)return null;var ee=H.type.kind;if(ee!=="string"&&ee!=="value"&&ee!=="null"&&ee!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,h.push({content:H,scale:null,font:null,textColor:null})}}return new bo(h)},bo.prototype.evaluate=function(t){return new zt(this.sections.map(function(a){var s=a.content.evaluate(t);return Qi(s)===pi?new Sn("",s,null,null,null):new Sn(fu(s),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))},bo.prototype.eachChild=function(t){for(var a=0,s=this.sections;a<s.length;a+=1){var h=s[a];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},bo.prototype.outputDefined=function(){return!1},bo.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var h=s[a];t.push(h.content.serialize());var d={};h.scale&&(d["font-scale"]=h.scale.serialize()),h.font&&(d["text-font"]=h.font.serialize()),h.textColor&&(d["text-color"]=h.textColor.serialize()),t.push(d)}return t};var Vo=function(t){this.type=pi,this.input=t};Vo.parse=function(t,a){if(t.length!==2)return a.error("Expected two arguments.");var s=a.parse(t[1],1,$r);return s?new Vo(s):a.error("No image name provided.")},Vo.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=na.fromString(a);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(a)>-1),s},Vo.prototype.eachChild=function(t){t(this.input)},Vo.prototype.outputDefined=function(){return!1},Vo.prototype.serialize=function(){return["image",this.input.serialize()]};var wu={"to-boolean":Fr,"to-color":Gr,"to-number":Tt,"to-string":$r},fo=function(t,a){this.type=t,this.args=a};fo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[0];if((s==="to-boolean"||s==="to-string")&&t.length!==2)return a.error("Expected one argument.");for(var h=wu[s],d=[],_=1;_<t.length;_++){var S=a.parse(t[_],_,Jr);if(!S)return null;d.push(S)}return new fo(h,d)},fo.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var a,s,h=0,d=this.args;h<d.length;h+=1){if(s=null,(a=d[h].evaluate(t))instanceof Ui)return a;if(typeof a=="string"){var _=t.parseColor(a);if(_)return _}else if(Array.isArray(a)&&!(s=a.length<3||a.length>4?"Invalid rbga value "+JSON.stringify(a)+": expected an array containing either three or four numeric values.":be(a[0],a[1],a[2],a[3])))return new Ui(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ma(s||"Could not parse color from value '"+(typeof a=="string"?a:String(JSON.stringify(a)))+"'")}if(this.type.kind==="number"){for(var S=null,M=0,k=this.args;M<k.length;M+=1){if((S=k[M].evaluate(t))===null)return 0;var z=Number(S);if(!isNaN(z))return z}throw new Ma("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?zt.fromString(fu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?na.fromString(fu(this.args[0].evaluate(t))):fu(this.args[0].evaluate(t))},fo.prototype.eachChild=function(t){this.args.forEach(t)},fo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},fo.prototype.serialize=function(){if(this.type.kind==="formatted")return new bo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(a){t.push(a.serialize())}),t};var Do=["Unknown","Point","LineString","Polygon"],aa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};aa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},aa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Do[this.feature.type]:this.feature.type:null},aa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},aa.prototype.canonicalID=function(){return this.canonical},aa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},aa.prototype.parseColor=function(t){var a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=Ui.parse(t)),a};var Xa=function(t,a,s,h){this.name=t,this.type=a,this._evaluate=s,this.args=h};Xa.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Xa.prototype.eachChild=function(t){this.args.forEach(t)},Xa.prototype.outputDefined=function(){return!1},Xa.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Xa.parse=function(t,a){var s,h=t[0],d=Xa.definitions[h];if(!d)return a.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var _=Array.isArray(d)?d[0]:d.type,S=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,M=S.filter(function(Zn){var ln=Zn[0];return!Array.isArray(ln)||ln.length===t.length-1}),k=null,z=0,V=M;z<V.length;z+=1){var H=V[z],ee=H[0],se=H[1];k=new Fs(a.registry,a.path,null,a.scope);for(var Me=[],Oe=!1,Ke=1;Ke<t.length;Ke++){var ze=t[Ke],ot=Array.isArray(ee)?ee[Ke-1]:ee.type,xt=k.parse(ze,1+Me.length,ot);if(!xt){Oe=!0;break}Me.push(xt)}if(!Oe)if(Array.isArray(ee)&&ee.length!==Me.length)k.error("Expected "+ee.length+" arguments, but found "+Me.length+" instead.");else{for(var Bt=0;Bt<Me.length;Bt++){var Vt=Array.isArray(ee)?ee[Bt]:ee.type,or=Me[Bt];k.concat(Bt+1).checkSubtype(Vt,or.type)}if(k.errors.length===0)return new Xa(h,_,se,Me)}}if(M.length===1)(s=a.errors).push.apply(s,k.errors);else{for(var Tr=(M.length?M:S).map(function(Zn){var ln;return ln=Zn[0],Array.isArray(ln)?"("+ln.map(_i).join(", ")+")":"("+_i(ln.type)+"...)"}).join(" | "),Vr=[],Mn=1;Mn<t.length;Mn++){var sn=a.parse(t[Mn],1+Vr.length);if(!sn)return null;Vr.push(_i(sn.type))}a.error("Expected arguments of type "+Tr+", but found ("+Vr.join(", ")+") instead.")}return null},Xa.register=function(t,a){for(var s in Xa.definitions=a,a)t[s]=Xa};var Fo=function(t,a,s){this.type=Pn,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=a};function Ya(t,a){t[0]=Math.min(t[0],a[0]),t[1]=Math.min(t[1],a[1]),t[2]=Math.max(t[2],a[0]),t[3]=Math.max(t[3],a[1])}function Cs(t,a){return!(t[0]<=a[0]||t[2]>=a[2]||t[1]<=a[1]||t[3]>=a[3])}function Sl(t,a){var s=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,d=Math.pow(2,a.z);return[Math.round(s*d*8192),Math.round(h*d*8192)]}function ds(t,a,s){return a[1]>t[1]!=s[1]>t[1]&&t[0]<(s[0]-a[0])*(t[1]-a[1])/(s[1]-a[1])+a[0]}function ae(t,a){for(var s,h,d,_,S,M,k,z=!1,V=0,H=a.length;V<H;V++)for(var ee=a[V],se=0,Me=ee.length;se<Me-1;se++){if((_=(s=t)[0]-(h=ee[se])[0])*(k=s[1]-(d=ee[se+1])[1])-(M=s[0]-d[0])*(S=s[1]-h[1])==0&&_*M<=0&&S*k<=0)return!1;ds(t,ee[se],ee[se+1])&&(z=!z)}return z}function xe(t,a){for(var s=0;s<a.length;s++)if(ae(t,a[s]))return!0;return!1}function qe(t,a,s,h){var d=h[0]-s[0],_=h[1]-s[1],S=(t[0]-s[0])*_-d*(t[1]-s[1]),M=(a[0]-s[0])*_-d*(a[1]-s[1]);return S>0&&M<0||S<0&&M>0}function Ct(t,a,s){for(var h=0,d=s;h<d.length;h+=1)for(var _=d[h],S=0;S<_.length-1;++S)if((H=[(V=_[S+1])[0]-(z=_[S])[0],V[1]-z[1]])[0]*(ee=[(k=a)[0]-(M=t)[0],k[1]-M[1]])[1]-H[1]*ee[0]!=0&&qe(M,k,z,V)&&qe(z,V,M,k))return!0;var M,k,z,V,H,ee;return!1}function Ir(t,a){for(var s=0;s<t.length;++s)if(!ae(t[s],a))return!1;for(var h=0;h<t.length-1;++h)if(Ct(t[h],t[h+1],a))return!1;return!0}function Tn(t,a){for(var s=0;s<a.length;s++)if(Ir(t,a[s]))return!0;return!1}function Pi(t,a,s){for(var h=[],d=0;d<t.length;d++){for(var _=[],S=0;S<t[d].length;S++){var M=Sl(t[d][S],s);Ya(a,M),_.push(M)}h.push(_)}return h}function ro(t,a,s){for(var h=[],d=0;d<t.length;d++){var _=Pi(t[d],a,s);h.push(_)}return h}function ka(t,a,s,h){if(t[0]<s[0]||t[0]>s[2]){var d=.5*h,_=t[0]-s[0]>d?-h:s[0]-t[0]>d?h:0;_===0&&(_=t[0]-s[2]>d?-h:s[2]-t[0]>d?h:0),t[0]+=_}Ya(a,t)}function za(t,a,s,h){for(var d=8192*Math.pow(2,h.z),_=[8192*h.x,8192*h.y],S=[],M=0,k=t;M<k.length;M+=1)for(var z=0,V=k[M];z<V.length;z+=1){var H=V[z],ee=[H.x+_[0],H.y+_[1]];ka(ee,a,s,d),S.push(ee)}return S}function jo(t,a,s,h){for(var d,_=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],M=[],k=0,z=t;k<z.length;k+=1){for(var V=[],H=0,ee=z[k];H<ee.length;H+=1){var se=ee[H],Me=[se.x+S[0],se.y+S[1]];Ya(a,Me),V.push(Me)}M.push(V)}if(a[2]-a[0]<=_/2){(d=a)[0]=d[1]=1/0,d[2]=d[3]=-1/0;for(var Oe=0,Ke=M;Oe<Ke.length;Oe+=1)for(var ze=0,ot=Ke[Oe];ze<ot.length;ze+=1)ka(ot[ze],a,s,_)}return M}Fo.parse=function(t,a){if(t.length!==2)return a.error("Expected one argument.");var s=t[1];if(typeof s!="object"||Array.isArray(s))return a.error("Collator options argument must be an object.");var h=a.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Fr);if(!h)return null;var d=a.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Fr);if(!d)return null;var _=null;return s.locale&&!(_=a.parse(s.locale,1,$r))?null:new Fo(h,d,_)},Fo.prototype.evaluate=function(t){return new Wr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Fo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Fo.prototype.outputDefined=function(){return!1},Fo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var vs=function(t,a){this.type=Fr,this.geojson=t,this.geometries=a};function oo(t){if(t instanceof Xa&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof vs)return!1;var a=!0;return t.eachChild(function(s){a&&!oo(s)&&(a=!1)}),a}function Eo(t){if(t instanceof Xa&&t.name==="feature-state")return!1;var a=!0;return t.eachChild(function(s){a&&!Eo(s)&&(a=!1)}),a}function ms(t,a){if(t instanceof Xa&&a.indexOf(t.name)>=0)return!1;var s=!0;return t.eachChild(function(h){s&&!ms(h,a)&&(s=!1)}),s}vs.parse=function(t,a){if(t.length!==2)return a.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(Ko(t[1])){var s=t[1];if(s.type==="FeatureCollection")for(var h=0;h<s.features.length;++h){var d=s.features[h].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new vs(s,s.features[h].geometry)}else if(s.type==="Feature"){var _=s.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new vs(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new vs(s,s)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")},vs.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,s){var h=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(s.type==="Polygon"){var S=Pi(s.coordinates,d,_),M=za(a.geometry(),h,d,_);if(!Cs(h,d))return!1;for(var k=0,z=M;k<z.length;k+=1)if(!ae(z[k],S))return!1}if(s.type==="MultiPolygon"){var V=ro(s.coordinates,d,_),H=za(a.geometry(),h,d,_);if(!Cs(h,d))return!1;for(var ee=0,se=H;ee<se.length;ee+=1)if(!xe(se[ee],V))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,s){var h=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(s.type==="Polygon"){var S=Pi(s.coordinates,d,_),M=jo(a.geometry(),h,d,_);if(!Cs(h,d))return!1;for(var k=0,z=M;k<z.length;k+=1)if(!Ir(z[k],S))return!1}if(s.type==="MultiPolygon"){var V=ro(s.coordinates,d,_),H=jo(a.geometry(),h,d,_);if(!Cs(h,d))return!1;for(var ee=0,se=H;ee<se.length;ee+=1)if(!Tn(se[ee],V))return!1}return!0}(t,this.geometries)}return!1},vs.prototype.eachChild=function(){},vs.prototype.outputDefined=function(){return!0},vs.prototype.serialize=function(){return["within",this.geojson]};var Ms=function(t,a){this.type=a.type,this.name=t,this.boundExpression=a};Ms.parse=function(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");var s=t[1];return a.scope.has(s)?new Ms(s,a.scope.get(s)):a.error('Unknown variable "'+s+'". Make sure "'+s+'" has been bound in an enclosing "let" expression before using it.',1)},Ms.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ms.prototype.eachChild=function(){},Ms.prototype.outputDefined=function(){return!1},Ms.prototype.serialize=function(){return["var",this.name]};var Fs=function(t,a,s,h,d){a===void 0&&(a=[]),h===void 0&&(h=new mn),d===void 0&&(d=[]),this.registry=t,this.path=a,this.key=a.map(function(_){return"["+_+"]"}).join(""),this.scope=h,this.errors=d,this.expectedType=s};function eu(t,a){for(var s,h=t.length-1,d=0,_=h,S=0;d<=_;)if((s=t[S=Math.floor((d+_)/2)])<=a){if(S===h||a<t[S+1])return S;d=S+1}else{if(!(s>a))throw new Ma("Input is not a number.");_=S-1}return 0}Fs.prototype.parse=function(t,a,s,h,d){return d===void 0&&(d={}),a?this.concat(a,s,h)._parse(t,d):this._parse(t,d)},Fs.prototype._parse=function(t,a){function s(z,V,H){return H==="assert"?new ia(V,[z]):H==="coerce"?new fo(V,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var d=this.registry[h];if(d){var _=d.parse(t,this);if(!_)return null;if(this.expectedType){var S=this.expectedType,M=_.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||M.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(S,M))return null}else _=s(_,S,a.typeAnnotation||"coerce");else _=s(_,S,a.typeAnnotation||"assert")}if(!(_ instanceof Ba)&&_.type.kind!=="resolvedImage"&&function z(V){if(V instanceof Ms)return z(V.boundExpression);if(V instanceof Xa&&V.name==="error"||V instanceof Fo||V instanceof vs)return!1;var H=V instanceof fo||V instanceof ia,ee=!0;return V.eachChild(function(se){ee=H?ee&&z(se):ee&&se instanceof Ba}),!!ee&&oo(V)&&ms(V,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(_)){var k=new aa;try{_=new Ba(_.type,_.evaluate(k))}catch(z){return this.error(z.message),null}}return _}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Fs.prototype.concat=function(t,a,s){var h=typeof t=="number"?this.path.concat(t):this.path,d=s?this.scope.concat(s):this.scope;return new Fs(this.registry,h,a||null,d,this.errors)},Fs.prototype.error=function(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];var h=""+this.key+a.map(function(d){return"["+d+"]"}).join("");this.errors.push(new pr(h,t))},Fs.prototype.checkSubtype=function(t,a){var s=Kt(t,a);return s&&this.error(s),s};var gs=function(t,a,s){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(var h=0,d=s;h<d.length;h+=1){var _=d[h],S=_[1];this.labels.push(_[0]),this.outputs.push(S)}};function ga(t,a,s){return t*(1-s)+a*s}gs.parse=function(t,a){if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");var s=a.parse(t[1],1,Tt);if(!s)return null;var h=[],d=null;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);for(var _=1;_<t.length;_+=2){var S=_===1?-1/0:t[_],M=t[_+1],k=_,z=_+1;if(typeof S!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(h.length&&h[h.length-1][0]>=S)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var V=a.parse(M,z,d);if(!V)return null;d=d||V.type,h.push([S,V])}return new gs(d,s,h)},gs.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return s[0].evaluate(t);var d=a.length;return h>=a[d-1]?s[d-1].evaluate(t):s[eu(a,h)].evaluate(t)},gs.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},gs.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},gs.prototype.serialize=function(){for(var t=["step",this.input.serialize()],a=0;a<this.labels.length;a++)a>0&&t.push(this.labels[a]),t.push(this.outputs[a].serialize());return t};var _a=Object.freeze({__proto__:null,number:ga,color:function(t,a,s){return new Ui(ga(t.r,a.r,s),ga(t.g,a.g,s),ga(t.b,a.b,s),ga(t.a,a.a,s))},array:function(t,a,s){return t.map(function(h,d){return ga(h,a[d],s)})}}),ns=6/29*3*(6/29),ef=Math.PI/180,wl=180/Math.PI;function Hs(t){return t>.008856451679035631?Math.pow(t,1/3):t/ns+4/29}function Jl(t){return t>6/29?t*t*t:ns*(t-4/29)}function zu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ws(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function il(t){var a=Ws(t.r),s=Ws(t.g),h=Ws(t.b),d=Hs((.4124564*a+.3575761*s+.1804375*h)/.95047),_=Hs((.2126729*a+.7151522*s+.072175*h)/1);return{l:116*_-16,a:500*(d-_),b:200*(_-Hs((.0193339*a+.119192*s+.9503041*h)/1.08883)),alpha:t.a}}function g(t){var a=(t.l+16)/116,s=isNaN(t.a)?a:a+t.a/500,h=isNaN(t.b)?a:a-t.b/200;return a=1*Jl(a),s=.95047*Jl(s),h=1.08883*Jl(h),new Ui(zu(3.2404542*s-1.5371385*a-.4985314*h),zu(-.969266*s+1.8760108*a+.041556*h),zu(.0556434*s-.2040259*a+1.0572252*h),t.alpha)}function A(t,a,s){var h=a-t;return t+s*(h>180||h<-180?h-360*Math.round(h/360):h)}var N={forward:il,reverse:g,interpolate:function(t,a,s){return{l:ga(t.l,a.l,s),a:ga(t.a,a.a,s),b:ga(t.b,a.b,s),alpha:ga(t.alpha,a.alpha,s)}}},O={forward:function(t){var a=il(t),s=a.l,h=a.a,d=a.b,_=Math.atan2(d,h)*wl;return{h:_<0?_+360:_,c:Math.sqrt(h*h+d*d),l:s,alpha:t.a}},reverse:function(t){var a=t.h*ef,s=t.c;return g({l:t.l,a:Math.cos(a)*s,b:Math.sin(a)*s,alpha:t.alpha})},interpolate:function(t,a,s){return{h:A(t.h,a.h,s),c:ga(t.c,a.c,s),l:ga(t.l,a.l,s),alpha:ga(t.alpha,a.alpha,s)}}},q=Object.freeze({__proto__:null,lab:N,hcl:O}),_e=function(t,a,s,h,d){this.type=t,this.operator=a,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(var _=0,S=d;_<S.length;_+=1){var M=S[_],k=M[1];this.labels.push(M[0]),this.outputs.push(k)}};function Xe(t,a,s,h){var d=h-s,_=t-s;return d===0?0:a===1?_/d:(Math.pow(a,_)-1)/(Math.pow(a,d)-1)}_e.interpolationFactor=function(t,a,s,h){var d=0;if(t.name==="exponential")d=Xe(a,t.base,s,h);else if(t.name==="linear")d=Xe(a,1,s,h);else if(t.name==="cubic-bezier"){var _=t.controlPoints;d=new F(_[0],_[1],_[2],_[3]).solve(Xe(a,1,s,h))}return d},_e.parse=function(t,a){var s=t[0],h=t[1],d=t[2],_=t.slice(3);if(!Array.isArray(h)||h.length===0)return a.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return a.error("Unknown interpolation type "+String(h[0]),1,0);var M=h.slice(1);if(M.length!==4||M.some(function(Ke){return typeof Ke!="number"||Ke<0||Ke>1}))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(!(d=a.parse(d,2,Tt)))return null;var k=[],z=null;s==="interpolate-hcl"||s==="interpolate-lab"?z=Gr:a.expectedType&&a.expectedType.kind!=="value"&&(z=a.expectedType);for(var V=0;V<_.length;V+=2){var H=_[V],ee=_[V+1],se=V+3,Me=V+4;if(typeof H!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',se);if(k.length&&k[k.length-1][0]>=H)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',se);var Oe=a.parse(ee,Me,z);if(!Oe)return null;z=z||Oe.type,k.push([H,Oe])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new _e(z,s,h,d,k):a.error("Type "+_i(z)+" is not interpolatable.")},_e.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return s[0].evaluate(t);var d=a.length;if(h>=a[d-1])return s[d-1].evaluate(t);var _=eu(a,h),S=_e.interpolationFactor(this.interpolation,h,a[_],a[_+1]),M=s[_].evaluate(t),k=s[_+1].evaluate(t);return this.operator==="interpolate"?_a[this.type.kind.toLowerCase()](M,k,S):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(M),O.forward(k),S)):N.reverse(N.interpolate(N.forward(M),N.forward(k),S))},_e.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},_e.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},_e.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var a=[this.operator,t,this.input.serialize()],s=0;s<this.labels.length;s++)a.push(this.labels[s],this.outputs[s].serialize());return a};var ft=function(t,a){this.type=t,this.args=a};ft.parse=function(t,a){if(t.length<2)return a.error("Expectected at least one argument.");var s=null,h=a.expectedType;h&&h.kind!=="value"&&(s=h);for(var d=[],_=0,S=t.slice(1);_<S.length;_+=1){var M=a.parse(S[_],1+d.length,s,void 0,{typeAnnotation:"omit"});if(!M)return null;s=s||M.type,d.push(M)}var k=h&&d.some(function(z){return Kt(h,z.type)});return new ft(k?Jr:s,d)},ft.prototype.evaluate=function(t){for(var a,s=null,h=0,d=0,_=this.args;d<_.length&&(h++,(s=_[d].evaluate(t))&&s instanceof na&&!s.available&&(a||(a=s.name),s=null,h===this.args.length&&(s=a)),s===null);d+=1);return s},ft.prototype.eachChild=function(t){this.args.forEach(t)},ft.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ft.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(a){t.push(a.serialize())}),t};var pt=function(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a};pt.prototype.evaluate=function(t){return this.result.evaluate(t)},pt.prototype.eachChild=function(t){for(var a=0,s=this.bindings;a<s.length;a+=1)t(s[a][1]);t(this.result)},pt.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var s=[],h=1;h<t.length-1;h+=2){var d=t[h];if(typeof d!="string")return a.error("Expected string, but found "+typeof d+" instead.",h);if(/[^a-zA-Z0-9_]/.test(d))return a.error("Variable names must contain only alphanumeric characters or '_'.",h);var _=a.parse(t[h+1],h+1);if(!_)return null;s.push([d,_])}var S=a.parse(t[t.length-1],t.length-1,a.expectedType,s);return S?new pt(s,S):null},pt.prototype.outputDefined=function(){return this.result.outputDefined()},pt.prototype.serialize=function(){for(var t=["let"],a=0,s=this.bindings;a<s.length;a+=1){var h=s[a];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var ir=function(t,a,s){this.type=t,this.index=a,this.input=s};ir.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Tt),h=a.parse(t[2],2,Ci(a.expectedType||Jr));return s&&h?new ir(h.type.itemType,s,h):null},ir.prototype.evaluate=function(t){var a=this.index.evaluate(t),s=this.input.evaluate(t);if(a<0)throw new Ma("Array index out of bounds: "+a+" < 0.");if(a>=s.length)throw new Ma("Array index out of bounds: "+a+" > "+(s.length-1)+".");if(a!==Math.floor(a))throw new Ma("Array index must be an integer, but found "+a+" instead.");return s[a]},ir.prototype.eachChild=function(t){t(this.index),t(this.input)},ir.prototype.outputDefined=function(){return!1},ir.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var sr=function(t,a){this.type=Fr,this.needle=t,this.haystack=a};sr.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Jr),h=a.parse(t[2],2,Jr);return s&&h?Ca(s.type,[Fr,$r,Tt,un,Jr])?new sr(s,h):a.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(s.type)+" instead"):null},sr.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!Ei(a,["boolean","string","number","null"]))throw new Ma("Expected first argument to be of type boolean, string, number or null, but found "+_i(Qi(a))+" instead.");if(!Ei(s,["string","array"]))throw new Ma("Expected second argument to be of type array or string, but found "+_i(Qi(s))+" instead.");return s.indexOf(a)>=0},sr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},sr.prototype.outputDefined=function(){return!0},sr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var wn=function(t,a,s){this.type=Tt,this.needle=t,this.haystack=a,this.fromIndex=s};wn.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Jr),h=a.parse(t[2],2,Jr);if(!s||!h)return null;if(!Ca(s.type,[Fr,$r,Tt,un,Jr]))return a.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(s.type)+" instead");if(t.length===4){var d=a.parse(t[3],3,Tt);return d?new wn(s,h,d):null}return new wn(s,h)},wn.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Ei(a,["boolean","string","number","null"]))throw new Ma("Expected first argument to be of type boolean, string, number or null, but found "+_i(Qi(a))+" instead.");if(!Ei(s,["string","array"]))throw new Ma("Expected second argument to be of type array or string, but found "+_i(Qi(s))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return s.indexOf(a,h)}return s.indexOf(a)},wn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},wn.prototype.outputDefined=function(){return!1},wn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ri=function(t,a,s,h,d,_){this.inputType=t,this.type=a,this.input=s,this.cases=h,this.outputs=d,this.otherwise=_};ri.parse=function(t,a){if(t.length<5)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return a.error("Expected an even number of arguments.");var s,h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);for(var d={},_=[],S=2;S<t.length-1;S+=2){var M=t[S],k=t[S+1];Array.isArray(M)||(M=[M]);var z=a.concat(S);if(M.length===0)return z.error("Expected at least one branch label.");for(var V=0,H=M;V<H.length;V+=1){var ee=H[V];if(typeof ee!="number"&&typeof ee!="string")return z.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ee=="number"&&Math.floor(ee)!==ee)return z.error("Numeric branch labels must be integer values.");if(s){if(z.checkSubtype(s,Qi(ee)))return null}else s=Qi(ee);if(d[String(ee)]!==void 0)return z.error("Branch labels must be unique.");d[String(ee)]=_.length}var se=a.parse(k,S,h);if(!se)return null;h=h||se.type,_.push(se)}var Me=a.parse(t[1],1,Jr);if(!Me)return null;var Oe=a.parse(t[t.length-1],t.length-1,h);return Oe?Me.type.kind!=="value"&&a.concat(1).checkSubtype(s,Me.type)?null:new ri(s,h,Me,d,_,Oe):null},ri.prototype.evaluate=function(t){var a=this.input.evaluate(t);return(Qi(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)},ri.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ri.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ri.prototype.serialize=function(){for(var t=this,a=["match",this.input.serialize()],s=[],h={},d=0,_=Object.keys(this.cases).sort();d<_.length;d+=1){var S=_[d];(H=h[this.cases[S]])===void 0?(h[this.cases[S]]=s.length,s.push([this.cases[S],[S]])):s[H][1].push(S)}for(var M=function(se){return t.inputType.kind==="number"?Number(se):se},k=0,z=s;k<z.length;k+=1){var V=z[k],H=V[0],ee=V[1];a.push(ee.length===1?M(ee[0]):ee.map(M)),a.push(this.outputs[outputIndex$1].serialize())}return a.push(this.otherwise.serialize()),a};var On=function(t,a,s){this.type=t,this.branches=a,this.otherwise=s};On.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return a.error("Expected an odd number of arguments.");var s;a.expectedType&&a.expectedType.kind!=="value"&&(s=a.expectedType);for(var h=[],d=1;d<t.length-1;d+=2){var _=a.parse(t[d],d,Fr);if(!_)return null;var S=a.parse(t[d+1],d+1,s);if(!S)return null;h.push([_,S]),s=s||S.type}var M=a.parse(t[t.length-1],t.length-1,s);return M?new On(s,h,M):null},On.prototype.evaluate=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var h=s[a],d=h[1];if(h[0].evaluate(t))return d.evaluate(t)}return this.otherwise.evaluate(t)},On.prototype.eachChild=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var h=s[a],d=h[1];t(h[0]),t(d)}t(this.otherwise)},On.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},On.prototype.serialize=function(){var t=["case"];return this.eachChild(function(a){t.push(a.serialize())}),t};var Xi=function(t,a,s,h){this.type=t,this.input=a,this.beginIndex=s,this.endIndex=h};function da(t,a){return t==="=="||t==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function wa(t,a,s,h){return h.compare(a,s)===0}function ji(t,a,s){var h=t!=="=="&&t!=="!=";return function(){function d(_,S,M){this.type=Fr,this.lhs=_,this.rhs=S,this.collator=M,this.hasUntypedArgument=_.type.kind==="value"||S.type.kind==="value"}return d.parse=function(_,S){if(_.length!==3&&_.length!==4)return S.error("Expected two or three arguments.");var M=_[0],k=S.parse(_[1],1,Jr);if(!k)return null;if(!da(M,k.type))return S.concat(1).error('"'+M+`" comparisons are not supported for type '`+_i(k.type)+"'.");var z=S.parse(_[2],2,Jr);if(!z)return null;if(!da(M,z.type))return S.concat(2).error('"'+M+`" comparisons are not supported for type '`+_i(z.type)+"'.");if(k.type.kind!==z.type.kind&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot compare types '"+_i(k.type)+"' and '"+_i(z.type)+"'.");h&&(k.type.kind==="value"&&z.type.kind!=="value"?k=new ia(z.type,[k]):k.type.kind!=="value"&&z.type.kind==="value"&&(z=new ia(k.type,[z])));var V=null;if(_.length===4){if(k.type.kind!=="string"&&z.type.kind!=="string"&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(V=S.parse(_[3],3,Pn)))return null}return new d(k,z,V)},d.prototype.evaluate=function(_){var S=this.lhs.evaluate(_),M=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){var k=Qi(S),z=Qi(M);if(k.kind!==z.kind||k.kind!=="string"&&k.kind!=="number")throw new Ma('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+k.kind+", "+z.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var V=Qi(S),H=Qi(M);if(V.kind!=="string"||H.kind!=="string")return a(_,S,M)}return this.collator?s(_,S,M,this.collator.evaluate(_)):a(_,S,M)},d.prototype.eachChild=function(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)},d.prototype.outputDefined=function(){return!0},d.prototype.serialize=function(){var _=[t];return this.eachChild(function(S){_.push(S.serialize())}),_},d}()}Xi.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Jr),h=a.parse(t[2],2,Tt);if(!s||!h)return null;if(!Ca(s.type,[Ci(Jr),$r,Jr]))return a.error("Expected first argument to be of type array or string, but found "+_i(s.type)+" instead");if(t.length===4){var d=a.parse(t[3],3,Tt);return d?new Xi(s.type,s,h,d):null}return new Xi(s.type,s,h)},Xi.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!Ei(a,["string","array"]))throw new Ma("Expected first argument to be of type array or string, but found "+_i(Qi(a))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return a.slice(s,h)}return a.slice(s)},Xi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Xi.prototype.outputDefined=function(){return!1},Xi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ys=ji("==",function(t,a,s){return a===s},wa),tu=ji("!=",function(t,a,s){return a!==s},function(t,a,s,h){return!wa(0,a,s,h)}),Uu=ji("<",function(t,a,s){return a<s},function(t,a,s,h){return h.compare(a,s)<0}),tf=ji(">",function(t,a,s){return a>s},function(t,a,s,h){return h.compare(a,s)>0}),al=ji("<=",function(t,a,s){return a<=s},function(t,a,s,h){return h.compare(a,s)<=0}),Cc=ji(">=",function(t,a,s){return a>=s},function(t,a,s,h){return h.compare(a,s)>=0}),Tu=function(t,a,s,h,d){this.type=$r,this.number=t,this.locale=a,this.currency=s,this.minFractionDigits=h,this.maxFractionDigits=d};Tu.parse=function(t,a){if(t.length!==3)return a.error("Expected two arguments.");var s=a.parse(t[1],1,Tt);if(!s)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");var d=null;if(h.locale&&!(d=a.parse(h.locale,1,$r)))return null;var _=null;if(h.currency&&!(_=a.parse(h.currency,1,$r)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=a.parse(h["min-fraction-digits"],1,Tt)))return null;var M=null;return h["max-fraction-digits"]&&!(M=a.parse(h["max-fraction-digits"],1,Tt))?null:new Tu(s,d,_,S,M)},Tu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Tu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Tu.prototype.outputDefined=function(){return!1},Tu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Au=function(t){this.type=Tt,this.input=t};Au.parse=function(t,a){if(t.length!==2)return a.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?a.error("Expected argument of type string or array, but found "+_i(s.type)+" instead."):new Au(s):null},Au.prototype.evaluate=function(t){var a=this.input.evaluate(t);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Ma("Expected value to be of type string or array, but found "+_i(Qi(a))+" instead.")},Au.prototype.eachChild=function(t){t(this.input)},Au.prototype.outputDefined=function(){return!1},Au.prototype.serialize=function(){var t=["length"];return this.eachChild(function(a){t.push(a.serialize())}),t};var Cu={"==":ys,"!=":tu,">":tf,"<":Uu,">=":Cc,"<=":al,array:ia,at:ir,boolean:ia,case:On,coalesce:ft,collator:Fo,format:bo,image:Vo,in:sr,"index-of":wn,interpolate:_e,"interpolate-hcl":_e,"interpolate-lab":_e,length:Au,let:pt,literal:Ba,match:ri,number:ia,"number-format":Tu,object:ia,slice:Xi,step:gs,string:ia,"to-boolean":fo,"to-color":fo,"to-number":fo,"to-string":fo,var:Ms,within:vs};function so(t,a){var s=a[0],h=a[1],d=a[2],_=a[3];s=s.evaluate(t),h=h.evaluate(t),d=d.evaluate(t);var S=_?_.evaluate(t):1,M=be(s,h,d,S);if(M)throw new Ma(M);return new Ui(s/255*S,h/255*S,d/255*S,S)}function kf(t,a){return t in a}function Df(t,a){var s=a[t];return s===void 0?null:s}function qo(t){return{type:t}}function Mc(t){return{result:"success",value:t}}function Mu(t){return{result:"error",value:t}}function ru(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function rf(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Tl(t){return!!t.expression&&t.expression.interpolated}function Fi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Al(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function yh(t){return t}function ol(t,a,s){return t!==void 0?t:a!==void 0?a:s!==void 0?s:void 0}function Pc(t,a,s,h,d){return ol(typeof s===d?h[s]:void 0,t.default,a.default)}function Ff(t,a,s){if(Fi(s)!=="number")return ol(t.default,a.default);var h=t.stops.length;if(h===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[h-1][0])return t.stops[h-1][1];var d=eu(t.stops.map(function(_){return _[0]}),s);return t.stops[d][1]}function _h(t,a,s){var h=t.base!==void 0?t.base:1;if(Fi(s)!=="number")return ol(t.default,a.default);var d=t.stops.length;if(d===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[d-1][0])return t.stops[d-1][1];var _=eu(t.stops.map(function(H){return H[0]}),s),S=function(H,ee,se,Me){var Oe=Me-se,Ke=H-se;return Oe===0?0:ee===1?Ke/Oe:(Math.pow(ee,Ke)-1)/(Math.pow(ee,Oe)-1)}(s,h,t.stops[_][0],t.stops[_+1][0]),M=t.stops[_][1],k=t.stops[_+1][1],z=_a[a.type]||yh;if(t.colorSpace&&t.colorSpace!=="rgb"){var V=q[t.colorSpace];z=function(H,ee){return V.reverse(V.interpolate(V.forward(H),V.forward(ee),S))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var H=[],ee=arguments.length;ee--;)H[ee]=arguments[ee];var se=M.evaluate.apply(void 0,H),Me=k.evaluate.apply(void 0,H);if(se!==void 0&&Me!==void 0)return z(se,Me,S)}}:z(M,k,S)}function Nf(t,a,s){return a.type==="color"?s=Ui.parse(s):a.type==="formatted"?s=zt.fromString(s.toString()):a.type==="resolvedImage"?s=na.fromString(s.toString()):Fi(s)===a.type||a.type==="enum"&&a.values[s]||(s=void 0),ol(s,t.default,a.default)}Xa.register(Cu,{error:[{kind:"error"},[$r],function(t,a){throw new Ma(a[0].evaluate(t))}],typeof:[$r,[Jr],function(t,a){return _i(Qi(a[0].evaluate(t)))}],"to-rgba":[Ci(Tt,4),[Gr],function(t,a){return a[0].evaluate(t).toArray()}],rgb:[Gr,[Tt,Tt,Tt],so],rgba:[Gr,[Tt,Tt,Tt,Tt],so],has:{type:Fr,overloads:[[[$r],function(t,a){return kf(a[0].evaluate(t),t.properties())}],[[$r,vi],function(t,a){var s=a[1];return kf(a[0].evaluate(t),s.evaluate(t))}]]},get:{type:Jr,overloads:[[[$r],function(t,a){return Df(a[0].evaluate(t),t.properties())}],[[$r,vi],function(t,a){var s=a[1];return Df(a[0].evaluate(t),s.evaluate(t))}]]},"feature-state":[Jr,[$r],function(t,a){return Df(a[0].evaluate(t),t.featureState||{})}],properties:[vi,[],function(t){return t.properties()}],"geometry-type":[$r,[],function(t){return t.geometryType()}],id:[Jr,[],function(t){return t.id()}],zoom:[Tt,[],function(t){return t.globals.zoom}],"heatmap-density":[Tt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Tt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Jr,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Tt,qo(Tt),function(t,a){for(var s=0,h=0,d=a;h<d.length;h+=1)s+=d[h].evaluate(t);return s}],"*":[Tt,qo(Tt),function(t,a){for(var s=1,h=0,d=a;h<d.length;h+=1)s*=d[h].evaluate(t);return s}],"-":{type:Tt,overloads:[[[Tt,Tt],function(t,a){var s=a[1];return a[0].evaluate(t)-s.evaluate(t)}],[[Tt],function(t,a){return-a[0].evaluate(t)}]]},"/":[Tt,[Tt,Tt],function(t,a){var s=a[1];return a[0].evaluate(t)/s.evaluate(t)}],"%":[Tt,[Tt,Tt],function(t,a){var s=a[1];return a[0].evaluate(t)%s.evaluate(t)}],ln2:[Tt,[],function(){return Math.LN2}],pi:[Tt,[],function(){return Math.PI}],e:[Tt,[],function(){return Math.E}],"^":[Tt,[Tt,Tt],function(t,a){var s=a[1];return Math.pow(a[0].evaluate(t),s.evaluate(t))}],sqrt:[Tt,[Tt],function(t,a){return Math.sqrt(a[0].evaluate(t))}],log10:[Tt,[Tt],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN10}],ln:[Tt,[Tt],function(t,a){return Math.log(a[0].evaluate(t))}],log2:[Tt,[Tt],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN2}],sin:[Tt,[Tt],function(t,a){return Math.sin(a[0].evaluate(t))}],cos:[Tt,[Tt],function(t,a){return Math.cos(a[0].evaluate(t))}],tan:[Tt,[Tt],function(t,a){return Math.tan(a[0].evaluate(t))}],asin:[Tt,[Tt],function(t,a){return Math.asin(a[0].evaluate(t))}],acos:[Tt,[Tt],function(t,a){return Math.acos(a[0].evaluate(t))}],atan:[Tt,[Tt],function(t,a){return Math.atan(a[0].evaluate(t))}],min:[Tt,qo(Tt),function(t,a){return Math.min.apply(Math,a.map(function(s){return s.evaluate(t)}))}],max:[Tt,qo(Tt),function(t,a){return Math.max.apply(Math,a.map(function(s){return s.evaluate(t)}))}],abs:[Tt,[Tt],function(t,a){return Math.abs(a[0].evaluate(t))}],round:[Tt,[Tt],function(t,a){var s=a[0].evaluate(t);return s<0?-Math.round(-s):Math.round(s)}],floor:[Tt,[Tt],function(t,a){return Math.floor(a[0].evaluate(t))}],ceil:[Tt,[Tt],function(t,a){return Math.ceil(a[0].evaluate(t))}],"filter-==":[Fr,[$r,Jr],function(t,a){var s=a[0],h=a[1];return t.properties()[s.value]===h.value}],"filter-id-==":[Fr,[Jr],function(t,a){var s=a[0];return t.id()===s.value}],"filter-type-==":[Fr,[$r],function(t,a){var s=a[0];return t.geometryType()===s.value}],"filter-<":[Fr,[$r,Jr],function(t,a){var s=a[0],h=a[1],d=t.properties()[s.value],_=h.value;return typeof d==typeof _&&d<_}],"filter-id-<":[Fr,[Jr],function(t,a){var s=a[0],h=t.id(),d=s.value;return typeof h==typeof d&&h<d}],"filter->":[Fr,[$r,Jr],function(t,a){var s=a[0],h=a[1],d=t.properties()[s.value],_=h.value;return typeof d==typeof _&&d>_}],"filter-id->":[Fr,[Jr],function(t,a){var s=a[0],h=t.id(),d=s.value;return typeof h==typeof d&&h>d}],"filter-<=":[Fr,[$r,Jr],function(t,a){var s=a[0],h=a[1],d=t.properties()[s.value],_=h.value;return typeof d==typeof _&&d<=_}],"filter-id-<=":[Fr,[Jr],function(t,a){var s=a[0],h=t.id(),d=s.value;return typeof h==typeof d&&h<=d}],"filter->=":[Fr,[$r,Jr],function(t,a){var s=a[0],h=a[1],d=t.properties()[s.value],_=h.value;return typeof d==typeof _&&d>=_}],"filter-id->=":[Fr,[Jr],function(t,a){var s=a[0],h=t.id(),d=s.value;return typeof h==typeof d&&h>=d}],"filter-has":[Fr,[Jr],function(t,a){return a[0].value in t.properties()}],"filter-has-id":[Fr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Fr,[Ci($r)],function(t,a){return a[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Fr,[Ci(Jr)],function(t,a){return a[0].value.indexOf(t.id())>=0}],"filter-in-small":[Fr,[$r,Ci(Jr)],function(t,a){var s=a[0];return a[1].value.indexOf(t.properties()[s.value])>=0}],"filter-in-large":[Fr,[$r,Ci(Jr)],function(t,a){var s=a[0],h=a[1];return function(d,_,S,M){for(;S<=M;){var k=S+M>>1;if(_[k]===d)return!0;_[k]>d?M=k-1:S=k+1}return!1}(t.properties()[s.value],h.value,0,h.value.length-1)}],all:{type:Fr,overloads:[[[Fr,Fr],function(t,a){var s=a[1];return a[0].evaluate(t)&&s.evaluate(t)}],[qo(Fr),function(t,a){for(var s=0,h=a;s<h.length;s+=1)if(!h[s].evaluate(t))return!1;return!0}]]},any:{type:Fr,overloads:[[[Fr,Fr],function(t,a){var s=a[1];return a[0].evaluate(t)||s.evaluate(t)}],[qo(Fr),function(t,a){for(var s=0,h=a;s<h.length;s+=1)if(h[s].evaluate(t))return!0;return!1}]]},"!":[Fr,[Fr],function(t,a){return!a[0].evaluate(t)}],"is-supported-script":[Fr,[$r],function(t,a){var s=t.globals&&t.globals.isSupportedScript;return!s||s(a[0].evaluate(t))}],upcase:[$r,[$r],function(t,a){return a[0].evaluate(t).toUpperCase()}],downcase:[$r,[$r],function(t,a){return a[0].evaluate(t).toLowerCase()}],concat:[$r,qo(Jr),function(t,a){return a.map(function(s){return fu(s.evaluate(t))}).join("")}],"resolved-locale":[$r,[Pn],function(t,a){return a[0].evaluate(t).resolvedLocale()}]});var Ic=function(t,a){this.expression=t,this._warningHistory={},this._evaluator=new aa,this._defaultValue=a?function(s){return s.type==="color"&&Al(s.default)?new Ui(0,0,0,0):s.type==="color"?Ui.parse(s.default)||null:s.default===void 0?null:s.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null};function Ql(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Cu}function ec(t,a){var s=new Fs(Cu,[],a?function(d){var _={color:Gr,string:$r,number:Tt,enum:$r,boolean:Fr,formatted:Wi,resolvedImage:pi};return d.type==="array"?Ci(_[d.value]||Jr,d.length):_[d.type]}(a):void 0),h=s.parse(t,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Mc(new Ic(h,a)):Mu(s.errors)}Ic.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,d,_){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=s,this._evaluator.canonical=h,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)},Ic.prototype.evaluate=function(t,a,s,h,d,_){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=_||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ma("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var Cl=function(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!Eo(a.expression)};Cl.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,d,_){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,h,d,_)},Cl.prototype.evaluate=function(t,a,s,h,d,_){return this._styleExpression.evaluate(t,a,s,h,d,_)};var sl=function(t,a,s,h){this.kind=t,this.zoomStops=s,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!Eo(a.expression),this.interpolationType=h};function Ml(t,a){if((t=ec(t,a)).result==="error")return t;var s=t.value.expression,h=oo(s);if(!h&&!ru(a))return Mu([new pr("","data expressions not supported")]);var d=ms(s,["zoom"]);if(!d&&!rf(a))return Mu([new pr("","zoom expressions not supported")]);var _=function S(M){var k=null;if(M instanceof pt)k=S(M.result);else if(M instanceof ft)for(var z=0,V=M.args;z<V.length&&!(k=S(V[z]));z+=1);else(M instanceof gs||M instanceof _e)&&M.input instanceof Xa&&M.input.name==="zoom"&&(k=M);return k instanceof pr||M.eachChild(function(H){var ee=S(H);ee instanceof pr?k=ee:!k&&ee?k=new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&ee&&k!==ee&&(k=new pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(s);return _||d?_ instanceof pr?Mu([_]):_ instanceof _e&&!Tl(a)?Mu([new pr("",'"interpolate" expressions cannot be used with this property')]):Mc(_?new sl(h?"camera":"composite",t.value,_.labels,_ instanceof _e?_.interpolation:void 0):new Cl(h?"constant":"source",t.value)):Mu([new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}sl.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,d,_){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,h,d,_)},sl.prototype.evaluate=function(t,a,s,h,d,_){return this._styleExpression.evaluate(t,a,s,h,d,_)},sl.prototype.interpolationFactor=function(t,a,s){return this.interpolationType?_e.interpolationFactor(this.interpolationType,t,a,s):0};var Zu=function(t,a){this._parameters=t,this._specification=a,hr(this,function s(h,d){var _,S,M,k=d.type==="color",z=h.stops&&typeof h.stops[0][0]=="object",V=z||!(z||h.property!==void 0),H=h.type||(Tl(d)?"exponential":"interval");if(k&&((h=hr({},h)).stops&&(h.stops=h.stops.map(function(sn){return[sn[0],Ui.parse(sn[1])]})),h.default=Ui.parse(h.default?h.default:d.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!q[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(H==="exponential")_=_h;else if(H==="interval")_=Ff;else if(H==="categorical"){_=Pc,S=Object.create(null);for(var ee=0,se=h.stops;ee<se.length;ee+=1){var Me=se[ee];S[Me[0]]=Me[1]}M=typeof h.stops[0][0]}else{if(H!=="identity")throw new Error('Unknown function type "'+H+'"');_=Nf}if(z){for(var Oe={},Ke=[],ze=0;ze<h.stops.length;ze++){var ot=h.stops[ze],xt=ot[0].zoom;Oe[xt]===void 0&&(Oe[xt]={zoom:xt,type:h.type,property:h.property,default:h.default,stops:[]},Ke.push(xt)),Oe[xt].stops.push([ot[0].value,ot[1]])}for(var Bt=[],Vt=0,or=Ke;Vt<or.length;Vt+=1){var Tr=or[Vt];Bt.push([Oe[Tr].zoom,s(Oe[Tr],d)])}var Vr={name:"linear"};return{kind:"composite",interpolationType:Vr,interpolationFactor:_e.interpolationFactor.bind(void 0,Vr),zoomStops:Bt.map(function(sn){return sn[0]}),evaluate:function(sn,Zn){var ln=sn.zoom;return _h({stops:Bt,base:h.base},d,ln).evaluate(ln,Zn)}}}if(V){var Mn=H==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:Mn,interpolationFactor:_e.interpolationFactor.bind(void 0,Mn),zoomStops:h.stops.map(function(sn){return sn[0]}),evaluate:function(sn){return _(h,d,sn.zoom,S,M)}}}return{kind:"source",evaluate:function(sn,Zn){var ln=Zn&&Zn.properties?Zn.properties[h.property]:void 0;return ln===void 0?ol(h.default,d.default):_(h,d,ln,S,M)}}}(this._parameters,this._specification))};function Xs(t){var a=t.key,s=t.value,h=t.valueSpec||{},d=t.objectElementValidators||{},_=t.style,S=t.styleSpec,M=[],k=Fi(s);if(k!=="object")return[new ke(a,s,"object expected, "+k+" found")];for(var z in s){var V=z.split(".")[0],H=h[V]||h["*"],ee=void 0;if(d[V])ee=d[V];else if(h[V])ee=Yi;else if(d["*"])ee=d["*"];else{if(!h["*"]){M.push(new ke(a,s[z],'unknown property "'+z+'"'));continue}ee=Yi}M=M.concat(ee({key:(a&&a+".")+z,value:s[z],valueSpec:H,style:_,styleSpec:S,object:s,objectKey:z},s))}for(var se in h)d[se]||h[se].required&&h[se].default===void 0&&s[se]===void 0&&M.push(new ke(a,s,'missing required property "'+se+'"'));return M}function nf(t){var a=t.value,s=t.valueSpec,h=t.style,d=t.styleSpec,_=t.key,S=t.arrayElementValidator||Yi;if(Fi(a)!=="array")return[new ke(_,a,"array expected, "+Fi(a)+" found")];if(s.length&&a.length!==s.length)return[new ke(_,a,"array length "+s.length+" expected, length "+a.length+" found")];if(s["min-length"]&&a.length<s["min-length"])return[new ke(_,a,"array length at least "+s["min-length"]+" expected, length "+a.length+" found")];var M={type:s.value,values:s.values};d.$version<7&&(M.function=s.function),Fi(s.value)==="object"&&(M=s.value);for(var k=[],z=0;z<a.length;z++)k=k.concat(S({array:a,arrayIndex:z,value:a[z],valueSpec:M,style:h,styleSpec:d,key:_+"["+z+"]"}));return k}function af(t){var a=t.key,s=t.value,h=t.valueSpec,d=Fi(s);return d==="number"&&s!=s&&(d="NaN"),d!=="number"?[new ke(a,s,"number expected, "+d+" found")]:"minimum"in h&&s<h.minimum?[new ke(a,s,s+" is less than the minimum value "+h.minimum)]:"maximum"in h&&s>h.maximum?[new ke(a,s,s+" is greater than the maximum value "+h.maximum)]:[]}function Bf(t){var a,s,h,d=t.valueSpec,_=Pt(t.value.type),S={},M=_!=="categorical"&&t.value.property===void 0,k=!M,z=Fi(t.value.stops)==="array"&&Fi(t.value.stops[0])==="array"&&Fi(t.value.stops[0][0])==="object",V=Xs({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(se){if(_==="identity")return[new ke(se.key,se.value,'identity function may not have a "stops" property')];var Me=[],Oe=se.value;return Me=Me.concat(nf({key:se.key,value:Oe,valueSpec:se.valueSpec,style:se.style,styleSpec:se.styleSpec,arrayElementValidator:H})),Fi(Oe)==="array"&&Oe.length===0&&Me.push(new ke(se.key,Oe,"array must have at least one stop")),Me},default:function(se){return Yi({key:se.key,value:se.value,valueSpec:d,style:se.style,styleSpec:se.styleSpec})}}});return _==="identity"&&M&&V.push(new ke(t.key,t.value,'missing required property "property"')),_==="identity"||t.value.stops||V.push(new ke(t.key,t.value,'missing required property "stops"')),_==="exponential"&&t.valueSpec.expression&&!Tl(t.valueSpec)&&V.push(new ke(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(k&&!ru(t.valueSpec)?V.push(new ke(t.key,t.value,"property functions not supported")):M&&!rf(t.valueSpec)&&V.push(new ke(t.key,t.value,"zoom functions not supported"))),_!=="categorical"&&!z||t.value.property!==void 0||V.push(new ke(t.key,t.value,'"property" property is required')),V;function H(se){var Me=[],Oe=se.value,Ke=se.key;if(Fi(Oe)!=="array")return[new ke(Ke,Oe,"array expected, "+Fi(Oe)+" found")];if(Oe.length!==2)return[new ke(Ke,Oe,"array length 2 expected, length "+Oe.length+" found")];if(z){if(Fi(Oe[0])!=="object")return[new ke(Ke,Oe,"object expected, "+Fi(Oe[0])+" found")];if(Oe[0].zoom===void 0)return[new ke(Ke,Oe,"object stop key must have zoom")];if(Oe[0].value===void 0)return[new ke(Ke,Oe,"object stop key must have value")];if(h&&h>Pt(Oe[0].zoom))return[new ke(Ke,Oe[0].zoom,"stop zoom values must appear in ascending order")];Pt(Oe[0].zoom)!==h&&(h=Pt(Oe[0].zoom),s=void 0,S={}),Me=Me.concat(Xs({key:Ke+"[0]",value:Oe[0],valueSpec:{zoom:{}},style:se.style,styleSpec:se.styleSpec,objectElementValidators:{zoom:af,value:ee}}))}else Me=Me.concat(ee({key:Ke+"[0]",value:Oe[0],valueSpec:{},style:se.style,styleSpec:se.styleSpec},Oe));return Ql(Dt(Oe[1]))?Me.concat([new ke(Ke+"[1]",Oe[1],"expressions are not allowed in function stops.")]):Me.concat(Yi({key:Ke+"[1]",value:Oe[1],valueSpec:d,style:se.style,styleSpec:se.styleSpec}))}function ee(se,Me){var Oe=Fi(se.value),Ke=Pt(se.value),ze=se.value!==null?se.value:Me;if(a){if(Oe!==a)return[new ke(se.key,ze,Oe+" stop domain type must match previous stop domain type "+a)]}else a=Oe;if(Oe!=="number"&&Oe!=="string"&&Oe!=="boolean")return[new ke(se.key,ze,"stop domain value must be a number, string, or boolean")];if(Oe!=="number"&&_!=="categorical"){var ot="number expected, "+Oe+" found";return ru(d)&&_===void 0&&(ot+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(se.key,ze,ot)]}return _!=="categorical"||Oe!=="number"||isFinite(Ke)&&Math.floor(Ke)===Ke?_!=="categorical"&&Oe==="number"&&s!==void 0&&Ke<s?[new ke(se.key,ze,"stop domain values must appear in ascending order")]:(s=Ke,_==="categorical"&&Ke in S?[new ke(se.key,ze,"stop domain values must be unique")]:(S[Ke]=!0,[])):[new ke(se.key,ze,"integer expected, found "+Ke)]}}function nu(t){var a=(t.expressionContext==="property"?Ml:ec)(Dt(t.value),t.valueSpec);if(a.result==="error")return a.value.map(function(h){return new ke(""+t.key+h.key,t.value,h.message)});var s=a.value.expression||a.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!s.outputDefined())return[new ke(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Eo(s))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Eo(s))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ms(s,["zoom","feature-state"]))return[new ke(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!oo(s))return[new ke(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function tc(t){var a=t.key,s=t.value,h=t.valueSpec,d=[];return Array.isArray(h.values)?h.values.indexOf(Pt(s))===-1&&d.push(new ke(a,s,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(s)+" found")):Object.keys(h.values).indexOf(Pt(s))===-1&&d.push(new ke(a,s,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(s)+" found")),d}function Oc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var a=0,s=t.slice(1);a<s.length;a+=1){var h=s[a];if(!Oc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}Zu.deserialize=function(t){return new Zu(t._parameters,t._specification)},Zu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var of={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Pl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Oc(t)||(t=sf(t));var a=ec(t,of);if(a.result==="error")throw new Error(a.value.map(function(s){return s.key+": "+s.message}).join(", "));return{filter:function(s,h,d){return a.value.evaluate(s,h,{},d)},needGeometry:function s(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var d=1;d<h.length;d++)if(s(h[d]))return!0;return!1}(t)}}function Xh(t,a){return t<a?-1:t>a?1:0}function sf(t){if(!t)return!0;var a,s=t[0];return t.length<=1?s!=="any":s==="=="?Il(t[1],t[2],"=="):s==="!="?Ol(Il(t[1],t[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Il(t[1],t[2],s):s==="any"?(a=t.slice(1),["any"].concat(a.map(sf))):s==="all"?["all"].concat(t.slice(1).map(sf)):s==="none"?["all"].concat(t.slice(1).map(sf).map(Ol)):s==="in"?uf(t[1],t.slice(2)):s==="!in"?Ol(uf(t[1],t.slice(2))):s==="has"?lf(t[1]):s==="!has"?Ol(lf(t[1])):s!=="within"||t}function Il(t,a,s){switch(t){case"$type":return["filter-type-"+s,a];case"$id":return["filter-id-"+s,a];default:return["filter-"+s,t,a]}}function uf(t,a){if(a.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(function(s){return typeof s!=typeof a[0]})?["filter-in-large",t,["literal",a.sort(Xh)]]:["filter-in-small",t,["literal",a]]}}function lf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ol(t){return["!",t]}function Rc(t){return Oc(Dt(t.value))?nu(hr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function a(s){var h=s.value,d=s.key;if(Fi(h)!=="array")return[new ke(d,h,"array expected, "+Fi(h)+" found")];var _,S=s.styleSpec,M=[];if(h.length<1)return[new ke(d,h,"filter array must have at least 1 element")];switch(M=M.concat(tc({key:d+"[0]",value:h[0],valueSpec:S.filter_operator,style:s.style,styleSpec:s.styleSpec})),Pt(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&Pt(h[1])==="$type"&&M.push(new ke(d,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&M.push(new ke(d,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(_=Fi(h[1]))!=="string"&&M.push(new ke(d+"[1]",h[1],"string expected, "+_+" found"));for(var k=2;k<h.length;k++)_=Fi(h[k]),Pt(h[1])==="$type"?M=M.concat(tc({key:d+"["+k+"]",value:h[k],valueSpec:S.geometry_type,style:s.style,styleSpec:s.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&M.push(new ke(d+"["+k+"]",h[k],"string, number, or boolean expected, "+_+" found"));break;case"any":case"all":case"none":for(var z=1;z<h.length;z++)M=M.concat(a({key:d+"["+z+"]",value:h[z],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":_=Fi(h[1]),h.length!==2?M.push(new ke(d,h,'filter array for "'+h[0]+'" operator must have 2 elements')):_!=="string"&&M.push(new ke(d+"[1]",h[1],"string expected, "+_+" found"));break;case"within":_=Fi(h[1]),h.length!==2?M.push(new ke(d,h,'filter array for "'+h[0]+'" operator must have 2 elements')):_!=="object"&&M.push(new ke(d+"[1]",h[1],"object expected, "+_+" found"))}return M}(t)}function xh(t,a){var s=t.key,h=t.style,d=t.styleSpec,_=t.value,S=t.objectKey,M=d[a+"_"+t.layerType];if(!M)return[];var k=S.match(/^(.*)-transition$/);if(a==="paint"&&k&&M[k[1]]&&M[k[1]].transition)return Yi({key:s,value:_,valueSpec:d.transition,style:h,styleSpec:d});var z,V=t.valueSpec||M[S];if(!V)return[new ke(s,_,'unknown property "'+S+'"')];if(Fi(_)==="string"&&ru(V)&&!V.tokens&&(z=/^{([^}]+)}$/.exec(_)))return[new ke(s,_,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var H=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&H.push(new ke(s,_,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Al(Dt(_))&&Pt(_.type)==="identity"&&H.push(new ke(s,_,'"text-font" does not support identity functions'))),H.concat(Yi({key:t.key,value:_,valueSpec:V,style:h,styleSpec:d,expressionContext:"property",propertyType:a,propertyKey:S}))}function bh(t){return xh(t,"paint")}function rc(t){return xh(t,"layout")}function Eh(t){var a=[],s=t.value,h=t.key,d=t.style,_=t.styleSpec;s.type||s.ref||a.push(new ke(h,s,'either "type" or "ref" is required'));var S,M=Pt(s.type),k=Pt(s.ref);if(s.id)for(var z=Pt(s.id),V=0;V<t.arrayIndex;V++){var H=d.layers[V];Pt(H.id)===z&&a.push(new ke(h,s.id,'duplicate layer id "'+s.id+'", previously used at line '+H.id.__line__))}if("ref"in s)["type","source","source-layer","filter","layout"].forEach(function(Me){Me in s&&a.push(new ke(h,s[Me],'"'+Me+'" is prohibited for ref layers'))}),d.layers.forEach(function(Me){Pt(Me.id)===k&&(S=Me)}),S?S.ref?a.push(new ke(h,s.ref,"ref cannot reference another ref layer")):M=Pt(S.type):a.push(new ke(h,s.ref,'ref layer "'+k+'" not found'));else if(M!=="background")if(s.source){var ee=d.sources&&d.sources[s.source],se=ee&&Pt(ee.type);ee?se==="vector"&&M==="raster"?a.push(new ke(h,s.source,'layer "'+s.id+'" requires a raster source')):se==="raster"&&M!=="raster"?a.push(new ke(h,s.source,'layer "'+s.id+'" requires a vector source')):se!=="vector"||s["source-layer"]?se==="raster-dem"&&M!=="hillshade"?a.push(new ke(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!s.paint||!s.paint["line-gradient"]||se==="geojson"&&ee.lineMetrics||a.push(new ke(h,s,'layer "'+s.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):a.push(new ke(h,s,'layer "'+s.id+'" must specify a "source-layer"')):a.push(new ke(h,s.source,'source "'+s.source+'" not found'))}else a.push(new ke(h,s,'missing required property "source"'));return a=a.concat(Xs({key:h,value:s,valueSpec:_.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Yi({key:h+".type",value:s.type,valueSpec:_.layer.type,style:t.style,styleSpec:t.styleSpec,object:s,objectKey:"type"})},filter:Rc,layout:function(Me){return Xs({layer:s,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Oe){return rc(hr({layerType:M},Oe))}}})},paint:function(Me){return Xs({layer:s,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Oe){return bh(hr({layerType:M},Oe))}}})}}}))}function Rl(t){var a=t.value,s=t.key,h=Fi(a);return h!=="string"?[new ke(s,a,"string expected, "+h+" found")]:[]}var $i={promoteId:function(t){var a=t.key,s=t.value;if(Fi(s)==="string")return Rl({key:a,value:s});var h=[];for(var d in s)h.push.apply(h,Rl({key:a+"."+d,value:s[d]}));return h}};function nc(t){var a=t.value,s=t.key,h=t.styleSpec,d=t.style;if(!a.type)return[new ke(s,a,'"type" is required')];var _,S=Pt(a.type);switch(S){case"vector":case"raster":case"raster-dem":return Xs({key:s,value:a,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:$i});case"geojson":if(_=Xs({key:s,value:a,valueSpec:h.source_geojson,style:d,styleSpec:h,objectElementValidators:$i}),a.cluster)for(var M in a.clusterProperties){var k=a.clusterProperties[M],z=k[0],V=typeof z=="string"?[z,["accumulated"],["get",M]]:z;_.push.apply(_,nu({key:s+"."+M+".map",value:k[1],expressionContext:"cluster-map"})),_.push.apply(_,nu({key:s+"."+M+".reduce",value:V,expressionContext:"cluster-reduce"}))}return _;case"video":return Xs({key:s,value:a,valueSpec:h.source_video,style:d,styleSpec:h});case"image":return Xs({key:s,value:a,valueSpec:h.source_image,style:d,styleSpec:h});case"canvas":return[new ke(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return tc({key:s+".type",value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:h})}}function ca(t){var a=t.value,s=t.styleSpec,h=s.light,d=t.style,_=[],S=Fi(a);if(a===void 0)return _;if(S!=="object")return _.concat([new ke("light",a,"object expected, "+S+" found")]);for(var M in a){var k=M.match(/^(.*)-transition$/);_=_.concat(k&&h[k[1]]&&h[k[1]].transition?Yi({key:M,value:a[M],valueSpec:s.transition,style:d,styleSpec:s}):h[M]?Yi({key:M,value:a[M],valueSpec:h[M],style:d,styleSpec:s}):[new ke(M,a[M],'unknown property "'+M+'"')])}return _}var Pu={"*":function(){return[]},array:nf,boolean:function(t){var a=t.value,s=t.key,h=Fi(a);return h!=="boolean"?[new ke(s,a,"boolean expected, "+h+" found")]:[]},number:af,color:function(t){var a=t.key,s=t.value,h=Fi(s);return h!=="string"?[new ke(a,s,"color expected, "+h+" found")]:Mi(s)===null?[new ke(a,s,'color expected, "'+s+'" found')]:[]},constants:vt,enum:tc,filter:Rc,function:Bf,layer:Eh,object:Xs,source:nc,light:ca,string:Rl,formatted:function(t){return Rl(t).length===0?[]:nu(t)},resolvedImage:function(t){return Rl(t).length===0?[]:nu(t)}};function Yi(t){var a=t.value,s=t.valueSpec,h=t.styleSpec;return s.expression&&Al(Pt(a))?Bf(t):s.expression&&Ql(Dt(a))?nu(t):s.type&&Pu[s.type]?Pu[s.type](t):Xs(hr({},t,{valueSpec:s.type?h[s.type]:s}))}function Pa(t){var a=t.value,s=t.key,h=Rl(t);return h.length||(a.indexOf("{fontstack}")===-1&&h.push(new ke(s,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&h.push(new ke(s,a,'"glyphs" url must include a "{range}" token'))),h}function _s(t,a){a===void 0&&(a=fe);var s=[];return s=s.concat(Yi({key:"",value:t,valueSpec:a.$root,styleSpec:a,style:t,objectElementValidators:{glyphs:Pa,"*":function(){return[]}}})),t.constants&&(s=s.concat(vt({key:"constants",value:t.constants,style:t,styleSpec:a}))),Lc(s)}function Lc(t){return[].concat(t).sort(function(a,s){return a.line-s.line})}function Vu(t){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return Lc(t.apply(this,a))}}_s.source=Vu(nc),_s.light=Vu(ca),_s.layer=Vu(Eh),_s.filter=Vu(Rc),_s.paintProperty=Vu(bh),_s.layoutProperty=Vu(rc);var Ua=_s,ic=Ua.light,Ll=Ua.paintProperty,ju=Ua.layoutProperty;function kc(t,a){var s=!1;if(a&&a.length)for(var h=0,d=a;h<d.length;h+=1)t.fire(new Ge(new Error(d[h].message))),s=!0;return s}var Iu=ho;function ho(t,a,s){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var d=new Int32Array(this.arrayBuffer);t=d[0],this.d=(a=d[1])+2*(s=d[2]);for(var _=0;_<this.d*this.d;_++){var S=d[3+_],M=d[3+_+1];h.push(S===M?null:d.subarray(S,M))}var k=d[3+h.length+1];this.keys=d.subarray(d[3+h.length],k),this.bboxes=d.subarray(k),this.insert=this._insertReadonly}else{this.d=a+2*s;for(var z=0;z<this.d*this.d;z++)h.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=s,this.scale=a/t,this.uid=0;var V=s/a*t;this.min=-V,this.max=t+V}ho.prototype.insert=function(t,a,s,h,d){this._forEachCell(a,s,h,d,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(d)},ho.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ho.prototype._insertCell=function(t,a,s,h,d,_){this.cells[d].push(_)},ho.prototype.query=function(t,a,s,h,d){var _=this.min,S=this.max;if(t<=_&&a<=_&&S<=s&&S<=h&&!d)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(t,a,s,h,this._queryCell,M,{},d),M},ho.prototype._queryCell=function(t,a,s,h,d,_,S,M){var k=this.cells[d];if(k!==null)for(var z=this.keys,V=this.bboxes,H=0;H<k.length;H++){var ee=k[H];if(S[ee]===void 0){var se=4*ee;(M?M(V[se+0],V[se+1],V[se+2],V[se+3]):t<=V[se+2]&&a<=V[se+3]&&s>=V[se+0]&&h>=V[se+1])?(S[ee]=!0,_.push(z[ee])):S[ee]=!1}}},ho.prototype._forEachCell=function(t,a,s,h,d,_,S,M){for(var k=this._convertToCellCoord(t),z=this._convertToCellCoord(a),V=this._convertToCellCoord(s),H=this._convertToCellCoord(h),ee=k;ee<=V;ee++)for(var se=z;se<=H;se++){var Me=this.d*se+ee;if((!M||M(this._convertFromCellCoord(ee),this._convertFromCellCoord(se),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(se+1)))&&d.call(this,t,a,s,h,Me,_,S,M))return}},ho.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ho.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ho.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,a=3+this.cells.length+1+1,s=0,h=0;h<this.cells.length;h++)s+=this.cells[h].length;var d=new Int32Array(a+s+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var _=a,S=0;S<t.length;S++){var M=t[S];d[3+S]=_,d.set(M,_),_+=M.length}return d[3+t.length]=_,d.set(this.keys,_),d[3+t.length+1]=_+=this.keys.length,d.set(this.bboxes,_),_+=this.bboxes.length,d.buffer};var kl=ne.ImageData,ac=ne.ImageBitmap,po={};function fn(t,a,s){s===void 0&&(s={}),Object.defineProperty(a,"_classRegistryKey",{value:t,writeable:!1}),po[t]={klass:a,omit:s.omit||[],shallow:s.shallow||[]}}for(var uo in fn("Object",Object),Iu.serialize=function(t,a){var s=t.toArrayBuffer();return a&&a.push(s),{buffer:s}},Iu.deserialize=function(t){return new Iu(t.buffer)},fn("Grid",Iu),fn("Color",Ui),fn("Error",Error),fn("ResolvedImage",na),fn("StylePropertyFunction",Zu),fn("StyleExpression",Ic,{omit:["_evaluator"]}),fn("ZoomDependentExpression",sl),fn("ZoomConstantExpression",Cl),fn("CompoundExpression",Xa,{omit:["_evaluate"]}),Cu)Cu[uo]._classRegistryKey||fn("Expression_"+uo,Cu[uo]);function Gu(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Da(t){return ac&&t instanceof ac}function Ys(t,a){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Gu(t)||Da(t))return a&&a.push(t),t;if(ArrayBuffer.isView(t)){var s=t;return a&&a.push(s.buffer),s}if(t instanceof kl)return a&&a.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],d=0,_=t;d<_.length;d+=1)h.push(Ys(_[d],a));return h}if(typeof t=="object"){var S=t.constructor,M=S._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var k=S.serialize?S.serialize(t,a):{};if(!S.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(po[M].omit.indexOf(z)>=0)){var V=t[z];k[z]=po[M].shallow.indexOf(z)>=0?V:Ys(V,a)}t instanceof Error&&(k.message=t.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(k.$name=M),k}throw new Error("can't serialize object of type "+typeof t)}function Ps(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Gu(t)||Da(t)||ArrayBuffer.isView(t)||t instanceof kl)return t;if(Array.isArray(t))return t.map(Ps);if(typeof t=="object"){var a=t.$name||"Object",s=po[a].klass;if(!s)throw new Error("can't deserialize unregistered class "+a);if(s.deserialize)return s.deserialize(t);for(var h=Object.create(s.prototype),d=0,_=Object.keys(t);d<_.length;d+=1){var S=_[d];if(S!=="$name"){var M=t[S];h[S]=po[a].shallow.indexOf(S)>=0?M:Ps(M)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var cf=function(){this.first=!0};cf.prototype.update=function(t,a){var s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))};var zr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function oc(t){for(var a=0,s=t;a<s.length;a+=1)if(ff(s[a].charCodeAt(0)))return!0;return!1}function ff(t){return!(t!==746&&t!==747&&(t<4352||!(zr["Bopomofo Extended"](t)||zr.Bopomofo(t)||zr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||zr["CJK Compatibility Ideographs"](t)||zr["CJK Compatibility"](t)||zr["CJK Radicals Supplement"](t)||zr["CJK Strokes"](t)||!(!zr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||zr["CJK Unified Ideographs Extension A"](t)||zr["CJK Unified Ideographs"](t)||zr["Enclosed CJK Letters and Months"](t)||zr["Hangul Compatibility Jamo"](t)||zr["Hangul Jamo Extended-A"](t)||zr["Hangul Jamo Extended-B"](t)||zr["Hangul Jamo"](t)||zr["Hangul Syllables"](t)||zr.Hiragana(t)||zr["Ideographic Description Characters"](t)||zr.Kanbun(t)||zr["Kangxi Radicals"](t)||zr["Katakana Phonetic Extensions"](t)||zr.Katakana(t)&&t!==12540||!(!zr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!zr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||zr["Unified Canadian Aboriginal Syllabics"](t)||zr["Unified Canadian Aboriginal Syllabics Extended"](t)||zr["Vertical Forms"](t)||zr["Yijing Hexagram Symbols"](t)||zr["Yi Syllables"](t)||zr["Yi Radicals"](t))))}function ul(t){return!(ff(t)||function(a){return!!(zr["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||zr["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||zr["Letterlike Symbols"](a)||zr["Number Forms"](a)||zr["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||zr["Control Pictures"](a)&&a!==9251||zr["Optical Character Recognition"](a)||zr["Enclosed Alphanumerics"](a)||zr["Geometric Shapes"](a)||zr["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||zr["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||zr["CJK Symbols and Punctuation"](a)||zr.Katakana(a)||zr["Private Use Area"](a)||zr["CJK Compatibility Forms"](a)||zr["Small Form Variants"](a)||zr["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(t))}function Ta(t){return t>=1424&&t<=2303||zr["Arabic Presentation Forms-A"](t)||zr["Arabic Presentation Forms-B"](t)}function xs(t,a){return!(!a&&Ta(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||zr.Khmer(t))}function hf(t){for(var a=0,s=t;a<s.length;a+=1)if(Ta(s[a].charCodeAt(0)))return!0;return!1}var Ou=null,Ns="unavailable",Ru=null,zf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Ns="error"),Ou&&Ou(t)};function ll(){Uf.fire(new Pe("pluginStateChange",{pluginStatus:Ns,pluginURL:Ru}))}var Uf=new et,pf=function(){return Ns},iu=function(){if(Ns!=="deferred"||!Ru)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ns="loading",ll(),Ru&&Na({url:Ru},function(t){t?zf(t):(Ns="loaded",ll())})},Is={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ns==="loaded"||Is.applyArabicShaping!=null},isLoading:function(){return Ns==="loading"},setState:function(t){Ns=t.pluginStatus,Ru=t.pluginURL},isParsed:function(){return Is.applyArabicShaping!=null&&Is.processBidirectionalText!=null&&Is.processStyledBidirectionalText!=null},getPluginURL:function(){return Ru}},wi=function(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new cf,this.transition={})};wi.prototype.isSupportedScript=function(t){return function(a,s){for(var h=0,d=a;h<d.length;h+=1)if(!xs(d[h].charCodeAt(0),s))return!1;return!0}(t,Is.isLoaded())},wi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},wi.prototype.getCrossfadeParameters=function(){var t=this.zoom,a=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*a}};var Lu=function(t,a){this.property=t,this.value=a,this.expression=function(s,h){if(Al(s))return new Zu(s,h);if(Ql(s)){var d=Ml(s,h);if(d.result==="error")throw new Error(d.value.map(function(S){return S.key+": "+S.message}).join(", "));return d.value}var _=s;return typeof s=="string"&&h.type==="color"&&(_=Ui.parse(s)),{kind:"constant",evaluate:function(){return _}}}(a===void 0?t.specification.default:a,t.specification)};Lu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Lu.prototype.possiblyEvaluate=function(t,a,s){return this.property.possiblyEvaluate(this,t,a,s)};var au=function(t){this.property=t,this.value=new Lu(t,void 0)};au.prototype.transitioned=function(t,a){return new cl(this.property,this.value,a,ht({},t.transition,this.transition),t.now)},au.prototype.untransitioned=function(){return new cl(this.property,this.value,null,{},0)};var Go=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Go.prototype.getValue=function(t){return Ye(this._values[t].value.value)},Go.prototype.setValue=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new au(this._values[t].property)),this._values[t].value=new Lu(this._values[t].property,a===null?void 0:Ye(a))},Go.prototype.getTransition=function(t){return Ye(this._values[t].transition)},Go.prototype.setTransition=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new au(this._values[t].property)),this._values[t].transition=Ye(a)||void 0},Go.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a],d=this.getValue(h);d!==void 0&&(t[h]=d);var _=this.getTransition(h);_!==void 0&&(t[h+"-transition"]=_)}return t},Go.prototype.transitioned=function(t,a){for(var s=new Bs(this._properties),h=0,d=Object.keys(this._values);h<d.length;h+=1){var _=d[h];s._values[_]=this._values[_].transitioned(t,a._values[_])}return s},Go.prototype.untransitioned=function(){for(var t=new Bs(this._properties),a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a];t._values[h]=this._values[h].untransitioned()}return t};var cl=function(t,a,s,h,d){this.property=t,this.value=a,this.begin=d+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=s)};cl.prototype.possiblyEvaluate=function(t,a,s){var h=t.now||0,d=this.value.possiblyEvaluate(t,a,s),_=this.prior;if(_){if(h>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(h<this.begin)return _.possiblyEvaluate(t,a,s);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,a,s),d,function(M){if(M<=0)return 0;if(M>=1)return 1;var k=M*M,z=k*M;return 4*(M<.5?z:3*(M-k)+z-.75)}(S))}return d};var Bs=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Bs.prototype.possiblyEvaluate=function(t,a,s){for(var h=new hu(this._properties),d=0,_=Object.keys(this._values);d<_.length;d+=1){var S=_[d];h._values[S]=this._values[S].possiblyEvaluate(t,a,s)}return h},Bs.prototype.hasTransition=function(){for(var t=0,a=Object.keys(this._values);t<a.length;t+=1)if(this._values[a[t]].prior)return!0;return!1};var Ks=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Ks.prototype.getValue=function(t){return Ye(this._values[t].value)},Ks.prototype.setValue=function(t,a){this._values[t]=new Lu(this._values[t].property,a===null?void 0:Ye(a))},Ks.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a],d=this.getValue(h);d!==void 0&&(t[h]=d)}return t},Ks.prototype.possiblyEvaluate=function(t,a,s){for(var h=new hu(this._properties),d=0,_=Object.keys(this._values);d<_.length;d+=1){var S=_[d];h._values[S]=this._values[S].possiblyEvaluate(t,a,s)}return h};var bs=function(t,a,s){this.property=t,this.value=a,this.parameters=s};bs.prototype.isConstant=function(){return this.value.kind==="constant"},bs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},bs.prototype.evaluate=function(t,a,s,h){return this.property.evaluate(this.value,this.parameters,t,a,s,h)};var hu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};hu.prototype.get=function(t){return this._values[t]};var Cn=function(t){this.specification=t};Cn.prototype.possiblyEvaluate=function(t,a){return t.expression.evaluate(a)},Cn.prototype.interpolate=function(t,a,s){var h=_a[this.specification.type];return h?h(t,a,s):t};var bn=function(t,a){this.specification=t,this.overrides=a};bn.prototype.possiblyEvaluate=function(t,a,s,h){return new bs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},s,h)}:t.expression,a)},bn.prototype.interpolate=function(t,a,s){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new bs(this,{kind:"constant",value:void 0},t.parameters);var h=_a[this.specification.type];return h?new bs(this,{kind:"constant",value:h(t.value.value,a.value.value,s)},t.parameters):t},bn.prototype.evaluate=function(t,a,s,h,d,_){return t.kind==="constant"?t.value:t.evaluate(a,s,h,d,_)};var Dc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,h,d,_){if(s.value===void 0)return new bs(this,{kind:"constant",value:void 0},h);if(s.expression.kind==="constant"){var S=s.expression.evaluate(h,null,{},d,_),M=s.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,k=this._calculate(M,M,M,h);return new bs(this,{kind:"constant",value:k},h)}if(s.expression.kind==="camera"){var z=this._calculate(s.expression.evaluate({zoom:h.zoom-1}),s.expression.evaluate({zoom:h.zoom}),s.expression.evaluate({zoom:h.zoom+1}),h);return new bs(this,{kind:"constant",value:z},h)}return new bs(this,s.expression,h)},a.prototype.evaluate=function(s,h,d,_,S,M){if(s.kind==="source"){var k=s.evaluate(h,d,_,S,M);return this._calculate(k,k,k,h)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(h.zoom)-1},d,_),s.evaluate({zoom:Math.floor(h.zoom)},d,_),s.evaluate({zoom:Math.floor(h.zoom)+1},d,_),h):s.value},a.prototype._calculate=function(s,h,d,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:d,to:h}},a.prototype.interpolate=function(s){return s},a}(bn),is=function(t){this.specification=t};is.prototype.possiblyEvaluate=function(t,a,s,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var d=t.expression.evaluate(a,null,{},s,h);return this._calculate(d,d,d,a)}return this._calculate(t.expression.evaluate(new wi(Math.floor(a.zoom-1),a)),t.expression.evaluate(new wi(Math.floor(a.zoom),a)),t.expression.evaluate(new wi(Math.floor(a.zoom+1),a)),a)}},is.prototype._calculate=function(t,a,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:s,to:a}},is.prototype.interpolate=function(t){return t};var as=function(t){this.specification=t};as.prototype.possiblyEvaluate=function(t,a,s,h){return!!t.expression.evaluate(a,null,{},s,h)},as.prototype.interpolate=function(){return!1};var No=function(t){for(var a in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var s=t[a];s.specification.overridable&&this.overridableProperties.push(a);var h=this.defaultPropertyValues[a]=new Lu(s,void 0),d=this.defaultTransitionablePropertyValues[a]=new au(s);this.defaultTransitioningPropertyValues[a]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate({})}};fn("DataDrivenProperty",bn),fn("DataConstantProperty",Cn),fn("CrossFadedDataDrivenProperty",Dc),fn("CrossFadedProperty",is),fn("ColorRampProperty",as);var Fa=function(t){function a(s,h){if(t.call(this),this.id=s.id,this.type=s.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},s.type!=="custom"&&(this.metadata=(s=s).metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),h.layout&&(this._unevaluatedLayout=new Ks(h.layout)),h.paint)){for(var d in this._transitionablePaint=new Go(h.paint),s.paint)this.setPaintProperty(d,s.paint[d],{validate:!1});for(var _ in s.layout)this.setLayoutProperty(_,s.layout[_],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hu(h.paint)}}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},a.prototype.getLayoutProperty=function(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)},a.prototype.setLayoutProperty=function(s,h,d){d===void 0&&(d={}),h!=null&&this._validate(ju,"layers."+this.id+".layout."+s,s,h,d)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,h):this.visibility=h)},a.prototype.getPaintProperty=function(s){return K(s,"-transition")?this._transitionablePaint.getTransition(s.slice(0,-"-transition".length)):this._transitionablePaint.getValue(s)},a.prototype.setPaintProperty=function(s,h,d){if(d===void 0&&(d={}),h!=null&&this._validate(Ll,"layers."+this.id+".paint."+s,s,h,d))return!1;if(K(s,"-transition"))return this._transitionablePaint.setTransition(s.slice(0,-"-transition".length),h||void 0),!1;var _=this._transitionablePaint._values[s],S=_.property.specification["property-type"]==="cross-faded-data-driven",M=_.value.isDataDriven(),k=_.value;this._transitionablePaint.setValue(s,h),this._handleSpecialPaintPropertyUpdate(s);var z=this._transitionablePaint._values[s].value;return z.isDataDriven()||M||S||this._handleOverridablePaintPropertyUpdate(s,k,z)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){},a.prototype._handleOverridablePaintPropertyUpdate=function(s,h,d){return!1},a.prototype.isHidden=function(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"},a.prototype.updateTransitions=function(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)},a.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},a.prototype.recalculate=function(s,h){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,h)},a.prototype.serialize=function(){var s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),at(s,function(h,d){return!(h===void 0||d==="layout"&&!Object.keys(h).length||d==="paint"&&!Object.keys(h).length)})},a.prototype._validate=function(s,h,d,_,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&kc(this,s.call(Ua,{key:h,layerType:this.type,objectKey:d,value:_,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))},a.prototype.is3D=function(){return!1},a.prototype.isTileClipped=function(){return!1},a.prototype.hasOffscreenPass=function(){return!1},a.prototype.resize=function(){},a.prototype.isStateDependent=function(){for(var s in this.paint._values){var h=this.paint.get(s);if(h instanceof bs&&ru(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},a}(et),Hu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Wu=function(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},oa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function ba(t,a){a===void 0&&(a=1);var s=0,h=0;return{members:t.map(function(d){var _=Hu[d.type].BYTES_PER_ELEMENT,S=s=sc(s,Math.max(a,_)),M=d.components||1;return h=Math.max(h,_),s+=_*M,{name:d.name,type:d.type,components:M,offset:S}}),size:sc(s,Math.max(h,a)),alignment:a}}function sc(t,a){return Math.ceil(t/a)*a}oa.serialize=function(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},oa.deserialize=function(t){var a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a},oa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},oa.prototype.clear=function(){this.length=0},oa.prototype.resize=function(t){this.reserve(t),this.length=t},oa.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}},oa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var fl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var d=this.length;return this.resize(d+1),this.emplace(d,s,h)},a.prototype.emplace=function(s,h,d){var _=2*s;return this.int16[_+0]=h,this.int16[_+1]=d,s},a}(oa);fl.prototype.bytesPerElement=4,fn("StructArrayLayout2i4",fl);var pu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d,_){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,d,_)},a.prototype.emplace=function(s,h,d,_,S){var M=4*s;return this.int16[M+0]=h,this.int16[M+1]=d,this.int16[M+2]=_,this.int16[M+3]=S,s},a}(oa);pu.prototype.bytesPerElement=8,fn("StructArrayLayout4i8",pu);var du=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d,_,S,M){var k=this.length;return this.resize(k+1),this.emplace(k,s,h,d,_,S,M)},a.prototype.emplace=function(s,h,d,_,S,M,k){var z=6*s;return this.int16[z+0]=h,this.int16[z+1]=d,this.int16[z+2]=_,this.int16[z+3]=S,this.int16[z+4]=M,this.int16[z+5]=k,s},a}(oa);du.prototype.bytesPerElement=12,fn("StructArrayLayout2i4i12",du);var So=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d,_,S,M){var k=this.length;return this.resize(k+1),this.emplace(k,s,h,d,_,S,M)},a.prototype.emplace=function(s,h,d,_,S,M,k){var z=4*s,V=8*s;return this.int16[z+0]=h,this.int16[z+1]=d,this.uint8[V+4]=_,this.uint8[V+5]=S,this.uint8[V+6]=M,this.uint8[V+7]=k,s},a}(oa);So.prototype.bytesPerElement=8,fn("StructArrayLayout2i4ub8",So);var Xu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var d=this.length;return this.resize(d+1),this.emplace(d,s,h)},a.prototype.emplace=function(s,h,d){var _=2*s;return this.float32[_+0]=h,this.float32[_+1]=d,s},a}(oa);Xu.prototype.bytesPerElement=8,fn("StructArrayLayout2f8",Xu);var vu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d,_,S,M,k,z,V,H){var ee=this.length;return this.resize(ee+1),this.emplace(ee,s,h,d,_,S,M,k,z,V,H)},a.prototype.emplace=function(s,h,d,_,S,M,k,z,V,H,ee){var se=10*s;return this.uint16[se+0]=h,this.uint16[se+1]=d,this.uint16[se+2]=_,this.uint16[se+3]=S,this.uint16[se+4]=M,this.uint16[se+5]=k,this.uint16[se+6]=z,this.uint16[se+7]=V,this.uint16[se+8]=H,this.uint16[se+9]=ee,s},a}(oa);vu.prototype.bytesPerElement=20,fn("StructArrayLayout10ui20",vu);var Dl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d,_,S,M,k,z,V,H,ee,se){var Me=this.length;return this.resize(Me+1),this.emplace(Me,s,h,d,_,S,M,k,z,V,H,ee,se)},a.prototype.emplace=function(s,h,d,_,S,M,k,z,V,H,ee,se,Me){var Oe=12*s;return this.int16[Oe+0]=h,this.int16[Oe+1]=d,this.int16[Oe+2]=_,this.int16[Oe+3]=S,this.uint16[Oe+4]=M,this.uint16[Oe+5]=k,this.uint16[Oe+6]=z,this.uint16[Oe+7]=V,this.int16[Oe+8]=H,this.int16[Oe+9]=ee,this.int16[Oe+10]=se,this.int16[Oe+11]=Me,s},a}(oa);Dl.prototype.bytesPerElement=24,fn("StructArrayLayout4i4ui4i24",Dl);var Yu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d){var _=this.length;return this.resize(_+1),this.emplace(_,s,h,d)},a.prototype.emplace=function(s,h,d,_){var S=3*s;return this.float32[S+0]=h,this.float32[S+1]=d,this.float32[S+2]=_,s},a}(oa);Yu.prototype.bytesPerElement=12,fn("StructArrayLayout3f12",Yu);var uc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.uint32[1*s+0]=h,s},a}(oa);uc.prototype.bytesPerElement=4,fn("StructArrayLayout1ul4",uc);var Fc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d,_,S,M,k,z,V){var H=this.length;return this.resize(H+1),this.emplace(H,s,h,d,_,S,M,k,z,V)},a.prototype.emplace=function(s,h,d,_,S,M,k,z,V,H){var ee=10*s,se=5*s;return this.int16[ee+0]=h,this.int16[ee+1]=d,this.int16[ee+2]=_,this.int16[ee+3]=S,this.int16[ee+4]=M,this.int16[ee+5]=k,this.uint32[se+3]=z,this.uint16[ee+8]=V,this.uint16[ee+9]=H,s},a}(oa);Fc.prototype.bytesPerElement=20,fn("StructArrayLayout6i1ul2ui20",Fc);var lc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d,_,S,M){var k=this.length;return this.resize(k+1),this.emplace(k,s,h,d,_,S,M)},a.prototype.emplace=function(s,h,d,_,S,M,k){var z=6*s;return this.int16[z+0]=h,this.int16[z+1]=d,this.int16[z+2]=_,this.int16[z+3]=S,this.int16[z+4]=M,this.int16[z+5]=k,s},a}(oa);lc.prototype.bytesPerElement=12,fn("StructArrayLayout2i2i2i12",lc);var Fl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d,_,S){var M=this.length;return this.resize(M+1),this.emplace(M,s,h,d,_,S)},a.prototype.emplace=function(s,h,d,_,S,M){var k=4*s,z=8*s;return this.float32[k+0]=h,this.float32[k+1]=d,this.float32[k+2]=_,this.int16[z+6]=S,this.int16[z+7]=M,s},a}(oa);Fl.prototype.bytesPerElement=16,fn("StructArrayLayout2f1f2i16",Fl);var Zf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d,_){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,d,_)},a.prototype.emplace=function(s,h,d,_,S){var M=12*s,k=3*s;return this.uint8[M+0]=h,this.uint8[M+1]=d,this.float32[k+1]=_,this.float32[k+2]=S,s},a}(oa);Zf.prototype.bytesPerElement=12,fn("StructArrayLayout2ub2f12",Zf);var hl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d){var _=this.length;return this.resize(_+1),this.emplace(_,s,h,d)},a.prototype.emplace=function(s,h,d,_){var S=3*s;return this.uint16[S+0]=h,this.uint16[S+1]=d,this.uint16[S+2]=_,s},a}(oa);hl.prototype.bytesPerElement=6,fn("StructArrayLayout3ui6",hl);var pl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d,_,S,M,k,z,V,H,ee,se,Me,Oe,Ke,ze,ot){var xt=this.length;return this.resize(xt+1),this.emplace(xt,s,h,d,_,S,M,k,z,V,H,ee,se,Me,Oe,Ke,ze,ot)},a.prototype.emplace=function(s,h,d,_,S,M,k,z,V,H,ee,se,Me,Oe,Ke,ze,ot,xt){var Bt=24*s,Vt=12*s,or=48*s;return this.int16[Bt+0]=h,this.int16[Bt+1]=d,this.uint16[Bt+2]=_,this.uint16[Bt+3]=S,this.uint32[Vt+2]=M,this.uint32[Vt+3]=k,this.uint32[Vt+4]=z,this.uint16[Bt+10]=V,this.uint16[Bt+11]=H,this.uint16[Bt+12]=ee,this.float32[Vt+7]=se,this.float32[Vt+8]=Me,this.uint8[or+36]=Oe,this.uint8[or+37]=Ke,this.uint8[or+38]=ze,this.uint32[Vt+10]=ot,this.int16[Bt+22]=xt,s},a}(oa);pl.prototype.bytesPerElement=48,fn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",pl);var zs=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d,_,S,M,k,z,V,H,ee,se,Me,Oe,Ke,ze,ot,xt,Bt,Vt,or,Tr,Vr,Mn,sn,Zn,ln,Li){var Yn=this.length;return this.resize(Yn+1),this.emplace(Yn,s,h,d,_,S,M,k,z,V,H,ee,se,Me,Oe,Ke,ze,ot,xt,Bt,Vt,or,Tr,Vr,Mn,sn,Zn,ln,Li)},a.prototype.emplace=function(s,h,d,_,S,M,k,z,V,H,ee,se,Me,Oe,Ke,ze,ot,xt,Bt,Vt,or,Tr,Vr,Mn,sn,Zn,ln,Li,Yn){var An=34*s,Ti=17*s;return this.int16[An+0]=h,this.int16[An+1]=d,this.int16[An+2]=_,this.int16[An+3]=S,this.int16[An+4]=M,this.int16[An+5]=k,this.int16[An+6]=z,this.int16[An+7]=V,this.uint16[An+8]=H,this.uint16[An+9]=ee,this.uint16[An+10]=se,this.uint16[An+11]=Me,this.uint16[An+12]=Oe,this.uint16[An+13]=Ke,this.uint16[An+14]=ze,this.uint16[An+15]=ot,this.uint16[An+16]=xt,this.uint16[An+17]=Bt,this.uint16[An+18]=Vt,this.uint16[An+19]=or,this.uint16[An+20]=Tr,this.uint16[An+21]=Vr,this.uint16[An+22]=Mn,this.uint32[Ti+12]=sn,this.float32[Ti+13]=Zn,this.float32[Ti+14]=ln,this.float32[Ti+15]=Li,this.float32[Ti+16]=Yn,s},a}(oa);zs.prototype.bytesPerElement=68,fn("StructArrayLayout8i15ui1ul4f68",zs);var dl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.float32[1*s+0]=h,s},a}(oa);dl.prototype.bytesPerElement=4,fn("StructArrayLayout1f4",dl);var Ho=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d){var _=this.length;return this.resize(_+1),this.emplace(_,s,h,d)},a.prototype.emplace=function(s,h,d,_){var S=3*s;return this.int16[S+0]=h,this.int16[S+1]=d,this.int16[S+2]=_,s},a}(oa);Ho.prototype.bytesPerElement=6,fn("StructArrayLayout3i6",Ho);var df=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d){var _=this.length;return this.resize(_+1),this.emplace(_,s,h,d)},a.prototype.emplace=function(s,h,d,_){var S=4*s;return this.uint32[2*s+0]=h,this.uint16[S+2]=d,this.uint16[S+3]=_,s},a}(oa);df.prototype.bytesPerElement=8,fn("StructArrayLayout1ul2ui8",df);var Nl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var d=this.length;return this.resize(d+1),this.emplace(d,s,h)},a.prototype.emplace=function(s,h,d){var _=2*s;return this.uint16[_+0]=h,this.uint16[_+1]=d,s},a}(oa);Nl.prototype.bytesPerElement=4,fn("StructArrayLayout2ui4",Nl);var Nc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.uint16[1*s+0]=h,s},a}(oa);Nc.prototype.bytesPerElement=2,fn("StructArrayLayout1ui2",Nc);var cc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,d,_){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,d,_)},a.prototype.emplace=function(s,h,d,_,S){var M=4*s;return this.float32[M+0]=h,this.float32[M+1]=d,this.float32[M+2]=_,this.float32[M+3]=S,s},a}(oa);cc.prototype.bytesPerElement=16,fn("StructArrayLayout4f16",cc);var l=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return s.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},s.x1.get=function(){return this._structArray.int16[this._pos2+2]},s.y1.get=function(){return this._structArray.int16[this._pos2+3]},s.x2.get=function(){return this._structArray.int16[this._pos2+4]},s.y2.get=function(){return this._structArray.int16[this._pos2+5]},s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.anchorPoint.get=function(){return new re(this.anchorPointX,this.anchorPointY)},Object.defineProperties(a.prototype,s),a}(Wu);l.prototype.size=20;var f=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new l(this,s)},a}(Fc);fn("CollisionBoxArray",f);var c=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},s.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},s.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},s.segment.get=function(){return this._structArray.uint16[this._pos2+10]},s.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},s.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},s.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},s.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},s.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},s.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},s.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},s.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},s.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},s.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},s.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(a.prototype,s),a}(Wu);c.prototype.size=48;var p=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new c(this,s)},a}(pl);fn("PlacedSymbolArray",p);var b=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},s.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},s.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},s.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},s.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},s.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},s.key.get=function(){return this._structArray.uint16[this._pos2+8]},s.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},s.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},s.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},s.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},s.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},s.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},s.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},s.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},s.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},s.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},s.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},s.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},s.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},s.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},s.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},s.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},s.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},s.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(a.prototype,s),a}(Wu);b.prototype.size=68;var w=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new b(this,s)},a}(zs);fn("SymbolInstanceArray",w);var C=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getoffsetX=function(s){return this.float32[1*s+0]},a}(dl);fn("GlyphOffsetArray",C);var R=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getx=function(s){return this.int16[3*s+0]},a.prototype.gety=function(s){return this.int16[3*s+1]},a.prototype.gettileUnitDistanceFromAnchor=function(s){return this.int16[3*s+2]},a}(Ho);fn("SymbolLineVertexArray",R);var U=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(a.prototype,s),a}(Wu);U.prototype.size=8;var Y=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new U(this,s)},a}(df);fn("FeatureIndexArray",Y);var ce=ba([{name:"a_pos",components:2,type:"Int16"}],4).members,he=function(t){t===void 0&&(t=[]),this.segments=t};function pe(t,a){return 256*(t=Rt(Math.floor(t),0,255))+Rt(Math.floor(a),0,255)}he.prototype.prepareSegment=function(t,a,s,h){var d=this.segments[this.segments.length-1];return t>he.MAX_VERTEX_ARRAY_LENGTH&&Je("Max vertices per segment is "+he.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!d||d.vertexLength+t>he.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==h)&&(d={vertexOffset:a.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},h!==void 0&&(d.sortKey=h),this.segments.push(d)),d},he.prototype.get=function(){return this.segments},he.prototype.destroy=function(){for(var t=0,a=this.segments;t<a.length;t+=1){var s=a[t];for(var h in s.vaos)s.vaos[h].destroy()}},he.simpleSegment=function(t,a,s,h){return new he([{vertexOffset:t,primitiveOffset:a,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])},he.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,fn("SegmentVector",he);var Ae=ba([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Re=J(function(t){t.exports=function(a,s){var h,d,_,S,M,k,z,V;for(d=a.length-(h=3&a.length),_=s,M=3432918353,k=461845907,V=0;V<d;)z=255&a.charCodeAt(V)|(255&a.charCodeAt(++V))<<8|(255&a.charCodeAt(++V))<<16|(255&a.charCodeAt(++V))<<24,++V,_=27492+(65535&(S=5*(65535&(_=(_^=z=(65535&(z=(z=(65535&z)*M+(((z>>>16)*M&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,h){case 3:z^=(255&a.charCodeAt(V+2))<<16;case 2:z^=(255&a.charCodeAt(V+1))<<8;case 1:_^=z=(65535&(z=(z=(65535&(z^=255&a.charCodeAt(V)))*M+(((z>>>16)*M&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295}return _^=a.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}}),We=J(function(t){t.exports=function(a,s){for(var h,d=a.length,_=s^d,S=0;d>=4;)h=1540483477*(65535&(h=255&a.charCodeAt(S)|(255&a.charCodeAt(++S))<<8|(255&a.charCodeAt(++S))<<16|(255&a.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),d-=4,++S;switch(d){case 3:_^=(255&a.charCodeAt(S+2))<<16;case 2:_^=(255&a.charCodeAt(S+1))<<8;case 1:_=1540483477*(65535&(_^=255&a.charCodeAt(S)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}}),Te=Re,Ve=We;Te.murmur3=Re,Te.murmur2=Ve;var Qe=function(){this.ids=[],this.positions=[],this.indexed=!1};Qe.prototype.add=function(t,a,s,h){this.ids.push(Gt(t)),this.positions.push(a,s,h)},Qe.prototype.getPositions=function(t){for(var a=Gt(t),s=0,h=this.ids.length-1;s<h;){var d=s+h>>1;this.ids[d]>=a?h=d:s=d+1}for(var _=[];this.ids[s]===a;)_.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return _},Qe.serialize=function(t,a){var s=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function d(_,S,M,k){for(;M<k;){for(var z=_[M+k>>1],V=M-1,H=k+1;;){do V++;while(_[V]<z);do H--;while(_[H]>z);if(V>=H)break;Ft(_,V,H),Ft(S,3*V,3*H),Ft(S,3*V+1,3*H+1),Ft(S,3*V+2,3*H+2)}H-M<k-H?(d(_,S,M,H),M=H+1):(d(_,S,H+1,k),k=H)}}(s,h,0,s.length-1),a&&a.push(s.buffer,h.buffer),{ids:s,positions:h}},Qe.deserialize=function(t){var a=new Qe;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a};var gt=Math.pow(2,53)-1;function Gt(t){var a=+t;return!isNaN(a)&&a<=gt?a:Te(String(t))}function Ft(t,a,s){var h=t[a];t[a]=t[s],t[s]=h}fn("FeaturePositionMap",Qe);var Xt=function(t,a){this.gl=t.gl,this.location=a},cr=function(t){function a(s,h){t.call(this,s,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))},a}(Xt),Rr=function(t){function a(s,h){t.call(this,s,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))},a}(Xt),Or=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))},a}(Xt),Qr=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))},a}(Xt),Dn=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))},a}(Xt),Bn=function(t){function a(s,h){t.call(this,s,h),this.current=Ui.transparent}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))},a}(Xt),Un=new Float32Array(16),di=function(t){function a(s,h){t.call(this,s,h),this.current=Un}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(var h=1;h<16;h++)if(s[h]!==this.current[h]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}},a}(Xt);function nn(t){return[pe(255*t.r,255*t.g),pe(255*t.b,255*t.a)]}var ai=function(t,a,s){this.value=t,this.uniformNames=a.map(function(h){return"u_"+h}),this.type=s};ai.prototype.setUniform=function(t,a,s){t.set(s.constantOr(this.value))},ai.prototype.getBinding=function(t,a,s){return this.type==="color"?new Bn(t,a):new Rr(t,a)};var si=function(t,a){this.uniformNames=a.map(function(s){return"u_"+s}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};si.prototype.setConstantPatternPositions=function(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr},si.prototype.setUniform=function(t,a,s,h){var d=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&t.set(d)},si.prototype.getBinding=function(t,a,s){return s.substr(0,9)==="u_pattern"?new Dn(t,a):new Rr(t,a)};var ei=function(t,a,s,h){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=a.map(function(d){return{name:"a_"+d,type:"Float32",components:s==="color"?2:1,offset:0}}),this.paintVertexArray=new h};ei.prototype.populatePaintArray=function(t,a,s,h,d){var _=this.paintVertexArray.length,S=this.expression.evaluate(new wi(0),a,{},h,[],d);this.paintVertexArray.resize(t),this._setPaintValue(_,t,S)},ei.prototype.updatePaintArray=function(t,a,s,h){var d=this.expression.evaluate({zoom:0},s,h);this._setPaintValue(t,a,d)},ei.prototype._setPaintValue=function(t,a,s){if(this.type==="color")for(var h=nn(s),d=t;d<a;d++)this.paintVertexArray.emplace(d,h[0],h[1]);else{for(var _=t;_<a;_++)this.paintVertexArray.emplace(_,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}},ei.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ei.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Wn=function(t,a,s,h,d,_){this.expression=t,this.uniformNames=a.map(function(S){return"u_"+S+"_t"}),this.type=s,this.useIntegerZoom=h,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=a.map(function(S){return{name:"a_"+S,type:"Float32",components:s==="color"?4:2,offset:0}}),this.paintVertexArray=new _};Wn.prototype.populatePaintArray=function(t,a,s,h,d){var _=this.expression.evaluate(new wi(this.zoom),a,{},h,[],d),S=this.expression.evaluate(new wi(this.zoom+1),a,{},h,[],d),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,_,S)},Wn.prototype.updatePaintArray=function(t,a,s,h){var d=this.expression.evaluate({zoom:this.zoom},s,h),_=this.expression.evaluate({zoom:this.zoom+1},s,h);this._setPaintValue(t,a,d,_)},Wn.prototype._setPaintValue=function(t,a,s,h){if(this.type==="color")for(var d=nn(s),_=nn(h),S=t;S<a;S++)this.paintVertexArray.emplace(S,d[0],d[1],_[0],_[1]);else{for(var M=t;M<a;M++)this.paintVertexArray.emplace(M,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}},Wn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Wn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Wn.prototype.setUniform=function(t,a){var s=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=Rt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(h)},Wn.prototype.getBinding=function(t,a,s){return new Rr(t,a)};var mi=function(t,a,s,h,d,_){this.expression=t,this.type=a,this.useIntegerZoom=s,this.zoom=h,this.layerId=_,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d};mi.prototype.populatePaintArray=function(t,a,s){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,a.patterns&&a.patterns[this.layerId],s)},mi.prototype.updatePaintArray=function(t,a,s,h,d){this._setPaintValues(t,a,s.patterns&&s.patterns[this.layerId],d)},mi.prototype._setPaintValues=function(t,a,s,h){if(h&&s){var d=h[s.min],_=h[s.mid],S=h[s.max];if(d&&_&&S)for(var M=t;M<a;M++)this.zoomInPaintVertexArray.emplace(M,_.tl[0],_.tl[1],_.br[0],_.br[1],d.tl[0],d.tl[1],d.br[0],d.br[1],_.pixelRatio,d.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,_.tl[0],_.tl[1],_.br[0],_.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],_.pixelRatio,S.pixelRatio)}},mi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ae.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ae.members,this.expression.isStateDependent))},mi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var $n=function(t,a,s){this.binders={},this._buffers=[];var h=[];for(var d in t.paint._values)if(s(d)){var _=t.paint.get(d);if(_ instanceof bs&&ru(_.property.specification)){var S=Ea(d,t.type),M=_.value,k=_.property.specification.type,z=_.property.useIntegerZoom,V=_.property.specification["property-type"],H=V==="cross-faded"||V==="cross-faded-data-driven";if(M.kind==="constant")this.binders[d]=H?new si(M.value,S):new ai(M.value,S,k),h.push("/u_"+d);else if(M.kind==="source"||H){var ee=Ka(d,k,"source");this.binders[d]=H?new mi(M,k,z,a,ee,t.id):new ei(M,S,k,ee),h.push("/a_"+d)}else{var se=Ka(d,k,"composite");this.binders[d]=new Wn(M,S,k,z,a,se),h.push("/z_"+d)}}}this.cacheKey=h.sort().join("")};$n.prototype.getMaxValue=function(t){var a=this.binders[t];return a instanceof ei||a instanceof Wn?a.maxValue:0},$n.prototype.populatePaintArrays=function(t,a,s,h,d){for(var _ in this.binders){var S=this.binders[_];(S instanceof ei||S instanceof Wn||S instanceof mi)&&S.populatePaintArray(t,a,s,h,d)}},$n.prototype.setConstantPatternPositions=function(t,a){for(var s in this.binders){var h=this.binders[s];h instanceof si&&h.setConstantPatternPositions(t,a)}},$n.prototype.updatePaintArrays=function(t,a,s,h,d){var _=!1;for(var S in t)for(var M=0,k=a.getPositions(S);M<k.length;M+=1){var z=k[M],V=s.feature(z.index);for(var H in this.binders){var ee=this.binders[H];if((ee instanceof ei||ee instanceof Wn||ee instanceof mi)&&ee.expression.isStateDependent===!0){var se=h.paint.get(H);ee.expression=se.value,ee.updatePaintArray(z.start,z.end,V,t[S],d),_=!0}}}return _},$n.prototype.defines=function(){var t=[];for(var a in this.binders){var s=this.binders[a];(s instanceof ai||s instanceof si)&&t.push.apply(t,s.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},$n.prototype.getBinderAttributes=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof ei||s instanceof Wn)for(var h=0;h<s.paintVertexAttributes.length;h++)t.push(s.paintVertexAttributes[h].name);else if(s instanceof mi)for(var d=0;d<Ae.members.length;d++)t.push(Ae.members[d].name)}return t},$n.prototype.getBinderUniforms=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof ai||s instanceof si||s instanceof Wn)for(var h=0,d=s.uniformNames;h<d.length;h+=1)t.push(d[h])}return t},$n.prototype.getPaintVertexBuffers=function(){return this._buffers},$n.prototype.getUniforms=function(t,a){var s=[];for(var h in this.binders){var d=this.binders[h];if(d instanceof ai||d instanceof si||d instanceof Wn)for(var _=0,S=d.uniformNames;_<S.length;_+=1){var M=S[_];if(a[M]){var k=d.getBinding(t,a[M],M);s.push({name:M,property:h,binding:k})}}}return s},$n.prototype.setUniforms=function(t,a,s,h){for(var d=0,_=a;d<_.length;d+=1){var S=_[d],M=S.name,k=S.property;this.binders[k].setUniform(S.binding,h,s.get(k),M)}},$n.prototype.updatePaintBuffers=function(t){for(var a in this._buffers=[],this.binders){var s=this.binders[a];if(t&&s instanceof mi){var h=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(s instanceof ei||s instanceof Wn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}},$n.prototype.upload=function(t){for(var a in this.binders){var s=this.binders[a];(s instanceof ei||s instanceof Wn||s instanceof mi)&&s.upload(t)}this.updatePaintBuffers()},$n.prototype.destroy=function(){for(var t in this.binders){var a=this.binders[t];(a instanceof ei||a instanceof Wn||a instanceof mi)&&a.destroy()}};var jn=function(t,a,s){s===void 0&&(s=function(){return!0}),this.programConfigurations={};for(var h=0,d=t;h<d.length;h+=1){var _=d[h];this.programConfigurations[_.id]=new $n(_,a,s)}this.needsUpload=!1,this._featureMap=new Qe,this._bufferOffset=0};function Ea(t,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(a+"-","").replace(/-/g,"_")]}function Ka(t,a,s){var h={color:{source:Xu,composite:cc},number:{source:dl,composite:Xu}},d=function(_){return{"line-pattern":{source:vu,composite:vu},"fill-pattern":{source:vu,composite:vu},"fill-extrusion-pattern":{source:vu,composite:vu}}[_]}(t);return d&&d[s]||h[a][s]}jn.prototype.populatePaintArrays=function(t,a,s,h,d,_){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,a,h,d,_);a.id!==void 0&&this._featureMap.add(a.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},jn.prototype.updatePaintArrays=function(t,a,s,h){for(var d=0,_=s;d<_.length;d+=1){var S=_[d];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,a,S,h)||this.needsUpload}},jn.prototype.get=function(t){return this.programConfigurations[t]},jn.prototype.upload=function(t){if(this.needsUpload){for(var a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}},jn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},fn("ConstantBinder",ai),fn("CrossFadedConstantBinder",si),fn("SourceExpressionBinder",ei),fn("CrossFadedCompositeBinder",mi),fn("CompositeExpressionBinder",Wn),fn("ProgramConfiguration",$n,{omit:["_buffers"]}),fn("ProgramConfigurationSet",jn);var Bo=Math.pow(2,14)-1,wo=-Bo-1;function Va(t){for(var a=8192/t.extent,s=t.loadGeometry(),h=0;h<s.length;h++)for(var d=s[h],_=0;_<d.length;_++){var S=d[_],M=Math.round(S.x*a),k=Math.round(S.y*a);S.x=Rt(M,wo,Bo),S.y=Rt(k,wo,Bo),(M<S.x||M>S.x+1||k<S.y||k>S.y+1)&&Je("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}function no(t,a){return{type:t.type,id:t.id,properties:t.properties,geometry:a?Va(t):[]}}function Es(t,a,s,h,d){t.emplaceBack(2*a+(h+1)/2,2*s+(d+1)/2)}var os=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new fl,this.indexArray=new hl,this.segments=new he,this.programConfigurations=new jn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function ku(t,a){for(var s=0;s<t.length;s++)if(ou(a,t[s]))return!0;for(var h=0;h<a.length;h++)if(ou(t,a[h]))return!0;return!!fc(t,a)}function ss(t,a,s){return!!ou(t,a)||!!mu(a,t,s)}function qs(t,a){if(t.length===1)return hc(a,t[0]);for(var s=0;s<a.length;s++)for(var h=a[s],d=0;d<h.length;d++)if(ou(t,h[d]))return!0;for(var _=0;_<t.length;_++)if(hc(a,t[_]))return!0;for(var S=0;S<a.length;S++)if(fc(t,a[S]))return!0;return!1}function $s(t,a,s){if(t.length>1){if(fc(t,a))return!0;for(var h=0;h<a.length;h++)if(mu(a[h],t,s))return!0}for(var d=0;d<t.length;d++)if(mu(t[d],a,s))return!0;return!1}function fc(t,a){if(t.length===0||a.length===0)return!1;for(var s=0;s<t.length-1;s++)for(var h=t[s],d=t[s+1],_=0;_<a.length-1;_++)if(Bl(h,d,a[_],a[_+1]))return!0;return!1}function Bl(t,a,s,h){return Ot(t,s,h)!==Ot(a,s,h)&&Ot(t,a,s)!==Ot(t,a,h)}function mu(t,a,s){var h=s*s;if(a.length===1)return t.distSqr(a[0])<h;for(var d=1;d<a.length;d++)if(vl(t,a[d-1],a[d])<h)return!0;return!1}function vl(t,a,s){var h=a.distSqr(s);if(h===0)return t.distSqr(a);var d=((t.x-a.x)*(s.x-a.x)+(t.y-a.y)*(s.y-a.y))/h;return t.distSqr(d<0?a:d>1?s:s.sub(a)._mult(d)._add(a))}function hc(t,a){for(var s,h,d,_=!1,S=0;S<t.length;S++)for(var M=0,k=(s=t[S]).length-1;M<s.length;k=M++)(h=s[M]).y>a.y!=(d=s[k]).y>a.y&&a.x<(d.x-h.x)*(a.y-h.y)/(d.y-h.y)+h.x&&(_=!_);return _}function ou(t,a){for(var s=!1,h=0,d=t.length-1;h<t.length;d=h++){var _=t[h],S=t[d];_.y>a.y!=S.y>a.y&&a.x<(S.x-_.x)*(a.y-_.y)/(S.y-_.y)+_.x&&(s=!s)}return s}function zl(t,a,s){var h=s[0],d=s[2];if(t.x<h.x&&a.x<h.x||t.x>d.x&&a.x>d.x||t.y<h.y&&a.y<h.y||t.y>d.y&&a.y>d.y)return!1;var _=Ot(t,a,s[0]);return _!==Ot(t,a,s[1])||_!==Ot(t,a,s[2])||_!==Ot(t,a,s[3])}function gu(t,a,s){var h=a.paint.get(t).value;return h.kind==="constant"?h.value:s.programConfigurations.get(a.id).getMaxValue(t)}function yo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function yu(t,a,s,h,d){if(!a[0]&&!a[1])return t;var _=re.convert(a)._mult(d);s==="viewport"&&_._rotate(-h);for(var S=[],M=0;M<t.length;M++)S.push(t[M].sub(_));return S}os.prototype.populate=function(t,a,s){var h=this.layers[0],d=[],_=null;h.type==="circle"&&(_=h.layout.get("circle-sort-key"));for(var S=0,M=t;S<M.length;S+=1){var k=M[S],z=k.feature,V=k.id,H=k.index,ee=k.sourceLayerIndex,se=this.layers[0]._featureFilter.needGeometry,Me=no(z,se);if(this.layers[0]._featureFilter.filter(new wi(this.zoom),Me,s)){var Oe=_?_.evaluate(Me,{},s):void 0,Ke={id:V,properties:z.properties,type:z.type,sourceLayerIndex:ee,index:H,geometry:se?Me.geometry:Va(z),patterns:{},sortKey:Oe};d.push(Ke)}}_&&d.sort(function(Vr,Mn){return Vr.sortKey-Mn.sortKey});for(var ze=0,ot=d;ze<ot.length;ze+=1){var xt=ot[ze],Bt=xt.geometry,Vt=xt.index,or=xt.sourceLayerIndex,Tr=t[Vt].feature;this.addFeature(xt,Bt,Vt,s),a.featureIndex.insert(Tr,Bt,Vt,or,this.index)}},os.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},os.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},os.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},os.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ce),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},os.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},os.prototype.addFeature=function(t,a,s,h){for(var d=0,_=a;d<_.length;d+=1)for(var S=0,M=_[d];S<M.length;S+=1){var k=M[S],z=k.x,V=k.y;if(!(z<0||z>=8192||V<0||V>=8192)){var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),ee=H.vertexLength;Es(this.layoutVertexArray,z,V,-1,-1),Es(this.layoutVertexArray,z,V,1,-1),Es(this.layoutVertexArray,z,V,1,1),Es(this.layoutVertexArray,z,V,-1,1),this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+3,ee+2),H.vertexLength+=4,H.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},h)},fn("CircleBucket",os,{omit:["layers"]});var Ku=new No({"circle-sort-key":new bn(fe.layout_circle["circle-sort-key"])}),Du={paint:new No({"circle-radius":new bn(fe.paint_circle["circle-radius"]),"circle-color":new bn(fe.paint_circle["circle-color"]),"circle-blur":new bn(fe.paint_circle["circle-blur"]),"circle-opacity":new bn(fe.paint_circle["circle-opacity"]),"circle-translate":new Cn(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new Cn(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Cn(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Cn(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bn(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bn(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bn(fe.paint_circle["circle-stroke-opacity"])}),layout:Ku},Ji=typeof Float32Array!="undefined"?Float32Array:Array;function Us(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function us(t,a,s){var h=a[0],d=a[1],_=a[2],S=a[3],M=a[4],k=a[5],z=a[6],V=a[7],H=a[8],ee=a[9],se=a[10],Me=a[11],Oe=a[12],Ke=a[13],ze=a[14],ot=a[15],xt=s[0],Bt=s[1],Vt=s[2],or=s[3];return t[0]=xt*h+Bt*M+Vt*H+or*Oe,t[1]=xt*d+Bt*k+Vt*ee+or*Ke,t[2]=xt*_+Bt*z+Vt*se+or*ze,t[3]=xt*S+Bt*V+Vt*Me+or*ot,t[4]=(xt=s[4])*h+(Bt=s[5])*M+(Vt=s[6])*H+(or=s[7])*Oe,t[5]=xt*d+Bt*k+Vt*ee+or*Ke,t[6]=xt*_+Bt*z+Vt*se+or*ze,t[7]=xt*S+Bt*V+Vt*Me+or*ot,t[8]=(xt=s[8])*h+(Bt=s[9])*M+(Vt=s[10])*H+(or=s[11])*Oe,t[9]=xt*d+Bt*k+Vt*ee+or*Ke,t[10]=xt*_+Bt*z+Vt*se+or*ze,t[11]=xt*S+Bt*V+Vt*Me+or*ot,t[12]=(xt=s[12])*h+(Bt=s[13])*M+(Vt=s[14])*H+(or=s[15])*Oe,t[13]=xt*d+Bt*k+Vt*ee+or*Ke,t[14]=xt*_+Bt*z+Vt*se+or*ze,t[15]=xt*S+Bt*V+Vt*Me+or*ot,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,a=0,s=arguments.length;s--;)a+=t[s]*t[s];return Math.sqrt(a)});var qu,Bc=us;function zc(t,a,s){var h=a[0],d=a[1],_=a[2],S=a[3];return t[0]=s[0]*h+s[4]*d+s[8]*_+s[12]*S,t[1]=s[1]*h+s[5]*d+s[9]*_+s[13]*S,t[2]=s[2]*h+s[6]*d+s[10]*_+s[14]*S,t[3]=s[3]*h+s[7]*d+s[11]*_+s[15]*S,t}qu=new Ji(3),Ji!=Float32Array&&(qu[0]=0,qu[1]=0,qu[2]=0),function(){var t=new Ji(4);Ji!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var vf=(function(){var t=new Ji(2);Ji!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function a(s){t.call(this,s,Du)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new os(s)},a.prototype.queryRadius=function(s){var h=s;return gu("circle-radius",this,h)+gu("circle-stroke-width",this,h)+yo(this.paint.get("circle-translate"))},a.prototype.queryIntersectsFeature=function(s,h,d,_,S,M,k,z){for(var V=yu(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,k),H=this.paint.get("circle-radius").evaluate(h,d)+this.paint.get("circle-stroke-width").evaluate(h,d),ee=this.paint.get("circle-pitch-alignment")==="map",se=ee?V:function(Tr,Vr){return Tr.map(function(Mn){return $o(Mn,Vr)})}(V,z),Me=ee?H*k:H,Oe=0,Ke=_;Oe<Ke.length;Oe+=1)for(var ze=0,ot=Ke[Oe];ze<ot.length;ze+=1){var xt=ot[ze],Bt=ee?xt:$o(xt,z),Vt=Me,or=zc([],[xt.x,xt.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Vt*=or[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Vt*=M.cameraToCenterDistance/or[3]),ss(se,Bt,Vt))return!0}return!1},a}(Fa));function $o(t,a){var s=zc([],[t.x,t.y,0,1],a);return new re(s[0]/s[3],s[1]/s[3])}var pc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(os);function su(t,a,s,h){var d=a.width,_=a.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==d*_*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(d*_*s);return t.width=d,t.height=_,t.data=h,t}function ml(t,a,s){var h=a.width,d=a.height;if(h!==t.width||d!==t.height){var _=su({},{width:h,height:d},s);Uc(t,_,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,d)},s),t.width=h,t.height=d,t.data=_.data}}function Uc(t,a,s,h,d,_){if(d.width===0||d.height===0)return a;if(d.width>t.width||d.height>t.height||s.x>t.width-d.width||s.y>t.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>a.width||d.height>a.height||h.x>a.width-d.width||h.y>a.height-d.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,M=a.data,k=0;k<d.height;k++)for(var z=((s.y+k)*t.width+s.x)*_,V=((h.y+k)*a.width+h.x)*_,H=0;H<d.width*_;H++)M[V+H]=S[z+H];return a}fn("HeatmapBucket",pc,{omit:["layers"]});var uu=function(t,a){su(this,t,1,a)};uu.prototype.resize=function(t){ml(this,t,1)},uu.prototype.clone=function(){return new uu({width:this.width,height:this.height},new Uint8Array(this.data))},uu.copy=function(t,a,s,h,d){Uc(t,a,s,h,d,1)};var To=function(t,a){su(this,t,4,a)};To.prototype.resize=function(t){ml(this,t,4)},To.prototype.replace=function(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},To.prototype.clone=function(){return new To({width:this.width,height:this.height},new Uint8Array(this.data))},To.copy=function(t,a,s,h,d){Uc(t,a,s,h,d,4)},fn("AlphaImage",uu),fn("RGBAImage",To);var Zc={paint:new No({"heatmap-radius":new bn(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bn(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Cn(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new as(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Cn(fe.paint_heatmap["heatmap-opacity"])})};function Vf(t){var a={},s=t.resolution||256,h=t.clips?t.clips.length:1,d=t.image||new To({width:s,height:h}),_=function(Me,Oe,Ke){a[t.evaluationKey]=Ke;var ze=t.expression.evaluate(a);d.data[Me+Oe+0]=Math.floor(255*ze.r/ze.a),d.data[Me+Oe+1]=Math.floor(255*ze.g/ze.a),d.data[Me+Oe+2]=Math.floor(255*ze.b/ze.a),d.data[Me+Oe+3]=Math.floor(255*ze.a)};if(t.clips)for(var S=0,M=0;S<h;++S,M+=4*s)for(var k=0,z=0;k<s;k++,z+=4){var V=k/(s-1),H=t.clips[S];_(M,z,H.start*(1-V)+H.end*V)}else for(var ee=0,se=0;ee<s;ee++,se+=4)_(0,se,ee/(s-1));return d}var jf=function(t){function a(s){t.call(this,s,Zc),this._updateColorRamp()}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new pc(s)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="heatmap-color"&&this._updateColorRamp()},a.prototype._updateColorRamp=function(){this.colorRamp=Vf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},a.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},a}(Fa),mf={paint:new No({"hillshade-illumination-direction":new Cn(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Cn(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Cn(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Cn(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Cn(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Cn(fe.paint_hillshade["hillshade-accent-color"])})},Yh=function(t){function a(s){t.call(this,s,mf)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},a}(Fa),Kh=ba([{name:"a_pos",components:2,type:"Int16"}],4).members,dc=Sh,gf=Sh;function Sh(t,a,s){s=s||2;var h,d,_,S,M,k,z,V=a&&a.length,H=V?a[0]*s:t.length,ee=yd(t,0,H,s,!0),se=[];if(!ee||ee.next===ee.prev)return se;if(V&&(ee=function(Oe,Ke,ze,ot){var xt,Bt,Vt,or=[];for(xt=0,Bt=Ke.length;xt<Bt;xt++)(Vt=yd(Oe,Ke[xt]*ot,xt<Bt-1?Ke[xt+1]*ot:Oe.length,ot,!1))===Vt.next&&(Vt.steiner=!0),or.push(Gf(Vt));for(or.sort(Bp),xt=0;xt<or.length;xt++)zp(or[xt],ze),ze=Lr(ze,ze.next);return ze}(t,a,ee,s)),t.length>80*s){h=_=t[0],d=S=t[1];for(var Me=s;Me<H;Me+=s)(M=t[Me])<h&&(h=M),(k=t[Me+1])<d&&(d=k),M>_&&(_=M),k>S&&(S=k);z=(z=Math.max(_-h,S-d))!==0?1/z:0}return yf(ee,se,s,h,d,z),se}function yd(t,a,s,h,d){var _,S;if(d===qf(t,a,s,h)>0)for(_=a;_<s;_+=h)S=bf(_,t[_],t[_+1],S);else for(_=s-h;_>=a;_-=h)S=bf(_,t[_],t[_+1],S);return S&&Hf(S,S.next)&&(gl(S),S=S.next),S}function Lr(t,a){if(!t)return t;a||(a=t);var s,h=t;do if(s=!1,h.steiner||!Hf(h,h.next)&&_o(h.prev,h,h.next)!==0)h=h.next;else{if(gl(h),(h=a=h.prev)===h.next)break;s=!0}while(s||h!==a);return a}function yf(t,a,s,h,d,_,S){if(t){!S&&_&&function(V,H,ee,se){var Me=V;do Me.z===null&&(Me.z=Th(Me.x,Me.y,H,ee,se)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==V);Me.prevZ.nextZ=null,Me.prevZ=null,function(Oe){var Ke,ze,ot,xt,Bt,Vt,or,Tr,Vr=1;do{for(ze=Oe,Oe=null,Bt=null,Vt=0;ze;){for(Vt++,ot=ze,or=0,Ke=0;Ke<Vr&&(or++,ot=ot.nextZ);Ke++);for(Tr=Vr;or>0||Tr>0&&ot;)or!==0&&(Tr===0||!ot||ze.z<=ot.z)?(xt=ze,ze=ze.nextZ,or--):(xt=ot,ot=ot.nextZ,Tr--),Bt?Bt.nextZ=xt:Oe=xt,xt.prevZ=Bt,Bt=xt;ze=ot}Bt.nextZ=null,Vr*=2}while(Vt>1)}(Me)}(t,h,d,_);for(var M,k,z=t;t.prev!==t.next;)if(M=t.prev,k=t.next,_?_d(t,h,d,_):qt(t))a.push(M.i/s),a.push(t.i/s),a.push(k.i/s),gl(t),t=k.next,z=k.next;else if((t=k)===z){S?S===1?yf(t=_f(Lr(t),a,s),a,s,h,d,_,2):S===2&&wh(t,a,s,h,d,_):yf(Lr(t),a,s,h,d,_,1);break}}}function qt(t){var a=t.prev,s=t,h=t.next;if(_o(a,s,h)>=0)return!1;for(var d=t.next.next;d!==t.prev;){if(xf(a.x,a.y,s.x,s.y,h.x,h.y,d.x,d.y)&&_o(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function _d(t,a,s,h){var d=t.prev,_=t,S=t.next;if(_o(d,_,S)>=0)return!1;for(var M=d.x>_.x?d.x>S.x?d.x:S.x:_.x>S.x?_.x:S.x,k=d.y>_.y?d.y>S.y?d.y:S.y:_.y>S.y?_.y:S.y,z=Th(d.x<_.x?d.x<S.x?d.x:S.x:_.x<S.x?_.x:S.x,d.y<_.y?d.y<S.y?d.y:S.y:_.y<S.y?_.y:S.y,a,s,h),V=Th(M,k,a,s,h),H=t.prevZ,ee=t.nextZ;H&&H.z>=z&&ee&&ee.z<=V;){if(H!==t.prev&&H!==t.next&&xf(d.x,d.y,_.x,_.y,S.x,S.y,H.x,H.y)&&_o(H.prev,H,H.next)>=0||(H=H.prevZ,ee!==t.prev&&ee!==t.next&&xf(d.x,d.y,_.x,_.y,S.x,S.y,ee.x,ee.y)&&_o(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;H&&H.z>=z;){if(H!==t.prev&&H!==t.next&&xf(d.x,d.y,_.x,_.y,S.x,S.y,H.x,H.y)&&_o(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;ee&&ee.z<=V;){if(ee!==t.prev&&ee!==t.next&&xf(d.x,d.y,_.x,_.y,S.x,S.y,ee.x,ee.y)&&_o(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function _f(t,a,s){var h=t;do{var d=h.prev,_=h.next.next;!Hf(d,_)&&qh(d,h,h.next,_)&&Yf(d,_)&&Yf(_,d)&&(a.push(d.i/s),a.push(h.i/s),a.push(_.i/s),gl(h),gl(h.next),h=t=_),h=h.next}while(h!==t);return Lr(h)}function wh(t,a,s,h,d,_){var S=t;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&xd(S,M)){var k=Kf(S,M);return S=Lr(S,S.next),k=Lr(k,k.next),yf(S,a,s,h,d,_),void yf(k,a,s,h,d,_)}M=M.next}S=S.next}while(S!==t)}function Bp(t,a){return t.x-a.x}function zp(t,a){if(a=function(h,d){var _,S=d,M=h.x,k=h.y,z=-1/0;do{if(k<=S.y&&k>=S.next.y&&S.next.y!==S.y){var V=S.x+(k-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(V<=M&&V>z){if(z=V,V===M){if(k===S.y)return S;if(k===S.next.y)return S.next}_=S.x<S.next.x?S:S.next}}S=S.next}while(S!==d);if(!_)return null;if(M===z)return _;var H,ee=_,se=_.x,Me=_.y,Oe=1/0;S=_;do M>=S.x&&S.x>=se&&M!==S.x&&xf(k<Me?M:z,k,se,Me,k<Me?z:M,k,S.x,S.y)&&(H=Math.abs(k-S.y)/(M-S.x),Yf(S,h)&&(H<Oe||H===Oe&&(S.x>_.x||S.x===_.x&&Up(_,S)))&&(_=S,Oe=H)),S=S.next;while(S!==ee);return _}(t,a)){var s=Kf(a,t);Lr(a,a.next),Lr(s,s.next)}}function Up(t,a){return _o(t.prev,t,a.prev)<0&&_o(a.next,t,t.next)<0}function Th(t,a,s,h,d){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*d)|t<<8))|t<<4))|t<<2))|t<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-h)*d)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function Gf(t){var a=t,s=t;do(a.x<s.x||a.x===s.x&&a.y<s.y)&&(s=a),a=a.next;while(a!==t);return s}function xf(t,a,s,h,d,_,S,M){return(d-S)*(a-M)-(t-S)*(_-M)>=0&&(t-S)*(h-M)-(s-S)*(a-M)>=0&&(s-S)*(_-M)-(d-S)*(h-M)>=0}function xd(t,a){return t.next.i!==a.i&&t.prev.i!==a.i&&!function(s,h){var d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==h.i&&d.next.i!==h.i&&qh(d,d.next,s,h))return!0;d=d.next}while(d!==s);return!1}(t,a)&&(Yf(t,a)&&Yf(a,t)&&function(s,h){var d=s,_=!1,S=(s.x+h.x)/2,M=(s.y+h.y)/2;do d.y>M!=d.next.y>M&&d.next.y!==d.y&&S<(d.next.x-d.x)*(M-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==s);return _}(t,a)&&(_o(t.prev,t,a.prev)||_o(t,a.prev,a))||Hf(t,a)&&_o(t.prev,t,t.next)>0&&_o(a.prev,a,a.next)>0)}function _o(t,a,s){return(a.y-t.y)*(s.x-a.x)-(a.x-t.x)*(s.y-a.y)}function Hf(t,a){return t.x===a.x&&t.y===a.y}function qh(t,a,s,h){var d=Xf(_o(t,a,s)),_=Xf(_o(t,a,h)),S=Xf(_o(s,h,t)),M=Xf(_o(s,h,a));return d!==_&&S!==M||!(d!==0||!Wf(t,s,a))||!(_!==0||!Wf(t,h,a))||!(S!==0||!Wf(s,t,h))||!(M!==0||!Wf(s,a,h))}function Wf(t,a,s){return a.x<=Math.max(t.x,s.x)&&a.x>=Math.min(t.x,s.x)&&a.y<=Math.max(t.y,s.y)&&a.y>=Math.min(t.y,s.y)}function Xf(t){return t>0?1:t<0?-1:0}function Yf(t,a){return _o(t.prev,t,t.next)<0?_o(t,a,t.next)>=0&&_o(t,t.prev,a)>=0:_o(t,a,t.prev)<0||_o(t,t.next,a)<0}function Kf(t,a){var s=new Ef(t.i,t.x,t.y),h=new Ef(a.i,a.x,a.y),d=t.next,_=a.prev;return t.next=a,a.prev=t,s.next=d,d.prev=s,h.next=s,s.prev=h,_.next=h,h.prev=_,h}function bf(t,a,s,h){var d=new Ef(t,a,s);return h?(d.next=h.next,d.prev=h,h.next.prev=d,h.next=d):(d.prev=d,d.next=d),d}function gl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ef(t,a,s){this.i=t,this.x=a,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qf(t,a,s,h){for(var d=0,_=a,S=s-h;_<s;_+=h)d+=(t[S]-t[_])*(t[_+1]+t[S+1]),S=_;return d}function Ah(t,a,s,h,d){(function _(S,M,k,z,V){for(;z>k;){if(z-k>600){var H=z-k+1,ee=M-k+1,se=Math.log(H),Me=.5*Math.exp(2*se/3),Oe=.5*Math.sqrt(se*Me*(H-Me)/H)*(ee-H/2<0?-1:1);_(S,M,Math.max(k,Math.floor(M-ee*Me/H+Oe)),Math.min(z,Math.floor(M+(H-ee)*Me/H+Oe)),V)}var Ke=S[M],ze=k,ot=z;for(vc(S,k,M),V(S[z],Ke)>0&&vc(S,k,z);ze<ot;){for(vc(S,ze,ot),ze++,ot--;V(S[ze],Ke)<0;)ze++;for(;V(S[ot],Ke)>0;)ot--}V(S[k],Ke)===0?vc(S,k,ot):vc(S,++ot,z),ot<=M&&(k=ot+1),M<=ot&&(z=ot-1)}})(t,a,s||0,h||t.length-1,d||Ch)}function vc(t,a,s){var h=t[a];t[a]=t[s],t[s]=h}function Ch(t,a){return t<a?-1:t>a?1:0}function $f(t,a){var s=t.length;if(s<=1)return[t];for(var h,d,_=[],S=0;S<s;S++){var M=dr(t[S]);M!==0&&(t[S].area=Math.abs(M),d===void 0&&(d=M<0),d===M<0?(h&&_.push(h),h=[t[S]]):h.push(t[S]))}if(h&&_.push(h),a>1)for(var k=0;k<_.length;k++)_[k].length<=a||(Ah(_[k],a,1,_[k].length-1,Mh),_[k]=_[k].slice(0,a));return _}function Mh(t,a){return a.area-t.area}function Vc(t,a,s){for(var h=s.patternDependencies,d=!1,_=0,S=a;_<S.length;_+=1){var M=S[_].paint.get(t+"-pattern");M.isConstant()||(d=!0);var k=M.constantOr(null);k&&(d=!0,h[k.to]=!0,h[k.from]=!0)}return d}function Sf(t,a,s,h,d){for(var _=d.patternDependencies,S=0,M=a;S<M.length;S+=1){var k=M[S],z=k.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var V=z.evaluate({zoom:h-1},s,{},d.availableImages),H=z.evaluate({zoom:h},s,{},d.availableImages),ee=z.evaluate({zoom:h+1},s,{},d.availableImages);H=H&&H.name?H.name:H,ee=ee&&ee.name?ee.name:ee,_[V=V&&V.name?V.name:V]=!0,_[H]=!0,_[ee]=!0,s.patterns[k.id]={min:V,mid:H,max:ee}}}return s}Sh.deviation=function(t,a,s,h){var d=a&&a.length,_=Math.abs(qf(t,0,d?a[0]*s:t.length,s));if(d)for(var S=0,M=a.length;S<M;S++)_-=Math.abs(qf(t,a[S]*s,S<M-1?a[S+1]*s:t.length,s));var k=0;for(S=0;S<h.length;S+=3){var z=h[S]*s,V=h[S+1]*s,H=h[S+2]*s;k+=Math.abs((t[z]-t[H])*(t[V+1]-t[z+1])-(t[z]-t[V])*(t[H+1]-t[z+1]))}return _===0&&k===0?0:Math.abs((k-_)/_)},Sh.flatten=function(t){for(var a=t[0][0].length,s={vertices:[],holes:[],dimensions:a},h=0,d=0;d<t.length;d++){for(var _=0;_<t[d].length;_++)for(var S=0;S<a;S++)s.vertices.push(t[d][_][S]);d>0&&s.holes.push(h+=t[d-1].length)}return s},dc.default=gf;var Zs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new fl,this.indexArray=new hl,this.indexArray2=new Nl,this.programConfigurations=new jn(t.layers,t.zoom),this.segments=new he,this.segments2=new he,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};Zs.prototype.populate=function(t,a,s){this.hasPattern=Vc("fill",this.layers,a);for(var h=this.layers[0].layout.get("fill-sort-key"),d=[],_=0,S=t;_<S.length;_+=1){var M=S[_],k=M.feature,z=M.id,V=M.index,H=M.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,se=no(k,ee);if(this.layers[0]._featureFilter.filter(new wi(this.zoom),se,s)){var Me=h?h.evaluate(se,{},s,a.availableImages):void 0,Oe={id:z,properties:k.properties,type:k.type,sourceLayerIndex:H,index:V,geometry:ee?se.geometry:Va(k),patterns:{},sortKey:Me};d.push(Oe)}}h&&d.sort(function(Tr,Vr){return Tr.sortKey-Vr.sortKey});for(var Ke=0,ze=d;Ke<ze.length;Ke+=1){var ot=ze[Ke],xt=ot.geometry,Bt=ot.index,Vt=ot.sourceLayerIndex;if(this.hasPattern){var or=Sf("fill",this.layers,ot,this.zoom,a);this.patternFeatures.push(or)}else this.addFeature(ot,xt,Bt,s,{});a.featureIndex.insert(t[Bt].feature,xt,Bt,Vt,this.index)}},Zs.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},Zs.prototype.addFeatures=function(t,a,s){for(var h=0,d=this.patternFeatures;h<d.length;h+=1){var _=d[h];this.addFeature(_,_.geometry,_.index,a,s)}},Zs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Zs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Zs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Kh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Zs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Zs.prototype.addFeature=function(t,a,s,h,d){for(var _=0,S=$f(a,500);_<S.length;_+=1){for(var M=S[_],k=0,z=0,V=M;z<V.length;z+=1)k+=V[z].length;for(var H=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),ee=H.vertexLength,se=[],Me=[],Oe=0,Ke=M;Oe<Ke.length;Oe+=1){var ze=Ke[Oe];if(ze.length!==0){ze!==M[0]&&Me.push(se.length/2);var ot=this.segments2.prepareSegment(ze.length,this.layoutVertexArray,this.indexArray2),xt=ot.vertexLength;this.layoutVertexArray.emplaceBack(ze[0].x,ze[0].y),this.indexArray2.emplaceBack(xt+ze.length-1,xt),se.push(ze[0].x),se.push(ze[0].y);for(var Bt=1;Bt<ze.length;Bt++)this.layoutVertexArray.emplaceBack(ze[Bt].x,ze[Bt].y),this.indexArray2.emplaceBack(xt+Bt-1,xt+Bt),se.push(ze[Bt].x),se.push(ze[Bt].y);ot.vertexLength+=ze.length,ot.primitiveLength+=ze.length}}for(var Vt=dc(se,Me),or=0;or<Vt.length;or+=3)this.indexArray.emplaceBack(ee+Vt[or],ee+Vt[or+1],ee+Vt[or+2]);H.vertexLength+=k,H.primitiveLength+=Vt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,h)},fn("FillBucket",Zs,{omit:["layers","patternFeatures"]});var Jf=new No({"fill-sort-key":new bn(fe.layout_fill["fill-sort-key"])}),Ph={paint:new No({"fill-antialias":new Cn(fe.paint_fill["fill-antialias"]),"fill-opacity":new bn(fe.paint_fill["fill-opacity"]),"fill-color":new bn(fe.paint_fill["fill-color"]),"fill-outline-color":new bn(fe.paint_fill["fill-outline-color"]),"fill-translate":new Cn(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new Cn(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Dc(fe.paint_fill["fill-pattern"])}),layout:Jf},Qf=function(t){function a(s){t.call(this,s,Ph)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,h){t.prototype.recalculate.call(this,s,h);var d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},a.prototype.createBucket=function(s){return new Zs(s)},a.prototype.queryRadius=function(){return yo(this.paint.get("fill-translate"))},a.prototype.queryIntersectsFeature=function(s,h,d,_,S,M,k){return qs(yu(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,k),_)},a.prototype.isTileClipped=function(){return!0},a}(Fa),wf=ba([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,eh=yl;function yl(t,a,s,h,d){this.properties={},this.extent=s,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=d,t.readFields(mc,this,a)}function mc(t,a,s){t==1?a.id=s.readVarint():t==2?function(h,d){for(var _=h.readVarint()+h.pos;h.pos<_;){var S=d._keys[h.readVarint()],M=d._values[h.readVarint()];d.properties[S]=M}}(s,a):t==3?a.type=s.readVarint():t==4&&(a._geometry=s.pos)}function $h(t){for(var a,s,h=0,d=0,_=t.length,S=_-1;d<_;S=d++)h+=((s=t[S]).x-(a=t[d]).x)*(a.y+s.y);return h}yl.types=["Unknown","Point","LineString","Polygon"],yl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var a,s=t.readVarint()+t.pos,h=1,d=0,_=0,S=0,M=[];t.pos<s;){if(d<=0){var k=t.readVarint();h=7&k,d=k>>3}if(d--,h===1||h===2)_+=t.readSVarint(),S+=t.readSVarint(),h===1&&(a&&M.push(a),a=[]),a.push(new re(_,S));else{if(h!==7)throw new Error("unknown command "+h);a&&a.push(a[0].clone())}}return a&&M.push(a),M},yl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var a=t.readVarint()+t.pos,s=1,h=0,d=0,_=0,S=1/0,M=-1/0,k=1/0,z=-1/0;t.pos<a;){if(h<=0){var V=t.readVarint();s=7&V,h=V>>3}if(h--,s===1||s===2)(d+=t.readSVarint())<S&&(S=d),d>M&&(M=d),(_+=t.readSVarint())<k&&(k=_),_>z&&(z=_);else if(s!==7)throw new Error("unknown command "+s)}return[S,k,M,z]},yl.prototype.toGeoJSON=function(t,a,s){var h,d,_=this.extent*Math.pow(2,s),S=this.extent*t,M=this.extent*a,k=this.loadGeometry(),z=yl.types[this.type];function V(se){for(var Me=0;Me<se.length;Me++){var Oe=se[Me];se[Me]=[360*(Oe.x+S)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(Oe.y+M)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(h=0;h<k.length;h++)H[h]=k[h][0];V(k=H);break;case 2:for(h=0;h<k.length;h++)V(k[h]);break;case 3:for(k=function(se){var Me=se.length;if(Me<=1)return[se];for(var Oe,Ke,ze=[],ot=0;ot<Me;ot++){var xt=$h(se[ot]);xt!==0&&(Ke===void 0&&(Ke=xt<0),Ke===xt<0?(Oe&&ze.push(Oe),Oe=[se[ot]]):Oe.push(se[ot]))}return Oe&&ze.push(Oe),ze}(k),h=0;h<k.length;h++)for(d=0;d<k[h].length;d++)V(k[h][d])}k.length===1?k=k[0]:z="Multi"+z;var ee={type:"Feature",geometry:{type:z,coordinates:k},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var Ih=Zp;function Zp(t,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(bd,this,a),this.length=this._features.length}function bd(t,a,s){t===15?a.version=s.readVarint():t===1?a.name=s.readString():t===5?a.extent=s.readVarint():t===2?a._features.push(s.pos):t===3?a._keys.push(s.readString()):t===4&&a._values.push(function(h){for(var d=null,_=h.readVarint()+h.pos;h.pos<_;){var S=h.readVarint()>>3;d=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return d}(s))}function Vp(t,a,s){if(t===3){var h=new Ih(s,s.readVarint()+s.pos);h.length&&(a[h.name]=h)}}Zp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var a=this._pbf.readVarint()+this._pbf.pos;return new eh(this._pbf,a,this.extent,this._keys,this._values)};var Os={VectorTile:function(t,a){this.layers=t.readFields(Vp,{},a)},VectorTileFeature:eh,VectorTileLayer:Ih},jp=Os.VectorTileFeature.types,Aa=Math.pow(2,13);function _u(t,a,s,h,d,_,S,M){t.emplaceBack(a,s,2*Math.floor(h*Aa)+S,d*Aa*2,_*Aa*2,Math.round(M))}var $u=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new du,this.indexArray=new hl,this.programConfigurations=new jn(t.layers,t.zoom),this.segments=new he,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Gp(t,a){return t.x===a.x&&(t.x<0||t.x>8192)||t.y===a.y&&(t.y<0||t.y>8192)}$u.prototype.populate=function(t,a,s){this.features=[],this.hasPattern=Vc("fill-extrusion",this.layers,a);for(var h=0,d=t;h<d.length;h+=1){var _=d[h],S=_.feature,M=_.id,k=_.index,z=_.sourceLayerIndex,V=this.layers[0]._featureFilter.needGeometry,H=no(S,V);if(this.layers[0]._featureFilter.filter(new wi(this.zoom),H,s)){var ee={id:M,sourceLayerIndex:z,index:k,geometry:V?H.geometry:Va(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Sf("fill-extrusion",this.layers,ee,this.zoom,a)):this.addFeature(ee,ee.geometry,k,s,{}),a.featureIndex.insert(S,ee.geometry,k,z,this.index,!0)}}},$u.prototype.addFeatures=function(t,a,s){for(var h=0,d=this.features;h<d.length;h+=1){var _=d[h];this.addFeature(_,_.geometry,_.index,a,s)}},$u.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},$u.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},$u.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},$u.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,wf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},$u.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},$u.prototype.addFeature=function(t,a,s,h,d){for(var _=0,S=$f(a,500);_<S.length;_+=1){for(var M=S[_],k=0,z=0,V=M;z<V.length;z+=1)k+=V[z].length;for(var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ee=0,se=M;ee<se.length;ee+=1){var Me=se[ee];if(Me.length!==0&&!((Ti=Me).every(function(Si){return Si.x<0})||Ti.every(function(Si){return Si.x>8192})||Ti.every(function(Si){return Si.y<0})||Ti.every(function(Si){return Si.y>8192})))for(var Oe=0,Ke=0;Ke<Me.length;Ke++){var ze=Me[Ke];if(Ke>=1){var ot=Me[Ke-1];if(!Gp(ze,ot)){H.vertexLength+4>he.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var xt=ze.sub(ot)._perp()._unit(),Bt=ot.dist(ze);Oe+Bt>32768&&(Oe=0),_u(this.layoutVertexArray,ze.x,ze.y,xt.x,xt.y,0,0,Oe),_u(this.layoutVertexArray,ze.x,ze.y,xt.x,xt.y,0,1,Oe),_u(this.layoutVertexArray,ot.x,ot.y,xt.x,xt.y,0,0,Oe+=Bt),_u(this.layoutVertexArray,ot.x,ot.y,xt.x,xt.y,0,1,Oe);var Vt=H.vertexLength;this.indexArray.emplaceBack(Vt,Vt+2,Vt+1),this.indexArray.emplaceBack(Vt+1,Vt+2,Vt+3),H.vertexLength+=4,H.primitiveLength+=2}}}}if(H.vertexLength+k>he.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),jp[t.type]==="Polygon"){for(var or=[],Tr=[],Vr=H.vertexLength,Mn=0,sn=M;Mn<sn.length;Mn+=1){var Zn=sn[Mn];if(Zn.length!==0){Zn!==M[0]&&Tr.push(or.length/2);for(var ln=0;ln<Zn.length;ln++){var Li=Zn[ln];_u(this.layoutVertexArray,Li.x,Li.y,0,0,1,1,0),or.push(Li.x),or.push(Li.y)}}}for(var Yn=dc(or,Tr),An=0;An<Yn.length;An+=3)this.indexArray.emplaceBack(Vr+Yn[An],Vr+Yn[An+2],Vr+Yn[An+1]);H.primitiveLength+=Yn.length/3,H.vertexLength+=k}}var Ti;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,h)},fn("FillExtrusionBucket",$u,{omit:["layers","features"]});var Hp={paint:new No({"fill-extrusion-opacity":new Cn(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bn(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Cn(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Cn(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Dc(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bn(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bn(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Cn(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},_l=function(t){function a(s){t.call(this,s,Hp)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new $u(s)},a.prototype.queryRadius=function(){return yo(this.paint.get("fill-extrusion-translate"))},a.prototype.is3D=function(){return!0},a.prototype.queryIntersectsFeature=function(s,h,d,_,S,M,k,z){var V=yu(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,k),H=this.paint.get("fill-extrusion-height").evaluate(h,d),ee=this.paint.get("fill-extrusion-base").evaluate(h,d),se=function(Oe,Ke,ze,ot){for(var xt=[],Bt=0,Vt=Oe;Bt<Vt.length;Bt+=1){var or=Vt[Bt],Tr=[or.x,or.y,0,1];zc(Tr,Tr,Ke),xt.push(new re(Tr[0]/Tr[3],Tr[1]/Tr[3]))}return xt}(V,z),Me=function(Oe,Ke,ze,ot){for(var xt=[],Bt=[],Vt=ot[8]*Ke,or=ot[9]*Ke,Tr=ot[10]*Ke,Vr=ot[11]*Ke,Mn=ot[8]*ze,sn=ot[9]*ze,Zn=ot[10]*ze,ln=ot[11]*ze,Li=0,Yn=Oe;Li<Yn.length;Li+=1){for(var An=[],Ti=[],Si=0,ta=Yn[Li];Si<ta.length;Si+=1){var Nn=ta[Si],ha=Nn.x,$a=Nn.y,vo=ot[0]*ha+ot[4]*$a+ot[12],ao=ot[1]*ha+ot[5]*$a+ot[13],Ja=ot[2]*ha+ot[6]*$a+ot[14],mo=ot[3]*ha+ot[7]*$a+ot[15],zo=Ja+Tr,fs=mo+Vr,Vs=vo+Mn,hs=ao+sn,Ds=Ja+Zn,Io=mo+ln,es=new re((vo+Vt)/fs,(ao+or)/fs);es.z=zo/fs,An.push(es);var Hi=new re(Vs/Io,hs/Io);Hi.z=Ds/Io,Ti.push(Hi)}xt.push(An),Bt.push(Ti)}return[xt,Bt]}(_,ee,H,z);return function(Oe,Ke,ze){var ot=1/0;qs(ze,Ke)&&(ot=Gc(ze,Ke[0]));for(var xt=0;xt<Ke.length;xt++)for(var Bt=Ke[xt],Vt=Oe[xt],or=0;or<Bt.length-1;or++){var Tr=Bt[or],Vr=[Tr,Bt[or+1],Vt[or+1],Vt[or],Tr];ku(ze,Vr)&&(ot=Math.min(ot,Gc(ze,Vr)))}return ot!==1/0&&ot}(Me[0],Me[1],se)},a}(Fa);function jc(t,a){return t.x*a.x+t.y*a.y}function Gc(t,a){if(t.length===1){for(var s,h=0,d=a[h++];!s||d.equals(s);)if(!(s=a[h++]))return 1/0;for(;h<a.length;h++){var _=a[h],S=t[0],M=s.sub(d),k=_.sub(d),z=S.sub(d),V=jc(M,M),H=jc(M,k),ee=jc(k,k),se=jc(z,M),Me=jc(z,k),Oe=V*ee-H*H,Ke=(ee*se-H*Me)/Oe,ze=(V*Me-H*se)/Oe,ot=d.z*(1-Ke-ze)+s.z*Ke+_.z*ze;if(isFinite(ot))return ot}return 1/0}for(var xt=1/0,Bt=0,Vt=a;Bt<Vt.length;Bt+=1)xt=Math.min(xt,Vt[Bt].z);return xt}var Ju=ba([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Wp=ba([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Jh=Os.VectorTileFeature.types,xu=Math.cos(Math.PI/180*37.5),Hc=Math.pow(2,14)/.5,ea=function(t){var a=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(s){a.gradients[s.id]={}}),this.layoutVertexArray=new So,this.layoutVertexArray2=new Xu,this.indexArray=new hl,this.programConfigurations=new jn(t.layers,t.zoom),this.segments=new he,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};ea.prototype.populate=function(t,a,s){this.hasPattern=Vc("line",this.layers,a);for(var h=this.layers[0].layout.get("line-sort-key"),d=[],_=0,S=t;_<S.length;_+=1){var M=S[_],k=M.feature,z=M.id,V=M.index,H=M.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,se=no(k,ee);if(this.layers[0]._featureFilter.filter(new wi(this.zoom),se,s)){var Me=h?h.evaluate(se,{},s):void 0,Oe={id:z,properties:k.properties,type:k.type,sourceLayerIndex:H,index:V,geometry:ee?se.geometry:Va(k),patterns:{},sortKey:Me};d.push(Oe)}}h&&d.sort(function(Tr,Vr){return Tr.sortKey-Vr.sortKey});for(var Ke=0,ze=d;Ke<ze.length;Ke+=1){var ot=ze[Ke],xt=ot.geometry,Bt=ot.index,Vt=ot.sourceLayerIndex;if(this.hasPattern){var or=Sf("line",this.layers,ot,this.zoom,a);this.patternFeatures.push(or)}else this.addFeature(ot,xt,Bt,s,{});a.featureIndex.insert(t[Bt].feature,xt,Bt,Vt,this.index)}},ea.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},ea.prototype.addFeatures=function(t,a,s){for(var h=0,d=this.patternFeatures;h<d.length;h+=1){var _=d[h];this.addFeature(_,_.geometry,_.index,a,s)}},ea.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ea.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ea.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Wp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ju),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ea.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ea.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},ea.prototype.addFeature=function(t,a,s,h,d){var _=this.layers[0].layout,S=_.get("line-join").evaluate(t,{}),M=_.get("line-cap"),k=_.get("line-miter-limit"),z=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var V=0,H=a;V<H.length;V+=1)this.addLine(H[V],t,S,M,k,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,h)},ea.prototype.addLine=function(t,a,s,h,d,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Jh[a.type]==="Polygon",k=t.length;k>=2&&t[k-1].equals(t[k-2]);)k--;for(var z=0;z<k-1&&t[z].equals(t[z+1]);)z++;if(!(k<(M?3:2))){s==="bevel"&&(d=1.05);var V,H=this.overscaling<=16?122880/(512*this.overscaling):0,ee=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),se=void 0,Me=void 0,Oe=void 0,Ke=void 0;this.e1=this.e2=-1,M&&(Ke=t[z].sub(V=t[k-2])._unit()._perp());for(var ze=z;ze<k;ze++)if(!(Me=ze===k-1?M?t[z+1]:void 0:t[ze+1])||!t[ze].equals(Me)){Ke&&(Oe=Ke),V&&(se=V),V=t[ze],Ke=Me?Me.sub(V)._unit()._perp():Oe;var ot=(Oe=Oe||Ke).add(Ke);ot.x===0&&ot.y===0||ot._unit();var xt=Oe.x*Ke.x+Oe.y*Ke.y,Bt=ot.x*Ke.x+ot.y*Ke.y,Vt=Bt!==0?1/Bt:1/0,or=2*Math.sqrt(2-2*Bt),Tr=Bt<xu&&se&&Me,Vr=Oe.x*Ke.y-Oe.y*Ke.x>0;if(Tr&&ze>z){var Mn=V.dist(se);if(Mn>2*H){var sn=V.sub(V.sub(se)._mult(H/Mn)._round());this.updateDistance(se,sn),this.addCurrentVertex(sn,Oe,0,0,ee),se=sn}}var Zn=se&&Me,ln=Zn?s:M?"butt":h;if(Zn&&ln==="round"&&(Vt<_?ln="miter":Vt<=2&&(ln="fakeround")),ln==="miter"&&Vt>d&&(ln="bevel"),ln==="bevel"&&(Vt>2&&(ln="flipbevel"),Vt<d&&(ln="miter")),se&&this.updateDistance(se,V),ln==="miter")ot._mult(Vt),this.addCurrentVertex(V,ot,0,0,ee);else if(ln==="flipbevel"){if(Vt>100)ot=Ke.mult(-1);else{var Li=Vt*Oe.add(Ke).mag()/Oe.sub(Ke).mag();ot._perp()._mult(Li*(Vr?-1:1))}this.addCurrentVertex(V,ot,0,0,ee),this.addCurrentVertex(V,ot.mult(-1),0,0,ee)}else if(ln==="bevel"||ln==="fakeround"){var Yn=-Math.sqrt(Vt*Vt-1),An=Vr?Yn:0,Ti=Vr?0:Yn;if(se&&this.addCurrentVertex(V,Oe,An,Ti,ee),ln==="fakeround")for(var Si=Math.round(180*or/Math.PI/20),ta=1;ta<Si;ta++){var Nn=ta/Si;if(Nn!==.5){var ha=Nn-.5;Nn+=Nn*ha*(Nn-1)*((1.0904+xt*(xt*(3.55645-1.43519*xt)-3.2452))*ha*ha+(.848013+xt*(.215638*xt-1.06021)))}var $a=Ke.sub(Oe)._mult(Nn)._add(Oe)._unit()._mult(Vr?-1:1);this.addHalfVertex(V,$a.x,$a.y,!1,Vr,0,ee)}Me&&this.addCurrentVertex(V,Ke,-An,-Ti,ee)}else if(ln==="butt")this.addCurrentVertex(V,ot,0,0,ee);else if(ln==="square"){var vo=se?1:-1;this.addCurrentVertex(V,ot,vo,vo,ee)}else ln==="round"&&(se&&(this.addCurrentVertex(V,Oe,0,0,ee),this.addCurrentVertex(V,Oe,1,1,ee,!0)),Me&&(this.addCurrentVertex(V,Ke,-1,-1,ee,!0),this.addCurrentVertex(V,Ke,0,0,ee)));if(Tr&&ze<k-1){var ao=V.dist(Me);if(ao>2*H){var Ja=V.add(Me.sub(V)._mult(H/ao)._round());this.updateDistance(V,Ja),this.addCurrentVertex(Ja,Ke,0,0,ee),V=Ja}}}}},ea.prototype.addCurrentVertex=function(t,a,s,h,d,_){_===void 0&&(_=!1);var S=a.y*h-a.x,M=-a.y-a.x*h;this.addHalfVertex(t,a.x+a.y*s,a.y-a.x*s,_,!1,s,d),this.addHalfVertex(t,S,M,_,!0,-h,d),this.distance>Hc/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,a,s,h,d,_))},ea.prototype.addHalfVertex=function(t,a,s,h,d,_,S){var M=.5*(this.lineClips?this.scaledDistance*(Hc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(d?1:0),Math.round(63*a)+128,Math.round(63*s)+128,1+(_===0?0:_<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),S.primitiveLength++),d?this.e2=k:this.e1=k},ea.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ea.prototype.updateDistance=function(t,a){this.distance+=t.dist(a),this.updateScaledDistance()},fn("LineBucket",ea,{omit:["layers","patternFeatures"]});var gc=new No({"line-cap":new Cn(fe.layout_line["line-cap"]),"line-join":new bn(fe.layout_line["line-join"]),"line-miter-limit":new Cn(fe.layout_line["line-miter-limit"]),"line-round-limit":new Cn(fe.layout_line["line-round-limit"]),"line-sort-key":new bn(fe.layout_line["line-sort-key"])}),lo={paint:new No({"line-opacity":new bn(fe.paint_line["line-opacity"]),"line-color":new bn(fe.paint_line["line-color"]),"line-translate":new Cn(fe.paint_line["line-translate"]),"line-translate-anchor":new Cn(fe.paint_line["line-translate-anchor"]),"line-width":new bn(fe.paint_line["line-width"]),"line-gap-width":new bn(fe.paint_line["line-gap-width"]),"line-offset":new bn(fe.paint_line["line-offset"]),"line-blur":new bn(fe.paint_line["line-blur"]),"line-dasharray":new is(fe.paint_line["line-dasharray"]),"line-pattern":new Dc(fe.paint_line["line-pattern"]),"line-gradient":new as(fe.paint_line["line-gradient"])}),layout:gc},Rs=new(function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,h){return h=new wi(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,s,h)},a.prototype.evaluate=function(s,h,d,_){return h=ht({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,s,h,d,_)},a}(bn))(lo.paint.properties["line-width"].specification);Rs.useIntegerZoom=!0;var Oh=function(t){function a(s){t.call(this,s,lo),this.gradientVersion=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof gs,this.gradientVersion=(this.gradientVersion+1)%Le)},a.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},a.prototype.recalculate=function(s,h){t.prototype.recalculate.call(this,s,h),this.paint._values["line-floorwidth"]=Rs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)},a.prototype.createBucket=function(s){return new ea(s)},a.prototype.queryRadius=function(s){var h=s,d=Qh(gu("line-width",this,h),gu("line-gap-width",this,h)),_=gu("line-offset",this,h);return d/2+Math.abs(_)+yo(this.paint.get("line-translate"))},a.prototype.queryIntersectsFeature=function(s,h,d,_,S,M,k){var z=yu(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,k),V=k/2*Qh(this.paint.get("line-width").evaluate(h,d),this.paint.get("line-gap-width").evaluate(h,d)),H=this.paint.get("line-offset").evaluate(h,d);return H&&(_=function(ee,se){for(var Me=[],Oe=new re(0,0),Ke=0;Ke<ee.length;Ke++){for(var ze=ee[Ke],ot=[],xt=0;xt<ze.length;xt++){var Bt=ze[xt],Vt=ze[xt+1],or=xt===0?Oe:Bt.sub(ze[xt-1])._unit()._perp(),Tr=xt===ze.length-1?Oe:Vt.sub(Bt)._unit()._perp(),Vr=or._add(Tr)._unit();Vr._mult(1/(Vr.x*Tr.x+Vr.y*Tr.y)),ot.push(Vr._mult(se)._add(Bt))}Me.push(ot)}return Me}(_,H*k)),function(ee,se,Me){for(var Oe=0;Oe<se.length;Oe++){var Ke=se[Oe];if(ee.length>=3){for(var ze=0;ze<Ke.length;ze++)if(ou(ee,Ke[ze]))return!0}if($s(ee,Ke,Me))return!0}return!1}(z,_,V)},a.prototype.isTileClipped=function(){return!0},a}(Fa);function Qh(t,a){return a>0?a+2*t:t}var Ed=ba([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sd=ba([{name:"a_projected_pos",components:3,type:"Float32"}],4),wd=(ba([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),ba([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),ep=(ba([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),ba([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Td=ba([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Xp(t,a,s){return t.sections.forEach(function(h){h.text=function(d,_,S){var M=_.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?d=d.toLocaleUpperCase():M==="lowercase"&&(d=d.toLocaleLowerCase()),Is.applyArabicShaping&&(d=Is.applyArabicShaping(d)),d}(h.text,a,s)}),t}ba([{name:"triangle",components:3,type:"Uint16"}]),ba([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ba([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ba([{type:"Float32",name:"offsetX"}]),ba([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var th={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Yp=function(t,a,s,h,d){var _,S,M=8*d-h-1,k=(1<<M)-1,z=k>>1,V=-7,H=s?d-1:0,ee=s?-1:1,se=t[a+H];for(H+=ee,_=se&(1<<-V)-1,se>>=-V,V+=M;V>0;_=256*_+t[a+H],H+=ee,V-=8);for(S=_&(1<<-V)-1,_>>=-V,V+=h;V>0;S=256*S+t[a+H],H+=ee,V-=8);if(_===0)_=1-z;else{if(_===k)return S?NaN:1/0*(se?-1:1);S+=Math.pow(2,h),_-=z}return(se?-1:1)*S*Math.pow(2,_-h)},tp=function(t,a,s,h,d,_){var S,M,k,z=8*_-d-1,V=(1<<z)-1,H=V>>1,ee=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,se=h?0:_-1,Me=h?1:-1,Oe=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(M=isNaN(a)?1:0,S=V):(S=Math.floor(Math.log(a)/Math.LN2),a*(k=Math.pow(2,-S))<1&&(S--,k*=2),(a+=S+H>=1?ee/k:ee*Math.pow(2,1-H))*k>=2&&(S++,k/=2),S+H>=V?(M=0,S=V):S+H>=1?(M=(a*k-1)*Math.pow(2,d),S+=H):(M=a*Math.pow(2,H-1)*Math.pow(2,d),S=0));d>=8;t[s+se]=255&M,se+=Me,M/=256,d-=8);for(S=S<<d|M,z+=d;z>0;t[s+se]=255&S,se+=Me,S/=256,z-=8);t[s+se-Me]|=128*Oe},rh=Ia;function Ia(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ia.Varint=0,Ia.Fixed64=1,Ia.Bytes=2,Ia.Fixed32=5;var rp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Ul(t){return t.type===Ia.Bytes?t.readVarint()+t.pos:t.pos+1}function Tf(t,a,s){return s?4294967296*a+(t>>>0):4294967296*(a>>>0)+(t>>>0)}function Rh(t,a,s){var h=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));s.realloc(h);for(var d=s.pos-1;d>=t;d--)s.buf[d+h]=s.buf[d]}function Kp(t,a){for(var s=0;s<t.length;s++)a.writeVarint(t[s])}function B(t,a){for(var s=0;s<t.length;s++)a.writeSVarint(t[s])}function me(t,a){for(var s=0;s<t.length;s++)a.writeFloat(t[s])}function Ne(t,a){for(var s=0;s<t.length;s++)a.writeDouble(t[s])}function It(t,a){for(var s=0;s<t.length;s++)a.writeBoolean(t[s])}function ar(t,a){for(var s=0;s<t.length;s++)a.writeFixed32(t[s])}function Mt(t,a){for(var s=0;s<t.length;s++)a.writeSFixed32(t[s])}function Jt(t,a){for(var s=0;s<t.length;s++)a.writeFixed64(t[s])}function lr(t,a){for(var s=0;s<t.length;s++)a.writeSFixed64(t[s])}function vr(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+16777216*t[a+3]}function _r(t,a,s){t[s]=a,t[s+1]=a>>>8,t[s+2]=a>>>16,t[s+3]=a>>>24}function wr(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+(t[a+3]<<24)}function Ar(t,a,s){t===1&&s.readMessage(Ur,a)}function Ur(t,a,s){if(t===3){var h=s.readMessage(gr,{}),d=h.width,_=h.height,S=h.left,M=h.top,k=h.advance;a.push({id:h.id,bitmap:new uu({width:d+6,height:_+6},h.bitmap),metrics:{width:d,height:_,left:S,top:M,advance:k}})}}function gr(t,a,s){t===1?a.id=s.readVarint():t===2?a.bitmap=s.readBytes():t===3?a.width=s.readVarint():t===4?a.height=s.readVarint():t===5?a.left=s.readSVarint():t===6?a.top=s.readSVarint():t===7&&(a.advance=s.readVarint())}function Er(t){for(var a=0,s=0,h=0,d=t;h<d.length;h+=1){var _=d[h];a+=_.w*_.h,s=Math.max(s,_.w)}t.sort(function(Oe,Ke){return Ke.h-Oe.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),s),h:1/0}],M=0,k=0,z=0,V=t;z<V.length;z+=1)for(var H=V[z],ee=S.length-1;ee>=0;ee--){var se=S[ee];if(!(H.w>se.w||H.h>se.h)){if(H.x=se.x,H.y=se.y,k=Math.max(k,H.y+H.h),M=Math.max(M,H.x+H.w),H.w===se.w&&H.h===se.h){var Me=S.pop();ee<S.length&&(S[ee]=Me)}else H.h===se.h?(se.x+=H.w,se.w-=H.w):H.w===se.w?(se.y+=H.h,se.h-=H.h):(S.push({x:se.x+H.w,y:se.y,w:se.w-H.w,h:H.h}),se.y+=H.h,se.h-=H.h);break}}return{w:M,h:k,fill:a/(M*k)||0}}Ia.prototype={destroy:function(){this.buf=null},readFields:function(t,a,s){for(s=s||this.length;this.pos<s;){var h=this.readVarint(),d=h>>3,_=this.pos;this.type=7&h,t(d,a,this),this.pos===_&&this.skip(h)}return a},readMessage:function(t,a){return this.readFields(t,a,this.readVarint()+this.pos)},readFixed32:function(){var t=vr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=wr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=vr(this.buf,this.pos)+4294967296*vr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=vr(this.buf,this.pos)+4294967296*wr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Yp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Yp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var a,s,h=this.buf;return a=127&(s=h[this.pos++]),s<128?a:(a|=(127&(s=h[this.pos++]))<<7,s<128?a:(a|=(127&(s=h[this.pos++]))<<14,s<128?a:(a|=(127&(s=h[this.pos++]))<<21,s<128?a:function(d,_,S){var M,k,z=S.buf;if(M=(112&(k=z[S.pos++]))>>4,k<128||(M|=(127&(k=z[S.pos++]))<<3,k<128)||(M|=(127&(k=z[S.pos++]))<<10,k<128)||(M|=(127&(k=z[S.pos++]))<<17,k<128)||(M|=(127&(k=z[S.pos++]))<<24,k<128)||(M|=(1&(k=z[S.pos++]))<<31,k<128))return Tf(d,M,_);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(s=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,a=this.pos;return this.pos=t,t-a>=12&&rp?function(s,h,d){return rp.decode(s.subarray(h,d))}(this.buf,a,t):function(s,h,d){for(var _="",S=h;S<d;){var M,k,z,V=s[S],H=null,ee=V>239?4:V>223?3:V>191?2:1;if(S+ee>d)break;ee===1?V<128&&(H=V):ee===2?(192&(M=s[S+1]))==128&&(H=(31&V)<<6|63&M)<=127&&(H=null):ee===3?(k=s[S+2],(192&(M=s[S+1]))==128&&(192&k)==128&&((H=(15&V)<<12|(63&M)<<6|63&k)<=2047||H>=55296&&H<=57343)&&(H=null)):ee===4&&(k=s[S+2],z=s[S+3],(192&(M=s[S+1]))==128&&(192&k)==128&&(192&z)==128&&((H=(15&V)<<18|(63&M)<<12|(63&k)<<6|63&z)<=65535||H>=1114112)&&(H=null)),H===null?(H=65533,ee=1):H>65535&&(H-=65536,_+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),_+=String.fromCharCode(H),S+=ee}return _}(this.buf,a,t)},readBytes:function(){var t=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,t);return this.pos=t,a},readPackedVarint:function(t,a){if(this.type!==Ia.Bytes)return t.push(this.readVarint(a));var s=Ul(this);for(t=t||[];this.pos<s;)t.push(this.readVarint(a));return t},readPackedSVarint:function(t){if(this.type!==Ia.Bytes)return t.push(this.readSVarint());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ia.Bytes)return t.push(this.readBoolean());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ia.Bytes)return t.push(this.readFloat());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ia.Bytes)return t.push(this.readDouble());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ia.Bytes)return t.push(this.readFixed32());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ia.Bytes)return t.push(this.readSFixed32());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ia.Bytes)return t.push(this.readFixed64());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ia.Bytes)return t.push(this.readSFixed64());var a=Ul(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed64());return t},skip:function(t){var a=7&t;if(a===Ia.Varint)for(;this.buf[this.pos++]>127;);else if(a===Ia.Bytes)this.pos=this.readVarint()+this.pos;else if(a===Ia.Fixed32)this.pos+=4;else{if(a!==Ia.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(t,a){this.writeVarint(t<<3|a)},realloc:function(t){for(var a=this.length||16;a<this.pos+t;)a*=2;if(a!==this.length){var s=new Uint8Array(a);s.set(this.buf),this.buf=s,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),_r(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),_r(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),_r(this.buf,-1&t,this.pos),_r(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),_r(this.buf,-1&t,this.pos),_r(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(a,s){var h,d;if(a>=0?(h=a%4294967296|0,d=a/4294967296|0):(d=~(-a/4294967296),4294967295^(h=~(-a%4294967296))?h=h+1|0:(h=0,d=d+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(_,S,M){M.buf[M.pos++]=127&_|128,_>>>=7,M.buf[M.pos++]=127&_|128,_>>>=7,M.buf[M.pos++]=127&_|128,_>>>=7,M.buf[M.pos++]=127&_|128,M.buf[M.pos]=127&(_>>>=7)}(h,0,s),function(_,S){var M=(7&_)<<4;S.buf[S.pos++]|=M|((_>>>=3)?128:0),_&&(S.buf[S.pos++]=127&_|((_>>>=7)?128:0),_&&(S.buf[S.pos++]=127&_|((_>>>=7)?128:0),_&&(S.buf[S.pos++]=127&_|((_>>>=7)?128:0),_&&(S.buf[S.pos++]=127&_|((_>>>=7)?128:0),_&&(S.buf[S.pos++]=127&_)))))}(d,s)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var a=this.pos;this.pos=function(h,d,_){for(var S,M,k=0;k<d.length;k++){if((S=d.charCodeAt(k))>55295&&S<57344){if(!M){S>56319||k+1===d.length?(h[_++]=239,h[_++]=191,h[_++]=189):M=S;continue}if(S<56320){h[_++]=239,h[_++]=191,h[_++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(h[_++]=239,h[_++]=191,h[_++]=189,M=null);S<128?h[_++]=S:(S<2048?h[_++]=S>>6|192:(S<65536?h[_++]=S>>12|224:(h[_++]=S>>18|240,h[_++]=S>>12&63|128),h[_++]=S>>6&63|128),h[_++]=63&S|128)}return _}(this.buf,t,this.pos);var s=this.pos-a;s>=128&&Rh(a,s,this),this.pos=a-1,this.writeVarint(s),this.pos+=s},writeFloat:function(t){this.realloc(4),tp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),tp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var a=t.length;this.writeVarint(a),this.realloc(a);for(var s=0;s<a;s++)this.buf[this.pos++]=t[s]},writeRawMessage:function(t,a){this.pos++;var s=this.pos;t(a,this);var h=this.pos-s;h>=128&&Rh(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,a,s){this.writeTag(t,Ia.Bytes),this.writeRawMessage(a,s)},writePackedVarint:function(t,a){a.length&&this.writeMessage(t,Kp,a)},writePackedSVarint:function(t,a){a.length&&this.writeMessage(t,B,a)},writePackedBoolean:function(t,a){a.length&&this.writeMessage(t,It,a)},writePackedFloat:function(t,a){a.length&&this.writeMessage(t,me,a)},writePackedDouble:function(t,a){a.length&&this.writeMessage(t,Ne,a)},writePackedFixed32:function(t,a){a.length&&this.writeMessage(t,ar,a)},writePackedSFixed32:function(t,a){a.length&&this.writeMessage(t,Mt,a)},writePackedFixed64:function(t,a){a.length&&this.writeMessage(t,Jt,a)},writePackedSFixed64:function(t,a){a.length&&this.writeMessage(t,lr,a)},writeBytesField:function(t,a){this.writeTag(t,Ia.Bytes),this.writeBytes(a)},writeFixed32Field:function(t,a){this.writeTag(t,Ia.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(t,a){this.writeTag(t,Ia.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(t,a){this.writeTag(t,Ia.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(t,a){this.writeTag(t,Ia.Fixed64),this.writeSFixed64(a)},writeVarintField:function(t,a){this.writeTag(t,Ia.Varint),this.writeVarint(a)},writeSVarintField:function(t,a){this.writeTag(t,Ia.Varint),this.writeSVarint(a)},writeStringField:function(t,a){this.writeTag(t,Ia.Bytes),this.writeString(a)},writeFloatField:function(t,a){this.writeTag(t,Ia.Fixed32),this.writeFloat(a)},writeDoubleField:function(t,a){this.writeTag(t,Ia.Fixed64),this.writeDouble(a)},writeBooleanField:function(t,a){this.writeVarintField(t,Boolean(a))}};var st=function(t,a){var s=a.pixelRatio,h=a.version,d=a.stretchX,_=a.stretchY,S=a.content;this.paddedRect=t,this.pixelRatio=s,this.stretchX=d,this.stretchY=_,this.content=S,this.version=h},Zt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Zt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Zt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Zt.tlbr.get=function(){return this.tl.concat(this.br)},Zt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(st.prototype,Zt);var yr=function(t,a){var s={},h={};this.haveRenderCallbacks=[];var d=[];this.addImages(t,s,d),this.addImages(a,h,d);var _=Er(d),S=new To({width:_.w||1,height:_.h||1});for(var M in t){var k=t[M],z=s[M].paddedRect;To.copy(k.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},k.data)}for(var V in a){var H=a[V],ee=h[V].paddedRect,se=ee.x+1,Me=ee.y+1,Oe=H.data.width,Ke=H.data.height;To.copy(H.data,S,{x:0,y:0},{x:se,y:Me},H.data),To.copy(H.data,S,{x:0,y:Ke-1},{x:se,y:Me-1},{width:Oe,height:1}),To.copy(H.data,S,{x:0,y:0},{x:se,y:Me+Ke},{width:Oe,height:1}),To.copy(H.data,S,{x:Oe-1,y:0},{x:se-1,y:Me},{width:1,height:Ke}),To.copy(H.data,S,{x:0,y:0},{x:se+Oe,y:Me},{width:1,height:Ke})}this.image=S,this.iconPositions=s,this.patternPositions=h};yr.prototype.addImages=function(t,a,s){for(var h in t){var d=t[h],_={x:0,y:0,w:d.data.width+2,h:d.data.height+2};s.push(_),a[h]=new st(_,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},yr.prototype.patchUpdatedImages=function(t,a){for(var s in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),a),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),a)},yr.prototype.patchUpdatedImage=function(t,a,s){if(t&&a&&t.version!==a.version){t.version=a.version;var h=t.tl;s.update(a.data,void 0,{x:h[0],y:h[1]})}},fn("ImagePosition",st),fn("ImageAtlas",yr);var Dr={horizontal:1,vertical:2,horizontalOnly:3},ur=function(){this.scale=1,this.fontStack="",this.imageName=null};ur.forText=function(t,a){var s=new ur;return s.scale=t||1,s.fontStack=a,s},ur.forImage=function(t){var a=new ur;return a.imageName=t,a};var Mr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Xr(t,a,s,h,d,_,S,M,k,z,V,H,ee,se,Me,Oe){var Ke,ze=Mr.fromFeature(t,d);H===Dr.vertical&&ze.verticalizePunctuation();var ot=Is.processBidirectionalText,xt=Is.processStyledBidirectionalText;if(ot&&ze.sections.length===1){Ke=[];for(var Bt=0,Vt=ot(ze.toString(),Yr(ze,z,_,a,h,se,Me));Bt<Vt.length;Bt+=1){var or=Vt[Bt],Tr=new Mr;Tr.text=or,Tr.sections=ze.sections;for(var Vr=0;Vr<or.length;Vr++)Tr.sectionIndex.push(0);Ke.push(Tr)}}else if(xt){Ke=[];for(var Mn=0,sn=xt(ze.text,ze.sectionIndex,Yr(ze,z,_,a,h,se,Me));Mn<sn.length;Mn+=1){var Zn=sn[Mn],ln=new Mr;ln.text=Zn[0],ln.sectionIndex=Zn[1],ln.sections=ze.sections,Ke.push(ln)}}else Ke=function(An,Ti){for(var Si=[],ta=An.text,Nn=0,ha=0,$a=Ti;ha<$a.length;ha+=1){var vo=$a[ha];Si.push(An.substring(Nn,vo)),Nn=vo}return Nn<ta.length&&Si.push(An.substring(Nn,ta.length)),Si}(ze,Yr(ze,z,_,a,h,se,Me));var Li=[],Yn={positionedLines:Li,text:ze.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(An,Ti,Si,ta,Nn,ha,$a,vo,ao,Ja,mo,zo){for(var fs=0,Vs=-17,hs=0,Ds=0,Io=vo==="right"?1:vo==="left"?0:.5,es=0,Hi=0,Ra=Nn;Hi<Ra.length;Hi+=1){var Sa=Ra[Hi];Sa.trim();var ra=Sa.getMaxScale(),js=24*(ra-1),ws={positionedGlyphs:[],lineOffset:0};An.positionedLines[es]=ws;var Ga=ws.positionedGlyphs,Oo=0;if(Sa.length()){for(var Ts=0;Ts<Sa.length();Ts++){var pa=Sa.getSection(Ts),jl=Sa.getSectionIndex(Ts),bu=Sa.getCharCode(Ts),Gl=0,xo=null,Hl=null,Qu=null,ts=24,Cf=!(ao===Dr.horizontal||!mo&&!ff(bu)||mo&&(zn[bu]||(xc=bu,zr.Arabic(xc)||zr["Arabic Supplement"](xc)||zr["Arabic Extended-A"](xc)||zr["Arabic Presentation Forms-A"](xc)||zr["Arabic Presentation Forms-B"](xc))));if(pa.imageName){var ih=ta[pa.imageName];if(!ih)continue;Qu=pa.imageName,An.iconsInText=An.iconsInText||!0,Hl=ih.paddedRect;var _c=ih.displaySize;pa.scale=24*pa.scale/zo,Gl=js+(24-_c[1]*pa.scale),ts=(xo={width:_c[0],height:_c[1],left:1,top:-3,advance:Cf?_c[1]:_c[0]}).advance;var ah=Cf?_c[0]*pa.scale-24*ra:_c[1]*pa.scale-24*ra;ah>0&&ah>Oo&&(Oo=ah)}else{var ap=Si[pa.fontStack],oh=ap&&ap[bu];if(oh&&oh.rect)Hl=oh.rect,xo=oh.metrics;else{var kh=Ti[pa.fontStack],op=kh&&kh[bu];if(!op)continue;xo=op.metrics}Gl=24*(ra-pa.scale)}Cf?(An.verticalizable=!0,Ga.push({glyph:bu,imageName:Qu,x:fs,y:Vs+Gl,vertical:Cf,scale:pa.scale,fontStack:pa.fontStack,sectionIndex:jl,metrics:xo,rect:Hl}),fs+=ts*pa.scale+Ja):(Ga.push({glyph:bu,imageName:Qu,x:fs,y:Vs+Gl,vertical:Cf,scale:pa.scale,fontStack:pa.fontStack,sectionIndex:jl,metrics:xo,rect:Hl}),fs+=xo.advance*pa.scale+Ja)}Ga.length!==0&&(hs=Math.max(fs-Ja,hs),gi(Ga,0,Ga.length-1,Io,Oo)),fs=0;var sp=ha*ra+Oo;ws.lineOffset=Math.max(Oo,js),Vs+=sp,Ds=Math.max(sp,Ds),++es}else Vs+=ha,++es}var xc,Dh=Vs- -17,sh=Kr($a),Xc=sh.horizontalAlign,uh=sh.verticalAlign;(function(up,$p,lp,cp,Jp,Fh,fp,hp,pp){var lh,dp=($p-lp)*Jp;lh=Fh!==fp?-hp*cp- -17:(-cp*pp+.5)*fp;for(var ch=0,Yc=up;ch<Yc.length;ch+=1)for(var Mf=0,vp=Yc[ch].positionedGlyphs;Mf<vp.length;Mf+=1){var Nh=vp[Mf];Nh.x+=dp,Nh.y+=lh}})(An.positionedLines,Io,Xc,uh,hs,Ds,ha,Dh,Nn.length),An.top+=-uh*Dh,An.bottom=An.top+Dh,An.left+=-Xc*hs,An.right=An.left+hs}(Yn,a,s,h,Ke,S,M,k,H,z,ee,Oe),!function(An){for(var Ti=0,Si=An;Ti<Si.length;Ti+=1)if(Si[Ti].positionedGlyphs.length!==0)return!1;return!0}(Li)&&Yn}Mr.fromFeature=function(t,a){for(var s=new Mr,h=0;h<t.sections.length;h++){var d=t.sections[h];d.image?s.addImageSection(d):s.addTextSection(d,a)}return s},Mr.prototype.length=function(){return this.text.length},Mr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Mr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Mr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Mr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var a="",s=0;s<t.length;s++){var h=t.charCodeAt(s+1)||null,d=t.charCodeAt(s-1)||null;a+=h&&ul(h)&&!th[t[s+1]]||d&&ul(d)&&!th[t[s-1]]||!th[t[s]]?t[s]:th[t[s]]}return a}(this.text)},Mr.prototype.trim=function(){for(var t=0,a=0;a<this.text.length&&zn[this.text.charCodeAt(a)];a++)t++;for(var s=this.text.length,h=this.text.length-1;h>=0&&h>=t&&zn[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)},Mr.prototype.substring=function(t,a){var s=new Mr;return s.text=this.text.substring(t,a),s.sectionIndex=this.sectionIndex.slice(t,a),s.sections=this.sections,s},Mr.prototype.toString=function(){return this.text},Mr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(a,s){return Math.max(a,t.sections[s].scale)},0)},Mr.prototype.addTextSection=function(t,a){this.text+=t.text,this.sections.push(ur.forText(t.scale,t.fontStack||a));for(var s=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(s)},Mr.prototype.addImageSection=function(t){var a=t.image?t.image.name:"";if(a.length!==0){var s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(ur.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Je("Reached maximum number of images 6401")}else Je("Can't add FormattedSection with an empty image.")},Mr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var zn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Qt={};function rr(t,a,s,h,d,_){if(a.imageName){var S=h[a.imageName];return S?S.displaySize[0]*a.scale*24/_+d:0}var M=s[a.fontStack],k=M&&M[t];return k?k.metrics.advance*a.scale+d:0}function gn(t,a,s,h){var d=Math.pow(t-a,2);return h?t<a?d/2:2*d:d+Math.abs(s)*s}function Zr(t,a,s){var h=0;return t===10&&(h-=1e4),s&&(h+=150),t!==40&&t!==65288||(h+=50),a!==41&&a!==65289||(h+=50),h}function xr(t,a,s,h,d,_){for(var S=null,M=gn(a,s,d,_),k=0,z=h;k<z.length;k+=1){var V=z[k],H=gn(a-V.x,s,d,_)+V.badness;H<=M&&(S=V,M=H)}return{index:t,x:a,priorBreak:S,badness:M}}function Yr(t,a,s,h,d,_,S){if(_!=="point")return[];if(!t)return[];for(var M,k=[],z=function(Ke,ze,ot,xt,Bt,Vt){for(var or=0,Tr=0;Tr<Ke.length();Tr++){var Vr=Ke.getSection(Tr);or+=rr(Ke.getCharCode(Tr),Vr,xt,Bt,ze,Vt)}return or/Math.max(1,Math.ceil(or/ot))}(t,a,s,h,d,S),V=t.text.indexOf("\u200B")>=0,H=0,ee=0;ee<t.length();ee++){var se=t.getSection(ee),Me=t.getCharCode(ee);if(zn[Me]||(H+=rr(Me,se,h,d,a,S)),ee<t.length()-1){var Oe=!((M=Me)<11904||!(zr["Bopomofo Extended"](M)||zr.Bopomofo(M)||zr["CJK Compatibility Forms"](M)||zr["CJK Compatibility Ideographs"](M)||zr["CJK Compatibility"](M)||zr["CJK Radicals Supplement"](M)||zr["CJK Strokes"](M)||zr["CJK Symbols and Punctuation"](M)||zr["CJK Unified Ideographs Extension A"](M)||zr["CJK Unified Ideographs"](M)||zr["Enclosed CJK Letters and Months"](M)||zr["Halfwidth and Fullwidth Forms"](M)||zr.Hiragana(M)||zr["Ideographic Description Characters"](M)||zr["Kangxi Radicals"](M)||zr["Katakana Phonetic Extensions"](M)||zr.Katakana(M)||zr["Vertical Forms"](M)||zr["Yi Radicals"](M)||zr["Yi Syllables"](M)));(Qt[Me]||Oe||se.imageName)&&k.push(xr(ee+1,H,z,k,Zr(Me,t.getCharCode(ee+1),Oe&&V),!1))}}return function Ke(ze){return ze?Ke(ze.priorBreak).concat(ze.index):[]}(xr(t.length(),H,z,k,0,!0))}function Kr(t){var a=.5,s=.5;switch(t){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:a,verticalAlign:s}}function gi(t,a,s,h,d){if(h||d)for(var _=t[s],S=(t[s].x+_.metrics.advance*_.scale)*h,M=a;M<=s;M++)t[M].x-=S,t[M].y+=d}function ni(t,a,s,h,d,_){var S,M=t.image;if(M.content){var k=M.content,z=M.pixelRatio||1;S=[k[0]/z,k[1]/z,M.displaySize[0]-k[2]/z,M.displaySize[1]-k[3]/z]}var V,H,ee,se,Me=a.left*_,Oe=a.right*_;s==="width"||s==="both"?(se=d[0]+Me-h[3],H=d[0]+Oe+h[1]):H=(se=d[0]+(Me+Oe-M.displaySize[0])/2)+M.displaySize[0];var Ke=a.top*_,ze=a.bottom*_;return s==="height"||s==="both"?(V=d[1]+Ke-h[0],ee=d[1]+ze+h[2]):ee=(V=d[1]+(Ke+ze-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:V,right:H,bottom:ee,left:se,collisionPadding:S}}Qt[10]=!0,Qt[32]=!0,Qt[38]=!0,Qt[40]=!0,Qt[41]=!0,Qt[43]=!0,Qt[45]=!0,Qt[47]=!0,Qt[173]=!0,Qt[183]=!0,Qt[8203]=!0,Qt[8208]=!0,Qt[8211]=!0,Qt[8231]=!0;var Hr=function(t){function a(s,h,d,_){t.call(this,s,h),this.angle=d,_!==void 0&&(this.segment=_)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.clone=function(){return new a(this.x,this.y,this.angle,this.segment)},a}(re);function en(t,a){var s=a.expression;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new wi(t+1))};if(s.kind==="source")return{kind:"source"};for(var h=s.zoomStops,d=s.interpolationType,_=0;_<h.length&&h[_]<=t;)_++;for(var S=_=Math.max(0,_-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var M=h[_],k=h[S];return s.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:k,interpolationType:d}:{kind:"camera",minZoom:M,maxZoom:k,minSize:s.evaluate(new wi(M)),maxSize:s.evaluate(new wi(k)),interpolationType:d}}function Jn(t,a,s){var h=a.uSize,d=s.lowerSize;return t.kind==="source"?d/128:t.kind==="composite"?ga(d/128,s.upperSize/128,a.uSizeT):h}function ui(t,a){var s=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var d=t.interpolationType,_=d?Rt(_e.interpolationFactor(d,a,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=ga(t.minSize,t.maxSize,_):s=_}return{uSizeT:s,uSize:h}}fn("Anchor",Hr);var Ni=Object.freeze({__proto__:null,getSizeData:en,evaluateSizeForFeature:Jn,evaluateSizeForZoom:ui,SIZE_PACK_FACTOR:128});function qa(t,a,s,h,d){if(a.segment===void 0)return!0;for(var _=a,S=a.segment+1,M=0;M>-s/2;){if(--S<0)return!1;M-=t[S].dist(_),_=t[S]}M+=t[S].dist(t[S+1]),S++;for(var k=[],z=0;M<s/2;){var V=t[S],H=t[S+1];if(!H)return!1;var ee=t[S-1].angleTo(V)-V.angleTo(H);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:M,angleDelta:ee}),z+=ee;M-k[0].distance>h;)z-=k.shift().angleDelta;if(z>d)return!1;S++,M+=V.dist(H)}return!0}function io(t){for(var a=0,s=0;s<t.length-1;s++)a+=t[s].dist(t[s+1]);return a}function Ri(t,a,s){return t?.6*a*s:0}function Jo(t,a){return Math.max(t?t.right-t.left:0,a?a.right-a.left:0)}function ja(t,a,s,h,d,_){for(var S=Ri(s,d,_),M=Jo(s,h)*_,k=0,z=io(t)/2,V=0;V<t.length-1;V++){var H=t[V],ee=t[V+1],se=H.dist(ee);if(k+se>z){var Me=(z-k)/se,Oe=ga(H.x,ee.x,Me),Ke=ga(H.y,ee.y,Me),ze=new Hr(Oe,Ke,ee.angleTo(H),V);return ze._round(),!S||qa(t,ze,M,S,a)?ze:void 0}k+=se}}function Wo(t,a,s,h,d,_,S,M,k){var z=Ri(h,_,S),V=Jo(h,d),H=V*S,ee=t[0].x===0||t[0].x===k||t[0].y===0||t[0].y===k;return a-H<a/4&&(a=H+a/4),function se(Me,Oe,Ke,ze,ot,xt,Bt,Vt,or){for(var Tr=xt/2,Vr=io(Me),Mn=0,sn=Oe-Ke,Zn=[],ln=0;ln<Me.length-1;ln++){for(var Li=Me[ln],Yn=Me[ln+1],An=Li.dist(Yn),Ti=Yn.angleTo(Li);sn+Ke<Mn+An;){var Si=((sn+=Ke)-Mn)/An,ta=ga(Li.x,Yn.x,Si),Nn=ga(Li.y,Yn.y,Si);if(ta>=0&&ta<or&&Nn>=0&&Nn<or&&sn-Tr>=0&&sn+Tr<=Vr){var ha=new Hr(ta,Nn,Ti,ln);ha._round(),ze&&!qa(Me,ha,xt,ze,ot)||Zn.push(ha)}}Mn+=An}return Vt||Zn.length||Bt||(Zn=se(Me,Mn/2,Ke,ze,ot,xt,Bt,!0,or)),Zn}(t,ee?a/2*M%a:(V/2+2*_)*S*M%a,a,z,s,H,ee,!1,k)}function Rn(t,a,s,h,d){for(var _=[],S=0;S<t.length;S++)for(var M=t[S],k=void 0,z=0;z<M.length-1;z++){var V=M[z],H=M[z+1];V.x<a&&H.x<a||(V.x<a?V=new re(a,V.y+(a-V.x)/(H.x-V.x)*(H.y-V.y))._round():H.x<a&&(H=new re(a,V.y+(a-V.x)/(H.x-V.x)*(H.y-V.y))._round()),V.y<s&&H.y<s||(V.y<s?V=new re(V.x+(s-V.y)/(H.y-V.y)*(H.x-V.x),s)._round():H.y<s&&(H=new re(V.x+(s-V.y)/(H.y-V.y)*(H.x-V.x),s)._round()),V.x>=h&&H.x>=h||(V.x>=h?V=new re(h,V.y+(h-V.x)/(H.x-V.x)*(H.y-V.y))._round():H.x>=h&&(H=new re(h,V.y+(h-V.x)/(H.x-V.x)*(H.y-V.y))._round()),V.y>=d&&H.y>=d||(V.y>=d?V=new re(V.x+(d-V.y)/(H.y-V.y)*(H.x-V.x),d)._round():H.y>=d&&(H=new re(V.x+(d-V.y)/(H.y-V.y)*(H.x-V.x),d)._round()),k&&V.equals(k[k.length-1])||_.push(k=[V]),k.push(H)))))}return _}function Fn(t,a,s,h){var d=[],_=t.image,S=_.pixelRatio,M=_.paddedRect.w-2,k=_.paddedRect.h-2,z=t.right-t.left,V=t.bottom-t.top,H=_.stretchX||[[0,M]],ee=_.stretchY||[[0,k]],se=function(ta,Nn){return ta+Nn[1]-Nn[0]},Me=H.reduce(se,0),Oe=ee.reduce(se,0),Ke=M-Me,ze=k-Oe,ot=0,xt=Me,Bt=0,Vt=Oe,or=0,Tr=Ke,Vr=0,Mn=ze;if(_.content&&h){var sn=_.content;ot=Ao(H,0,sn[0]),Bt=Ao(ee,0,sn[1]),xt=Ao(H,sn[0],sn[2]),Vt=Ao(ee,sn[1],sn[3]),or=sn[0]-ot,Vr=sn[1]-Bt,Tr=sn[2]-sn[0]-xt,Mn=sn[3]-sn[1]-Vt}var Zn=function(ta,Nn,ha,$a){var vo=co(ta.stretch-ot,xt,z,t.left),ao=xi(ta.fixed-or,Tr,ta.stretch,Me),Ja=co(Nn.stretch-Bt,Vt,V,t.top),mo=xi(Nn.fixed-Vr,Mn,Nn.stretch,Oe),zo=co(ha.stretch-ot,xt,z,t.left),fs=xi(ha.fixed-or,Tr,ha.stretch,Me),Vs=co($a.stretch-Bt,Vt,V,t.top),hs=xi($a.fixed-Vr,Mn,$a.stretch,Oe),Ds=new re(vo,Ja),Io=new re(zo,Ja),es=new re(zo,Vs),Hi=new re(vo,Vs),Ra=new re(ao/S,mo/S),Sa=new re(fs/S,hs/S),ra=a*Math.PI/180;if(ra){var js=Math.sin(ra),ws=Math.cos(ra),Ga=[ws,-js,js,ws];Ds._matMult(Ga),Io._matMult(Ga),Hi._matMult(Ga),es._matMult(Ga)}var Oo=ta.stretch+ta.fixed,Ts=Nn.stretch+Nn.fixed;return{tl:Ds,tr:Io,bl:Hi,br:es,tex:{x:_.paddedRect.x+1+Oo,y:_.paddedRect.y+1+Ts,w:ha.stretch+ha.fixed-Oo,h:$a.stretch+$a.fixed-Ts},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ra,pixelOffsetBR:Sa,minFontScaleX:Tr/S/z,minFontScaleY:Mn/S/V,isSDF:s}};if(h&&(_.stretchX||_.stretchY))for(var ln=Ss(H,Ke,Me),Li=Ss(ee,ze,Oe),Yn=0;Yn<ln.length-1;Yn++)for(var An=ln[Yn],Ti=ln[Yn+1],Si=0;Si<Li.length-1;Si++)d.push(Zn(An,Li[Si],Ti,Li[Si+1]));else d.push(Zn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:k+1}));return d}function Ao(t,a,s){for(var h=0,d=0,_=t;d<_.length;d+=1){var S=_[d];h+=Math.max(a,Math.min(s,S[1]))-Math.max(a,Math.min(s,S[0]))}return h}function Ss(t,a,s){for(var h=[{fixed:-1,stretch:0}],d=0,_=t;d<_.length;d+=1){var S=_[d],M=S[0],k=S[1],z=h[h.length-1];h.push({fixed:M-z.stretch,stretch:z.stretch}),h.push({fixed:M-z.stretch,stretch:z.stretch+(k-M)})}return h.push({fixed:a+1,stretch:s}),h}function co(t,a,s,h){return t/a*s+h}function xi(t,a,s,h){return t-a*s/h}var Xo=function(t,a,s,h,d,_,S,M,k,z){if(this.boxStartIndex=t.length,k){var V=_.top,H=_.bottom,ee=_.collisionPadding;ee&&(V-=ee[1],H+=ee[3]);var se=H-V;se>0&&(se=Math.max(10,se),this.circleDiameter=se)}else{var Me=_.top*S-M,Oe=_.bottom*S+M,Ke=_.left*S-M,ze=_.right*S+M,ot=_.collisionPadding;if(ot&&(Ke-=ot[0]*S,Me-=ot[1]*S,ze+=ot[2]*S,Oe+=ot[3]*S),z){var xt=new re(Ke,Me),Bt=new re(ze,Me),Vt=new re(Ke,Oe),or=new re(ze,Oe),Tr=z*Math.PI/180;xt._rotate(Tr),Bt._rotate(Tr),Vt._rotate(Tr),or._rotate(Tr),Ke=Math.min(xt.x,Bt.x,Vt.x,or.x),ze=Math.max(xt.x,Bt.x,Vt.x,or.x),Me=Math.min(xt.y,Bt.y,Vt.y,or.y),Oe=Math.max(xt.y,Bt.y,Vt.y,or.y)}t.emplaceBack(a.x,a.y,Ke,Me,ze,Oe,s,h,d)}this.boxEndIndex=t.length},sa=function(t,a){if(t===void 0&&(t=[]),a===void 0&&(a=ls),this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function ls(t,a){return t<a?-1:t>a?1:0}function ii(t,a,s){a===void 0&&(a=1),s===void 0&&(s=!1);for(var h=1/0,d=1/0,_=-1/0,S=-1/0,M=t[0],k=0;k<M.length;k++){var z=M[k];(!k||z.x<h)&&(h=z.x),(!k||z.y<d)&&(d=z.y),(!k||z.x>_)&&(_=z.x),(!k||z.y>S)&&(S=z.y)}var V=Math.min(_-h,S-d),H=V/2,ee=new sa([],Zi);if(V===0)return new re(h,d);for(var se=h;se<_;se+=V)for(var Me=d;Me<S;Me+=V)ee.push(new ya(se+H,Me+H,H,t));for(var Oe=function(ot){for(var xt=0,Bt=0,Vt=0,or=ot[0],Tr=0,Vr=or.length,Mn=Vr-1;Tr<Vr;Mn=Tr++){var sn=or[Tr],Zn=or[Mn],ln=sn.x*Zn.y-Zn.x*sn.y;Bt+=(sn.x+Zn.x)*ln,Vt+=(sn.y+Zn.y)*ln,xt+=3*ln}return new ya(Bt/xt,Vt/xt,0,ot)}(t),Ke=ee.length;ee.length;){var ze=ee.pop();(ze.d>Oe.d||!Oe.d)&&(Oe=ze,s&&console.log("found best %d after %d probes",Math.round(1e4*ze.d)/1e4,Ke)),ze.max-Oe.d<=a||(ee.push(new ya(ze.p.x-(H=ze.h/2),ze.p.y-H,H,t)),ee.push(new ya(ze.p.x+H,ze.p.y-H,H,t)),ee.push(new ya(ze.p.x-H,ze.p.y+H,H,t)),ee.push(new ya(ze.p.x+H,ze.p.y+H,H,t)),Ke+=4)}return s&&(console.log("num probes: "+Ke),console.log("best distance: "+Oe.d)),Oe.p}function Zi(t,a){return a.max-t.max}function ya(t,a,s,h){this.p=new re(t,a),this.h=s,this.d=function(d,_){for(var S=!1,M=1/0,k=0;k<_.length;k++)for(var z=_[k],V=0,H=z.length,ee=H-1;V<H;ee=V++){var se=z[V],Me=z[ee];se.y>d.y!=Me.y>d.y&&d.x<(Me.x-se.x)*(d.y-se.y)/(Me.y-se.y)+se.x&&(S=!S),M=Math.min(M,vl(d,se,Me))}return(S?1:-1)*Math.sqrt(M)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}sa.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},sa.prototype.pop=function(){if(this.length!==0){var t=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),t}},sa.prototype.peek=function(){return this.data[0]},sa.prototype._up=function(t){for(var a=this.data,s=this.compare,h=a[t];t>0;){var d=t-1>>1,_=a[d];if(s(h,_)>=0)break;a[t]=_,t=d}a[t]=h},sa.prototype._down=function(t){for(var a=this.data,s=this.compare,h=this.length>>1,d=a[t];t<h;){var _=1+(t<<1),S=a[_],M=_+1;if(M<this.length&&s(a[M],S)<0&&(_=M,S=a[M]),s(S,d)>=0)break;a[t]=S,t=_}a[t]=d};var Co=Number.POSITIVE_INFINITY;function Zl(t,a){return a[1]!==Co?function(s,h,d){var _=0,S=0;switch(h=Math.abs(h),d=Math.abs(d),s){case"top-right":case"top-left":case"top":S=d-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-d}switch(s){case"top-right":case"bottom-right":case"right":_=-h;break;case"top-left":case"bottom-left":case"left":_=h}return[_,S]}(t,a[0],a[1]):function(s,h){var d=0,_=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(s){case"top-right":case"top-left":_=S-7;break;case"bottom-right":case"bottom-left":_=7-S;break;case"bottom":_=7-h;break;case"top":_=h-7}switch(s){case"top-right":case"bottom-right":d=-S;break;case"top-left":case"bottom-left":d=S;break;case"left":d=h;break;case"right":d=-h}return[d,_]}(t,a[0])}function Ce(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Nt(t,a,s,h,d,_,S,M,k,z,V,H,ee,se,Me){var Oe=function(Bt,Vt,or,Tr,Vr,Mn,sn,Zn){for(var ln=Tr.layout.get("text-rotate").evaluate(Mn,{})*Math.PI/180,Li=[],Yn=0,An=Vt.positionedLines;Yn<An.length;Yn+=1)for(var Ti=An[Yn],Si=0,ta=Ti.positionedGlyphs;Si<ta.length;Si+=1){var Nn=ta[Si];if(Nn.rect){var ha=Nn.rect||{},$a=4,vo=!0,ao=1,Ja=0,mo=(Vr||Zn)&&Nn.vertical,zo=Nn.metrics.advance*Nn.scale/2;if(Zn&&Vt.verticalizable&&(Ja=Ti.lineOffset/2-(Nn.imageName?-(24-Nn.metrics.width*Nn.scale)/2:24*(Nn.scale-1))),Nn.imageName){var fs=sn[Nn.imageName];vo=fs.sdf,$a=1/(ao=fs.pixelRatio)}var Vs=Vr?[Nn.x+zo,Nn.y]:[0,0],hs=Vr?[0,0]:[Nn.x+zo+or[0],Nn.y+or[1]-Ja],Ds=[0,0];mo&&(Ds=hs,hs=[0,0]);var Io=(Nn.metrics.left-$a)*Nn.scale-zo+hs[0],es=(-Nn.metrics.top-$a)*Nn.scale+hs[1],Hi=Io+ha.w*Nn.scale/ao,Ra=es+ha.h*Nn.scale/ao,Sa=new re(Io,es),ra=new re(Hi,es),js=new re(Io,Ra),ws=new re(Hi,Ra);if(mo){var Ga=new re(-zo,zo- -17),Oo=-Math.PI/2,Ts=12-zo,pa=new re(22-Ts,-(Nn.imageName?Ts:0)),jl=new(Function.prototype.bind.apply(re,[null].concat(Ds)));Sa._rotateAround(Oo,Ga)._add(pa)._add(jl),ra._rotateAround(Oo,Ga)._add(pa)._add(jl),js._rotateAround(Oo,Ga)._add(pa)._add(jl),ws._rotateAround(Oo,Ga)._add(pa)._add(jl)}if(ln){var bu=Math.sin(ln),Gl=Math.cos(ln),xo=[Gl,-bu,bu,Gl];Sa._matMult(xo),ra._matMult(xo),js._matMult(xo),ws._matMult(xo)}var Hl=new re(0,0),Qu=new re(0,0);Li.push({tl:Sa,tr:ra,bl:js,br:ws,tex:ha,writingMode:Vt.writingMode,glyphOffset:Vs,sectionIndex:Nn.sectionIndex,isSDF:vo,pixelOffsetTL:Hl,pixelOffsetBR:Qu,minFontScaleX:0,minFontScaleY:0})}}return Li}(0,s,M,d,_,S,h,t.allowVerticalPlacement),Ke=t.textSizeData,ze=null;Ke.kind==="source"?(ze=[128*d.layout.get("text-size").evaluate(S,{})])[0]>32640&&Je(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ke.kind==="composite"&&((ze=[128*se.compositeTextSizes[0].evaluate(S,{},Me),128*se.compositeTextSizes[1].evaluate(S,{},Me)])[0]>32640||ze[1]>32640)&&Je(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Oe,ze,M,_,S,z,a,k.lineStartIndex,k.lineLength,ee,Me);for(var ot=0,xt=V;ot<xt.length;ot+=1)H[xt[ot]]=t.text.placedSymbolArray.length-1;return 4*Oe.length}function _t(t){for(var a in t)return t[a];return null}function hn(t,a,s,h){var d=t.compareText;if(a in d){for(var _=d[a],S=_.length-1;S>=0;S--)if(h.dist(_[S])<s)return!0}else d[a]=[];return d[a].push(h),!1}var Gi=Os.VectorTileFeature.types,Ee=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ue(t,a,s,h,d,_,S,M,k,z,V,H,ee){var se=M?Math.min(32640,Math.round(M[0])):0,Me=M?Math.min(32640,Math.round(M[1])):0;t.emplaceBack(a,s,Math.round(32*h),Math.round(32*d),_,S,(se<<1)+(k?1:0),Me,16*z,16*V,256*H,256*ee)}function je(t,a,s){t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s)}function lt(t){for(var a=0,s=t.sections;a<s.length;a+=1)if(hf(s[a].text))return!0;return!1}var At=function(t){this.layoutVertexArray=new Dl,this.indexArray=new hl,this.programConfigurations=t,this.segments=new he,this.dynamicLayoutVertexArray=new Yu,this.opacityVertexArray=new uc,this.placedSymbolArray=new p};At.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},At.prototype.upload=function(t,a,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ed.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Sd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ee,!0),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(t))},At.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},fn("SymbolBuffers",At);var $e=function(t,a,s){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new s,this.segments=new he,this.collisionVertexArray=new Zf};$e.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,wd.members,!0)},$e.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},fn("CollisionBuffers",$e);var Fe=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(_){return _.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Us([]),this.placementViewportMatrix=Us([]);var a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=en(this.zoom,a["text-size"]),this.iconSizeData=en(this.zoom,a["icon-size"]);var s=this.layers[0].layout,h=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(function(_){return Dr[_]})),this.stateDependentLayerIds=this.layers.filter(function(_){return _.isStateDependent()}).map(function(_){return _.id}),this.sourceID=t.sourceID};Fe.prototype.createArrays=function(){this.text=new At(new jn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new At(new jn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new C,this.lineVertexArray=new R,this.symbolInstances=new w},Fe.prototype.calculateGlyphDependencies=function(t,a,s,h,d){for(var _=0;_<t.length;_++)if(a[t.charCodeAt(_)]=!0,(s||h)&&d){var S=th[t.charAt(_)];S&&(a[S.charCodeAt(0)]=!0)}},Fe.prototype.populate=function(t,a,s){var h=this.layers[0],d=h.layout,_=d.get("text-font"),S=d.get("text-field"),M=d.get("icon-image"),k=(S.value.kind!=="constant"||S.value.value instanceof zt&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),z=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,V=d.get("symbol-sort-key");if(this.features=[],k||z){for(var H=a.iconDependencies,ee=a.glyphDependencies,se=a.availableImages,Me=new wi(this.zoom),Oe=0,Ke=t;Oe<Ke.length;Oe+=1){var ze=Ke[Oe],ot=ze.feature,xt=ze.id,Bt=ze.index,Vt=ze.sourceLayerIndex,or=h._featureFilter.needGeometry,Tr=no(ot,or);if(h._featureFilter.filter(Me,Tr,s)){or||(Tr.geometry=Va(ot));var Vr=void 0;if(k){var Mn=h.getValueAndResolveTokens("text-field",Tr,s,se),sn=zt.factory(Mn);lt(sn)&&(this.hasRTLText=!0),(!this.hasRTLText||pf()==="unavailable"||this.hasRTLText&&Is.isParsed())&&(Vr=Xp(sn,h,Tr))}var Zn=void 0;if(z){var ln=h.getValueAndResolveTokens("icon-image",Tr,s,se);Zn=ln instanceof na?ln:na.fromString(ln)}if(Vr||Zn){var Li=this.sortFeaturesByKey?V.evaluate(Tr,{},s):void 0;if(this.features.push({id:xt,text:Vr,icon:Zn,index:Bt,sourceLayerIndex:Vt,geometry:Tr.geometry,properties:ot.properties,type:Gi[ot.type],sortKey:Li}),Zn&&(H[Zn.name]=!0),Vr){var Yn=_.evaluate(Tr,{},s).join(","),An=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Dr.vertical)>=0;for(var Ti=0,Si=Vr.sections;Ti<Si.length;Ti+=1){var ta=Si[Ti];if(ta.image)H[ta.image.name]=!0;else{var Nn=oc(Vr.toString()),ha=ta.fontStack||Yn,$a=ee[ha]=ee[ha]||{};this.calculateGlyphDependencies(ta.text,$a,An,this.allowVerticalPlacement,Nn)}}}}}}d.get("symbol-placement")==="line"&&(this.features=function(vo){var ao={},Ja={},mo=[],zo=0;function fs(Ga){mo.push(vo[Ga]),zo++}function Vs(Ga,Oo,Ts){var pa=Ja[Ga];return delete Ja[Ga],Ja[Oo]=pa,mo[pa].geometry[0].pop(),mo[pa].geometry[0]=mo[pa].geometry[0].concat(Ts[0]),pa}function hs(Ga,Oo,Ts){var pa=ao[Oo];return delete ao[Oo],ao[Ga]=pa,mo[pa].geometry[0].shift(),mo[pa].geometry[0]=Ts[0].concat(mo[pa].geometry[0]),pa}function Ds(Ga,Oo,Ts){var pa=Ts?Oo[0][Oo[0].length-1]:Oo[0][0];return Ga+":"+pa.x+":"+pa.y}for(var Io=0;Io<vo.length;Io++){var es=vo[Io],Hi=es.geometry,Ra=es.text?es.text.toString():null;if(Ra){var Sa=Ds(Ra,Hi),ra=Ds(Ra,Hi,!0);if(Sa in Ja&&ra in ao&&Ja[Sa]!==ao[ra]){var js=hs(Sa,ra,Hi),ws=Vs(Sa,ra,mo[js].geometry);delete ao[Sa],delete Ja[ra],Ja[Ds(Ra,mo[ws].geometry,!0)]=ws,mo[js].geometry=null}else Sa in Ja?Vs(Sa,ra,Hi):ra in ao?hs(Sa,ra,Hi):(fs(Io),ao[Sa]=zo-1,Ja[ra]=zo-1)}else fs(Io)}return mo.filter(function(Ga){return Ga.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(vo,ao){return vo.sortKey-ao.sortKey})}},Fe.prototype.update=function(t,a,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,s))},Fe.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Fe.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Fe.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Fe.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Fe.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Fe.prototype.addToLineVertexArray=function(t,a){var s=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(a[t.segment+1]),d=t.dist(a[t.segment]),_={},S=t.segment+1;S<a.length;S++)_[S]={x:a[S].x,y:a[S].y,tileUnitDistanceFromAnchor:h},S<a.length-1&&(h+=a[S+1].dist(a[S]));for(var M=t.segment||0;M>=0;M--)_[M]={x:a[M].x,y:a[M].y,tileUnitDistanceFromAnchor:d},M>0&&(d+=a[M-1].dist(a[M]));for(var k=0;k<a.length;k++){var z=_[k];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}},Fe.prototype.addSymbols=function(t,a,s,h,d,_,S,M,k,z,V,H){for(var ee=t.indexArray,se=t.layoutVertexArray,Me=t.segments.prepareSegment(4*a.length,se,ee,this.canOverlap?_.sortKey:void 0),Oe=this.glyphOffsetArray.length,Ke=Me.vertexLength,ze=this.allowVerticalPlacement&&S===Dr.vertical?Math.PI/2:0,ot=_.text&&_.text.sections,xt=0;xt<a.length;xt++){var Bt=a[xt],Vt=Bt.tl,or=Bt.tr,Tr=Bt.bl,Vr=Bt.br,Mn=Bt.tex,sn=Bt.pixelOffsetTL,Zn=Bt.pixelOffsetBR,ln=Bt.minFontScaleX,Li=Bt.minFontScaleY,Yn=Bt.glyphOffset,An=Bt.isSDF,Ti=Bt.sectionIndex,Si=Me.vertexLength,ta=Yn[1];ue(se,M.x,M.y,Vt.x,ta+Vt.y,Mn.x,Mn.y,s,An,sn.x,sn.y,ln,Li),ue(se,M.x,M.y,or.x,ta+or.y,Mn.x+Mn.w,Mn.y,s,An,Zn.x,sn.y,ln,Li),ue(se,M.x,M.y,Tr.x,ta+Tr.y,Mn.x,Mn.y+Mn.h,s,An,sn.x,Zn.y,ln,Li),ue(se,M.x,M.y,Vr.x,ta+Vr.y,Mn.x+Mn.w,Mn.y+Mn.h,s,An,Zn.x,Zn.y,ln,Li),je(t.dynamicLayoutVertexArray,M,ze),ee.emplaceBack(Si,Si+1,Si+2),ee.emplaceBack(Si+1,Si+2,Si+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Yn[0]),xt!==a.length-1&&Ti===a[xt+1].sectionIndex||t.programConfigurations.populatePaintArrays(se.length,_,_.index,{},H,ot&&ot[Ti])}t.placedSymbolArray.emplaceBack(M.x,M.y,Oe,this.glyphOffsetArray.length-Oe,Ke,k,z,M.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],S,0,!1,0,V)},Fe.prototype._addCollisionDebugVertex=function(t,a,s,h,d,_){return a.emplaceBack(0,0),t.emplaceBack(s.x,s.y,h,d,Math.round(_.x),Math.round(_.y))},Fe.prototype.addCollisionDebugVertices=function(t,a,s,h,d,_,S){var M=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),k=M.vertexLength,z=d.layoutVertexArray,V=d.collisionVertexArray,H=S.anchorX,ee=S.anchorY;this._addCollisionDebugVertex(z,V,_,H,ee,new re(t,a)),this._addCollisionDebugVertex(z,V,_,H,ee,new re(s,a)),this._addCollisionDebugVertex(z,V,_,H,ee,new re(s,h)),this._addCollisionDebugVertex(z,V,_,H,ee,new re(t,h)),M.vertexLength+=4;var se=d.indexArray;se.emplaceBack(k,k+1),se.emplaceBack(k+1,k+2),se.emplaceBack(k+2,k+3),se.emplaceBack(k+3,k),M.primitiveLength+=4},Fe.prototype.addDebugCollisionBoxes=function(t,a,s,h){for(var d=t;d<a;d++){var _=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,h?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,s)}},Fe.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $e(lc,ep.members,Nl),this.iconCollisionBox=new $e(lc,ep.members,Nl);for(var t=0;t<this.symbolInstances.length;t++){var a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}},Fe.prototype._deserializeCollisionBoxesForSymbol=function(t,a,s,h,d,_,S,M,k){for(var z={},V=a;V<s;V++){var H=t.get(V);z.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},z.textFeatureIndex=H.featureIndex;break}for(var ee=h;ee<d;ee++){var se=t.get(ee);z.verticalTextBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},z.verticalTextFeatureIndex=se.featureIndex;break}for(var Me=_;Me<S;Me++){var Oe=t.get(Me);z.iconBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,anchorPointX:Oe.anchorPointX,anchorPointY:Oe.anchorPointY},z.iconFeatureIndex=Oe.featureIndex;break}for(var Ke=M;Ke<k;Ke++){var ze=t.get(Ke);z.verticalIconBox={x1:ze.x1,y1:ze.y1,x2:ze.x2,y2:ze.y2,anchorPointX:ze.anchorPointX,anchorPointY:ze.anchorPointY},z.verticalIconFeatureIndex=ze.featureIndex;break}return z},Fe.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}},Fe.prototype.hasTextData=function(){return this.text.segments.get().length>0},Fe.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Fe.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Fe.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Fe.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Fe.prototype.addIndicesForPlacedSymbol=function(t,a){for(var s=t.placedSymbolArray.get(a),h=s.vertexStartIndex+4*s.numGlyphs,d=s.vertexStartIndex;d<h;d+=4)t.indexArray.emplaceBack(d,d+1,d+2),t.indexArray.emplaceBack(d+1,d+2,d+3)},Fe.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var a=Math.sin(t),s=Math.cos(t),h=[],d=[],_=[],S=0;S<this.symbolInstances.length;++S){_.push(S);var M=this.symbolInstances.get(S);h.push(0|Math.round(a*M.anchorX+s*M.anchorY)),d.push(M.featureIndex)}return _.sort(function(k,z){return h[k]-h[z]||d[z]-d[k]}),_},Fe.prototype.addToSortKeyRanges=function(t,a){var s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===a?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Fe.prototype.sortFeatures=function(t){var a=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var s=0,h=this.symbolInstanceIndexes;s<h.length;s+=1){var d=this.symbolInstances.get(h[s]);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach(function(_,S,M){_>=0&&M.indexOf(_)===S&&a.addIndicesForPlacedSymbol(a.text,_)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},fn("SymbolBucket",Fe,{omit:["layers","collisionBoxArray","features","compareText"]}),Fe.MAX_GLYPHS=65535,Fe.addDynamicAttributes=je;var tt=new No({"symbol-placement":new Cn(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new Cn(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Cn(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bn(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Cn(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Cn(fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Cn(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Cn(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Cn(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new bn(fe.layout_symbol["icon-size"]),"icon-text-fit":new Cn(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Cn(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new bn(fe.layout_symbol["icon-image"]),"icon-rotate":new bn(fe.layout_symbol["icon-rotate"]),"icon-padding":new Cn(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new Cn(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new bn(fe.layout_symbol["icon-offset"]),"icon-anchor":new bn(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Cn(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Cn(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Cn(fe.layout_symbol["text-rotation-alignment"]),"text-field":new bn(fe.layout_symbol["text-field"]),"text-font":new bn(fe.layout_symbol["text-font"]),"text-size":new bn(fe.layout_symbol["text-size"]),"text-max-width":new bn(fe.layout_symbol["text-max-width"]),"text-line-height":new Cn(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new bn(fe.layout_symbol["text-letter-spacing"]),"text-justify":new bn(fe.layout_symbol["text-justify"]),"text-radial-offset":new bn(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Cn(fe.layout_symbol["text-variable-anchor"]),"text-anchor":new bn(fe.layout_symbol["text-anchor"]),"text-max-angle":new Cn(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new Cn(fe.layout_symbol["text-writing-mode"]),"text-rotate":new bn(fe.layout_symbol["text-rotate"]),"text-padding":new Cn(fe.layout_symbol["text-padding"]),"text-keep-upright":new Cn(fe.layout_symbol["text-keep-upright"]),"text-transform":new bn(fe.layout_symbol["text-transform"]),"text-offset":new bn(fe.layout_symbol["text-offset"]),"text-allow-overlap":new Cn(fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Cn(fe.layout_symbol["text-ignore-placement"]),"text-optional":new Cn(fe.layout_symbol["text-optional"])}),ye={paint:new No({"icon-opacity":new bn(fe.paint_symbol["icon-opacity"]),"icon-color":new bn(fe.paint_symbol["icon-color"]),"icon-halo-color":new bn(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new bn(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bn(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new Cn(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Cn(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new bn(fe.paint_symbol["text-opacity"]),"text-color":new bn(fe.paint_symbol["text-color"],{runtimeType:Gr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new bn(fe.paint_symbol["text-halo-color"]),"text-halo-width":new bn(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new bn(fe.paint_symbol["text-halo-blur"]),"text-translate":new Cn(fe.paint_symbol["text-translate"]),"text-translate-anchor":new Cn(fe.paint_symbol["text-translate-anchor"])}),layout:tt},Ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:un,this.defaultValue=t};Ze.prototype.evaluate=function(t){if(t.formattedSection){var a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ze.prototype.outputDefined=function(){return!1},Ze.prototype.serialize=function(){return null},fn("FormatSectionOverride",Ze,{omit:["defaultValue"]});var Se=function(t){function a(s){t.call(this,s,ye)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,h){if(t.prototype.recalculate.call(this,s,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var d=this.layout.get("text-writing-mode");if(d){for(var _=[],S=0,M=d;S<M.length;S+=1){var k=M[S];_.indexOf(k)<0&&_.push(k)}this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},a.prototype.getValueAndResolveTokens=function(s,h,d,_){var S=this.layout.get(s).evaluate(h,{},d,_),M=this._unevaluatedLayout._values[s];return M.isDataDriven()||Ql(M.value)||!S?S:function(k,z){return z.replace(/{([^{}]+)}/g,function(V,H){return H in k?String(k[H]):""})}(h.properties,S)},a.prototype.createBucket=function(s){return new Fe(s)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype._setPaintOverrides=function(){for(var s=0,h=ye.paint.overridableProperties;s<h.length;s+=1){var d=h[s];if(a.hasPaintOverride(this.layout,d)){var _,S=this.paint.get(d),M=new Ze(S),k=new Ic(M,S.property.specification);_=S.value.kind==="constant"||S.value.kind==="source"?new Cl("source",k):new sl("composite",k,S.value.zoomStops,S.value._interpolationType),this.paint._values[d]=new bs(S.property,_,S.parameters)}}},a.prototype._handleOverridablePaintPropertyUpdate=function(s,h,d){return!(!this.layout||h.isDataDriven()||d.isDataDriven())&&a.hasPaintOverride(this.layout,s)},a.hasPaintOverride=function(s,h){var d=s.get("text-field"),_=ye.paint.properties[h],S=!1,M=function(V){for(var H=0,ee=V;H<ee.length;H+=1)if(_.overrides&&_.overrides.hasOverride(ee[H]))return void(S=!0)};if(d.value.kind==="constant"&&d.value.value instanceof zt)M(d.value.value.sections);else if(d.value.kind==="source"){var k=function(V){S||(V instanceof Ba&&Qi(V.value)===Wi?M(V.value.sections):V instanceof bo?M(V.sections):V.eachChild(k))},z=d.value;z._styleExpression&&k(z._styleExpression.expression)}return S},a}(Fa),ct={paint:new No({"background-color":new Cn(fe.paint_background["background-color"]),"background-pattern":new is(fe.paint_background["background-pattern"]),"background-opacity":new Cn(fe.paint_background["background-opacity"])})},Et=function(t){function a(s){t.call(this,s,ct)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Fa),fr={paint:new No({"raster-opacity":new Cn(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Cn(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Cn(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Cn(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new Cn(fe.paint_raster["raster-saturation"]),"raster-contrast":new Cn(fe.paint_raster["raster-contrast"]),"raster-resampling":new Cn(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new Cn(fe.paint_raster["raster-fade-duration"])})},Nr=function(t){function a(s){t.call(this,s,fr)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Fa),Br=function(t){function a(s){t.call(this,s,{}),this.implementation=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},a.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},a.prototype.recalculate=function(){},a.prototype.updateTransitions=function(){},a.prototype.hasTransition=function(){},a.prototype.serialize=function(){},a.prototype.onAdd=function(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},a.prototype.onRemove=function(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},a}(Fa),rn={circle:vf,heatmap:jf,hillshade:Yh,fill:Qf,"fill-extrusion":_l,line:Oh,symbol:Se,background:Et,raster:Nr},kr=ne.HTMLImageElement,En=ne.HTMLCanvasElement,on=ne.HTMLVideoElement,_n=ne.ImageData,yn=ne.ImageBitmap,pn=function(t,a,s,h){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(a,h)};pn.prototype.update=function(t,a,s){var h=t.width,d=t.height,_=!(this.size&&this.size[0]===h&&this.size[1]===d||s),S=this.context,M=S.gl;if(this.useMipmap=Boolean(a&&a.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!a||a.premultiply!==!1)),_)this.size=[h,d],t instanceof kr||t instanceof En||t instanceof on||t instanceof _n||yn&&t instanceof yn?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,t):M.texImage2D(M.TEXTURE_2D,0,this.format,h,d,0,this.format,M.UNSIGNED_BYTE,t.data);else{var k=s||{x:0,y:0},z=k.x,V=k.y;t instanceof kr||t instanceof En||t instanceof on||t instanceof _n||yn&&t instanceof yn?M.texSubImage2D(M.TEXTURE_2D,0,z,V,M.RGBA,M.UNSIGNED_BYTE,t):M.texSubImage2D(M.TEXTURE_2D,0,z,V,h,d,M.RGBA,M.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},pn.prototype.bind=function(t,a,s){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),s!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,s||t),this.filter=t),a!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrap=a)},pn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},pn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Qn=function(t){var a=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){a._triggered=!1,a._callback()})};Qn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Qn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var va=function(t,a,s){this.target=t,this.parent=a,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},er(["receive","process"],this),this.invoker=new Qn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Cr()?t:ne};function Qo(t,a,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[t*h-2*Math.PI*6378137/2,a*h-2*Math.PI*6378137/2]}va.prototype.send=function(t,a,s,h,d){var _=this;d===void 0&&(d=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[S]=s);var M=we(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!s,targetMapId:h,mustQueue:d,sourceMapId:this.mapId,data:Ys(a,M)},M),{cancel:function(){s&&delete _.callbacks[S],_.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:_.mapId})}}},va.prototype.receive=function(t){var a=t.data,s=a.id;if(s&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){delete this.tasks[s];var h=this.cancelCallbacks[s];delete this.cancelCallbacks[s],h&&h()}else Cr()||a.mustQueue?(this.tasks[s]=a,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,a)},va.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),a=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),a&&this.processTask(t,a)}},va.prototype.processTask=function(t,a){var s=this;if(a.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(a.error?h(Ps(a.error)):h(null,Ps(a.data)))}else{var d=!1,_=we(this.globalScope)?void 0:[],S=a.hasCallback?function(V,H){d=!0,delete s.cancelCallbacks[t],s.target.postMessage({id:t,type:"<response>",sourceMapId:s.mapId,error:V?Ys(V):null,data:Ys(H,_)},_)}:function(V){d=!0},M=null,k=Ps(a.data);if(this.parent[a.type])M=this.parent[a.type](a.sourceMapId,k,S);else if(this.parent.getWorkerSource){var z=a.type.split(".");M=this.parent.getWorkerSource(a.sourceMapId,z[0],k.source)[z[1]](k,S)}else S(new Error("Could not find function "+a.type));!d&&M&&M.cancel&&(this.cancelCallbacks[t]=M.cancel)}},va.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Oa=function(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Oa.prototype.setNorthEast=function(t){return this._ne=t instanceof fa?new fa(t.lng,t.lat):fa.convert(t),this},Oa.prototype.setSouthWest=function(t){return this._sw=t instanceof fa?new fa(t.lng,t.lat):fa.convert(t),this},Oa.prototype.extend=function(t){var a,s,h=this._sw,d=this._ne;if(t instanceof fa)a=t,s=t;else{if(!(t instanceof Oa))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Oa.convert(t)):this.extend(fa.convert(t)):this;if(s=t._ne,!(a=t._sw)||!s)return this}return h||d?(h.lng=Math.min(a.lng,h.lng),h.lat=Math.min(a.lat,h.lat),d.lng=Math.max(s.lng,d.lng),d.lat=Math.max(s.lat,d.lat)):(this._sw=new fa(a.lng,a.lat),this._ne=new fa(s.lng,s.lat)),this},Oa.prototype.getCenter=function(){return new fa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Oa.prototype.getSouthWest=function(){return this._sw},Oa.prototype.getNorthEast=function(){return this._ne},Oa.prototype.getNorthWest=function(){return new fa(this.getWest(),this.getNorth())},Oa.prototype.getSouthEast=function(){return new fa(this.getEast(),this.getSouth())},Oa.prototype.getWest=function(){return this._sw.lng},Oa.prototype.getSouth=function(){return this._sw.lat},Oa.prototype.getEast=function(){return this._ne.lng},Oa.prototype.getNorth=function(){return this._ne.lat},Oa.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Oa.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Oa.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Oa.prototype.contains=function(t){var a=fa.convert(t),s=a.lng,h=a.lat,d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&d},Oa.convert=function(t){return!t||t instanceof Oa?t:new Oa(t)};var fa=function(t,a){if(isNaN(t)||isNaN(a))throw new Error("Invalid LngLat object: ("+t+", "+a+")");if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};fa.prototype.wrap=function(){return new fa($t(this.lng,-180,180),this.lat)},fa.prototype.toArray=function(){return[this.lng,this.lat]},fa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},fa.prototype.distanceTo=function(t){var a=Math.PI/180,s=this.lat*a,h=t.lat*a,d=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((t.lng-this.lng)*a);return 63710088e-1*Math.acos(Math.min(d,1))},fa.prototype.toBounds=function(t){t===void 0&&(t=0);var a=360*t/40075017,s=a/Math.cos(Math.PI/180*this.lat);return new Oa(new fa(this.lng-s,this.lat-a),new fa(this.lng+s,this.lat+a))},fa.convert=function(t){if(t instanceof fa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new fa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new fa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Ls=2*Math.PI*63710088e-1;function Mo(t){return Ls*Math.cos(t*Math.PI/180)}function Fu(t){return(180+t)/360}function lu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Lh(t,a){return t/Mo(a)}function Js(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Vl=function(t,a,s){s===void 0&&(s=0),this.x=+t,this.y=+a,this.z=+s};Vl.fromLngLat=function(t,a){a===void 0&&(a=0);var s=fa.convert(t);return new Vl(Fu(s.lng),lu(s.lat),Lh(a,s.lat))},Vl.prototype.toLngLat=function(){return new fa(360*this.x-180,Js(this.y))},Vl.prototype.toAltitude=function(){return this.z*Mo(Js(this.y))},Vl.prototype.meterInMercatorCoordinateUnits=function(){return 1/Ls*(t=Js(this.y),1/Math.cos(t*Math.PI/180));var t};var nh=function(t,a,s){this.z=t,this.x=a,this.y=s,this.key=Wc(0,t,t,a,s)};nh.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},nh.prototype.url=function(t,a){var s,h,d,_,S,M=(h=this.y,d=this.z,_=Qo(256*(s=this.x),256*(h=Math.pow(2,d)-h-1),d),S=Qo(256*(s+1),256*(h+1),d),_[0]+","+_[1]+","+S[0]+","+S[1]),k=function(z,V,H){for(var ee,se="",Me=z;Me>0;Me--)se+=(V&(ee=1<<Me-1)?1:0)+(H&ee?2:0);return se}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",M)},nh.prototype.getTilePoint=function(t){var a=Math.pow(2,this.z);return new re(8192*(t.x*a-this.x),8192*(t.y*a-this.y))},nh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var sv=function(t,a){this.wrap=t,this.canonical=a,this.key=Wc(t,a.z,a.z,a.x,a.y)},Yo=function(t,a,s,h,d){this.overscaledZ=t,this.wrap=a,this.canonical=new nh(s,+h,+d),this.key=Wc(a,t,s,h,d)};function Wc(t,a,s,h,d){(t*=2)<0&&(t=-1*t-1);var _=1<<s;return(_*_*t+_*d+h).toString(36)+s.toString(36)+a.toString(36)}Yo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Yo.prototype.scaledTo=function(t){var a=this.canonical.z-t;return t>this.canonical.z?new Yo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Yo(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)},Yo.prototype.calculateScaledKey=function(t,a){var s=this.canonical.z-t;return t>this.canonical.z?Wc(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):Wc(this.wrap*+a,t,t,this.canonical.x>>s,this.canonical.y>>s)},Yo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a},Yo.prototype.children=function(t){if(this.overscaledZ>=t)return[new Yo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var a=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new Yo(a,this.wrap,a,s,h),new Yo(a,this.wrap,a,s+1,h),new Yo(a,this.wrap,a,s,h+1),new Yo(a,this.wrap,a,s+1,h+1)]},Yo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Yo.prototype.wrapped=function(){return new Yo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Yo.prototype.unwrapTo=function(t){return new Yo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Yo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Yo.prototype.toUnwrapped=function(){return new sv(this.wrap,this.canonical)},Yo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Yo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Vl(t.x-this.wrap,t.y))},fn("CanonicalTileID",nh),fn("OverscaledTileID",Yo,{omit:["posMatrix"]});var Po=function(t,a,s){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Je('"'+s+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=a.height;var h=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=s||"mapbox";for(var d=0;d<h;d++)this.data[this._idx(-1,d)]=this.data[this._idx(0,d)],this.data[this._idx(h,d)]=this.data[this._idx(h-1,d)],this.data[this._idx(d,-1)]=this.data[this._idx(d,0)],this.data[this._idx(d,h)]=this.data[this._idx(d,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};Po.prototype.get=function(t,a){var s=new Uint8Array(this.data.buffer),h=4*this._idx(t,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[h],s[h+1],s[h+2])},Po.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Po.prototype._idx=function(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)},Po.prototype._unpackMapbox=function(t,a,s){return(256*t*256+256*a+s)/10-1e4},Po.prototype._unpackTerrarium=function(t,a,s){return 256*t+a+s/256-32768},Po.prototype.getPixels=function(){return new To({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Po.prototype.backfillBorder=function(t,a,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=a*this.dim,d=a*this.dim+this.dim,_=s*this.dim,S=s*this.dim+this.dim;switch(a){case-1:h=d-1;break;case 1:d=h+1}switch(s){case-1:_=S-1;break;case 1:S=_+1}for(var M=-a*this.dim,k=-s*this.dim,z=_;z<S;z++)for(var V=h;V<d;V++)this.data[this._idx(V,z)]=t.data[this._idx(V+M,z+k)]},fn("DEMData",Po);var np=function(t){this._stringToNumber={},this._numberToString=[];for(var a=0;a<t.length;a++){var s=t[a];this._stringToNumber[s]=a,this._numberToString[a]=s}};np.prototype.encode=function(t){return this._stringToNumber[t]},np.prototype.decode=function(t){return this._numberToString[t]};var ip=function(t,a,s,h,d){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=s,t._y=h,this.properties=t.properties,this.id=d},qp={geometry:{configurable:!0}};qp.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},qp.geometry.set=function(t){this._geometry=t},ip.prototype.toJSON=function(){var t={geometry:this.geometry};for(var a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t},Object.defineProperties(ip.prototype,qp);var Af=function(){this.state={},this.stateChanges={},this.deletedStates={}};Af.prototype.updateState=function(t,a,s){var h=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},ht(this.stateChanges[t][h],s),this.deletedStates[t]===null)for(var d in this.deletedStates[t]={},this.state[t])d!==h&&(this.deletedStates[t][d]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var _ in this.deletedStates[t][h]={},this.state[t][h])s[_]||(this.deletedStates[t][h][_]=null);else for(var S in s)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},Af.prototype.removeFeatureState=function(t,a,s){if(this.deletedStates[t]!==null){var h=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&a!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][s]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(s in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][s]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},Af.prototype.getState=function(t,a){var s=String(a),h=ht({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var d=this.deletedStates[t][a];if(d===null)return{};for(var _ in d)delete h[_]}return h},Af.prototype.initializeTileState=function(t,a){t.setFeatureState(this.state,a)},Af.prototype.coalesceChanges=function(t,a){var s={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var d={};for(var _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),ht(this.state[h][_],this.stateChanges[h][_]),d[_]=this.state[h][_];s[h]=d}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var M={};if(this.deletedStates[S]===null)for(var k in this.state[S])M[k]={},this.state[S][k]={};else for(var z in this.deletedStates[S]){if(this.deletedStates[S][z]===null)this.state[S][z]={};else for(var V=0,H=Object.keys(this.deletedStates[S][z]);V<H.length;V+=1)delete this.state[S][z][H[V]];M[z]=this.state[S][z]}s[S]=s[S]||{},ht(s[S],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(var ee in t)t[ee].setFeatureState(s,a)};var yc=function(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Iu(8192,16,0),this.grid3D=new Iu(8192,16,0),this.featureIndexArray=new Y,this.promoteId=a};function uv(t,a,s,h,d){return Ht(t,function(_,S){var M=a instanceof hu?a.get(S):null;return M&&M.evaluate?M.evaluate(s,h,d):M})}function lv(t){for(var a=1/0,s=1/0,h=-1/0,d=-1/0,_=0,S=t;_<S.length;_+=1){var M=S[_];a=Math.min(a,M.x),s=Math.min(s,M.y),h=Math.max(h,M.x),d=Math.max(d,M.y)}return{minX:a,minY:s,maxX:h,maxY:d}}function dm(t,a){return a-t}yc.prototype.insert=function(t,a,s,h,d,_){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,d);for(var M=_?this.grid3D:this.grid,k=0;k<a.length;k++){for(var z=a[k],V=[1/0,1/0,-1/0,-1/0],H=0;H<z.length;H++){var ee=z[H];V[0]=Math.min(V[0],ee.x),V[1]=Math.min(V[1],ee.y),V[2]=Math.max(V[2],ee.x),V[3]=Math.max(V[3],ee.y)}V[0]<8192&&V[1]<8192&&V[2]>=0&&V[3]>=0&&M.insert(S,V[0],V[1],V[2],V[3])}},yc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Os.VectorTile(new rh(this.rawTileData)).layers,this.sourceLayerCoder=new np(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},yc.prototype.query=function(t,a,s,h){var d=this;this.loadVTLayers();for(var _=t.params||{},S=8192/t.tileSize/t.scale,M=Pl(_.filter),k=t.queryGeometry,z=t.queryPadding*S,V=lv(k),H=this.grid.query(V.minX-z,V.minY-z,V.maxX+z,V.maxY+z),ee=lv(t.cameraQueryGeometry),se=this.grid3D.query(ee.minX-z,ee.minY-z,ee.maxX+z,ee.maxY+z,function(Bt,Vt,or,Tr){return function(Vr,Mn,sn,Zn,ln){for(var Li=0,Yn=Vr;Li<Yn.length;Li+=1){var An=Yn[Li];if(Mn<=An.x&&sn<=An.y&&Zn>=An.x&&ln>=An.y)return!0}var Ti=[new re(Mn,sn),new re(Mn,ln),new re(Zn,ln),new re(Zn,sn)];if(Vr.length>2){for(var Si=0,ta=Ti;Si<ta.length;Si+=1)if(ou(Vr,ta[Si]))return!0}for(var Nn=0;Nn<Vr.length-1;Nn++)if(zl(Vr[Nn],Vr[Nn+1],Ti))return!0;return!1}(t.cameraQueryGeometry,Bt-z,Vt-z,or+z,Tr+z)}),Me=0,Oe=se;Me<Oe.length;Me+=1)H.push(Oe[Me]);H.sort(dm);for(var Ke,ze={},ot=function(Bt){var Vt=H[Bt];if(Vt!==Ke){Ke=Vt;var or=d.featureIndexArray.get(Vt),Tr=null;d.loadMatchingFeature(ze,or.bucketIndex,or.sourceLayerIndex,or.featureIndex,M,_.layers,_.availableImages,a,s,h,function(Vr,Mn,sn){return Tr||(Tr=Va(Vr)),Mn.queryIntersectsFeature(k,Vr,sn,Tr,d.z,t.transform,S,t.pixelPosMatrix)})}},xt=0;xt<H.length;xt++)ot(xt);return ze},yc.prototype.loadMatchingFeature=function(t,a,s,h,d,_,S,M,k,z,V){var H=this.bucketLayerIDs[a];if(!_||function(Vr,Mn){for(var sn=0;sn<Vr.length;sn++)if(Mn.indexOf(Vr[sn])>=0)return!0;return!1}(_,H)){var ee=this.sourceLayerCoder.decode(s),se=this.vtLayers[ee].feature(h);if(d.needGeometry){var Me=no(se,!0);if(!d.filter(new wi(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!d.filter(new wi(this.tileID.overscaledZ),se))return;for(var Oe=this.getId(se,ee),Ke=0;Ke<H.length;Ke++){var ze=H[Ke];if(!(_&&_.indexOf(ze)<0)){var ot=M[ze];if(ot){var xt={};Oe!==void 0&&z&&(xt=z.getState(ot.sourceLayer||"_geojsonTileLayer",Oe));var Bt=ht({},k[ze]);Bt.paint=uv(Bt.paint,ot.paint,se,xt,S),Bt.layout=uv(Bt.layout,ot.layout,se,xt,S);var Vt=!V||V(se,ot,xt);if(Vt){var or=new ip(se,this.z,this.x,this.y,Oe);or.layer=Bt;var Tr=t[ze];Tr===void 0&&(Tr=t[ze]=[]),Tr.push({featureIndex:h,feature:or,intersectionZ:Vt})}}}}}},yc.prototype.lookupSymbolFeatures=function(t,a,s,h,d,_,S,M){var k={};this.loadVTLayers();for(var z=Pl(d),V=0,H=t;V<H.length;V+=1)this.loadMatchingFeature(k,s,h,H[V],z,_,S,M,a);return k},yc.prototype.hasLayer=function(t){for(var a=0,s=this.bucketLayerIDs;a<s.length;a+=1)for(var h=0,d=s[a];h<d.length;h+=1)if(t===d[h])return!0;return!1},yc.prototype.getId=function(t,a){var s=t.id;return this.promoteId&&typeof(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]])=="boolean"&&(s=Number(s)),s},fn("FeatureIndex",yc,{omit:["rawTileData","sourceLayerCoder"]});var cs=function(t,a){this.tileID=t,this.uid=dt(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};cs.prototype.registerFadeDuration=function(t){var a=t+this.timeAdded;a<li.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)},cs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},cs.prototype.loadVectorData=function(t,a,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,V){var H={};if(!V)return H;for(var ee=function(){var Oe=Me[se],Ke=Oe.layerIds.map(function(xt){return V.getLayer(xt)}).filter(Boolean);if(Ke.length!==0){Oe.layers=Ke,Oe.stateDependentLayerIds&&(Oe.stateDependentLayers=Oe.stateDependentLayerIds.map(function(xt){return Ke.filter(function(Bt){return Bt.id===xt})[0]}));for(var ze=0,ot=Ke;ze<ot.length;ze+=1)H[ot[ze].id]=Oe}},se=0,Me=z;se<Me.length;se+=1)ee();return H}(t.buckets,a.style),this.hasSymbolBuckets=!1,this.buckets){var d=this.buckets[h];if(d instanceof Fe){if(this.hasSymbolBuckets=!0,!s)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var _ in this.buckets){var S=this.buckets[_];if(S instanceof Fe&&S.hasRTLText){this.hasRTLText=!0,Is.isLoading()||Is.isLoaded()||pf()!=="deferred"||iu();break}}for(var M in this.queryPadding=0,this.buckets){var k=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(M).queryRadius(k))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},cs.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},cs.prototype.getBucket=function(t){return this.buckets[t.id]},cs.prototype.upload=function(t){for(var a in this.buckets){var s=this.buckets[a];s.uploadPending()&&s.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},cs.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},cs.prototype.queryRenderedFeatures=function(t,a,s,h,d,_,S,M,k,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:d,scale:_,tileSize:this.tileSize,pixelPosMatrix:z,transform:M,params:S,queryPadding:this.queryPadding*k},t,a,s):{}},cs.prototype.querySourceFeatures=function(t,a){var s=this.latestFeatureIndex;if(s&&s.rawTileData){var h=s.loadVTLayers(),d=a?a.sourceLayer:"",_=h._geojsonTileLayer||h[d];if(_)for(var S=Pl(a&&a.filter),M=this.tileID.canonical,k=M.z,z=M.x,V=M.y,H={z:k,x:z,y:V},ee=0;ee<_.length;ee++){var se=_.feature(ee);if(S.needGeometry){var Me=no(se,!0);if(!S.filter(new wi(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!S.filter(new wi(this.tileID.overscaledZ),se))continue;var Oe=s.getId(se,d),Ke=new ip(se,k,z,V,Oe);Ke.tile=H,t.push(Ke)}}},cs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},cs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},cs.prototype.setExpiryData=function(t){var a=this.expirationTime;if(t.cacheControl){var s=jr(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),d=!1;if(this.expirationTime>h)d=!1;else if(a)if(this.expirationTime<a)d=!0;else{var _=this.expirationTime-a;_?this.expirationTime=h+Math.max(_,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},cs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},cs.prototype.setFeatureState=function(t,a){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var s=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(a.style.hasLayer(h)){var d=this.buckets[h],_=d.layers[0].sourceLayer||"_geojsonTileLayer",S=s[_],M=t[_];if(S&&M&&Object.keys(M).length!==0){d.update(M,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=a&&a.style&&a.style.getLayer(h);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(d)))}}}},cs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},cs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<li.now()},cs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},cs.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=li.now()+t},cs.prototype.setDependencies=function(t,a){for(var s={},h=0,d=a;h<d.length;h+=1)s[d[h]]=!0;this.dependencies[t]=s},cs.prototype.hasDependency=function(t,a){for(var s=0,h=t;s<h.length;s+=1){var d=this.dependencies[h[s]];if(d){for(var _=0,S=a;_<S.length;_+=1)if(d[S[_]])return!0}}return!1};var ks=ne.performance,cv=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},ks.mark(this._marks.start)};cv.prototype.finish=function(){ks.mark(this._marks.end);var t=ks.getEntriesByName(this._marks.measure);return t.length===0&&(ks.measure(this._marks.measure,this._marks.start,this._marks.end),t=ks.getEntriesByName(this._marks.measure),ks.clearMarks(this._marks.start),ks.clearMarks(this._marks.end),ks.clearMeasures(this._marks.measure)),t},m.Actor=va,m.AlphaImage=uu,m.CanonicalTileID=nh,m.CollisionBoxArray=f,m.Color=Ui,m.DEMData=Po,m.DataConstantProperty=Cn,m.DictionaryCoder=np,m.EXTENT=8192,m.ErrorEvent=Ge,m.EvaluationParameters=wi,m.Event=Pe,m.Evented=et,m.FeatureIndex=yc,m.FillBucket=Zs,m.FillExtrusionBucket=$u,m.ImageAtlas=yr,m.ImagePosition=st,m.LineBucket=ea,m.LngLat=fa,m.LngLatBounds=Oa,m.MercatorCoordinate=Vl,m.ONE_EM=24,m.OverscaledTileID=Yo,m.Point=re,m.Point$1=re,m.Properties=No,m.Protobuf=rh,m.RGBAImage=To,m.RequestManager=Vi,m.RequestPerformance=cv,m.ResourceType=an,m.SegmentVector=he,m.SourceFeatureState=Af,m.StructArrayLayout1ui2=Nc,m.StructArrayLayout2f1f2i16=Fl,m.StructArrayLayout2i4=fl,m.StructArrayLayout3ui6=hl,m.StructArrayLayout4i8=pu,m.SymbolBucket=Fe,m.Texture=pn,m.Tile=cs,m.Transitionable=Go,m.Uniform1f=Rr,m.Uniform1i=cr,m.Uniform2f=Or,m.Uniform3f=Qr,m.Uniform4f=Dn,m.UniformColor=Bn,m.UniformMatrix4f=di,m.UnwrappedTileID=sv,m.ValidationError=ke,m.WritingMode=Dr,m.ZoomHistory=cf,m.add=function(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t},m.addDynamicAttributes=je,m.asyncAll=function(t,a,s){if(!t.length)return s(null,[]);var h=t.length,d=new Array(t.length),_=null;t.forEach(function(S,M){a(S,function(k,z){k&&(_=k),d[M]=z,--h==0&&s(_,d)})})},m.bezier=Ie,m.bindAll=er,m.browser=li,m.cacheEntryPossiblyAdded=function(t){++hi>Sr&&(t.getActor().send("enforceCacheSizeLimit",tr),hi=0)},m.clamp=Rt,m.clearTileCache=function(t){var a=ne.caches.delete("mapbox-tiles");t&&a.catch(t).then(function(){return t()})},m.clipLine=Rn,m.clone=function(t){var a=new Ji(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},m.clone$1=Ye,m.clone$2=function(t){var a=new Ji(3);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a},m.collisionCircleLayout=Td,m.config=Vn,m.create=function(){var t=new Ji(16);return Ji!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},m.create$1=function(){var t=new Ji(9);return Ji!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},m.create$2=function(){var t=new Ji(4);return Ji!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},m.createCommonjsModule=J,m.createExpression=ec,m.createLayout=ba,m.createStyleLayer=function(t){return t.type==="custom"?new Br(t):new rn[t.type](t)},m.cross=function(t,a,s){var h=a[0],d=a[1],_=a[2],S=s[0],M=s[1],k=s[2];return t[0]=d*k-_*M,t[1]=_*S-h*k,t[2]=h*M-d*S,t},m.deepEqual=function t(a,s){if(Array.isArray(a)){if(!Array.isArray(s)||a.length!==s.length)return!1;for(var h=0;h<a.length;h++)if(!t(a[h],s[h]))return!1;return!0}if(typeof a=="object"&&a!==null&&s!==null){if(typeof s!="object"||Object.keys(a).length!==Object.keys(s).length)return!1;for(var d in a)if(!t(a[d],s[d]))return!1;return!0}return a===s},m.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},m.dot$1=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},m.ease=He,m.emitValidationErrors=kc,m.endsWith=K,m.enforceCacheSizeLimit=function(t){qr(),qi&&qi.then(function(a){a.keys().then(function(s){for(var h=0;h<s.length-t;h++)a.delete(s[h])})})},m.evaluateSizeForFeature=Jn,m.evaluateSizeForZoom=ui,m.evaluateVariableOffset=Zl,m.evented=Uf,m.extend=ht,m.featureFilter=Pl,m.filterObject=at,m.fromRotation=function(t,a){var s=Math.sin(a),h=Math.cos(a);return t[0]=h,t[1]=s,t[2]=0,t[3]=-s,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},m.getAnchorAlignment=Kr,m.getAnchorJustification=Ce,m.getArrayBuffer=Na,m.getImage=Q,m.getJSON=function(t,a){return Zo(ht(t,{type:"json"}),a)},m.getRTLTextPluginStatus=pf,m.getReferrer=Oi,m.getVideo=function(t,a){var s,h,d=ne.document.createElement("video");d.muted=!0,d.onloadstart=function(){a(null,d)};for(var _=0;_<t.length;_++){var S=ne.document.createElement("source");s=t[_],h=void 0,(h=ne.document.createElement("a")).href=s,(h.protocol!==ne.document.location.protocol||h.host!==ne.document.location.host)&&(d.crossOrigin="Anonymous"),S.src=t[_],d.appendChild(S)}return{cancel:function(){}}},m.identity=Us,m.invert=function(t,a){var s=a[0],h=a[1],d=a[2],_=a[3],S=a[4],M=a[5],k=a[6],z=a[7],V=a[8],H=a[9],ee=a[10],se=a[11],Me=a[12],Oe=a[13],Ke=a[14],ze=a[15],ot=s*M-h*S,xt=s*k-d*S,Bt=s*z-_*S,Vt=h*k-d*M,or=h*z-_*M,Tr=d*z-_*k,Vr=V*Oe-H*Me,Mn=V*Ke-ee*Me,sn=V*ze-se*Me,Zn=H*Ke-ee*Oe,ln=H*ze-se*Oe,Li=ee*ze-se*Ke,Yn=ot*Li-xt*ln+Bt*Zn+Vt*sn-or*Mn+Tr*Vr;return Yn?(t[0]=(M*Li-k*ln+z*Zn)*(Yn=1/Yn),t[1]=(d*ln-h*Li-_*Zn)*Yn,t[2]=(Oe*Tr-Ke*or+ze*Vt)*Yn,t[3]=(ee*or-H*Tr-se*Vt)*Yn,t[4]=(k*sn-S*Li-z*Mn)*Yn,t[5]=(s*Li-d*sn+_*Mn)*Yn,t[6]=(Ke*Bt-Me*Tr-ze*xt)*Yn,t[7]=(V*Tr-ee*Bt+se*xt)*Yn,t[8]=(S*ln-M*sn+z*Vr)*Yn,t[9]=(h*sn-s*ln-_*Vr)*Yn,t[10]=(Me*or-Oe*Bt+ze*ot)*Yn,t[11]=(H*Bt-V*or-se*ot)*Yn,t[12]=(M*Mn-S*Zn-k*Vr)*Yn,t[13]=(s*Zn-h*Mn+d*Vr)*Yn,t[14]=(Oe*xt-Me*Vt-Ke*ot)*Yn,t[15]=(V*Vt-H*xt+ee*ot)*Yn,t):null},m.isChar=zr,m.isMapboxURL=ki,m.keysDifference=function(t,a){var s=[];for(var h in t)h in a||s.push(h);return s},m.makeRequest=Zo,m.mapObject=Ht,m.mercatorXfromLng=Fu,m.mercatorYfromLat=lu,m.mercatorZfromAltitude=Lh,m.mul=Bc,m.multiply=us,m.mvt=Os,m.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},m.normalize=function(t,a){var s=a[0],h=a[1],d=a[2],_=s*s+h*h+d*d;return _>0&&(_=1/Math.sqrt(_)),t[0]=a[0]*_,t[1]=a[1]*_,t[2]=a[2]*_,t},m.number=ga,m.offscreenCanvasSupported=qn,m.ortho=function(t,a,s,h,d,_,S){var M=1/(a-s),k=1/(h-d),z=1/(_-S);return t[0]=-2*M,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*k,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(a+s)*M,t[13]=(d+h)*k,t[14]=(S+_)*z,t[15]=1,t},m.parseGlyphPBF=function(t){return new rh(t).readFields(Ar,[])},m.pbf=rh,m.performSymbolLayout=function(t,a,s,h,d,_,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var M=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var V=t.textSizeData,H=V.maxZoom;z.compositeTextSizes=[k["text-size"].possiblyEvaluate(new wi(V.minZoom),S),k["text-size"].possiblyEvaluate(new wi(H),S)]}if(t.iconSizeData.kind==="composite"){var ee=t.iconSizeData,se=ee.maxZoom;z.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new wi(ee.minZoom),S),k["icon-size"].possiblyEvaluate(new wi(se),S)]}z.layoutTextSize=k["text-size"].possiblyEvaluate(new wi(t.zoom+1),S),z.layoutIconSize=k["icon-size"].possiblyEvaluate(new wi(t.zoom+1),S),z.textMaxSize=k["text-size"].possiblyEvaluate(new wi(18));for(var Me=24*M.get("text-line-height"),Oe=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Ke=M.get("text-keep-upright"),ze=M.get("text-size"),ot=function(){var Vt=Bt[xt],or=M.get("text-font").evaluate(Vt,{},S).join(","),Tr=ze.evaluate(Vt,{},S),Vr=z.layoutTextSize.evaluate(Vt,{},S),Mn=z.layoutIconSize.evaluate(Vt,{},S),sn={horizontal:{},vertical:void 0},Zn=Vt.text,ln=[0,0];if(Zn){var Li=Zn.toString(),Yn=24*M.get("text-letter-spacing").evaluate(Vt,{},S),An=function(Hi){for(var Ra=0,Sa=Hi;Ra<Sa.length;Ra+=1)if(ra=Sa[Ra].charCodeAt(0),zr.Arabic(ra)||zr["Arabic Supplement"](ra)||zr["Arabic Extended-A"](ra)||zr["Arabic Presentation Forms-A"](ra)||zr["Arabic Presentation Forms-B"](ra))return!1;var ra;return!0}(Li)?Yn:0,Ti=M.get("text-anchor").evaluate(Vt,{},S),Si=M.get("text-variable-anchor");if(!Si){var ta=M.get("text-radial-offset").evaluate(Vt,{},S);ln=ta?Zl(Ti,[24*ta,Co]):M.get("text-offset").evaluate(Vt,{},S).map(function(Hi){return 24*Hi})}var Nn=Oe?"center":M.get("text-justify").evaluate(Vt,{},S),ha=M.get("symbol-placement"),$a=ha==="point"?24*M.get("text-max-width").evaluate(Vt,{},S):0,vo=function(){t.allowVerticalPlacement&&oc(Li)&&(sn.vertical=Xr(Zn,a,s,d,or,$a,Me,Ti,"left",An,ln,Dr.vertical,!0,ha,Vr,Tr))};if(!Oe&&Si){for(var ao=Nn==="auto"?Si.map(function(Hi){return Ce(Hi)}):[Nn],Ja=!1,mo=0;mo<ao.length;mo++){var zo=ao[mo];if(!sn.horizontal[zo])if(Ja)sn.horizontal[zo]=sn.horizontal[0];else{var fs=Xr(Zn,a,s,d,or,$a,Me,"center",zo,An,ln,Dr.horizontal,!1,ha,Vr,Tr);fs&&(sn.horizontal[zo]=fs,Ja=fs.positionedLines.length===1)}}vo()}else{Nn==="auto"&&(Nn=Ce(Ti));var Vs=Xr(Zn,a,s,d,or,$a,Me,Ti,Nn,An,ln,Dr.horizontal,!1,ha,Vr,Tr);Vs&&(sn.horizontal[Nn]=Vs),vo(),oc(Li)&&Oe&&Ke&&(sn.vertical=Xr(Zn,a,s,d,or,$a,Me,Ti,Nn,An,ln,Dr.vertical,!1,ha,Vr,Tr))}}var hs=void 0,Ds=!1;if(Vt.icon&&Vt.icon.name){var Io=h[Vt.icon.name];Io&&(hs=function(Hi,Ra,Sa){var ra=Kr(Sa),js=Ra[0]-Hi.displaySize[0]*ra.horizontalAlign,ws=Ra[1]-Hi.displaySize[1]*ra.verticalAlign;return{image:Hi,top:ws,bottom:ws+Hi.displaySize[1],left:js,right:js+Hi.displaySize[0]}}(d[Vt.icon.name],M.get("icon-offset").evaluate(Vt,{},S),M.get("icon-anchor").evaluate(Vt,{},S)),Ds=Io.sdf,t.sdfIcons===void 0?t.sdfIcons=Io.sdf:t.sdfIcons!==Io.sdf&&Je("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Io.pixelRatio!==t.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var es=_t(sn.horizontal)||sn.vertical;t.iconsInText=!!es&&es.iconsInText,(es||hs)&&function(Hi,Ra,Sa,ra,js,ws,Ga,Oo,Ts,pa,jl){var bu=ws.textMaxSize.evaluate(Ra,{});bu===void 0&&(bu=Ga);var Gl,xo=Hi.layers[0].layout,Hl=xo.get("icon-offset").evaluate(Ra,{},jl),Qu=_t(Sa.horizontal),ts=Ga/24,Cf=Hi.tilePixelRatio*ts,ih=Hi.tilePixelRatio*bu/24,_c=Hi.tilePixelRatio*Oo,ah=Hi.tilePixelRatio*xo.get("symbol-spacing"),ap=xo.get("text-padding")*Hi.tilePixelRatio,oh=xo.get("icon-padding")*Hi.tilePixelRatio,kh=xo.get("text-max-angle")/180*Math.PI,op=xo.get("text-rotation-alignment")==="map"&&xo.get("symbol-placement")!=="point",sp=xo.get("icon-rotation-alignment")==="map"&&xo.get("symbol-placement")!=="point",xc=xo.get("symbol-placement"),Dh=ah/2,sh=xo.get("icon-text-fit");ra&&sh!=="none"&&(Hi.allowVerticalPlacement&&Sa.vertical&&(Gl=ni(ra,Sa.vertical,sh,xo.get("icon-text-fit-padding"),Hl,ts)),Qu&&(ra=ni(ra,Qu,sh,xo.get("icon-text-fit-padding"),Hl,ts)));var Xc=function(vm,mp){mp.x<0||mp.x>=8192||mp.y<0||mp.y>=8192||function(Ro,Wl,mm,Pf,Pd,pv,Qp,el,Xl,Bh,gp,yp,_p,Id,If,Od,Rd,dv,vv,mv,Eu,xp,Ld,xl,gv){var yv,fh,hh,zh,ph,dh=Ro.addToLineVertexArray(Wl,mm),kd=0,Dd=0,_v=0,xv=0,Fd=-1,Nd=-1,Kc={},bv=Te(""),Bd=0,ed=0;if(el._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Bd=(yv=el.layout.get("text-offset").evaluate(Eu,{},xl).map(function(wp){return 24*wp}))[0],ed=yv[1]):(Bd=24*el.layout.get("text-radial-offset").evaluate(Eu,{},xl),ed=Co),Ro.allowVerticalPlacement&&Pf.vertical){var zd=el.layout.get("text-rotate").evaluate(Eu,{},xl)+90;zh=new Xo(Xl,Wl,Bh,gp,yp,Pf.vertical,_p,Id,If,zd),Qp&&(ph=new Xo(Xl,Wl,Bh,gp,yp,Qp,Rd,dv,If,zd))}if(Pd){var td=el.layout.get("icon-rotate").evaluate(Eu,{}),rd=el.layout.get("icon-text-fit")!=="none",Ud=Fn(Pd,td,Ld,rd),nd=Qp?Fn(Qp,td,Ld,rd):void 0;hh=new Xo(Xl,Wl,Bh,gp,yp,Pd,Rd,dv,!1,td),kd=4*Ud.length;var Uh=Ro.iconSizeData,bp=null;Uh.kind==="source"?(bp=[128*el.layout.get("icon-size").evaluate(Eu,{})])[0]>32640&&Je(Ro.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Uh.kind==="composite"&&((bp=[128*xp.compositeIconSizes[0].evaluate(Eu,{},xl),128*xp.compositeIconSizes[1].evaluate(Eu,{},xl)])[0]>32640||bp[1]>32640)&&Je(Ro.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Ro.addSymbols(Ro.icon,Ud,bp,mv,vv,Eu,!1,Wl,dh.lineStartIndex,dh.lineLength,-1,xl),Fd=Ro.icon.placedSymbolArray.length-1,nd&&(Dd=4*nd.length,Ro.addSymbols(Ro.icon,nd,bp,mv,vv,Eu,Dr.vertical,Wl,dh.lineStartIndex,dh.lineLength,-1,xl),Nd=Ro.icon.placedSymbolArray.length-1)}for(var qc in Pf.horizontal){var Ep=Pf.horizontal[qc];if(!fh){bv=Te(Ep.text);var Ev=el.layout.get("text-rotate").evaluate(Eu,{},xl);fh=new Xo(Xl,Wl,Bh,gp,yp,Ep,_p,Id,If,Ev)}var Zd=Ep.positionedLines.length===1;if(_v+=Nt(Ro,Wl,Ep,pv,el,If,Eu,Od,dh,Pf.vertical?Dr.horizontal:Dr.horizontalOnly,Zd?Object.keys(Pf.horizontal):[qc],Kc,Fd,xp,xl),Zd)break}Pf.vertical&&(xv+=Nt(Ro,Wl,Pf.vertical,pv,el,If,Eu,Od,dh,Dr.vertical,["vertical"],Kc,Nd,xp,xl));var Sv=fh?fh.boxStartIndex:Ro.collisionBoxArray.length,gm=fh?fh.boxEndIndex:Ro.collisionBoxArray.length,ym=zh?zh.boxStartIndex:Ro.collisionBoxArray.length,_m=zh?zh.boxEndIndex:Ro.collisionBoxArray.length,xm=hh?hh.boxStartIndex:Ro.collisionBoxArray.length,bm=hh?hh.boxEndIndex:Ro.collisionBoxArray.length,wv=ph?ph.boxStartIndex:Ro.collisionBoxArray.length,Tv=ph?ph.boxEndIndex:Ro.collisionBoxArray.length,Yl=-1,Sp=function(wp,Cv){return wp&&wp.circleDiameter?Math.max(wp.circleDiameter,Cv):Cv};Yl=Sp(fh,Yl),Yl=Sp(zh,Yl),Yl=Sp(hh,Yl);var Av=(Yl=Sp(ph,Yl))>-1?1:0;Av&&(Yl*=gv/24),Ro.glyphOffsetArray.length>=Fe.MAX_GLYPHS&&Je("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Eu.sortKey!==void 0&&Ro.addToSortKeyRanges(Ro.symbolInstances.length,Eu.sortKey),Ro.symbolInstances.emplaceBack(Wl.x,Wl.y,Kc.right>=0?Kc.right:-1,Kc.center>=0?Kc.center:-1,Kc.left>=0?Kc.left:-1,Kc.vertical||-1,Fd,Nd,bv,Sv,gm,ym,_m,xm,bm,wv,Tv,Bh,_v,xv,kd,Dd,Av,0,_p,Bd,ed,Yl)}(Hi,mp,vm,Sa,ra,js,Gl,Hi.layers[0],Hi.collisionBoxArray,Ra.index,Ra.sourceLayerIndex,Hi.index,Cf,ap,op,Ts,_c,oh,sp,Hl,Ra,ws,pa,jl,Ga)};if(xc==="line")for(var uh=0,up=Rn(Ra.geometry,0,0,8192,8192);uh<up.length;uh+=1)for(var $p=up[uh],lp=0,cp=Wo($p,ah,kh,Sa.vertical||Qu,ra,24,ih,Hi.overscaling,8192);lp<cp.length;lp+=1){var Jp=cp[lp];Qu&&hn(Hi,Qu.text,Dh,Jp)||Xc($p,Jp)}else if(xc==="line-center")for(var Fh=0,fp=Ra.geometry;Fh<fp.length;Fh+=1){var hp=fp[Fh];if(hp.length>1){var pp=ja(hp,kh,Sa.vertical||Qu,ra,24,ih);pp&&Xc(hp,pp)}}else if(Ra.type==="Polygon")for(var lh=0,dp=$f(Ra.geometry,0);lh<dp.length;lh+=1){var ch=dp[lh],Yc=ii(ch,16);Xc(ch[0],new Hr(Yc.x,Yc.y,0))}else if(Ra.type==="LineString")for(var Mf=0,vp=Ra.geometry;Mf<vp.length;Mf+=1){var Nh=vp[Mf];Xc(Nh,new Hr(Nh[0].x,Nh[0].y,0))}else if(Ra.type==="Point")for(var Ad=0,fv=Ra.geometry;Ad<fv.length;Ad+=1)for(var Cd=0,hv=fv[Ad];Cd<hv.length;Cd+=1){var Md=hv[Cd];Xc([Md],new Hr(Md.x,Md.y,0))}}(t,Vt,sn,hs,h,z,Vr,Mn,ln,Ds,S)},xt=0,Bt=t.features;xt<Bt.length;xt+=1)ot();_&&t.generateCollisionDebugBuffers()},m.perspective=function(t,a,s,h,d){var _,S=1/Math.tan(a/2);return t[0]=S/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,d!=null&&d!==1/0?(t[10]=(d+h)*(_=1/(h-d)),t[14]=2*d*h*_):(t[10]=-1,t[14]=-2*h),t},m.pick=function(t,a){for(var s={},h=0;h<a.length;h++){var d=a[h];d in t&&(s[d]=t[d])}return s},m.plugin=Is,m.polygonIntersectsPolygon=ku,m.postMapLoadEvent=kt,m.postTurnstileEvent=Za,m.potpack=Er,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=fn,m.registerForPluginStateChange=function(t){return t({pluginStatus:Ns,pluginURL:Ru}),Uf.on("pluginStateChange",t),t},m.renderColorRamp=Vf,m.rotate=function(t,a,s){var h=a[0],d=a[1],_=a[2],S=a[3],M=Math.sin(s),k=Math.cos(s);return t[0]=h*k+_*M,t[1]=d*k+S*M,t[2]=h*-M+_*k,t[3]=d*-M+S*k,t},m.rotateX=function(t,a,s){var h=Math.sin(s),d=Math.cos(s),_=a[4],S=a[5],M=a[6],k=a[7],z=a[8],V=a[9],H=a[10],ee=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=_*d+z*h,t[5]=S*d+V*h,t[6]=M*d+H*h,t[7]=k*d+ee*h,t[8]=z*d-_*h,t[9]=V*d-S*h,t[10]=H*d-M*h,t[11]=ee*d-k*h,t},m.rotateZ=function(t,a,s){var h=Math.sin(s),d=Math.cos(s),_=a[0],S=a[1],M=a[2],k=a[3],z=a[4],V=a[5],H=a[6],ee=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=_*d+z*h,t[1]=S*d+V*h,t[2]=M*d+H*h,t[3]=k*d+ee*h,t[4]=z*d-_*h,t[5]=V*d-S*h,t[6]=H*d-M*h,t[7]=ee*d-k*h,t},m.scale=function(t,a,s){var h=s[0],d=s[1],_=s[2];return t[0]=a[0]*h,t[1]=a[1]*h,t[2]=a[2]*h,t[3]=a[3]*h,t[4]=a[4]*d,t[5]=a[5]*d,t[6]=a[6]*d,t[7]=a[7]*d,t[8]=a[8]*_,t[9]=a[9]*_,t[10]=a[10]*_,t[11]=a[11]*_,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},m.scale$1=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t},m.scale$2=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t},m.setCacheLimits=function(t,a){tr=t,Sr=a},m.setRTLTextPlugin=function(t,a,s){if(s===void 0&&(s=!1),Ns==="deferred"||Ns==="loading"||Ns==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Ru=li.resolveURL(t),Ns="deferred",Ou=a,ll(),s||iu()},m.sphericalToCartesian=function(t){var a=t[0],s=t[1],h=t[2];return s+=90,s*=Math.PI/180,h*=Math.PI/180,{x:a*Math.cos(s)*Math.sin(h),y:a*Math.sin(s)*Math.sin(h),z:a*Math.cos(h)}},m.sqrLen=function(t){var a=t[0],s=t[1];return a*a+s*s},m.styleSpec=fe,m.sub=function(t,a,s){return t[0]=a[0]-s[0],t[1]=a[1]-s[1],t[2]=a[2]-s[2],t},m.symbolSize=Ni,m.transformMat3=function(t,a,s){var h=a[0],d=a[1],_=a[2];return t[0]=h*s[0]+d*s[3]+_*s[6],t[1]=h*s[1]+d*s[4]+_*s[7],t[2]=h*s[2]+d*s[5]+_*s[8],t},m.transformMat4=zc,m.translate=function(t,a,s){var h,d,_,S,M,k,z,V,H,ee,se,Me,Oe=s[0],Ke=s[1],ze=s[2];return a===t?(t[12]=a[0]*Oe+a[4]*Ke+a[8]*ze+a[12],t[13]=a[1]*Oe+a[5]*Ke+a[9]*ze+a[13],t[14]=a[2]*Oe+a[6]*Ke+a[10]*ze+a[14],t[15]=a[3]*Oe+a[7]*Ke+a[11]*ze+a[15]):(d=a[1],_=a[2],S=a[3],M=a[4],k=a[5],z=a[6],V=a[7],H=a[8],ee=a[9],se=a[10],Me=a[11],t[0]=h=a[0],t[1]=d,t[2]=_,t[3]=S,t[4]=M,t[5]=k,t[6]=z,t[7]=V,t[8]=H,t[9]=ee,t[10]=se,t[11]=Me,t[12]=h*Oe+M*Ke+H*ze+a[12],t[13]=d*Oe+k*Ke+ee*ze+a[13],t[14]=_*Oe+z*Ke+se*ze+a[14],t[15]=S*Oe+V*Ke+Me*ze+a[15]),t},m.triggerPluginCompletionEvent=zf,m.uniqueId=dt,m.validateCustomStyleLayer=function(t){var a=[],s=t.id;return s===void 0&&a.push({message:"layers."+s+': missing required property "id"'}),t.render===void 0&&a.push({message:"layers."+s+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&a.push({message:"layers."+s+': property "renderingMode" must be either "2d" or "3d"'}),a},m.validateLight=ic,m.validateStyle=Ua,m.values=function(t){var a=[];for(var s in t)a.push(t[s]);return a},m.vectorTile=Os,m.version="1.13.2",m.warnOnce=Je,m.webpSupported=ti,m.window=ne,m.wrap=$t}),j(["./shared"],function(m){"use strict";function J(G){var Q=typeof G;if(Q==="number"||Q==="boolean"||Q==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var oe="[",ge=0,Pe=G;ge<Pe.length;ge+=1)oe+=J(Pe[ge])+",";return oe+"]"}for(var Ge=Object.keys(G).sort(),et="{",fe=0;fe<Ge.length;fe++)et+=JSON.stringify(Ge[fe])+":"+J(G[Ge[fe]])+",";return et+"}"}function F(G){for(var Q="",oe=0,ge=m.refProperties;oe<ge.length;oe+=1)Q+="/"+J(G[ge[oe]]);return Q}var $=function(G){this.keyCache={},G&&this.replace(G)};$.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},$.prototype.update=function(G,Q){for(var oe=this,ge=0,Pe=G;ge<Pe.length;ge+=1){var Ge=Pe[ge];this._layerConfigs[Ge.id]=Ge;var et=this._layers[Ge.id]=m.createStyleLayer(Ge);et._featureFilter=m.featureFilter(et.filter),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id]}for(var fe=0,ke=Q;fe<ke.length;fe+=1){var vt=ke[fe];delete this.keyCache[vt],delete this._layerConfigs[vt],delete this._layers[vt]}this.familiesBySource={};for(var hr=0,Pt=function(Fr,Gr){for(var vi={},Jr=0;Jr<Fr.length;Jr++){var Pn=Gr&&Gr[Fr[Jr].id]||F(Fr[Jr]);Gr&&(Gr[Fr[Jr].id]=Pn);var Wi=vi[Pn];Wi||(Wi=vi[Pn]=[]),Wi.push(Fr[Jr])}var pi=[];for(var Ci in vi)pi.push(vi[Ci]);return pi}(m.values(this._layerConfigs),this.keyCache);hr<Pt.length;hr+=1){var Dt=Pt[hr].map(function(Fr){return oe._layers[Fr.id]}),pr=Dt[0];if(pr.visibility!=="none"){var mn=pr.source||"",un=this.familiesBySource[mn];un||(un=this.familiesBySource[mn]={});var Tt=pr.sourceLayer||"_geojsonTileLayer",$r=un[Tt];$r||($r=un[Tt]=[]),$r.push(Dt)}}};var re=function(G){var Q={},oe=[];for(var ge in G){var Pe=G[ge],Ge=Q[ge]={};for(var et in Pe){var fe=Pe[+et];if(fe&&fe.bitmap.width!==0&&fe.bitmap.height!==0){var ke={x:0,y:0,w:fe.bitmap.width+2,h:fe.bitmap.height+2};oe.push(ke),Ge[et]={rect:ke,metrics:fe.metrics}}}}var vt=m.potpack(oe),hr=new m.AlphaImage({width:vt.w||1,height:vt.h||1});for(var Pt in G){var Dt=G[Pt];for(var pr in Dt){var mn=Dt[+pr];if(mn&&mn.bitmap.width!==0&&mn.bitmap.height!==0){var un=Q[Pt][pr].rect;m.AlphaImage.copy(mn.bitmap,hr,{x:0,y:0},{x:un.x+1,y:un.y+1},mn.bitmap)}}}this.image=hr,this.positions=Q};m.register("GlyphAtlas",re);var ie=function(G){this.tileID=new m.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function ne(G,Q,oe){for(var ge=new m.EvaluationParameters(Q),Pe=0,Ge=G;Pe<Ge.length;Pe+=1)Ge[Pe].recalculate(ge,oe)}function Le(G,Q){var oe=m.getArrayBuffer(G.request,function(ge,Pe,Ge,et){ge?Q(ge):Pe&&Q(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Pe)),rawData:Pe,cacheControl:Ge,expires:et})});return function(){oe.cancel(),Q()}}ie.prototype.parse=function(G,Q,oe,ge,Pe){var Ge=this;this.status="parsing",this.data=G,this.collisionBoxArray=new m.CollisionBoxArray;var et=new m.DictionaryCoder(Object.keys(G.layers).sort()),fe=new m.FeatureIndex(this.tileID,this.promoteId);fe.bucketLayerIDs=[];var ke,vt,hr,Pt,Dt={},pr={featureIndex:fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:oe},mn=Q.familiesBySource[this.source];for(var un in mn){var Tt=G.layers[un];if(Tt){Tt.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+un+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var $r=et.encode(un),Fr=[],Gr=0;Gr<Tt.length;Gr++){var vi=Tt.feature(Gr),Jr=fe.getId(vi,un);Fr.push({feature:vi,id:Jr,index:Gr,sourceLayerIndex:$r})}for(var Pn=0,Wi=mn[un];Pn<Wi.length;Pn+=1){var pi=Wi[Pn],Ci=pi[0];Ci.minzoom&&this.zoom<Math.floor(Ci.minzoom)||Ci.maxzoom&&this.zoom>=Ci.maxzoom||Ci.visibility!=="none"&&(ne(pi,this.zoom,oe),(Dt[Ci.id]=Ci.createBucket({index:fe.bucketLayerIDs.length,layers:pi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$r,sourceID:this.source})).populate(Fr,pr,this.tileID.canonical),fe.bucketLayerIDs.push(pi.map(function(Ei){return Ei.id})))}}}var _i=m.mapObject(pr.glyphDependencies,function(Ei){return Object.keys(Ei).map(Number)});Object.keys(_i).length?ge.send("getGlyphs",{uid:this.uid,stacks:_i},function(Ei,Mi){ke||(ke=Ei,vt=Mi,Ca.call(Ge))}):vt={};var St=Object.keys(pr.iconDependencies);St.length?ge.send("getImages",{icons:St,source:this.source,tileID:this.tileID,type:"icons"},function(Ei,Mi){ke||(ke=Ei,hr=Mi,Ca.call(Ge))}):hr={};var Kt=Object.keys(pr.patternDependencies);function Ca(){if(ke)return Pe(ke);if(vt&&hr&&Pt){var Ei=new re(vt),Mi=new m.ImageAtlas(hr,Pt);for(var Ui in Dt){var Wr=Dt[Ui];Wr instanceof m.SymbolBucket?(ne(Wr.layers,this.zoom,oe),m.performSymbolLayout(Wr,vt,Ei.positions,hr,Mi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Wr.hasPattern&&(Wr instanceof m.LineBucket||Wr instanceof m.FillBucket||Wr instanceof m.FillExtrusionBucket)&&(ne(Wr.layers,this.zoom,oe),Wr.addFeatures(pr,this.tileID.canonical,Mi.patternPositions))}this.status="done",Pe(null,{buckets:m.values(Dt).filter(function(Sn){return!Sn.isEmpty()}),featureIndex:fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ei.image,imageAtlas:Mi,glyphMap:this.returnDependencies?vt:null,iconMap:this.returnDependencies?hr:null,glyphPositions:this.returnDependencies?Ei.positions:null})}}Kt.length?ge.send("getImages",{icons:Kt,source:this.source,tileID:this.tileID,type:"patterns"},function(Ei,Mi){ke||(ke=Ei,Pt=Mi,Ca.call(Ge))}):Pt={},Ca.call(this)};var Ie=function(G,Q,oe,ge){this.actor=G,this.layerIndex=Q,this.availableImages=oe,this.loadVectorData=ge||Le,this.loading={},this.loaded={}};Ie.prototype.loadTile=function(G,Q){var oe=this,ge=G.uid;this.loading||(this.loading={});var Pe=!!(G&&G.request&&G.request.collectResourceTiming)&&new m.RequestPerformance(G.request),Ge=this.loading[ge]=new ie(G);Ge.abort=this.loadVectorData(G,function(et,fe){if(delete oe.loading[ge],et||!fe)return Ge.status="done",oe.loaded[ge]=Ge,Q(et);var ke=fe.rawData,vt={};fe.expires&&(vt.expires=fe.expires),fe.cacheControl&&(vt.cacheControl=fe.cacheControl);var hr={};if(Pe){var Pt=Pe.finish();Pt&&(hr.resourceTiming=JSON.parse(JSON.stringify(Pt)))}Ge.vectorTile=fe.vectorTile,Ge.parse(fe.vectorTile,oe.layerIndex,oe.availableImages,oe.actor,function(Dt,pr){if(Dt||!pr)return Q(Dt);Q(null,m.extend({rawTileData:ke.slice(0)},pr,vt,hr))}),oe.loaded=oe.loaded||{},oe.loaded[ge]=Ge})},Ie.prototype.reloadTile=function(G,Q){var oe=this,ge=this.loaded,Pe=G.uid,Ge=this;if(ge&&ge[Pe]){var et=ge[Pe];et.showCollisionBoxes=G.showCollisionBoxes;var fe=function(ke,vt){var hr=et.reloadCallback;hr&&(delete et.reloadCallback,et.parse(et.vectorTile,Ge.layerIndex,oe.availableImages,Ge.actor,hr)),Q(ke,vt)};et.status==="parsing"?et.reloadCallback=fe:et.status==="done"&&(et.vectorTile?et.parse(et.vectorTile,this.layerIndex,this.availableImages,this.actor,fe):fe())}},Ie.prototype.abortTile=function(G,Q){var oe=this.loading,ge=G.uid;oe&&oe[ge]&&oe[ge].abort&&(oe[ge].abort(),delete oe[ge]),Q()},Ie.prototype.removeTile=function(G,Q){var oe=this.loaded,ge=G.uid;oe&&oe[ge]&&delete oe[ge],Q()};var He=m.window.ImageBitmap,Rt=function(){this.loaded={}};function $t(G,Q){if(G.length!==0){ht(G[0],Q);for(var oe=1;oe<G.length;oe++)ht(G[oe],!Q)}}function ht(G,Q){for(var oe=0,ge=0,Pe=G.length,Ge=Pe-1;ge<Pe;Ge=ge++)oe+=(G[ge][0]-G[Ge][0])*(G[Ge][1]+G[ge][1]);oe>=0!=!!Q&&G.reverse()}Rt.prototype.loadTile=function(G,Q){var oe=G.uid,ge=G.encoding,Pe=G.rawImageData,Ge=He&&Pe instanceof He?this.getImageData(Pe):Pe,et=new m.DEMData(oe,Ge,ge);this.loaded=this.loaded||{},this.loaded[oe]=et,Q(null,et)},Rt.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var Q=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:Q.width,height:Q.height},Q.data)},Rt.prototype.removeTile=function(G){var Q=this.loaded,oe=G.uid;Q&&Q[oe]&&delete Q[oe]};var Ut=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,dt=function(G){this._feature=G,this.extent=m.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};dt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],Q=0,oe=this._feature.geometry;Q<oe.length;Q+=1){var ge=oe[Q];G.push([new m.Point$1(ge[0],ge[1])])}return G}for(var Pe=[],Ge=0,et=this._feature.geometry;Ge<et.length;Ge+=1){for(var fe=[],ke=0,vt=et[Ge];ke<vt.length;ke+=1){var hr=vt[ke];fe.push(new m.Point$1(hr[0],hr[1]))}Pe.push(fe)}return Pe},dt.prototype.toGeoJSON=function(G,Q,oe){return Ut.call(this,G,Q,oe)};var nt=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=G.length,this._features=G};nt.prototype.feature=function(G){return new dt(this._features[G])};var rt=m.vectorTile.VectorTileFeature,er=K;function K(G,Q){this.options=Q||{},this.features=G,this.length=G.length}function Ht(G,Q){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=Q||4096}K.prototype.feature=function(G){return new Ht(this.features[G],this.options.extent)},Ht.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var Q=0;Q<G.length;Q++){for(var oe=G[Q],ge=[],Pe=0;Pe<oe.length;Pe++)ge.push(new m.Point$1(oe[Pe][0],oe[Pe][1]));this.geometry.push(ge)}return this.geometry},Ht.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,Q=1/0,oe=-1/0,ge=1/0,Pe=-1/0,Ge=0;Ge<G.length;Ge++)for(var et=G[Ge],fe=0;fe<et.length;fe++){var ke=et[fe];Q=Math.min(Q,ke.x),oe=Math.max(oe,ke.x),ge=Math.min(ge,ke.y),Pe=Math.max(Pe,ke.y)}return[Q,ge,oe,Pe]},Ht.prototype.toGeoJSON=rt.prototype.toGeoJSON;var at=ut,Ye=er;function ut(G){var Q=new m.pbf;return function(oe,ge){for(var Pe in oe.layers)ge.writeMessage(3,Je,oe.layers[Pe])}(G,Q),Q.finish()}function Je(G,Q){var oe;Q.writeVarintField(15,G.version||1),Q.writeStringField(1,G.name||""),Q.writeVarintField(5,G.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(oe=0;oe<G.length;oe++)ge.feature=G.feature(oe),Q.writeMessage(2,Ot,ge);var Pe=ge.keys;for(oe=0;oe<Pe.length;oe++)Q.writeStringField(3,Pe[oe]);var Ge=ge.values;for(oe=0;oe<Ge.length;oe++)Q.writeMessage(4,we,Ge[oe])}function Ot(G,Q){var oe=G.feature;oe.id!==void 0&&Q.writeVarintField(1,oe.id),Q.writeMessage(2,dr,G),Q.writeVarintField(3,oe.type),Q.writeMessage(4,T,oe)}function dr(G,Q){var oe=G.feature,ge=G.keys,Pe=G.values,Ge=G.keycache,et=G.valuecache;for(var fe in oe.properties){var ke=Ge[fe];ke===void 0&&(ge.push(fe),Ge[fe]=ke=ge.length-1),Q.writeVarint(ke);var vt=oe.properties[fe],hr=typeof vt;hr!=="string"&&hr!=="boolean"&&hr!=="number"&&(vt=JSON.stringify(vt));var Pt=hr+":"+vt,Dt=et[Pt];Dt===void 0&&(Pe.push(vt),et[Pt]=Dt=Pe.length-1),Q.writeVarint(Dt)}}function Cr(G,Q){return(Q<<3)+(7&G)}function jr(G){return G<<1^G>>31}function T(G,Q){for(var oe=G.loadGeometry(),ge=G.type,Pe=0,Ge=0,et=oe.length,fe=0;fe<et;fe++){var ke=oe[fe],vt=1;ge===1&&(vt=ke.length),Q.writeVarint(Cr(1,vt));for(var hr=ge===3?ke.length-1:ke.length,Pt=0;Pt<hr;Pt++){Pt===1&&ge!==1&&Q.writeVarint(Cr(2,hr-1));var Dt=ke[Pt].x-Pe,pr=ke[Pt].y-Ge;Q.writeVarint(jr(Dt)),Q.writeVarint(jr(pr)),Pe+=Dt,Ge+=pr}ge===3&&Q.writeVarint(Cr(7,1))}}function we(G,Q){var oe=typeof G;oe==="string"?Q.writeStringField(1,G):oe==="boolean"?Q.writeBooleanField(7,G):oe==="number"&&(G%1!=0?Q.writeDoubleField(3,G):G<0?Q.writeSVarintField(6,G):Q.writeVarintField(5,G))}function De(G,Q,oe,ge){bt(G,oe,ge),bt(Q,2*oe,2*ge),bt(Q,2*oe+1,2*ge+1)}function bt(G,Q,oe){var ge=G[Q];G[Q]=G[oe],G[oe]=ge}function mt(G,Q,oe,ge){var Pe=G-oe,Ge=Q-ge;return Pe*Pe+Ge*Ge}at.fromVectorTileJs=ut,at.fromGeojsonVt=function(G,Q){Q=Q||{};var oe={};for(var ge in G)oe[ge]=new er(G[ge].features,Q),oe[ge].name=ge,oe[ge].version=Q.version,oe[ge].extent=Q.extent;return ut({layers:oe})},at.GeoJSONWrapper=Ye;var Lt=function(G){return G[0]},Yt=function(G){return G[1]},br=function(G,Q,oe,ge,Pe){Q===void 0&&(Q=Lt),oe===void 0&&(oe=Yt),ge===void 0&&(ge=64),Pe===void 0&&(Pe=Float64Array),this.nodeSize=ge,this.points=G;for(var Ge=G.length<65536?Uint16Array:Uint32Array,et=this.ids=new Ge(G.length),fe=this.coords=new Pe(2*G.length),ke=0;ke<G.length;ke++)et[ke]=ke,fe[2*ke]=Q(G[ke]),fe[2*ke+1]=oe(G[ke]);(function vt(hr,Pt,Dt,pr,mn,un){if(!(mn-pr<=Dt)){var Tt=pr+mn>>1;(function $r(Fr,Gr,vi,Jr,Pn,Wi){for(;Pn>Jr;){if(Pn-Jr>600){var pi=Pn-Jr+1,Ci=vi-Jr+1,_i=Math.log(pi),St=.5*Math.exp(2*_i/3),Kt=.5*Math.sqrt(_i*St*(pi-St)/pi)*(Ci-pi/2<0?-1:1);$r(Fr,Gr,vi,Math.max(Jr,Math.floor(vi-Ci*St/pi+Kt)),Math.min(Pn,Math.floor(vi+(pi-Ci)*St/pi+Kt)),Wi)}var Ca=Gr[2*vi+Wi],Ei=Jr,Mi=Pn;for(De(Fr,Gr,Jr,vi),Gr[2*Pn+Wi]>Ca&&De(Fr,Gr,Jr,Pn);Ei<Mi;){for(De(Fr,Gr,Ei,Mi),Ei++,Mi--;Gr[2*Ei+Wi]<Ca;)Ei++;for(;Gr[2*Mi+Wi]>Ca;)Mi--}Gr[2*Jr+Wi]===Ca?De(Fr,Gr,Jr,Mi):De(Fr,Gr,++Mi,Pn),Mi<=vi&&(Jr=Mi+1),vi<=Mi&&(Pn=Mi-1)}})(hr,Pt,Tt,pr,mn,un%2),vt(hr,Pt,Dt,pr,Tt-1,un+1),vt(hr,Pt,Dt,Tt+1,mn,un+1)}})(et,fe,ge,0,et.length-1,0)};br.prototype.range=function(G,Q,oe,ge){return function(Pe,Ge,et,fe,ke,vt,hr){for(var Pt,Dt,pr=[0,Pe.length-1,0],mn=[];pr.length;){var un=pr.pop(),Tt=pr.pop(),$r=pr.pop();if(Tt-$r<=hr)for(var Fr=$r;Fr<=Tt;Fr++)Dt=Ge[2*Fr+1],(Pt=Ge[2*Fr])>=et&&Pt<=ke&&Dt>=fe&&Dt<=vt&&mn.push(Pe[Fr]);else{var Gr=Math.floor(($r+Tt)/2);Dt=Ge[2*Gr+1],(Pt=Ge[2*Gr])>=et&&Pt<=ke&&Dt>=fe&&Dt<=vt&&mn.push(Pe[Gr]);var vi=(un+1)%2;(un===0?et<=Pt:fe<=Dt)&&(pr.push($r),pr.push(Gr-1),pr.push(vi)),(un===0?ke>=Pt:vt>=Dt)&&(pr.push(Gr+1),pr.push(Tt),pr.push(vi))}}return mn}(this.ids,this.coords,G,Q,oe,ge,this.nodeSize)},br.prototype.within=function(G,Q,oe){return function(ge,Pe,Ge,et,fe,ke){for(var vt=[0,ge.length-1,0],hr=[],Pt=fe*fe;vt.length;){var Dt=vt.pop(),pr=vt.pop(),mn=vt.pop();if(pr-mn<=ke)for(var un=mn;un<=pr;un++)mt(Pe[2*un],Pe[2*un+1],Ge,et)<=Pt&&hr.push(ge[un]);else{var Tt=Math.floor((mn+pr)/2),$r=Pe[2*Tt],Fr=Pe[2*Tt+1];mt($r,Fr,Ge,et)<=Pt&&hr.push(ge[Tt]);var Gr=(Dt+1)%2;(Dt===0?Ge-fe<=$r:et-fe<=Fr)&&(vt.push(mn),vt.push(Tt-1),vt.push(Gr)),(Dt===0?Ge+fe>=$r:et+fe>=Fr)&&(vt.push(Tt+1),vt.push(pr),vt.push(Gr))}}return hr}(this.ids,this.coords,G,Q,oe,this.nodeSize)};var Kn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},cn=function(G){this.options=ua(Object.create(Kn),G),this.trees=new Array(this.options.maxZoom+1)};function li(G,Q,oe,ge,Pe){return{x:G,y:Q,zoom:1/0,id:oe,parentId:-1,numPoints:ge,properties:Pe}}function Vn(G,Q){var oe=G.geometry.coordinates,ge=oe[1];return{x:Hn(oe[0]),y:fi(ge),zoom:1/0,index:Q,parentId:-1}}function ti(G){return{type:"Feature",id:G.id,properties:ci(G),geometry:{type:"Point",coordinates:[(ge=G.x,360*(ge-.5)),(Q=G.y,oe=(180-360*Q)*Math.PI/180,360*Math.atan(Math.exp(oe))/Math.PI-90)]}};var Q,oe,ge}function ci(G){var Q=G.numPoints,oe=Q>=1e4?Math.round(Q/1e3)+"k":Q>=1e3?Math.round(Q/100)/10+"k":Q;return ua(ua({},G.properties),{cluster:!0,cluster_id:G.id,point_count:Q,point_count_abbreviated:oe})}function Hn(G){return G/360+.5}function fi(G){var Q=Math.sin(G*Math.PI/180),oe=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return oe<0?0:oe>1?1:oe}function ua(G,Q){for(var oe in Q)G[oe]=Q[oe];return G}function Vi(G){return G.x}function ki(G){return G.y}function Ki(G,Q,oe,ge,Pe,Ge){var et=Pe-oe,fe=Ge-ge;if(et!==0||fe!==0){var ke=((G-oe)*et+(Q-ge)*fe)/(et*et+fe*fe);ke>1?(oe=Pe,ge=Ge):ke>0&&(oe+=et*ke,ge+=fe*ke)}return(et=G-oe)*et+(fe=Q-ge)*fe}function la(G,Q,oe,ge){var Pe={id:G===void 0?null:G,type:Q,geometry:oe,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ge){var et=Ge.geometry,fe=Ge.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")Ai(Ge,et);else if(fe==="Polygon"||fe==="MultiLineString")for(var ke=0;ke<et.length;ke++)Ai(Ge,et[ke]);else if(fe==="MultiPolygon")for(ke=0;ke<et.length;ke++)for(var vt=0;vt<et[ke].length;vt++)Ai(Ge,et[ke][vt])}(Pe),Pe}function Ai(G,Q){for(var oe=0;oe<Q.length;oe+=3)G.minX=Math.min(G.minX,Q[oe]),G.minY=Math.min(G.minY,Q[oe+1]),G.maxX=Math.max(G.maxX,Q[oe]),G.maxY=Math.max(G.maxY,Q[oe+1])}function ma(G,Q,oe,ge){if(Q.geometry){var Pe=Q.geometry.coordinates,Ge=Q.geometry.type,et=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2),fe=[],ke=Q.id;if(oe.promoteId?ke=Q.properties[oe.promoteId]:oe.generateId&&(ke=ge||0),Ge==="Point")Xn(Pe,fe);else if(Ge==="MultiPoint")for(var vt=0;vt<Pe.length;vt++)Xn(Pe[vt],fe);else if(Ge==="LineString")bi(Pe,fe,et,!1);else if(Ge==="MultiLineString"){if(oe.lineMetrics){for(vt=0;vt<Pe.length;vt++)bi(Pe[vt],fe=[],et,!1),G.push(la(ke,"LineString",fe,Q.properties));return}zi(Pe,fe,et,!1)}else if(Ge==="Polygon")zi(Pe,fe,et,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(vt=0;vt<Q.geometry.geometries.length;vt++)ma(G,{id:ke,geometry:Q.geometry.geometries[vt],properties:Q.properties},oe,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(vt=0;vt<Pe.length;vt++){var hr=[];zi(Pe[vt],hr,et,!0),fe.push(hr)}}G.push(la(ke,Ge,fe,Q.properties))}}function Xn(G,Q){Q.push(qi(G[0])),Q.push(ko(G[1])),Q.push(0)}function bi(G,Q,oe,ge){for(var Pe,Ge,et=0,fe=0;fe<G.length;fe++){var ke=qi(G[fe][0]),vt=ko(G[fe][1]);Q.push(ke),Q.push(vt),Q.push(0),fe>0&&(et+=ge?(Pe*vt-ke*Ge)/2:Math.sqrt(Math.pow(ke-Pe,2)+Math.pow(vt-Ge,2))),Pe=ke,Ge=vt}var hr=Q.length-3;Q[2]=1,function Pt(Dt,pr,mn,un){for(var Tt,$r=un,Fr=mn-pr>>1,Gr=mn-pr,vi=Dt[pr],Jr=Dt[pr+1],Pn=Dt[mn],Wi=Dt[mn+1],pi=pr+3;pi<mn;pi+=3){var Ci=Ki(Dt[pi],Dt[pi+1],vi,Jr,Pn,Wi);if(Ci>$r)Tt=pi,$r=Ci;else if(Ci===$r){var _i=Math.abs(pi-Fr);_i<Gr&&(Tt=pi,Gr=_i)}}$r>un&&(Tt-pr>3&&Pt(Dt,pr,Tt,un),Dt[Tt+2]=$r,mn-Tt>3&&Pt(Dt,Tt,mn,un))}(Q,0,hr,oe),Q[hr+2]=1,Q.size=Math.abs(et),Q.start=0,Q.end=Q.size}function zi(G,Q,oe,ge){for(var Pe=0;Pe<G.length;Pe++){var Ge=[];bi(G[Pe],Ge,oe,ge),Q.push(Ge)}}function qi(G){return G/360+.5}function ko(G){var Q=Math.sin(G*Math.PI/180),oe=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return oe<0?0:oe>1?1:oe}function de(G,Q,oe,ge,Pe,Ge,et,fe){if(ge/=Q,Ge>=(oe/=Q)&&et<ge)return G;if(et<oe||Ge>=ge)return null;for(var ke=[],vt=0;vt<G.length;vt++){var hr=G[vt],Pt=hr.geometry,Dt=hr.type,pr=Pe===0?hr.minX:hr.minY,mn=Pe===0?hr.maxX:hr.maxY;if(pr>=oe&&mn<ge)ke.push(hr);else if(!(mn<oe||pr>=ge)){var un=[];if(Dt==="Point"||Dt==="MultiPoint")Ln(Pt,un,oe,ge,Pe);else if(Dt==="LineString")Za(Pt,un,oe,ge,Pe,!1,fe.lineMetrics);else if(Dt==="MultiLineString")kt(Pt,un,oe,ge,Pe,!1);else if(Dt==="Polygon")kt(Pt,un,oe,ge,Pe,!0);else if(Dt==="MultiPolygon")for(var Tt=0;Tt<Pt.length;Tt++){var $r=[];kt(Pt[Tt],$r,oe,ge,Pe,!0),$r.length&&un.push($r)}if(un.length){if(fe.lineMetrics&&Dt==="LineString"){for(Tt=0;Tt<un.length;Tt++)ke.push(la(hr.id,Dt,un[Tt],hr.tags));continue}Dt!=="LineString"&&Dt!=="MultiLineString"||(un.length===1?(Dt="LineString",un=un[0]):Dt="MultiLineString"),Dt!=="Point"&&Dt!=="MultiPoint"||(Dt=un.length===3?"Point":"MultiPoint"),ke.push(la(hr.id,Dt,un,hr.tags))}}}return ke.length?ke:null}function Ln(G,Q,oe,ge,Pe){for(var Ge=0;Ge<G.length;Ge+=3){var et=G[Ge+Pe];et>=oe&&et<=ge&&(Q.push(G[Ge]),Q.push(G[Ge+1]),Q.push(G[Ge+2]))}}function Za(G,Q,oe,ge,Pe,Ge,et){for(var fe,ke,vt=rs(G),hr=Pe===0?Sr:qr,Pt=G.start,Dt=0;Dt<G.length-3;Dt+=3){var pr=G[Dt],mn=G[Dt+1],un=G[Dt+2],Tt=G[Dt+3],$r=G[Dt+4],Fr=Pe===0?pr:mn,Gr=Pe===0?Tt:$r,vi=!1;et&&(fe=Math.sqrt(Math.pow(pr-Tt,2)+Math.pow(mn-$r,2))),Fr<oe?Gr>oe&&(ke=hr(vt,pr,mn,Tt,$r,oe),et&&(vt.start=Pt+fe*ke)):Fr>ge?Gr<ge&&(ke=hr(vt,pr,mn,Tt,$r,ge),et&&(vt.start=Pt+fe*ke)):tr(vt,pr,mn,un),Gr<oe&&Fr>=oe&&(ke=hr(vt,pr,mn,Tt,$r,oe),vi=!0),Gr>ge&&Fr<=ge&&(ke=hr(vt,pr,mn,Tt,$r,ge),vi=!0),!Ge&&vi&&(et&&(vt.end=Pt+fe*ke),Q.push(vt),vt=rs(G)),et&&(Pt+=fe)}var Jr=G.length-3;pr=G[Jr],mn=G[Jr+1],un=G[Jr+2],(Fr=Pe===0?pr:mn)>=oe&&Fr<=ge&&tr(vt,pr,mn,un),Jr=vt.length-3,Ge&&Jr>=3&&(vt[Jr]!==vt[0]||vt[Jr+1]!==vt[1])&&tr(vt,vt[0],vt[1],vt[2]),vt.length&&Q.push(vt)}function rs(G){var Q=[];return Q.size=G.size,Q.start=G.start,Q.end=G.end,Q}function kt(G,Q,oe,ge,Pe,Ge){for(var et=0;et<G.length;et++)Za(G[et],Q,oe,ge,Pe,Ge,!1)}function tr(G,Q,oe,ge){G.push(Q),G.push(oe),G.push(ge)}function Sr(G,Q,oe,ge,Pe,Ge){var et=(Ge-Q)/(ge-Q);return G.push(Ge),G.push(oe+(Pe-oe)*et),G.push(1),et}function qr(G,Q,oe,ge,Pe,Ge){var et=(Ge-oe)/(Pe-oe);return G.push(Q+(ge-Q)*et),G.push(Ge),G.push(1),et}function xn(G,Q){for(var oe=[],ge=0;ge<G.length;ge++){var Pe,Ge=G[ge],et=Ge.type;if(et==="Point"||et==="MultiPoint"||et==="LineString")Pe=kn(Ge.geometry,Q);else if(et==="MultiLineString"||et==="Polygon"){Pe=[];for(var fe=0;fe<Ge.geometry.length;fe++)Pe.push(kn(Ge.geometry[fe],Q))}else if(et==="MultiPolygon")for(Pe=[],fe=0;fe<Ge.geometry.length;fe++){for(var ke=[],vt=0;vt<Ge.geometry[fe].length;vt++)ke.push(kn(Ge.geometry[fe][vt],Q));Pe.push(ke)}oe.push(la(Ge.id,et,Pe,Ge.tags))}return oe}function kn(G,Q){var oe=[];oe.size=G.size,G.start!==void 0&&(oe.start=G.start,oe.end=G.end);for(var ge=0;ge<G.length;ge+=3)oe.push(G[ge]+Q,G[ge+1],G[ge+2]);return oe}function hi(G,Q){if(G.transformed)return G;var oe,ge,Pe,Ge=1<<G.z,et=G.x,fe=G.y;for(oe=0;oe<G.features.length;oe++){var ke=G.features[oe],vt=ke.geometry,hr=ke.type;if(ke.geometry=[],hr===1)for(ge=0;ge<vt.length;ge+=2)ke.geometry.push(qn(vt[ge],vt[ge+1],Q,Ge,et,fe));else for(ge=0;ge<vt.length;ge++){var Pt=[];for(Pe=0;Pe<vt[ge].length;Pe+=2)Pt.push(qn(vt[ge][Pe],vt[ge][Pe+1],Q,Ge,et,fe));ke.geometry.push(Pt)}}return G.transformed=!0,G}function qn(G,Q,oe,ge,Pe,Ge){return[Math.round(oe*(G*ge-Pe)),Math.round(oe*(Q*ge-Ge))]}function an(G,Q,oe,ge,Pe){for(var Ge=Q===Pe.maxZoom?0:Pe.tolerance/((1<<Q)*Pe.extent),et={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:oe,y:ge,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<G.length;fe++){et.numFeatures++,Di(et,G[fe],Ge,Pe);var ke=G[fe].minX,vt=G[fe].minY,hr=G[fe].maxX,Pt=G[fe].maxY;ke<et.minX&&(et.minX=ke),vt<et.minY&&(et.minY=vt),hr>et.maxX&&(et.maxX=hr),Pt>et.maxY&&(et.maxY=Pt)}return et}function Di(G,Q,oe,ge){var Pe=Q.geometry,Ge=Q.type,et=[];if(Ge==="Point"||Ge==="MultiPoint")for(var fe=0;fe<Pe.length;fe+=3)et.push(Pe[fe]),et.push(Pe[fe+1]),G.numPoints++,G.numSimplified++;else if(Ge==="LineString")Oi(et,Pe,G,oe,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(fe=0;fe<Pe.length;fe++)Oi(et,Pe[fe],G,oe,Ge==="Polygon",fe===0);else if(Ge==="MultiPolygon")for(var ke=0;ke<Pe.length;ke++){var vt=Pe[ke];for(fe=0;fe<vt.length;fe++)Oi(et,vt[fe],G,oe,!0,fe===0)}if(et.length){var hr=Q.tags||null;if(Ge==="LineString"&&ge.lineMetrics){for(var Pt in hr={},Q.tags)hr[Pt]=Q.tags[Pt];hr.mapbox_clip_start=Pe.start/Pe.size,hr.mapbox_clip_end=Pe.end/Pe.size}var Dt={geometry:et,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:hr};Q.id!==null&&(Dt.id=Q.id),G.features.push(Dt)}}function Oi(G,Q,oe,ge,Pe,Ge){var et=ge*ge;if(ge>0&&Q.size<(Pe?et:ge))oe.numPoints+=Q.length/3;else{for(var fe=[],ke=0;ke<Q.length;ke+=3)(ge===0||Q[ke+2]>et)&&(oe.numSimplified++,fe.push(Q[ke]),fe.push(Q[ke+1])),oe.numPoints++;Pe&&function(vt,hr){for(var Pt=0,Dt=0,pr=vt.length,mn=pr-2;Dt<pr;mn=Dt,Dt+=2)Pt+=(vt[Dt]-vt[mn])*(vt[Dt+1]+vt[mn+1]);if(Pt>0===hr)for(Dt=0,pr=vt.length;Dt<pr/2;Dt+=2){var un=vt[Dt],Tt=vt[Dt+1];vt[Dt]=vt[pr-2-Dt],vt[Dt+1]=vt[pr-1-Dt],vt[pr-2-Dt]=un,vt[pr-1-Dt]=Tt}}(fe,Ge),G.push(fe)}}function to(G,Q){var oe=(Q=this.options=function(Pe,Ge){for(var et in Ge)Pe[et]=Ge[et];return Pe}(Object.create(this.options),Q)).debug;if(oe&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(Pe,Ge){var et=[];if(Pe.type==="FeatureCollection")for(var fe=0;fe<Pe.features.length;fe++)ma(et,Pe.features[fe],Ge,fe);else ma(et,Pe.type==="Feature"?Pe:{geometry:Pe},Ge);return et}(G,Q);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ge=function(Pe,Ge){var et=Ge.buffer/Ge.extent,fe=Pe,ke=de(Pe,1,-1-et,et,0,-1,2,Ge),vt=de(Pe,1,1-et,2+et,0,-1,2,Ge);return(ke||vt)&&(fe=de(Pe,1,-et,1+et,0,-1,2,Ge)||[],ke&&(fe=xn(ke,1).concat(fe)),vt&&(fe=fe.concat(xn(vt,-1)))),fe}(ge,Q)).length&&this.splitTile(ge,0,0,0),oe&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ps(G,Q,oe){return 32*((1<<G)*oe+Q)+G}function Zo(G,Q){var oe=G.tileID.canonical;if(!this._geoJSONIndex)return Q(null,null);var ge=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!ge)return Q(null,null);var Pe=new nt(ge.features),Ge=at(Pe);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),Q(null,{vectorTile:Pe,rawData:Ge.buffer})}cn.prototype.load=function(G){var Q=this.options,oe=Q.log,ge=Q.minZoom,Pe=Q.maxZoom,Ge=Q.nodeSize;oe&&console.time("total time");var et="prepare "+G.length+" points";oe&&console.time(et),this.points=G;for(var fe=[],ke=0;ke<G.length;ke++)G[ke].geometry&&fe.push(Vn(G[ke],ke));this.trees[Pe+1]=new br(fe,Vi,ki,Ge,Float32Array),oe&&console.timeEnd(et);for(var vt=Pe;vt>=ge;vt--){var hr=+Date.now();fe=this._cluster(fe,vt),this.trees[vt]=new br(fe,Vi,ki,Ge,Float32Array),oe&&console.log("z%d: %d clusters in %dms",vt,fe.length,+Date.now()-hr)}return oe&&console.timeEnd("total time"),this},cn.prototype.getClusters=function(G,Q){var oe=((G[0]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,G[1])),Pe=G[2]===180?180:((G[2]+180)%360+360)%360-180,Ge=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)oe=-180,Pe=180;else if(oe>Pe){var et=this.getClusters([oe,ge,180,Ge],Q),fe=this.getClusters([-180,ge,Pe,Ge],Q);return et.concat(fe)}for(var ke=this.trees[this._limitZoom(Q)],vt=[],hr=0,Pt=ke.range(Hn(oe),fi(Ge),Hn(Pe),fi(ge));hr<Pt.length;hr+=1){var Dt=ke.points[Pt[hr]];vt.push(Dt.numPoints?ti(Dt):this.points[Dt.index])}return vt},cn.prototype.getChildren=function(G){var Q=this._getOriginId(G),oe=this._getOriginZoom(G),ge="No cluster with the specified id.",Pe=this.trees[oe];if(!Pe)throw new Error(ge);var Ge=Pe.points[Q];if(!Ge)throw new Error(ge);for(var et=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),fe=[],ke=0,vt=Pe.within(Ge.x,Ge.y,et);ke<vt.length;ke+=1){var hr=Pe.points[vt[ke]];hr.parentId===G&&fe.push(hr.numPoints?ti(hr):this.points[hr.index])}if(fe.length===0)throw new Error(ge);return fe},cn.prototype.getLeaves=function(G,Q,oe){var ge=[];return this._appendLeaves(ge,G,Q=Q||10,oe=oe||0,0),ge},cn.prototype.getTile=function(G,Q,oe){var ge=this.trees[this._limitZoom(G)],Pe=Math.pow(2,G),Ge=this.options,et=Ge.radius/Ge.extent,fe=(oe-et)/Pe,ke=(oe+1+et)/Pe,vt={features:[]};return this._addTileFeatures(ge.range((Q-et)/Pe,fe,(Q+1+et)/Pe,ke),ge.points,Q,oe,Pe,vt),Q===0&&this._addTileFeatures(ge.range(1-et/Pe,fe,1,ke),ge.points,Pe,oe,Pe,vt),Q===Pe-1&&this._addTileFeatures(ge.range(0,fe,et/Pe,ke),ge.points,-1,oe,Pe,vt),vt.features.length?vt:null},cn.prototype.getClusterExpansionZoom=function(G){for(var Q=this._getOriginZoom(G)-1;Q<=this.options.maxZoom;){var oe=this.getChildren(G);if(Q++,oe.length!==1)break;G=oe[0].properties.cluster_id}return Q},cn.prototype._appendLeaves=function(G,Q,oe,ge,Pe){for(var Ge=0,et=this.getChildren(Q);Ge<et.length;Ge+=1){var fe=et[Ge],ke=fe.properties;if(ke&&ke.cluster?Pe+ke.point_count<=ge?Pe+=ke.point_count:Pe=this._appendLeaves(G,ke.cluster_id,oe,ge,Pe):Pe<ge?Pe++:G.push(fe),G.length===oe)break}return Pe},cn.prototype._addTileFeatures=function(G,Q,oe,ge,Pe,Ge){for(var et=0,fe=G;et<fe.length;et+=1){var ke=Q[fe[et]],vt=ke.numPoints,hr={type:1,geometry:[[Math.round(this.options.extent*(ke.x*Pe-oe)),Math.round(this.options.extent*(ke.y*Pe-ge))]],tags:vt?ci(ke):this.points[ke.index].properties},Pt=void 0;vt?Pt=ke.id:this.options.generateId?Pt=ke.index:this.points[ke.index].id&&(Pt=this.points[ke.index].id),Pt!==void 0&&(hr.id=Pt),Ge.features.push(hr)}},cn.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},cn.prototype._cluster=function(G,Q){for(var oe=[],ge=this.options,Pe=ge.reduce,Ge=ge.minPoints,et=ge.radius/(ge.extent*Math.pow(2,Q)),fe=0;fe<G.length;fe++){var ke=G[fe];if(!(ke.zoom<=Q)){ke.zoom=Q;for(var vt=this.trees[Q+1],hr=vt.within(ke.x,ke.y,et),Pt=ke.numPoints||1,Dt=Pt,pr=0,mn=hr;pr<mn.length;pr+=1){var un=vt.points[mn[pr]];un.zoom>Q&&(Dt+=un.numPoints||1)}if(Dt>=Ge){for(var Tt=ke.x*Pt,$r=ke.y*Pt,Fr=Pe&&Pt>1?this._map(ke,!0):null,Gr=(fe<<5)+(Q+1)+this.points.length,vi=0,Jr=hr;vi<Jr.length;vi+=1){var Pn=vt.points[Jr[vi]];if(!(Pn.zoom<=Q)){Pn.zoom=Q;var Wi=Pn.numPoints||1;Tt+=Pn.x*Wi,$r+=Pn.y*Wi,Pn.parentId=Gr,Pe&&(Fr||(Fr=this._map(ke,!0)),Pe(Fr,this._map(Pn)))}}ke.parentId=Gr,oe.push(li(Tt/Dt,$r/Dt,Gr,Dt,Fr))}else if(oe.push(ke),Dt>1)for(var pi=0,Ci=hr;pi<Ci.length;pi+=1){var _i=vt.points[Ci[pi]];_i.zoom<=Q||(_i.zoom=Q,oe.push(_i))}}}return oe},cn.prototype._getOriginId=function(G){return G-this.points.length>>5},cn.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},cn.prototype._map=function(G,Q){if(G.numPoints)return Q?ua({},G.properties):G.properties;var oe=this.points[G.index].properties,ge=this.options.map(oe);return Q&&ge===oe?ua({},ge):ge},to.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},to.prototype.splitTile=function(G,Q,oe,ge,Pe,Ge,et){for(var fe=[G,Q,oe,ge],ke=this.options,vt=ke.debug;fe.length;){ge=fe.pop(),oe=fe.pop(),Q=fe.pop(),G=fe.pop();var hr=1<<Q,Pt=ps(Q,oe,ge),Dt=this.tiles[Pt];if(!Dt&&(vt>1&&console.time("creation"),Dt=this.tiles[Pt]=an(G,Q,oe,ge,ke),this.tileCoords.push({z:Q,x:oe,y:ge}),vt)){vt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,oe,ge,Dt.numFeatures,Dt.numPoints,Dt.numSimplified),console.timeEnd("creation"));var pr="z"+Q;this.stats[pr]=(this.stats[pr]||0)+1,this.total++}if(Dt.source=G,Pe){if(Q===ke.maxZoom||Q===Pe)continue;var mn=1<<Pe-Q;if(oe!==Math.floor(Ge/mn)||ge!==Math.floor(et/mn))continue}else if(Q===ke.indexMaxZoom||Dt.numPoints<=ke.indexMaxPoints)continue;if(Dt.source=null,G.length!==0){vt>1&&console.time("clipping");var un,Tt,$r,Fr,Gr,vi,Jr=.5*ke.buffer/ke.extent,Pn=.5-Jr,Wi=.5+Jr,pi=1+Jr;un=Tt=$r=Fr=null,Gr=de(G,hr,oe-Jr,oe+Wi,0,Dt.minX,Dt.maxX,ke),vi=de(G,hr,oe+Pn,oe+pi,0,Dt.minX,Dt.maxX,ke),G=null,Gr&&(un=de(Gr,hr,ge-Jr,ge+Wi,1,Dt.minY,Dt.maxY,ke),Tt=de(Gr,hr,ge+Pn,ge+pi,1,Dt.minY,Dt.maxY,ke),Gr=null),vi&&($r=de(vi,hr,ge-Jr,ge+Wi,1,Dt.minY,Dt.maxY,ke),Fr=de(vi,hr,ge+Pn,ge+pi,1,Dt.minY,Dt.maxY,ke),vi=null),vt>1&&console.timeEnd("clipping"),fe.push(un||[],Q+1,2*oe,2*ge),fe.push(Tt||[],Q+1,2*oe,2*ge+1),fe.push($r||[],Q+1,2*oe+1,2*ge),fe.push(Fr||[],Q+1,2*oe+1,2*ge+1)}}},to.prototype.getTile=function(G,Q,oe){var ge=this.options,Pe=ge.extent,Ge=ge.debug;if(G<0||G>24)return null;var et=1<<G,fe=ps(G,Q=(Q%et+et)%et,oe);if(this.tiles[fe])return hi(this.tiles[fe],Pe);Ge>1&&console.log("drilling down to z%d-%d-%d",G,Q,oe);for(var ke,vt=G,hr=Q,Pt=oe;!ke&&vt>0;)vt--,hr=Math.floor(hr/2),Pt=Math.floor(Pt/2),ke=this.tiles[ps(vt,hr,Pt)];return ke&&ke.source?(Ge>1&&console.log("found parent tile z%d-%d-%d",vt,hr,Pt),Ge>1&&console.time("drilling down"),this.splitTile(ke.source,vt,hr,Pt,G,Q,oe),Ge>1&&console.timeEnd("drilling down"),this.tiles[fe]?hi(this.tiles[fe],Pe):null):null};var Na=function(G){function Q(oe,ge,Pe,Ge){G.call(this,oe,ge,Pe,Zo),Ge&&(this.loadGeoJSON=Ge)}return G&&(Q.__proto__=G),(Q.prototype=Object.create(G&&G.prototype)).constructor=Q,Q.prototype.loadData=function(oe,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ge,this._pendingLoadDataParams=oe,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},Q.prototype._loadData=function(){var oe=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ge=this._pendingCallback,Pe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ge=!!(Pe&&Pe.request&&Pe.request.collectResourceTiming)&&new m.RequestPerformance(Pe.request);this.loadGeoJSON(Pe,function(et,fe){if(et||!fe)return ge(et);if(typeof fe!="object")return ge(new Error("Input data given to '"+Pe.source+"' is not a valid GeoJSON object."));(function Dt(pr,mn){var un,Tt=pr&&pr.type;if(Tt==="FeatureCollection")for(un=0;un<pr.features.length;un++)Dt(pr.features[un],mn);else if(Tt==="GeometryCollection")for(un=0;un<pr.geometries.length;un++)Dt(pr.geometries[un],mn);else if(Tt==="Feature")Dt(pr.geometry,mn);else if(Tt==="Polygon")$t(pr.coordinates,mn);else if(Tt==="MultiPolygon")for(un=0;un<pr.coordinates.length;un++)$t(pr.coordinates[un],mn);return pr})(fe,!0);try{if(Pe.filter){var ke=m.createExpression(Pe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ke.result==="error")throw new Error(ke.value.map(function(Dt){return Dt.key+": "+Dt.message}).join(", "));var vt=fe.features.filter(function(Dt){return ke.value.evaluate({zoom:0},Dt)});fe={type:"FeatureCollection",features:vt}}oe._geoJSONIndex=Pe.cluster?new cn(function(Dt){var pr=Dt.superclusterOptions,mn=Dt.clusterProperties;if(!mn||!pr)return pr;for(var un={},Tt={},$r={accumulated:null,zoom:0},Fr={properties:null},Gr=Object.keys(mn),vi=0,Jr=Gr;vi<Jr.length;vi+=1){var Pn=Jr[vi],Wi=mn[Pn],pi=Wi[0],Ci=m.createExpression(Wi[1]),_i=m.createExpression(typeof pi=="string"?[pi,["accumulated"],["get",Pn]]:pi);un[Pn]=Ci.value,Tt[Pn]=_i.value}return pr.map=function(St){Fr.properties=St;for(var Kt={},Ca=0,Ei=Gr;Ca<Ei.length;Ca+=1){var Mi=Ei[Ca];Kt[Mi]=un[Mi].evaluate($r,Fr)}return Kt},pr.reduce=function(St,Kt){Fr.properties=Kt;for(var Ca=0,Ei=Gr;Ca<Ei.length;Ca+=1){var Mi=Ei[Ca];$r.accumulated=St[Mi],St[Mi]=Tt[Mi].evaluate($r,Fr)}},pr}(Pe)).load(fe.features):function(Dt,pr){return new to(Dt,pr)}(fe,Pe.geojsonVtOptions)}catch(Dt){return ge(Dt)}oe.loaded={};var hr={};if(Ge){var Pt=Ge.finish();Pt&&(hr.resourceTiming={},hr.resourceTiming[Pe.source]=JSON.parse(JSON.stringify(Pt)))}ge(null,hr)})}},Q.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},Q.prototype.reloadTile=function(oe,ge){var Pe=this.loaded;return Pe&&Pe[oe.uid]?G.prototype.reloadTile.call(this,oe,ge):this.loadTile(oe,ge)},Q.prototype.loadGeoJSON=function(oe,ge){if(oe.request)m.getJSON(oe.request,ge);else{if(typeof oe.data!="string")return ge(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."));try{return ge(null,JSON.parse(oe.data))}catch(Pe){return ge(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."))}}},Q.prototype.removeSource=function(oe,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ge()},Q.prototype.getClusterExpansionZoom=function(oe,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(Pe){ge(Pe)}},Q.prototype.getClusterChildren=function(oe,ge){try{ge(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(Pe){ge(Pe)}},Q.prototype.getClusterLeaves=function(oe,ge){try{ge(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(Pe){ge(Pe)}},Q}(Ie),xa=function(G){var Q=this;this.self=G,this.actor=new m.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ie,geojson:Na},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(oe,ge){if(Q.workerSourceTypes[oe])throw new Error('Worker source with name "'+oe+'" already registered.');Q.workerSourceTypes[oe]=ge},this.self.registerRTLTextPlugin=function(oe){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=oe.applyArabicShaping,m.plugin.processBidirectionalText=oe.processBidirectionalText,m.plugin.processStyledBidirectionalText=oe.processStyledBidirectionalText}};return xa.prototype.setReferrer=function(G,Q){this.referrer=Q},xa.prototype.setImages=function(G,Q,oe){for(var ge in this.availableImages[G]=Q,this.workerSources[G]){var Pe=this.workerSources[G][ge];for(var Ge in Pe)Pe[Ge].availableImages=Q}oe()},xa.prototype.setLayers=function(G,Q,oe){this.getLayerIndex(G).replace(Q),oe()},xa.prototype.updateLayers=function(G,Q,oe){this.getLayerIndex(G).update(Q.layers,Q.removedIds),oe()},xa.prototype.loadTile=function(G,Q,oe){this.getWorkerSource(G,Q.type,Q.source).loadTile(Q,oe)},xa.prototype.loadDEMTile=function(G,Q,oe){this.getDEMWorkerSource(G,Q.source).loadTile(Q,oe)},xa.prototype.reloadTile=function(G,Q,oe){this.getWorkerSource(G,Q.type,Q.source).reloadTile(Q,oe)},xa.prototype.abortTile=function(G,Q,oe){this.getWorkerSource(G,Q.type,Q.source).abortTile(Q,oe)},xa.prototype.removeTile=function(G,Q,oe){this.getWorkerSource(G,Q.type,Q.source).removeTile(Q,oe)},xa.prototype.removeDEMTile=function(G,Q){this.getDEMWorkerSource(G,Q.source).removeTile(Q)},xa.prototype.removeSource=function(G,Q,oe){if(this.workerSources[G]&&this.workerSources[G][Q.type]&&this.workerSources[G][Q.type][Q.source]){var ge=this.workerSources[G][Q.type][Q.source];delete this.workerSources[G][Q.type][Q.source],ge.removeSource!==void 0?ge.removeSource(Q,oe):oe()}},xa.prototype.loadWorkerSource=function(G,Q,oe){try{this.self.importScripts(Q.url),oe()}catch(ge){oe(ge.toString())}},xa.prototype.syncRTLPluginState=function(G,Q,oe){try{m.plugin.setState(Q);var ge=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&ge!=null){this.self.importScripts(ge);var Pe=m.plugin.isParsed();oe(Pe?void 0:new Error("RTL Text Plugin failed to import scripts from "+ge),Pe)}}catch(Ge){oe(Ge.toString())}},xa.prototype.getAvailableImages=function(G){var Q=this.availableImages[G];return Q||(Q=[]),Q},xa.prototype.getLayerIndex=function(G){var Q=this.layerIndexes[G];return Q||(Q=this.layerIndexes[G]=new $),Q},xa.prototype.getWorkerSource=function(G,Q,oe){var ge=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][Q]||(this.workerSources[G][Q]={}),this.workerSources[G][Q][oe]||(this.workerSources[G][Q][oe]=new this.workerSourceTypes[Q]({send:function(Pe,Ge,et){ge.actor.send(Pe,Ge,et,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][Q][oe]},xa.prototype.getDEMWorkerSource=function(G,Q){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][Q]||(this.demWorkerSources[G][Q]=new Rt),this.demWorkerSources[G][Q]},xa.prototype.enforceCacheSizeLimit=function(G,Q){m.enforceCacheSizeLimit(Q)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new xa(self)),xa}),j(["./shared"],function(m){"use strict";var J=m.createCommonjsModule(function(l){function f(b){return!c(b)}function c(b){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var C,R,U=new Blob([""],{type:"text/javascript"}),Y=URL.createObjectURL(U);try{R=new Worker(Y),C=!0}catch(ce){C=!1}return R&&R.terminate(),URL.revokeObjectURL(Y),C}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var C=document.createElement("canvas");C.width=C.height=1;var R=C.getContext("2d");if(!R)return!1;var U=R.getImageData(0,0,1,1);return U&&U.width===C.width}()?(p[w=b&&b.failIfMajorPerformanceCaveat]===void 0&&(p[w]=function(C){var R=function(Y){var ce=document.createElement("canvas"),he=Object.create(f.webGLContextAttributes);return he.failIfMajorPerformanceCaveat=Y,ce.probablySupportsContext?ce.probablySupportsContext("webgl",he)||ce.probablySupportsContext("experimental-webgl",he):ce.supportsContext?ce.supportsContext("webgl",he)||ce.supportsContext("experimental-webgl",he):ce.getContext("webgl",he)||ce.getContext("experimental-webgl",he)}(C);if(!R)return!1;var U=R.createShader(R.VERTEX_SHADER);return!(!U||R.isContextLost())&&(R.shaderSource(U,"void main() {}"),R.compileShader(U),R.getShaderParameter(U,R.COMPILE_STATUS)===!0)}(w)),p[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var p={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),F={create:function(l,f,c){var p=m.window.document.createElement(l);return f!==void 0&&(p.className=f),c&&c.appendChild(p),p},createNS:function(l,f){return m.window.document.createElementNS(l,f)}},$=m.window.document&&m.window.document.documentElement.style;function re(l){if(!$)return l[0];for(var f=0;f<l.length;f++)if(l[f]in $)return l[f];return l[0]}var ie,ne=re(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);F.disableDrag=function(){$&&ne&&(ie=$[ne],$[ne]="none")},F.enableDrag=function(){$&&ne&&($[ne]=ie)};var Le=re(["transform","WebkitTransform"]);F.setTransform=function(l,f){l.style[Le]=f};var Ie=!1;try{var He=Object.defineProperty({},"passive",{get:function(){Ie=!0}});m.window.addEventListener("test",He,He),m.window.removeEventListener("test",He,He)}catch(l){Ie=!1}F.addEventListener=function(l,f,c,p){p===void 0&&(p={}),l.addEventListener(f,c,"passive"in p&&Ie?p:p.capture)},F.removeEventListener=function(l,f,c,p){p===void 0&&(p={}),l.removeEventListener(f,c,"passive"in p&&Ie?p:p.capture)};var Rt=function(l){l.preventDefault(),l.stopPropagation(),m.window.removeEventListener("click",Rt,!0)};function $t(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}F.suppressClick=function(){m.window.addEventListener("click",Rt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",Rt,!0)},0)},F.mousePos=function(l,f){var c=l.getBoundingClientRect();return new m.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},F.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),p=[],b=0;b<f.length;b++)p.push(new m.Point(f[b].clientX-c.left-l.clientLeft,f[b].clientY-c.top-l.clientTop));return p},F.mouseButton=function(l){return m.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},F.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var ht=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var p=0,b=this.requestors;p<b.length;p+=1){var w=b[p];this._notify(w.ids,w.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,p){this._validate(c,p)&&(this.images[c]=p)},f.prototype._validate=function(c,p){var b=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),b=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),b=!1),this._validateContent(p.content,p)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),b=!1),b},f.prototype._validateStretch=function(c,p){if(!c)return!0;for(var b=0,w=0,C=c;w<C.length;w+=1){var R=C[w];if(R[0]<b||R[1]<R[0]||p<R[1])return!1;b=R[1]}return!0},f.prototype._validateContent=function(c,p){return!(c&&(c.length!==4||c[0]<0||p.data.width<c[0]||c[1]<0||p.data.height<c[1]||c[2]<0||p.data.width<c[2]||c[3]<0||p.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,p){p.version=this.images[c].version+1,this.images[c]=p,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var p=this.images[c];delete this.images[c],delete this.patterns[c],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,p){var b=!0;if(!this.isLoaded())for(var w=0,C=c;w<C.length;w+=1)this.images[C[w]]||(b=!1);this.isLoaded()||b?this._notify(c,p):this.requestors.push({ids:c,callback:p})},f.prototype._notify=function(c,p){for(var b={},w=0,C=c;w<C.length;w+=1){var R=C[w];this.images[R]||this.fire(new m.Event("styleimagemissing",{id:R}));var U=this.images[R];U?b[R]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:m.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}p(null,b)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var p=this.patterns[c],b=this.getImage(c);if(!b)return null;if(p&&p.position.version===b.version)return p.position;if(p)p.position.version=b.version;else{var w={w:b.data.width+2,h:b.data.height+2,x:0,y:0},C=new m.ImagePosition(w,b);this.patterns[c]={bin:w,position:C}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var p=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var p in this.patterns)c.push(this.patterns[p].bin);var b=m.potpack(c),w=b.w,C=b.h,R=this.atlasImage;for(var U in R.resize({width:w||1,height:C||1}),this.patterns){var Y=this.patterns[U].bin,ce=Y.x+1,he=Y.y+1,pe=this.images[U].data,Ae=pe.width,Re=pe.height;m.RGBAImage.copy(pe,R,{x:0,y:0},{x:ce,y:he},{width:Ae,height:Re}),m.RGBAImage.copy(pe,R,{x:0,y:Re-1},{x:ce,y:he-1},{width:Ae,height:1}),m.RGBAImage.copy(pe,R,{x:0,y:0},{x:ce,y:he+Re},{width:Ae,height:1}),m.RGBAImage.copy(pe,R,{x:Ae-1,y:0},{x:ce-1,y:he},{width:1,height:Re}),m.RGBAImage.copy(pe,R,{x:0,y:0},{x:ce+Ae,y:he},{width:1,height:Re})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var p=0,b=c;p<b.length;p+=1){var w=b[p];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var C=this.images[w];$t(C)&&this.updateImage(w,C)}}},f}(m.Evented),Ut=rt,dt=rt,nt=1e20;function rt(l,f,c,p,b,w){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=p||.25,this.fontFamily=b||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var C=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=C,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.d=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Int16Array(C),this.middle=Math.round(C/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function er(l,f,c,p,b,w,C){for(var R=0;R<f;R++){for(var U=0;U<c;U++)p[U]=l[U*f+R];for(K(p,b,w,C,c),U=0;U<c;U++)l[U*f+R]=b[U]}for(U=0;U<c;U++){for(R=0;R<f;R++)p[R]=l[U*f+R];for(K(p,b,w,C,f),R=0;R<f;R++)l[U*f+R]=Math.sqrt(b[R])}}function K(l,f,c,p,b){c[0]=0,p[0]=-nt,p[1]=+nt;for(var w=1,C=0;w<b;w++){for(var R=(l[w]+w*w-(l[c[C]]+c[C]*c[C]))/(2*w-2*c[C]);R<=p[C];)C--,R=(l[w]+w*w-(l[c[C]]+c[C]*c[C]))/(2*w-2*c[C]);c[++C]=w,p[C]=R,p[C+1]=+nt}for(w=0,C=0;w<b;w++){for(;p[C+1]<w;)C++;f[w]=(w-c[C])*(w-c[C])+l[c[C]]}}rt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),p=0;p<this.size*this.size;p++){var b=f.data[4*p+3]/255;this.gridOuter[p]=b===1?0:b===0?nt:Math.pow(Math.max(0,.5-b),2),this.gridInner[p]=b===1?nt:b===0?0:Math.pow(Math.max(0,b-.5),2)}for(er(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),er(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),p=0;p<this.size*this.size;p++)c[p]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[p]-this.gridInner[p])/this.radius+this.cutoff))));return c},Ut.default=dt;var Ht=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Ht.prototype.setURL=function(l){this.url=l},Ht.prototype.getGlyphs=function(l,f){var c=this,p=[];for(var b in l)for(var w=0,C=l[b];w<C.length;w+=1)p.push({stack:b,id:C[w]});m.asyncAll(p,function(R,U){var Y=R.stack,ce=R.id,he=c.entries[Y];he||(he=c.entries[Y]={glyphs:{},requests:{},ranges:{}});var pe=he.glyphs[ce];if(pe===void 0){if(pe=c._tinySDF(he,Y,ce))return he.glyphs[ce]=pe,void U(null,{stack:Y,id:ce,glyph:pe});var Ae=Math.floor(ce/256);if(256*Ae>65535)U(new Error("glyphs > 65535 not supported"));else if(he.ranges[Ae])U(null,{stack:Y,id:ce,glyph:pe});else{var Re=he.requests[Ae];Re||(Re=he.requests[Ae]=[],Ht.loadGlyphRange(Y,Ae,c.url,c.requestManager,function(We,Te){if(Te){for(var Ve in Te)c._doesCharSupportLocalGlyph(+Ve)||(he.glyphs[+Ve]=Te[+Ve]);he.ranges[Ae]=!0}for(var Qe=0,gt=Re;Qe<gt.length;Qe+=1)(0,gt[Qe])(We,Te);delete he.requests[Ae]})),Re.push(function(We,Te){We?U(We):Te&&U(null,{stack:Y,id:ce,glyph:Te[ce]||null})})}}else U(null,{stack:Y,id:ce,glyph:pe})},function(R,U){if(R)f(R);else if(U){for(var Y={},ce=0,he=U;ce<he.length;ce+=1){var pe=he[ce],Ae=pe.stack,Re=pe.id,We=pe.glyph;(Y[Ae]||(Y[Ae]={}))[Re]=We&&{id:We.id,bitmap:We.bitmap.clone(),metrics:We.metrics}}f(null,Y)}})},Ht.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](l)||m.isChar["Hangul Syllables"](l)||m.isChar.Hiragana(l)||m.isChar.Katakana(l))},Ht.prototype._tinySDF=function(l,f,c){var p=this.localIdeographFontFamily;if(p&&this._doesCharSupportLocalGlyph(c)){var b=l.tinySDF;if(!b){var w="400";/bold/i.test(f)?w="900":/medium/i.test(f)?w="500":/light/i.test(f)&&(w="200"),b=l.tinySDF=new Ht.TinySDF(24,3,8,.25,p,w)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},b.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Ht.loadGlyphRange=function(l,f,c,p,b){var w=256*f,C=w+255,R=p.transformRequest(p.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+C),m.ResourceType.Glyphs);m.getArrayBuffer(R,function(U,Y){if(U)b(U);else if(Y){for(var ce={},he=0,pe=m.parseGlyphPBF(Y);he<pe.length;he+=1){var Ae=pe[he];ce[Ae.id]=Ae}b(null,ce)}})},Ht.TinySDF=Ut;var at=function(){this.specification=m.styleSpec.light.position};at.prototype.possiblyEvaluate=function(l,f){return m.sphericalToCartesian(l.expression.evaluate(f))},at.prototype.interpolate=function(l,f,c){return{x:m.number(l.x,f.x,c),y:m.number(l.y,f.y,c),z:m.number(l.z,f.z,c)}};var Ye=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new at,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),ut=function(l){function f(c){l.call(this),this._transitionable=new m.Transitionable(Ye),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,p){if(p===void 0&&(p={}),!this._validate(m.validateLight,c,p))for(var b in c){var w=c[b];m.endsWith(b,"-transition")?this._transitionable.setTransition(b.slice(0,-"-transition".length),w):this._transitionable.setValue(b,w)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,p,b){return(!b||b.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},f}(m.Evented),Je=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Je.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},Je.prototype.getDashRanges=function(l,f,c){var p=[],b=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,C=!0;p.push({left:b,right:w,isDash:C,zeroLength:l[0]===0});for(var R=l[0],U=1;U<l.length;U++){var Y=l[U];p.push({left:b=R*c,right:w=(R+=Y)*c,isDash:C=!C,zeroLength:Y===0})}return p},Je.prototype.addRoundDash=function(l,f,c){for(var p=f/2,b=-c;b<=c;b++)for(var w=this.width*(this.nextRow+c+b),C=0,R=l[C],U=0;U<this.width;U++){U/R.right>1&&(R=l[++C]);var Y=Math.abs(U-R.left),ce=Math.abs(U-R.right),he=Math.min(Y,ce),pe=void 0,Ae=b/c*(p+1);if(R.isDash){var Re=p-Math.abs(Ae);pe=Math.sqrt(he*he+Re*Re)}else pe=p-Math.sqrt(he*he+Ae*Ae);this.data[w+U]=Math.max(0,Math.min(255,pe+128))}},Je.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],p=l[f+1];c.zeroLength?l.splice(f,1):p&&p.isDash===c.isDash&&(p.left=c.left,l.splice(f,1))}var b=l[0],w=l[l.length-1];b.isDash===w.isDash&&(b.left=w.left-this.width,w.right=b.right+this.width);for(var C=this.width*this.nextRow,R=0,U=l[R],Y=0;Y<this.width;Y++){Y/U.right>1&&(U=l[++R]);var ce=Math.abs(Y-U.left),he=Math.abs(Y-U.right),pe=Math.min(ce,he);this.data[C+Y]=Math.max(0,Math.min(255,(U.isDash?pe:-pe)+128))}},Je.prototype.addDash=function(l,f){var c=f?7:0,p=2*c+1;if(this.nextRow+p>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var b=0,w=0;w<l.length;w++)b+=l[w];if(b!==0){var C=this.width/b,R=this.getDashRanges(l,this.width,C);f?this.addRoundDash(R,C,c):this.addRegularDash(R)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:b};return this.nextRow+=p,this.dirty=!0,U},Je.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Ot=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var p=this.workerPool.acquire(this.id),b=0;b<p.length;b++){var w=new l.Actor(p[b],c,this.id);w.name="Worker "+b,this.actors.push(w)}};function dr(l,f,c){var p=function(b,w){if(b)return c(b);if(w){var C=m.pick(m.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(C.vectorLayers=w.vector_layers,C.vectorLayerIds=C.vectorLayers.map(function(R){return R.id})),C.tiles=f.canonicalizeTileset(C,l.url),c(null,C)}};return l.url?m.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),m.ResourceType.Source),p):m.browser.frame(function(){return p(null,l)})}Ot.prototype.broadcast=function(l,f,c){m.asyncAll(this.actors,function(p,b){p.send(l,f,b)},c=c||function(){})},Ot.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ot.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Ot.Actor=m.Actor;var Cr=function(l,f,c){this.bounds=m.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Cr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Cr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*f),p=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*f),b=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*f),w=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<b&&l.y>=p&&l.y<w};var jr=function(l){function f(c,p,b,w){if(l.call(this),this.id=c,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(p,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},p),this._collectResourceTiming=p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=dr(this._options,this.map._requestManager,function(p,b){c._tileJSONRequest=null,c._loaded=!0,p?c.fire(new m.ErrorEvent(p)):b&&(m.extend(c,b),b.bounds&&(c.tileBounds=new Cr(b.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(b.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var p=this;return this.setSourceProperty(function(){p._options.tiles=c}),this},f.prototype.setUrl=function(c){var p=this;return this.setSourceProperty(function(){p.url=c,p._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.loadTile=function(c,p){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(b,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function C(R,U){return delete c.request,c.aborted?p(null):R&&R.status!==404?p(R):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),p(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=p:c.request=c.actor.send("reloadTile",w,C.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,C.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(m.Evented),T=function(l){function f(c,p,b,w){l.call(this),this.id=c,this.dispatcher=b,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},p),m.extend(this,m.pick(p,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=dr(this._options,this.map._requestManager,function(p,b){c._tileJSONRequest=null,c._loaded=!0,p?c.fire(new m.ErrorEvent(p)):b&&(m.extend(c,b),b.bounds&&(c.tileBounds=new Cr(b.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(b.tiles),m.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,p){var b=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),function(C,R){if(delete c.request,c.aborted)c.state="unloaded",p(null);else if(C)c.state="errored",p(C);else if(R){b.map._refreshExpiredTiles&&c.setExpiryData(R),delete R.cacheControl,delete R.expires;var U=b.map.painter.context,Y=U.gl;c.texture=b.map.painter.getTileTexture(R.width),c.texture?c.texture.update(R,{useMipmap:!0}):(c.texture=new m.Texture(U,R,Y.RGBA,{useMipmap:!0}),c.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&Y.texParameterf(Y.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(b.dispatcher),p(null)}})},f.prototype.abortTile=function(c,p){c.request&&(c.request.cancel(),delete c.request),p()},f.prototype.unloadTile=function(c,p){c.texture&&this.map.painter.saveTileTexture(c.texture),p()},f.prototype.hasTransition=function(){return!1},f}(m.Evented),we=function(l){function f(c,p,b,w){l.call(this,c,p,b,w),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},p),this.encoding=p.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,p){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(C,R){C&&(c.state="errored",p(C)),R&&(c.dem=R,c.needsHillshadePrepare=!0,c.state="loaded",p(null))}c.request=m.getImage(this.map._requestManager.transformRequest(b,m.ResourceType.Tile),function(C,R){if(delete c.request,c.aborted)c.state="unloaded",p(null);else if(C)c.state="errored",p(C);else if(R){this.map._refreshExpiredTiles&&c.setExpiryData(R),delete R.cacheControl,delete R.expires;var U=m.window.ImageBitmap&&R instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?R:m.browser.getImageData(R,1),Y={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",Y,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var p=c.canonical,b=Math.pow(2,p.z),w=(p.x-1+b)%b,C=p.x===0?c.wrap-1:c.wrap,R=(p.x+1+b)%b,U=p.x+1===b?c.wrap+1:c.wrap,Y={};return Y[new m.OverscaledTileID(c.overscaledZ,C,p.z,w,p.y).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,U,p.z,R,p.y).key]={backfilled:!1},p.y>0&&(Y[new m.OverscaledTileID(c.overscaledZ,C,p.z,w,p.y-1).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,c.wrap,p.z,p.x,p.y-1).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,U,p.z,R,p.y-1).key]={backfilled:!1}),p.y+1<b&&(Y[new m.OverscaledTileID(c.overscaledZ,C,p.z,w,p.y+1).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,c.wrap,p.z,p.x,p.y+1).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,U,p.z,R,p.y+1).key]={backfilled:!1}),Y},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(T),De=function(l){function f(c,p,b,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=b.getActor(),this.setEventedParent(w),this._data=p.data,this._options=m.extend({},p),this._collectResourceTiming=p.collectResourceTiming,this._resourceTiming=[],p.maxzoom!==void 0&&(this.maxzoom=p.maxzoom),p.type&&(this.type=p.type),p.attribution&&(this.attribution=p.attribution),this.promoteId=p.promoteId;var C=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:p.cluster||!1,geojsonVtOptions:{buffer:(p.buffer!==void 0?p.buffer:128)*C,tolerance:(p.tolerance!==void 0?p.tolerance:.375)*C,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:p.lineMetrics||!1,generateId:p.generateId||!1},superclusterOptions:{maxZoom:p.clusterMaxZoom!==void 0?Math.min(p.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,p.clusterMinPoints||2),extent:m.EXTENT,radius:(p.clusterRadius||50)*C,log:!1,generateId:p.generateId||!1},clusterProperties:p.clusterProperties,filter:p.filter},p.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(p){if(p)c.fire(new m.ErrorEvent(p));else{var b={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(b.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",b))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var p=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(b){if(b)p.fire(new m.ErrorEvent(b));else{var w={dataType:"source",sourceDataType:"content"};p._collectResourceTiming&&p._resourceTiming&&p._resourceTiming.length>0&&(w.resourceTiming=p._resourceTiming,p._resourceTiming=[]),p.fire(new m.Event("data",w))}}),this},f.prototype.getClusterExpansionZoom=function(c,p){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},p),this},f.prototype.getClusterChildren=function(c,p){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},p),this},f.prototype.getClusterLeaves=function(c,p,b,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:p,offset:b},w),this},f.prototype._updateWorkerData=function(c){var p=this;this._loaded=!1;var b=m.extend({},this.workerOptions),w=this._data;typeof w=="string"?(b.request=this.map._requestManager.transformRequest(m.browser.resolveURL(w),m.ResourceType.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(w),this.actor.send(this.type+".loadData",b,function(C,R){p._removed||R&&R.abandoned||(p._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[p.id]&&(p._resourceTiming=R.resourceTiming[p.id].slice(0)),p.actor.send(p.type+".coalesce",{source:b.source},null),c(C))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,p){var b=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(C,R){return delete c.request,c.unloadVectorData(),c.aborted?p(null):C?p(C):(c.loadVectorData(R,b.map.painter,w==="reloadTile"),p(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(m.Evented),bt=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),mt=function(l){function f(c,p,b,w){l.call(this),this.id=c,this.dispatcher=b,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,p){var b=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(w,C){b._loaded=!0,w?b.fire(new m.ErrorEvent(w)):C&&(b.image=C,c&&(b.coordinates=c),p&&p(),b._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var p=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){p.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var p=this;this.coordinates=c;var b=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(C){for(var R=1/0,U=1/0,Y=-1/0,ce=-1/0,he=0,pe=C;he<pe.length;he+=1){var Ae=pe[he];R=Math.min(R,Ae.x),U=Math.min(U,Ae.y),Y=Math.max(Y,Ae.x),ce=Math.max(ce,Ae.y)}var Re=Math.max(Y-R,ce-U),We=Math.max(0,Math.floor(-Math.log(Re)/Math.LN2)),Te=Math.pow(2,We);return new m.CanonicalTileID(We,Math.floor((R+Y)/2*Te),Math.floor((U+ce)/2*Te))}(b),this.minzoom=this.maxzoom=this.tileID.z;var w=b.map(function(C){return p.tileID.getTilePoint(C)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,p=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,bt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[b];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.loadTile=function(c,p){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},p(null)):(c.state="errored",p(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Lt=function(l){function f(c,p,b,w){l.call(this,c,p,b,w),this.roundZoom=!0,this.type="video",this.options=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var p=this.options;this.urls=[];for(var b=0,w=p.urls;b<w.length;b+=1)this.urls.push(this.map._requestManager.transformRequest(w[b],m.ResourceType.Source).url);m.getVideo(this.urls,function(C,R){c._loaded=!0,C?c.fire(new m.ErrorEvent(C)):R&&(c.video=R,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var p=this.video.seekable;c<p.start(0)||c>p.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+p.start(0)+" and "+p.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,p=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,bt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.texSubImage2D(p.TEXTURE_2D,0,0,0,p.RGBA,p.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[b];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(mt),Yt=function(l){function f(c,p,b,w){l.call(this,c,p,b,w),p.coordinates?Array.isArray(p.coordinates)&&p.coordinates.length===4&&!p.coordinates.some(function(C){return!Array.isArray(C)||C.length!==2||C.some(function(R){return typeof R!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),p.animate&&typeof p.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),p.canvas?typeof p.canvas=="string"||p.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=p,this.animate=p.animate===void 0||p.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var p=this.map.painter.context,b=p.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,bt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(p,this.canvas,b.RGBA,{premultiply:!0}),this.tiles){var C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,p=[this.canvas.width,this.canvas.height];c<p.length;c+=1){var b=p[c];if(isNaN(b)||b<=0)return!0}return!1},f}(mt),br={vector:jr,raster:T,"raster-dem":we,geojson:De,video:Lt,image:mt,canvas:Yt};function Kn(l,f){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*l.width,.5*l.height,1]),m.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function cn(l,f,c,p,b,w){var C=function(We,Te,Ve){if(We)for(var Qe=0,gt=We;Qe<gt.length;Qe+=1){var Gt=Te[gt[Qe]];if(Gt&&Gt.source===Ve&&Gt.type==="fill-extrusion")return!0}else for(var Ft in Te){var Xt=Te[Ft];if(Xt.source===Ve&&Xt.type==="fill-extrusion")return!0}return!1}(b&&b.layers,f,l.id),R=w.maxPitchScaleFactor(),U=l.tilesIn(p,R,C);U.sort(li);for(var Y=[],ce=0,he=U;ce<he.length;ce+=1){var pe=he[ce];Y.push({wrappedTileID:pe.tileID.wrapped().key,queryResults:pe.tile.queryRenderedFeatures(f,c,l._state,pe.queryGeometry,pe.cameraQueryGeometry,pe.scale,b,w,R,Kn(l.transform,pe.tileID))})}var Ae=function(We){for(var Te={},Ve={},Qe=0,gt=We;Qe<gt.length;Qe+=1){var Gt=gt[Qe],Ft=Gt.queryResults,Xt=Gt.wrappedTileID,cr=Ve[Xt]=Ve[Xt]||{};for(var Rr in Ft)for(var Or=Ft[Rr],Qr=cr[Rr]=cr[Rr]||{},Dn=Te[Rr]=Te[Rr]||[],Bn=0,Un=Or;Bn<Un.length;Bn+=1){var di=Un[Bn];Qr[di.featureIndex]||(Qr[di.featureIndex]=!0,Dn.push(di))}}return Te}(Y);for(var Re in Ae)Ae[Re].forEach(function(We){var Te=We.feature,Ve=l.getFeatureState(Te.layer["source-layer"],Te.id);Te.source=Te.layer.source,Te.layer["source-layer"]&&(Te.sourceLayer=Te.layer["source-layer"]),Te.state=Ve});return Ae}function li(l,f){var c=l.tileID,p=f.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}var Vn=function(l,f){this.max=l,this.onRemove=f,this.reset()};Vn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var p=c[f];p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value)}return this.data={},this.order=[],this},Vn.prototype.add=function(l,f,c){var p=this,b=l.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);var w={value:f,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){p.remove(l,w)},c)),this.data[b].push(w),this.order.push(b),this.order.length>this.max){var C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this},Vn.prototype.has=function(l){return l.wrapped().key in this.data},Vn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Vn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Vn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Vn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Vn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,p=f===void 0?0:this.data[c].indexOf(f),b=this.data[c][p];return this.data[c].splice(p,1),b.timeout&&clearTimeout(b.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(b.value),this.order.splice(this.order.indexOf(c),1),this},Vn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Vn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var p=0,b=this.data[c];p<b.length;p+=1){var w=b[p];l(w.value)||f.push(w)}for(var C=0,R=f;C<R.length;C+=1){var U=R[C];this.remove(U.value.tileID,U)}};var ti=function(l,f,c){this.context=l;var p=l.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};ti.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ti.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ti.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ci={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Hn=function(l,f,c,p){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=p,this.context=l;var b=l.gl;this.buffer=b.createBuffer(),l.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Hn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Hn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},Hn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var p=f.attributes[this.attributes[c].name];p!==void 0&&l.enableVertexAttribArray(p)}},Hn.prototype.setVertexAttribPointers=function(l,f,c){for(var p=0;p<this.attributes.length;p++){var b=this.attributes[p],w=f.attributes[b.name];w!==void 0&&l.vertexAttribPointer(w,b.components,l[ci[b.type]],!1,this.itemSize,b.offset+this.itemSize*(c||0))}},Hn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var fi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};fi.prototype.get=function(){return this.current},fi.prototype.set=function(l){},fi.prototype.getDefault=function(){return this.default},fi.prototype.setDefault=function(){this.set(this.default)};var ua=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(fi),Vi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(fi),ki=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(fi),Ki=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(fi),la=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(fi),Ai=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(fi),ma=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var p=this.current;(c.func!==p.func||c.ref!==p.ref||c.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(fi),Xn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(fi),bi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(fi),zi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(fi),qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(fi),ko=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(fi),de=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.BLEND):p.disable(p.BLEND),this.current=c,this.dirty=!1}},f}(fi),Ln=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(fi),Za=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(fi),rs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(fi),kt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=c,this.dirty=!1}},f}(fi),tr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(fi),Sr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(fi),qr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(fi),xn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(fi),kn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(fi),hi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(fi),qn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(fi),an=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindTexture(p.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(fi),Di=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(fi),Oi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(fi),to=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(fi),ps=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(fi),Zo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(fi),Na=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(fi),xa=function(l){function f(c,p){l.call(this,c),this.context=c,this.parent=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(fi),G=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(xa),Q=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(xa),oe=function(l,f,c,p){this.context=l,this.width=f,this.height=c;var b=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new G(l,b),p&&(this.depthAttachment=new Q(l,b))};oe.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ge=function(l,f,c){this.func=l,this.mask=f,this.range=c};ge.ReadOnly=!1,ge.ReadWrite=!0,ge.disabled=new ge(519,ge.ReadOnly,[0,1]);var Pe=function(l,f,c,p,b,w){this.test=l,this.ref=f,this.mask=c,this.fail=p,this.depthFail=b,this.pass=w};Pe.disabled=new Pe({func:519,mask:0},0,0,7680,7680,7680);var Ge=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ge.disabled=new Ge(Ge.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),Ge.unblended=new Ge(Ge.Replace,m.Color.transparent,[!0,!0,!0,!0]),Ge.alphaBlended=new Ge([1,771],m.Color.transparent,[!0,!0,!0,!0]);var et=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};et.disabled=new et(!1,1029,2305),et.backCCW=new et(!0,1029,2305);var fe=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ua(this),this.clearDepth=new Vi(this),this.clearStencil=new ki(this),this.colorMask=new Ki(this),this.depthMask=new la(this),this.stencilMask=new Ai(this),this.stencilFunc=new ma(this),this.stencilOp=new Xn(this),this.stencilTest=new bi(this),this.depthRange=new zi(this),this.depthTest=new qi(this),this.depthFunc=new ko(this),this.blend=new de(this),this.blendFunc=new Ln(this),this.blendColor=new Za(this),this.blendEquation=new rs(this),this.cullFace=new kt(this),this.cullFaceSide=new tr(this),this.frontFace=new Sr(this),this.program=new qr(this),this.activeTexture=new xn(this),this.viewport=new kn(this),this.bindFramebuffer=new hi(this),this.bindRenderbuffer=new qn(this),this.bindTexture=new an(this),this.bindVertexBuffer=new Di(this),this.bindElementBuffer=new Oi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new to(this),this.pixelStoreUnpack=new ps(this),this.pixelStoreUnpackPremultiplyAlpha=new Zo(this),this.pixelStoreUnpackFlipY=new Na(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};fe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},fe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},fe.prototype.createIndexBuffer=function(l,f){return new ti(this,l,f)},fe.prototype.createVertexBuffer=function(l,f,c){return new Hn(this,l,f,c)},fe.prototype.createRenderbuffer=function(l,f,c){var p=this.gl,b=p.createRenderbuffer();return this.bindRenderbuffer.set(b),p.renderbufferStorage(p.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),b},fe.prototype.createFramebuffer=function(l,f,c){return new oe(this,l,f,c)},fe.prototype.clear=function(l){var f=l.color,c=l.depth,p=this.gl,b=0;f&&(b|=p.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p.clear(b)},fe.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},fe.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},fe.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},fe.prototype.setColorMode=function(l){m.deepEqual(l.blendFunction,Ge.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},fe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ke=function(l){function f(c,p,b){var w=this;l.call(this),this.id=c,this.dispatcher=b,this.on("data",function(C){C.dataType==="source"&&C.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&C.dataType==="source"&&C.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(C,R,U,Y){var ce=new br[R.type](C,R,U,Y);if(ce.id!==C)throw new Error("Expected Source id to be "+C+" instead of "+ce.id);return m.bindAll(["load","abort","unload","serialize","prepare"],ce),ce}(c,p,b,this),this._tiles={},this._cache=new Vn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var p=this._tiles[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,p){return this._source.loadTile(c,p)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var p in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var b=this._tiles[p];b.upload(c),b.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(vt).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var p=this,b=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&b.push(this._tiles[w]);return c?b.sort(function(C,R){var U=C.tileID,Y=R.tileID,ce=new m.Point(U.canonical.x,U.canonical.y)._rotate(p.transform.angle),he=new m.Point(Y.canonical.x,Y.canonical.y)._rotate(p.transform.angle);return U.overscaledZ-Y.overscaledZ||he.y-ce.y||he.x-ce.x}).map(function(C){return C.tileID.key}):b.map(function(C){return C.tileID}).sort(vt).map(function(C){return C.key})},f.prototype.hasRenderableParent=function(c){var p=this.findLoadedParent(c,0);return!!p&&this._isIdRenderable(p.tileID.key)},f.prototype._isIdRenderable=function(c,p){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(p||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,p){var b=this._tiles[c];b&&(b.state!=="loading"&&(b.state=p),this._loadTile(b,this._tileLoaded.bind(this,b,c,p)))},f.prototype._tileLoaded=function(c,p,b,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new m.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),b==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(p,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var p=this.getRenderableIds(),b=0;b<p.length;b++){var w=p[b];if(c.neighboringTiles&&c.neighboringTiles[w]){var C=this.getTileByID(w);R(c,C),R(C,c)}}function R(U,Y){U.needsHillshadePrepare=!0;var ce=Y.tileID.canonical.x-U.tileID.canonical.x,he=Y.tileID.canonical.y-U.tileID.canonical.y,pe=Math.pow(2,U.tileID.canonical.z),Ae=Y.tileID.key;ce===0&&he===0||Math.abs(he)>1||(Math.abs(ce)>1&&(Math.abs(ce+pe)===1?ce+=pe:Math.abs(ce-pe)===1&&(ce-=pe)),Y.dem&&U.dem&&(U.dem.backfillBorder(Y.dem,ce,he),U.neighboringTiles&&U.neighboringTiles[Ae]&&(U.neighboringTiles[Ae].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,p,b,w){for(var C in this._tiles){var R=this._tiles[C];if(!(w[C]||!R.hasData()||R.tileID.overscaledZ<=p||R.tileID.overscaledZ>b)){for(var U=R.tileID;R&&R.tileID.overscaledZ>p+1;){var Y=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[Y.key])&&R.hasData()&&(U=Y)}for(var ce=U;ce.overscaledZ>p;)if(c[(ce=ce.scaledTo(ce.overscaledZ-1)).key]){w[U.key]=U;break}}}},f.prototype.findLoadedParent=function(c,p){if(c.key in this._loadedParentTiles){var b=this._loadedParentTiles[c.key];return b&&b.tileID.overscaledZ>=p?b:null}for(var w=c.overscaledZ-1;w>=p;w--){var C=c.scaledTo(w),R=this._getLoadedTile(C);if(R)return R}},f.prototype._getLoadedTile=function(c){var p=this._tiles[c.key];return p&&p.hasData()?p:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var p=Math.ceil(c.width/this._source.tileSize)+1,b=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(p*b*5),C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(C)},f.prototype.handleWrapJump=function(c){var p=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,p){var b={};for(var w in this._tiles){var C=this._tiles[w];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+p),b[C.tileID.key]=C}for(var R in this._tiles=b,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},f.prototype.update=function(c){var p=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var b;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?b=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(cr){return new m.OverscaledTileID(cr.canonical.z,cr.wrap,cr.canonical.z,cr.canonical.x,cr.canonical.y)}):(b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(b=b.filter(function(cr){return p._source.hasTile(cr)}))):b=[];var w=c.coveringZoomLevel(this._source),C=Math.max(w-f.maxOverzooming,this._source.minzoom),R=Math.max(w+f.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(b,w);if(hr(this._source.type)){for(var Y={},ce={},he=0,pe=Object.keys(U);he<pe.length;he+=1){var Ae=pe[he],Re=U[Ae],We=this._tiles[Ae];if(We&&!(We.fadeEndTime&&We.fadeEndTime<=m.browser.now())){var Te=this.findLoadedParent(Re,C);Te&&(this._addTile(Te.tileID),Y[Te.tileID.key]=Te.tileID),ce[Ae]=Re}}for(var Ve in this._retainLoadedChildren(ce,w,R,U),Y)U[Ve]||(this._coveredTiles[Ve]=!0,U[Ve]=Y[Ve])}for(var Qe in U)this._tiles[Qe].clearFadeHold();for(var gt=0,Gt=m.keysDifference(this._tiles,U);gt<Gt.length;gt+=1){var Ft=Gt[gt],Xt=this._tiles[Ft];Xt.hasSymbolBuckets&&!Xt.holdingForFade()?Xt.setHoldDuration(this.map._fadeDuration):Xt.hasSymbolBuckets&&!Xt.symbolFadeFinished()||this._removeTile(Ft)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,p){for(var b={},w={},C=Math.max(p-f.maxOverzooming,this._source.minzoom),R=Math.max(p+f.maxUnderzooming,this._source.minzoom),U={},Y=0,ce=c;Y<ce.length;Y+=1){var he=ce[Y],pe=this._addTile(he);b[he.key]=he,pe.hasData()||p<this._source.maxzoom&&(U[he.key]=he)}this._retainLoadedChildren(U,p,R,b);for(var Ae=0,Re=c;Ae<Re.length;Ae+=1){var We=Re[Ae],Te=this._tiles[We.key];if(!Te.hasData()){if(p+1>this._source.maxzoom){var Ve=We.children(this._source.maxzoom)[0],Qe=this.getTile(Ve);if(Qe&&Qe.hasData()){b[Ve.key]=Ve;continue}}else{var gt=We.children(this._source.maxzoom);if(b[gt[0].key]&&b[gt[1].key]&&b[gt[2].key]&&b[gt[3].key])continue}for(var Gt=Te.wasRequested(),Ft=We.overscaledZ-1;Ft>=C;--Ft){var Xt=We.scaledTo(Ft);if(w[Xt.key]||(w[Xt.key]=!0,!(Te=this.getTile(Xt))&&Gt&&(Te=this._addTile(Xt)),Te&&(b[Xt.key]=Xt,Gt=Te.wasRequested(),Te.hasData())))break}}}return b},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var p=[],b=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){b=this._loadedParentTiles[w.key];break}p.push(w.key);var C=w.scaledTo(w.overscaledZ-1);if(b=this._getLoadedTile(C))break;w=C}for(var R=0,U=p;R<U.length;R+=1)this._loadedParentTiles[U[R]]=b}},f.prototype._addTile=function(c){var p=this._tiles[c.key];if(p)return p;(p=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,p),p.tileID=c,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,p)));var b=Boolean(p);return b||(p=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(p,this._tileLoaded.bind(this,p,c.key,p.state))),p?(p.uses++,this._tiles[c.key]=p,b||this._source.fire(new m.Event("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p):null},f.prototype._setTileReloadTimer=function(c,p){var b=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=p.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){b._reloadTile(c,"expired"),delete b._timers[c]},w))},f.prototype._removeTile=function(c){var p=this._tiles[c];p&&(p.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),p.uses>0||(p.hasData()&&p.state!=="reloading"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,p,b){var w=this,C=[],R=this.transform;if(!R)return C;for(var U=b?R.getCameraQueryGeometry(c):c,Y=c.map(function(Ft){return R.pointCoordinate(Ft)}),ce=U.map(function(Ft){return R.pointCoordinate(Ft)}),he=this.getIds(),pe=1/0,Ae=1/0,Re=-1/0,We=-1/0,Te=0,Ve=ce;Te<Ve.length;Te+=1){var Qe=Ve[Te];pe=Math.min(pe,Qe.x),Ae=Math.min(Ae,Qe.y),Re=Math.max(Re,Qe.x),We=Math.max(We,Qe.y)}for(var gt=function(Ft){var Xt=w._tiles[he[Ft]];if(!Xt.holdingForFade()){var cr=Xt.tileID,Rr=Math.pow(2,R.zoom-Xt.tileID.overscaledZ),Or=p*Xt.queryPadding*m.EXTENT/Xt.tileSize/Rr,Qr=[cr.getTilePoint(new m.MercatorCoordinate(pe,Ae)),cr.getTilePoint(new m.MercatorCoordinate(Re,We))];if(Qr[0].x-Or<m.EXTENT&&Qr[0].y-Or<m.EXTENT&&Qr[1].x+Or>=0&&Qr[1].y+Or>=0){var Dn=Y.map(function(Un){return cr.getTilePoint(Un)}),Bn=ce.map(function(Un){return cr.getTilePoint(Un)});C.push({tile:Xt,tileID:cr,queryGeometry:Dn,cameraQueryGeometry:Bn,scale:Rr})}}},Gt=0;Gt<he.length;Gt++)gt(Gt);return C},f.prototype.getVisibleCoordinates=function(c){for(var p=this,b=this.getRenderableIds(c).map(function(U){return p._tiles[U].tileID}),w=0,C=b;w<C.length;w+=1){var R=C[w];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return b},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(hr(this._source.type))for(var c in this._tiles){var p=this._tiles[c];if(p.fadeEndTime!==void 0&&p.fadeEndTime>=m.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,p,b){this._state.updateState(c=c||"_geojsonTileLayer",p,b)},f.prototype.removeFeatureState=function(c,p,b){this._state.removeFeatureState(c=c||"_geojsonTileLayer",p,b)},f.prototype.getFeatureState=function(c,p){return this._state.getState(c=c||"_geojsonTileLayer",p)},f.prototype.setDependencies=function(c,p,b){var w=this._tiles[c];w&&w.setDependencies(p,b)},f.prototype.reloadTilesForDependencies=function(c,p){for(var b in this._tiles)this._tiles[b].hasDependency(c,p)&&this._reloadTile(b,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,p)})},f}(m.Evented);function vt(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),p=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||p-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function hr(l){return l==="raster"||l==="image"||l==="video"}function Pt(){return new m.window.Worker(cc.workerUrl)}ke.maxOverzooming=10,ke.maxUnderzooming=3;var Dt="mapboxgl_preloaded_worker_pool",pr=function(){this.active={}};pr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<pr.workerCount;)this.workers.push(new Pt);return this.active[l]=!0,this.workers.slice()},pr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},pr.prototype.isPreloaded=function(){return!!this.active[Dt]},pr.prototype.numActive=function(){return Object.keys(this.active).length};var mn,un=Math.floor(m.browser.hardwareConcurrency/2);function Tt(){return mn||(mn=new pr),mn}function $r(l,f){var c={};for(var p in l)p!=="ref"&&(c[p]=l[p]);return m.refProperties.forEach(function(b){b in f&&(c[b]=f[b])}),c}function Fr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var p=0;p<l.length;p++)"ref"in l[p]&&(l[p]=$r(l[p],f[l[p].ref]));return l}pr.workerCount=Math.max(Math.min(un,6),1);var Gr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function vi(l,f,c){c.push({command:Gr.addSource,args:[l,f[l]]})}function Jr(l,f,c){f.push({command:Gr.removeSource,args:[l]}),c[l]=!0}function Pn(l,f,c,p){Jr(l,c,p),vi(l,f,c)}function Wi(l,f,c){var p;for(p in l[c])if(l[c].hasOwnProperty(p)&&p!=="data"&&!m.deepEqual(l[c][p],f[c][p]))return!1;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!m.deepEqual(l[c][p],f[c][p]))return!1;return!0}function pi(l,f,c,p,b,w){var C;for(C in f=f||{},l=l||{})l.hasOwnProperty(C)&&(m.deepEqual(l[C],f[C])||c.push({command:w,args:[p,C,f[C],b]}));for(C in f)f.hasOwnProperty(C)&&!l.hasOwnProperty(C)&&(m.deepEqual(l[C],f[C])||c.push({command:w,args:[p,C,f[C],b]}))}function Ci(l){return l.id}function _i(l,f){return l[f.id]=f,l}var St=function(l,f){this.reset(l,f)};St.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},St.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=m.clamp(l,0,1);for(var f=1,c=this._distances[f],p=l*this.paddedLength+this.padding;c<p&&f<this._distances.length;)c=this._distances[++f];var b=f-1,w=this._distances[b],C=c-w,R=C>0?(p-w)/C:0;return this.points[b].mult(1-R).add(this.points[f].mult(R))};var Kt=function(l,f,c){var p=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)p.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Ca(l,f,c,p,b){var w=m.create();return f?(m.scale(w,w,[1/b,1/b,1]),c||m.rotateZ(w,w,p.angle)):m.multiply(w,p.labelPlaneMatrix,l),w}function Ei(l,f,c,p,b){if(f){var w=m.clone(l);return m.scale(w,w,[b,b,1]),c||m.rotateZ(w,w,-p.angle),w}return p.glCoordMatrix}function Mi(l,f){var c=[l.x,l.y,0,1];Ma(c,c,f);var p=c[3];return{point:new m.Point(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function Ui(l,f){return .5+l/f*.5}function Wr(l,f){var c=l[0]/l[3],p=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&p>=-f[1]&&p<=f[1]}function Sn(l,f,c,p,b,w,C,R){var U=p?l.textSizeData:l.iconSizeData,Y=m.evaluateSizeForZoom(U,c.transform.zoom),ce=[256/c.width*2+1,256/c.height*2+1],he=p?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;he.clear();for(var pe=l.lineVertexArray,Ae=p?l.text.placedSymbolArray:l.icon.placedSymbolArray,Re=c.transform.width/c.transform.height,We=!1,Te=0;Te<Ae.length;Te++){var Ve=Ae.get(Te);if(Ve.hidden||Ve.writingMode===m.WritingMode.vertical&&!We)Ba(Ve.numGlyphs,he);else{We=!1;var Qe=[Ve.anchorX,Ve.anchorY,0,1];if(m.transformMat4(Qe,Qe,f),Wr(Qe,ce)){var gt=Ui(c.transform.cameraToCenterDistance,Qe[3]),Gt=m.evaluateSizeForFeature(U,Y,Ve),Ft=C?Gt/gt:Gt*gt,Xt=new m.Point(Ve.anchorX,Ve.anchorY),cr=Mi(Xt,b).point,Rr={},Or=be(Ve,Ft,!1,R,f,b,w,l.glyphOffsetArray,pe,he,cr,Xt,Rr,Re);We=Or.useVertical,(Or.notEnoughRoom||We||Or.needsFlipping&&be(Ve,Ft,!0,R,f,b,w,l.glyphOffsetArray,pe,he,cr,Xt,Rr,Re).notEnoughRoom)&&Ba(Ve.numGlyphs,he)}else Ba(Ve.numGlyphs,he)}}p?l.text.dynamicLayoutVertexBuffer.updateData(he):l.icon.dynamicLayoutVertexBuffer.updateData(he)}function zt(l,f,c,p,b,w,C,R,U,Y,ce){var he=R.glyphStartIndex+R.numGlyphs,pe=R.lineStartIndex,Ae=R.lineStartIndex+R.lineLength,Re=f.getoffsetX(R.glyphStartIndex),We=f.getoffsetX(he-1),Te=Qi(l*Re,c,p,b,w,C,R.segment,pe,Ae,U,Y,ce);if(!Te)return null;var Ve=Qi(l*We,c,p,b,w,C,R.segment,pe,Ae,U,Y,ce);return Ve?{first:Te,last:Ve}:null}function na(l,f,c,p){return l===m.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*p?{useVertical:!0}:(l===m.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function be(l,f,c,p,b,w,C,R,U,Y,ce,he,pe,Ae){var Re,We=f/24,Te=l.lineOffsetX*We,Ve=l.lineOffsetY*We;if(l.numGlyphs>1){var Qe=l.glyphStartIndex+l.numGlyphs,gt=l.lineStartIndex,Gt=l.lineStartIndex+l.lineLength,Ft=zt(We,R,Te,Ve,c,ce,he,l,U,w,pe);if(!Ft)return{notEnoughRoom:!0};var Xt=Mi(Ft.first.point,C).point,cr=Mi(Ft.last.point,C).point;if(p&&!c){var Rr=na(l.writingMode,Xt,cr,Ae);if(Rr)return Rr}Re=[Ft.first];for(var Or=l.glyphStartIndex+1;Or<Qe-1;Or++)Re.push(Qi(We*R.getoffsetX(Or),Te,Ve,c,ce,he,l.segment,gt,Gt,U,w,pe));Re.push(Ft.last)}else{if(p&&!c){var Qr=Mi(he,b).point,Dn=l.lineStartIndex+l.segment+1,Bn=new m.Point(U.getx(Dn),U.gety(Dn)),Un=Mi(Bn,b),di=Un.signedDistanceFromCamera>0?Un.point:Ko(he,Bn,Qr,1,b),nn=na(l.writingMode,Qr,di,Ae);if(nn)return nn}var ai=Qi(We*R.getoffsetX(l.glyphStartIndex),Te,Ve,c,ce,he,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,w,pe);if(!ai)return{notEnoughRoom:!0};Re=[ai]}for(var si=0,ei=Re;si<ei.length;si+=1){var Wn=ei[si];m.addDynamicAttributes(Y,Wn.point,Wn.angle)}return{}}function Ko(l,f,c,p,b){var w=Mi(l.add(l.sub(f)._unit()),b).point,C=c.sub(w);return c.add(C._mult(p/C.mag()))}function Qi(l,f,c,p,b,w,C,R,U,Y,ce,he){var pe=p?l-f:l+f,Ae=pe>0?1:-1,Re=0;p&&(Ae*=-1,Re=Math.PI),Ae<0&&(Re+=Math.PI);for(var We=Ae>0?R+C:R+C+1,Te=b,Ve=b,Qe=0,gt=0,Gt=Math.abs(pe),Ft=[];Qe+gt<=Gt;){if((We+=Ae)<R||We>=U)return null;if(Ve=Te,Ft.push(Te),(Te=he[We])===void 0){var Xt=new m.Point(Y.getx(We),Y.gety(We)),cr=Mi(Xt,ce);if(cr.signedDistanceFromCamera>0)Te=he[We]=cr.point;else{var Rr=We-Ae;Te=Ko(Qe===0?w:new m.Point(Y.getx(Rr),Y.gety(Rr)),Xt,Ve,Gt-Qe+1,ce)}}Qe+=gt,gt=Ve.dist(Te)}var Or=(Gt-Qe)/gt,Qr=Te.sub(Ve),Dn=Qr.mult(Or)._add(Ve);Dn._add(Qr._unit()._perp()._mult(c*Ae));var Bn=Re+Math.atan2(Te.y-Ve.y,Te.x-Ve.x);return Ft.push(Dn),{point:Dn,angle:Bn,path:Ft}}Kt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Kt.prototype.insert=function(l,f,c,p,b){this._forEachCell(f,c,p,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(b)},Kt.prototype.insertCircle=function(l,f,c,p){this._forEachCell(f-p,c-p,f+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(p)},Kt.prototype._insertBoxCell=function(l,f,c,p,b,w){this.boxCells[b].push(w)},Kt.prototype._insertCircleCell=function(l,f,c,p,b,w){this.circleCells[b].push(w)},Kt.prototype._query=function(l,f,c,p,b,w){if(c<0||l>this.width||p<0||f>this.height)return!b&&[];var C=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=p){if(b)return!0;for(var R=0;R<this.boxKeys.length;R++)C.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var U=0;U<this.circleKeys.length;U++){var Y=this.circles[3*U],ce=this.circles[3*U+1],he=this.circles[3*U+2];C.push({key:this.circleKeys[U],x1:Y-he,y1:ce-he,x2:Y+he,y2:ce+he})}return w?C.filter(w):C}return this._forEachCell(l,f,c,p,this._queryCell,C,{hitTest:b,seenUids:{box:{},circle:{}}},w),b?C.length>0:C},Kt.prototype._queryCircle=function(l,f,c,p,b){var w=l-c,C=l+c,R=f-c,U=f+c;if(C<0||w>this.width||U<0||R>this.height)return!p&&[];var Y=[];return this._forEachCell(w,R,C,U,this._queryCellCircle,Y,{hitTest:p,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},b),p?Y.length>0:Y},Kt.prototype.query=function(l,f,c,p,b){return this._query(l,f,c,p,!1,b)},Kt.prototype.hitTest=function(l,f,c,p,b){return this._query(l,f,c,p,!0,b)},Kt.prototype.hitTestCircle=function(l,f,c,p){return this._queryCircle(l,f,c,!0,p)},Kt.prototype._queryCell=function(l,f,c,p,b,w,C,R){var U=C.seenUids,Y=this.boxCells[b];if(Y!==null)for(var ce=this.bboxes,he=0,pe=Y;he<pe.length;he+=1){var Ae=pe[he];if(!U.box[Ae]){U.box[Ae]=!0;var Re=4*Ae;if(l<=ce[Re+2]&&f<=ce[Re+3]&&c>=ce[Re+0]&&p>=ce[Re+1]&&(!R||R(this.boxKeys[Ae]))){if(C.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Ae],x1:ce[Re],y1:ce[Re+1],x2:ce[Re+2],y2:ce[Re+3]})}}}var We=this.circleCells[b];if(We!==null)for(var Te=this.circles,Ve=0,Qe=We;Ve<Qe.length;Ve+=1){var gt=Qe[Ve];if(!U.circle[gt]){U.circle[gt]=!0;var Gt=3*gt;if(this._circleAndRectCollide(Te[Gt],Te[Gt+1],Te[Gt+2],l,f,c,p)&&(!R||R(this.circleKeys[gt]))){if(C.hitTest)return w.push(!0),!0;var Ft=Te[Gt],Xt=Te[Gt+1],cr=Te[Gt+2];w.push({key:this.circleKeys[gt],x1:Ft-cr,y1:Xt-cr,x2:Ft+cr,y2:Xt+cr})}}}},Kt.prototype._queryCellCircle=function(l,f,c,p,b,w,C,R){var U=C.circle,Y=C.seenUids,ce=this.boxCells[b];if(ce!==null)for(var he=this.bboxes,pe=0,Ae=ce;pe<Ae.length;pe+=1){var Re=Ae[pe];if(!Y.box[Re]){Y.box[Re]=!0;var We=4*Re;if(this._circleAndRectCollide(U.x,U.y,U.radius,he[We+0],he[We+1],he[We+2],he[We+3])&&(!R||R(this.boxKeys[Re])))return w.push(!0),!0}}var Te=this.circleCells[b];if(Te!==null)for(var Ve=this.circles,Qe=0,gt=Te;Qe<gt.length;Qe+=1){var Gt=gt[Qe];if(!Y.circle[Gt]){Y.circle[Gt]=!0;var Ft=3*Gt;if(this._circlesCollide(Ve[Ft],Ve[Ft+1],Ve[Ft+2],U.x,U.y,U.radius)&&(!R||R(this.circleKeys[Gt])))return w.push(!0),!0}}},Kt.prototype._forEachCell=function(l,f,c,p,b,w,C,R){for(var U=this._convertToXCellCoord(l),Y=this._convertToYCellCoord(f),ce=this._convertToXCellCoord(c),he=this._convertToYCellCoord(p),pe=U;pe<=ce;pe++)for(var Ae=Y;Ae<=he;Ae++)if(b.call(this,l,f,c,p,this.xCellCount*Ae+pe,w,C,R))return},Kt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Kt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Kt.prototype._circlesCollide=function(l,f,c,p,b,w){var C=p-l,R=b-f,U=c+w;return U*U>C*C+R*R},Kt.prototype._circleAndRectCollide=function(l,f,c,p,b,w,C){var R=(w-p)/2,U=Math.abs(l-(p+R));if(U>R+c)return!1;var Y=(C-b)/2,ce=Math.abs(f-(b+Y));if(ce>Y+c)return!1;if(U<=R||ce<=Y)return!0;var he=U-R,pe=ce-Y;return he*he+pe*pe<=c*c};var fu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ba(l,f){for(var c=0;c<l;c++){var p=f.length;f.resize(p+4),f.float32.set(fu,3*p)}}function Ma(l,f,c){var p=f[0],b=f[1];return l[0]=c[0]*p+c[4]*b+c[12],l[1]=c[1]*p+c[5]*b+c[13],l[3]=c[3]*p+c[7]*b+c[15],l}var Wa=function(l,f,c){f===void 0&&(f=new Kt(l.width+200,l.height+200,25)),c===void 0&&(c=new Kt(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ia(l,f,c){return f*(m.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Wa.prototype.placeCollisionBox=function(l,f,c,p,b){var w=this.projectAndGetPerspectiveRatio(p,l.anchorPointX,l.anchorPointY),C=c*w.perspectiveRatio,R=l.x1*C+w.point.x,U=l.y1*C+w.point.y,Y=l.x2*C+w.point.x,ce=l.y2*C+w.point.y;return!this.isInsideGrid(R,U,Y,ce)||!f&&this.grid.hitTest(R,U,Y,ce,b)?{box:[],offscreen:!1}:{box:[R,U,Y,ce],offscreen:this.isOffscreen(R,U,Y,ce)}},Wa.prototype.placeCollisionCircles=function(l,f,c,p,b,w,C,R,U,Y,ce,he,pe){var Ae=[],Re=new m.Point(f.anchorX,f.anchorY),We=Mi(Re,w),Te=Ui(this.transform.cameraToCenterDistance,We.signedDistanceFromCamera),Ve=(Y?b/Te:b*Te)/m.ONE_EM,Qe=Mi(Re,C).point,gt=zt(Ve,p,f.lineOffsetX*Ve,f.lineOffsetY*Ve,!1,Qe,Re,f,c,C,{}),Gt=!1,Ft=!1,Xt=!0;if(gt){for(var cr=.5*he*Te+pe,Rr=new m.Point(-100,-100),Or=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),Qr=new St,Dn=gt.first,Bn=gt.last,Un=[],di=Dn.path.length-1;di>=1;di--)Un.push(Dn.path[di]);for(var nn=1;nn<Bn.path.length;nn++)Un.push(Bn.path[nn]);var ai=2.5*cr;if(R){var si=Un.map(function($s){return Mi($s,R)});Un=si.some(function($s){return $s.signedDistanceFromCamera<=0})?[]:si.map(function($s){return $s.point})}var ei=[];if(Un.length>0){for(var Wn=Un[0].clone(),mi=Un[0].clone(),$n=1;$n<Un.length;$n++)Wn.x=Math.min(Wn.x,Un[$n].x),Wn.y=Math.min(Wn.y,Un[$n].y),mi.x=Math.max(mi.x,Un[$n].x),mi.y=Math.max(mi.y,Un[$n].y);ei=Wn.x>=Rr.x&&mi.x<=Or.x&&Wn.y>=Rr.y&&mi.y<=Or.y?[Un]:mi.x<Rr.x||Wn.x>Or.x||mi.y<Rr.y||Wn.y>Or.y?[]:m.clipLine([Un],Rr.x,Rr.y,Or.x,Or.y)}for(var jn=0,Ea=ei;jn<Ea.length;jn+=1){var Ka;Qr.reset(Ea[jn],.25*cr),Ka=Qr.length<=.5*cr?1:Math.ceil(Qr.paddedLength/ai)+1;for(var Bo=0;Bo<Ka;Bo++){var wo=Bo/Math.max(Ka-1,1),Va=Qr.lerp(wo),no=Va.x+100,Es=Va.y+100;Ae.push(no,Es,cr,0);var os=no-cr,ku=Es-cr,ss=no+cr,qs=Es+cr;if(Xt=Xt&&this.isOffscreen(os,ku,ss,qs),Ft=Ft||this.isInsideGrid(os,ku,ss,qs),!l&&this.grid.hitTestCircle(no,Es,cr,ce)&&(Gt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Gt}}}}return{circles:!U&&Gt||!Ft?[]:Ae,offscreen:Xt,collisionDetected:Gt}},Wa.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,p=1/0,b=-1/0,w=-1/0,C=0,R=l;C<R.length;C+=1){var U=R[C],Y=new m.Point(U.x+100,U.y+100);c=Math.min(c,Y.x),p=Math.min(p,Y.y),b=Math.max(b,Y.x),w=Math.max(w,Y.y),f.push(Y)}for(var ce={},he={},pe=0,Ae=this.grid.query(c,p,b,w).concat(this.ignoredGrid.query(c,p,b,w));pe<Ae.length;pe+=1){var Re=Ae[pe],We=Re.key;if(ce[We.bucketInstanceId]===void 0&&(ce[We.bucketInstanceId]={}),!ce[We.bucketInstanceId][We.featureIndex]){var Te=[new m.Point(Re.x1,Re.y1),new m.Point(Re.x2,Re.y1),new m.Point(Re.x2,Re.y2),new m.Point(Re.x1,Re.y2)];m.polygonIntersectsPolygon(f,Te)&&(ce[We.bucketInstanceId][We.featureIndex]=!0,he[We.bucketInstanceId]===void 0&&(he[We.bucketInstanceId]=[]),he[We.bucketInstanceId].push(We.featureIndex))}}return he},Wa.prototype.insertCollisionBox=function(l,f,c,p,b){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:b},l[0],l[1],l[2],l[3])},Wa.prototype.insertCollisionCircles=function(l,f,c,p,b){for(var w=f?this.ignoredGrid:this.grid,C={bucketInstanceId:c,featureIndex:p,collisionGroupID:b},R=0;R<l.length;R+=4)w.insertCircle(C,l[R],l[R+1],l[R+2])},Wa.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var p=[f,c,0,1];return Ma(p,p,l),{point:new m.Point((p[0]/p[3]+1)/2*this.transform.width+100,(-p[1]/p[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/p[3]*.5}},Wa.prototype.isOffscreen=function(l,f,c,p){return c<100||l>=this.screenRightBoundary||p<100||f>this.screenBottomBoundary},Wa.prototype.isInsideGrid=function(l,f,c,p){return c>=0&&l<this.gridRightBoundary&&p>=0&&f<this.gridBottomBoundary},Wa.prototype.getViewportMatrix=function(){var l=m.identity([]);return m.translate(l,l,[-100,-100,0]),l};var bo=function(l,f,c,p){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):p&&c?1:0,this.placed=c};bo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Vo=function(l,f,c,p,b){this.text=new bo(l?l.text:null,f,c,b),this.icon=new bo(l?l.icon:null,f,p,b)};Vo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var wu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},fo=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},Do=function(l,f,c,p,b){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=b},aa=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Xa(l,f,c,p,b){var w=m.getAnchorAlignment(l),C=-(w.horizontalAlign-.5)*f,R=-(w.verticalAlign-.5)*c,U=m.evaluateVariableOffset(l,p);return new m.Point(C+U[0]*b,R+U[1]*b)}function Fo(l,f,c,p,b,w){var C=l.x1,R=l.x2,U=l.y1,Y=l.y2,ce=l.anchorPointX,he=l.anchorPointY,pe=new m.Point(f,c);return p&&pe._rotate(b?w:-w),{x1:C+pe.x,y1:U+pe.y,x2:R+pe.x,y2:Y+pe.y,anchorPointX:ce,anchorPointY:he}}aa.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var Ya=function(l,f,c,p){this.transform=l.clone(),this.collisionIndex=new Wa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new aa(c),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}};function Cs(l,f,c,p,b){l.emplaceBack(f?1:0,c?1:0,p||0,b||0),l.emplaceBack(f?1:0,c?1:0,p||0,b||0),l.emplaceBack(f?1:0,c?1:0,p||0,b||0),l.emplaceBack(f?1:0,c?1:0,p||0,b||0)}Ya.prototype.getBucketParts=function(l,f,c,p){var b=c.getBucket(f),w=c.latestFeatureIndex;if(b&&w&&f.id===b.layerIds[0]){var C=c.collisionBoxArray,R=b.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),Y=c.tileSize/m.EXTENT,ce=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),he=R.get("text-pitch-alignment")==="map",pe=R.get("text-rotation-alignment")==="map",Ae=ia(c,1,this.transform.zoom),Re=Ca(ce,he,pe,this.transform,Ae),We=null;if(he){var Te=Ei(ce,he,pe,this.transform,Ae);We=m.multiply([],this.transform.labelPlaneMatrix,Te)}this.retainedQueryData[b.bucketInstanceId]=new Do(b.bucketInstanceId,w,b.sourceLayerIndex,b.index,c.tileID);var Ve={bucket:b,layout:R,posMatrix:ce,textLabelPlaneMatrix:Re,labelToScreenMatrix:We,scale:U,textPixelRatio:Y,holdingForFade:c.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(p)for(var Qe=0,gt=b.sortKeyRanges;Qe<gt.length;Qe+=1){var Gt=gt[Qe];l.push({sortKey:Gt.sortKey,symbolInstanceStart:Gt.symbolInstanceStart,symbolInstanceEnd:Gt.symbolInstanceEnd,parameters:Ve})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ve})}},Ya.prototype.attemptAnchorPlacement=function(l,f,c,p,b,w,C,R,U,Y,ce,he,pe,Ae,Re){var We,Te=[he.textOffset0,he.textOffset1],Ve=Xa(l,c,p,Te,b),Qe=this.collisionIndex.placeCollisionBox(Fo(f,Ve.x,Ve.y,w,C,this.transform.angle),ce,R,U,Y.predicate);if(!Re||this.collisionIndex.placeCollisionBox(Fo(Re,Ve.x,Ve.y,w,C,this.transform.angle),ce,R,U,Y.predicate).box.length!==0)return Qe.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[he.crossTileID]&&this.prevPlacement.placements[he.crossTileID]&&this.prevPlacement.placements[he.crossTileID].text&&(We=this.prevPlacement.variableOffsets[he.crossTileID].anchor),this.variableOffsets[he.crossTileID]={textOffset:Te,width:c,height:p,anchor:l,textBoxScale:b,prevAnchor:We},this.markUsedJustification(pe,l,he,Ae),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,Ae,he),this.placedOrientations[he.crossTileID]=Ae),{shift:Ve,placedGlyphBoxes:Qe}):void 0},Ya.prototype.placeLayerBucketPart=function(l,f,c){var p=this,b=l.parameters,w=b.bucket,C=b.layout,R=b.posMatrix,U=b.textLabelPlaneMatrix,Y=b.labelToScreenMatrix,ce=b.textPixelRatio,he=b.holdingForFade,pe=b.collisionBoxArray,Ae=b.partiallyEvaluatedTextSize,Re=b.collisionGroup,We=C.get("text-optional"),Te=C.get("icon-optional"),Ve=C.get("text-allow-overlap"),Qe=C.get("icon-allow-overlap"),gt=C.get("text-rotation-alignment")==="map",Gt=C.get("text-pitch-alignment")==="map",Ft=C.get("icon-text-fit")!=="none",Xt=C.get("symbol-z-order")==="viewport-y",cr=Ve&&(Qe||!w.hasIconData()||Te),Rr=Qe&&(Ve||!w.hasTextData()||We);!w.collisionArrays&&pe&&w.deserializeCollisionBoxes(pe);var Or=function(nn,ai){if(!f[nn.crossTileID])if(he)p.placements[nn.crossTileID]=new wu(!1,!1,!1);else{var si,ei=!1,Wn=!1,mi=!0,$n=null,jn={box:null,offscreen:null},Ea={box:null,offscreen:null},Ka=null,Bo=null,wo=0,Va=0,no=0;ai.textFeatureIndex?wo=ai.textFeatureIndex:nn.useRuntimeCollisionCircles&&(wo=nn.featureIndex),ai.verticalTextFeatureIndex&&(Va=ai.verticalTextFeatureIndex);var Es=ai.textBox;if(Es){var os=function(Ji){var Us=m.WritingMode.horizontal;if(w.allowVerticalPlacement&&!Ji&&p.prevPlacement){var us=p.prevPlacement.placedOrientations[nn.crossTileID];us&&(p.placedOrientations[nn.crossTileID]=us,p.markUsedOrientation(w,Us=us,nn))}return Us},ku=function(Ji,Us){if(w.allowVerticalPlacement&&nn.numVerticalGlyphVertices>0&&ai.verticalTextBox)for(var us=0,qu=w.writingModes;us<qu.length&&(qu[us]===m.WritingMode.vertical?(jn=Us(),Ea=jn):jn=Ji(),!(jn&&jn.box&&jn.box.length));us+=1);else jn=Ji()};if(C.get("text-variable-anchor")){var ss=C.get("text-variable-anchor");if(p.prevPlacement&&p.prevPlacement.variableOffsets[nn.crossTileID]){var qs=p.prevPlacement.variableOffsets[nn.crossTileID];ss.indexOf(qs.anchor)>0&&(ss=ss.filter(function(Ji){return Ji!==qs.anchor})).unshift(qs.anchor)}var $s=function(Ji,Us,us){for(var qu=Ji.x2-Ji.x1,Bc=Ji.y2-Ji.y1,zc=nn.textBoxScale,vf=Ft&&!Qe?Us:null,$o={box:[],offscreen:!1},pc=Ve?2*ss.length:ss.length,su=0;su<pc;++su){var ml=p.attemptAnchorPlacement(ss[su%ss.length],Ji,qu,Bc,zc,gt,Gt,ce,R,Re,su>=ss.length,nn,w,us,vf);if(ml&&($o=ml.placedGlyphBoxes)&&$o.box&&$o.box.length){ei=!0,$n=ml.shift;break}}return $o};ku(function(){return $s(Es,ai.iconBox,m.WritingMode.horizontal)},function(){var Ji=ai.verticalTextBox;return w.allowVerticalPlacement&&!(jn&&jn.box&&jn.box.length)&&nn.numVerticalGlyphVertices>0&&Ji?$s(Ji,ai.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),jn&&(ei=jn.box,mi=jn.offscreen);var fc=os(jn&&jn.box);if(!ei&&p.prevPlacement){var Bl=p.prevPlacement.variableOffsets[nn.crossTileID];Bl&&(p.variableOffsets[nn.crossTileID]=Bl,p.markUsedJustification(w,Bl.anchor,nn,fc))}}else{var mu=function(Ji,Us){var us=p.collisionIndex.placeCollisionBox(Ji,Ve,ce,R,Re.predicate);return us&&us.box&&us.box.length&&(p.markUsedOrientation(w,Us,nn),p.placedOrientations[nn.crossTileID]=Us),us};ku(function(){return mu(Es,m.WritingMode.horizontal)},function(){var Ji=ai.verticalTextBox;return w.allowVerticalPlacement&&nn.numVerticalGlyphVertices>0&&Ji?mu(Ji,m.WritingMode.vertical):{box:null,offscreen:null}}),os(jn&&jn.box&&jn.box.length)}}if(ei=(si=jn)&&si.box&&si.box.length>0,mi=si&&si.offscreen,nn.useRuntimeCollisionCircles){var vl=w.text.placedSymbolArray.get(nn.centerJustifiedTextSymbolIndex),hc=m.evaluateSizeForFeature(w.textSizeData,Ae,vl),ou=C.get("text-padding");Ka=p.collisionIndex.placeCollisionCircles(Ve,vl,w.lineVertexArray,w.glyphOffsetArray,hc,R,U,Y,c,Gt,Re.predicate,nn.collisionCircleDiameter,ou),ei=Ve||Ka.circles.length>0&&!Ka.collisionDetected,mi=mi&&Ka.offscreen}if(ai.iconFeatureIndex&&(no=ai.iconFeatureIndex),ai.iconBox){var zl=function(Ji){var Us=Ft&&$n?Fo(Ji,$n.x,$n.y,gt,Gt,p.transform.angle):Ji;return p.collisionIndex.placeCollisionBox(Us,Qe,ce,R,Re.predicate)};Wn=Ea&&Ea.box&&Ea.box.length&&ai.verticalIconBox?(Bo=zl(ai.verticalIconBox)).box.length>0:(Bo=zl(ai.iconBox)).box.length>0,mi=mi&&Bo.offscreen}var gu=We||nn.numHorizontalGlyphVertices===0&&nn.numVerticalGlyphVertices===0,yo=Te||nn.numIconVertices===0;if(gu||yo?yo?gu||(Wn=Wn&&ei):ei=Wn&&ei:Wn=ei=Wn&&ei,ei&&si&&si.box&&p.collisionIndex.insertCollisionBox(si.box,C.get("text-ignore-placement"),w.bucketInstanceId,Ea&&Ea.box&&Va?Va:wo,Re.ID),Wn&&Bo&&p.collisionIndex.insertCollisionBox(Bo.box,C.get("icon-ignore-placement"),w.bucketInstanceId,no,Re.ID),Ka&&(ei&&p.collisionIndex.insertCollisionCircles(Ka.circles,C.get("text-ignore-placement"),w.bucketInstanceId,wo,Re.ID),c)){var yu=w.bucketInstanceId,Ku=p.collisionCircleArrays[yu];Ku===void 0&&(Ku=p.collisionCircleArrays[yu]=new fo);for(var Du=0;Du<Ka.circles.length;Du+=4)Ku.circles.push(Ka.circles[Du+0]),Ku.circles.push(Ka.circles[Du+1]),Ku.circles.push(Ka.circles[Du+2]),Ku.circles.push(Ka.collisionDetected?1:0)}p.placements[nn.crossTileID]=new wu(ei||cr,Wn||Rr,mi||w.justReloaded),f[nn.crossTileID]=!0}};if(Xt)for(var Qr=w.getSortedSymbolIndexes(this.transform.angle),Dn=Qr.length-1;Dn>=0;--Dn){var Bn=Qr[Dn];Or(w.symbolInstances.get(Bn),w.collisionArrays[Bn])}else for(var Un=l.symbolInstanceStart;Un<l.symbolInstanceEnd;Un++)Or(w.symbolInstances.get(Un),w.collisionArrays[Un]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var di=this.collisionCircleArrays[w.bucketInstanceId];m.invert(di.invProjMatrix,R),di.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Ya.prototype.markUsedJustification=function(l,f,c,p){var b;b=p===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(f)];for(var w=0,C=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<C.length;w+=1){var R=C[w];R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=b>=0&&R!==b?0:c.crossTileID)}},Ya.prototype.markUsedOrientation=function(l,f,c){for(var p=f===m.WritingMode.horizontal||f===m.WritingMode.horizontalOnly?f:0,b=f===m.WritingMode.vertical?f:0,w=0,C=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<C.length;w+=1)l.text.placedSymbolArray.get(C[w]).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=b)},Ya.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var p=f?f.symbolFadeChange(l):1,b=f?f.opacities:{},w=f?f.variableOffsets:{},C=f?f.placedOrientations:{};for(var R in this.placements){var U=this.placements[R],Y=b[R];Y?(this.opacities[R]=new Vo(Y,p,U.text,U.icon),c=c||U.text!==Y.text.placed||U.icon!==Y.icon.placed):(this.opacities[R]=new Vo(null,p,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var ce in b){var he=b[ce];if(!this.opacities[ce]){var pe=new Vo(he,p,!1,!1);pe.isHidden()||(this.opacities[ce]=pe,c=c||he.text.placed||he.icon.placed)}}for(var Ae in w)this.variableOffsets[Ae]||!this.opacities[Ae]||this.opacities[Ae].isHidden()||(this.variableOffsets[Ae]=w[Ae]);for(var Re in C)this.placedOrientations[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.placedOrientations[Re]=C[Re]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},Ya.prototype.updateLayerOpacities=function(l,f){for(var c={},p=0,b=f;p<b.length;p+=1){var w=b[p],C=w.getBucket(l);C&&w.latestFeatureIndex&&l.id===C.layerIds[0]&&this.updateBucketOpacities(C,c,w.collisionBoxArray)}},Ya.prototype.updateBucketOpacities=function(l,f,c){var p=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var b=l.layers[0].layout,w=new Vo(null,0,!1,!1,!0),C=b.get("text-allow-overlap"),R=b.get("icon-allow-overlap"),U=b.get("text-variable-anchor"),Y=b.get("text-rotation-alignment")==="map",ce=b.get("text-pitch-alignment")==="map",he=b.get("icon-text-fit")!=="none",pe=new Vo(null,0,C&&(R||!l.hasIconData()||b.get("icon-optional")),R&&(C||!l.hasTextData()||b.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Ae=function(Ve,Qe,gt){for(var Gt=0;Gt<Qe/4;Gt++)Ve.opacityVertexArray.emplaceBack(gt)},Re=function(Ve){var Qe=l.symbolInstances.get(Ve),gt=Qe.numHorizontalGlyphVertices,Gt=Qe.numVerticalGlyphVertices,Ft=Qe.crossTileID,Xt=p.opacities[Ft];f[Ft]?Xt=w:Xt||(p.opacities[Ft]=Xt=pe),f[Ft]=!0;var cr=Qe.numIconVertices>0,Rr=p.placedOrientations[Qe.crossTileID],Or=Rr===m.WritingMode.vertical,Qr=Rr===m.WritingMode.horizontal||Rr===m.WritingMode.horizontalOnly;if(gt>0||Gt>0){var Dn=Tn(Xt.text);Ae(l.text,gt,Or?Pi:Dn),Ae(l.text,Gt,Qr?Pi:Dn);var Bn=Xt.text.isHidden();[Qe.rightJustifiedTextSymbolIndex,Qe.centerJustifiedTextSymbolIndex,Qe.leftJustifiedTextSymbolIndex].forEach(function(jn){jn>=0&&(l.text.placedSymbolArray.get(jn).hidden=Bn||Or?1:0)}),Qe.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Qe.verticalPlacedTextSymbolIndex).hidden=Bn||Qr?1:0);var Un=p.variableOffsets[Qe.crossTileID];Un&&p.markUsedJustification(l,Un.anchor,Qe,Rr);var di=p.placedOrientations[Qe.crossTileID];di&&(p.markUsedJustification(l,"left",Qe,di),p.markUsedOrientation(l,di,Qe))}if(cr){var nn=Tn(Xt.icon),ai=!(he&&Qe.verticalPlacedIconSymbolIndex&&Or);Qe.placedIconSymbolIndex>=0&&(Ae(l.icon,Qe.numIconVertices,ai?nn:Pi),l.icon.placedSymbolArray.get(Qe.placedIconSymbolIndex).hidden=Xt.icon.isHidden()),Qe.verticalPlacedIconSymbolIndex>=0&&(Ae(l.icon,Qe.numVerticalIconVertices,ai?Pi:nn),l.icon.placedSymbolArray.get(Qe.verticalPlacedIconSymbolIndex).hidden=Xt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var si=l.collisionArrays[Ve];if(si){var ei=new m.Point(0,0);if(si.textBox||si.verticalTextBox){var Wn=!0;if(U){var mi=p.variableOffsets[Ft];mi?(ei=Xa(mi.anchor,mi.width,mi.height,mi.textOffset,mi.textBoxScale),Y&&ei._rotate(ce?p.transform.angle:-p.transform.angle)):Wn=!1}si.textBox&&Cs(l.textCollisionBox.collisionVertexArray,Xt.text.placed,!Wn||Or,ei.x,ei.y),si.verticalTextBox&&Cs(l.textCollisionBox.collisionVertexArray,Xt.text.placed,!Wn||Qr,ei.x,ei.y)}var $n=Boolean(!Qr&&si.verticalIconBox);si.iconBox&&Cs(l.iconCollisionBox.collisionVertexArray,Xt.icon.placed,$n,he?ei.x:0,he?ei.y:0),si.verticalIconBox&&Cs(l.iconCollisionBox.collisionVertexArray,Xt.icon.placed,!$n,he?ei.x:0,he?ei.y:0)}}},We=0;We<l.symbolInstances.length;We++)Re(We);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Te=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Te.invProjMatrix,l.placementViewportMatrix=Te.viewportMatrix,l.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Ya.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ya.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Ya.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Ya.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},Ya.prototype.setStale=function(){this.stale=!0};var Sl=Math.pow(2,25),ds=Math.pow(2,24),ae=Math.pow(2,17),xe=Math.pow(2,16),qe=Math.pow(2,9),Ct=Math.pow(2,8),Ir=Math.pow(2,1);function Tn(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Sl+f*ds+c*ae+f*xe+c*qe+f*Ct+c*Ir+f}var Pi=0,ro=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ro.prototype.continuePlacement=function(l,f,c,p,b){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(w,p,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(C,R){return C.sortKey-R.sortKey}));this._currentPartIndex<w.length;)if(f.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,b())return!0;return!1};var ka=function(l,f,c,p,b,w,C){this.placement=new Ya(l,b,w,C),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1};ka.prototype.isDone=function(){return this._done},ka.prototype.continuePlacement=function(l,f,c){for(var p=this,b=m.browser.now(),w=function(){var U=m.browser.now()-b;return!p._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var C=f[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=R)&&(!C.maxzoom||C.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new ro(C)),this._inProgressLayer.continuePlacement(c[C.source],this.placement,this._showCollisionBoxes,C,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},ka.prototype.commit=function(l){return this.placement.commit(l),this.placement};var za=512/m.EXTENT/2,jo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var p=0;p<f.length;p++){var b=f.get(p),w=b.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,l)})}};jo.prototype.getScaledCoordinates=function(l,f){var c=za/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*m.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*m.EXTENT+l.anchorY)*c)}},jo.prototype.findMatches=function(l,f,c){for(var p=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),b=0;b<l.length;b++){var w=l.get(b);if(!w.crossTileID){var C=this.indexedSymbolInstances[w.key];if(C)for(var R=this.getScaledCoordinates(w,f),U=0,Y=C;U<Y.length;U+=1){var ce=Y[U];if(Math.abs(ce.coord.x-R.x)<=p&&Math.abs(ce.coord.y-R.y)<=p&&!c[ce.crossTileID]){c[ce.crossTileID]=!0,w.crossTileID=ce.crossTileID;break}}}}};var vs=function(){this.maxCrossTileID=0};vs.prototype.generate=function(){return++this.maxCrossTileID};var oo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};oo.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var p=this.indexes[c],b={};for(var w in p){var C=p[w];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+f),b[C.tileID.key]=C}this.indexes[c]=b}this.lng=l},oo.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var p=0;p<f.symbolInstances.length;p++)f.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var b=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var C=this.indexes[w];if(Number(w)>l.overscaledZ)for(var R in C){var U=C[R];U.tileID.isChildOf(l)&&U.findMatches(f.symbolInstances,l,b)}else{var Y=C[l.scaledTo(Number(w)).key];Y&&Y.findMatches(f.symbolInstances,l,b)}}for(var ce=0;ce<f.symbolInstances.length;ce++){var he=f.symbolInstances.get(ce);he.crossTileID||(he.crossTileID=c.generate(),b[he.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new jo(l,f.symbolInstances,f.bucketInstanceId),!0},oo.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var p=0,b=f.indexedSymbolInstances[c];p<b.length;p+=1)delete this.usedCrossTileIDs[l][b[p].crossTileID]},oo.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var p=this.indexes[c];for(var b in p)l[p[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[b]),delete p[b],f=!0)}return f};var Eo=function(){this.layerIndexes={},this.crossTileIDs=new vs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Eo.prototype.addLayer=function(l,f,c){var p=this.layerIndexes[l.id];p===void 0&&(p=this.layerIndexes[l.id]=new oo);var b=!1,w={};p.handleWrapJump(c);for(var C=0,R=f;C<R.length;C+=1){var U=R[C],Y=U.getBucket(l);Y&&l.id===Y.layerIds[0]&&(Y.bucketInstanceId||(Y.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(U.tileID,Y,this.crossTileIDs)&&(b=!0),w[Y.bucketInstanceId]=!0)}return p.removeStaleBuckets(w)&&(b=!0),b},Eo.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(p){f[p]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var ms=function(l,f){return m.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},Ms=m.pick(Gr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Fs=m.pick(Gr,["setCenter","setZoom","setBearing","setPitch"]),eu=function(){var l={},f=m.styleSpec.$version;for(var c in m.styleSpec.$root){var p,b=m.styleSpec.$root[c];b.required&&(p=c==="version"?f:b.type==="array"?[]:{})!=null&&(l[c]=p)}return l}(),gs=function(l){function f(c,p){var b=this;p===void 0&&(p={}),l.call(this),this.map=c,this.dispatcher=new Ot(Tt(),this),this.imageManager=new ht,this.imageManager.setEventedParent(this),this.glyphManager=new Ht(c._requestManager,p.localIdeographFontFamily),this.lineAtlas=new Je(256,512),this.crossTileSymbolIndex=new Eo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var w=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(C){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:C.pluginStatus,pluginURL:C.pluginURL},function(R,U){if(m.triggerPluginCompletionEvent(R),U&&U.every(function(ce){return ce}))for(var Y in w.sourceCaches)w.sourceCaches[Y].reload()})}),this.on("data",function(C){if(C.dataType==="source"&&C.sourceDataType==="metadata"){var R=b.sourceCaches[C.sourceId];if(R){var U=R.getSource();if(U&&U.vectorLayerIds)for(var Y in b._layers){var ce=b._layers[Y];ce.source===U.id&&b._validateLayer(ce)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,p){var b=this;p===void 0&&(p={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var w=typeof p.validate=="boolean"?p.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,p.accessToken);var C=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(C,function(R,U){b._request=null,R?b.fire(new m.ErrorEvent(R)):U&&b._load(U,w)})},f.prototype.loadJSON=function(c,p){var b=this;p===void 0&&(p={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){b._request=null,b._load(c,p.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(eu,!1)},f.prototype._load=function(c,p){if(!p||!ms(this,m.validateStyle(c))){for(var b in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(b,c.sources[b],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Fr(this.stylesheet.layers);this._order=w.map(function(Y){return Y.id}),this._layers={},this._serializedLayers={};for(var C=0,R=w;C<R.length;C+=1){var U=R[C];(U=m.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ut(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},f.prototype._loadSprite=function(c){var p=this;this._spriteRequest=function(b,w,C){var R,U,Y,ce=m.browser.devicePixelRatio>1?"@2x":"",he=m.getJSON(w.transformRequest(w.normalizeSpriteURL(b,ce,".json"),m.ResourceType.SpriteJSON),function(Re,We){he=null,Y||(Y=Re,R=We,Ae())}),pe=m.getImage(w.transformRequest(w.normalizeSpriteURL(b,ce,".png"),m.ResourceType.SpriteImage),function(Re,We){pe=null,Y||(Y=Re,U=We,Ae())});function Ae(){if(Y)C(Y);else if(R&&U){var Re=m.browser.getImageData(U),We={};for(var Te in R){var Ve=R[Te],Qe=Ve.width,gt=Ve.height,Gt=Ve.x,Ft=Ve.y,Xt=Ve.sdf,cr=Ve.pixelRatio,Rr=Ve.stretchX,Or=Ve.stretchY,Qr=Ve.content,Dn=new m.RGBAImage({width:Qe,height:gt});m.RGBAImage.copy(Re,Dn,{x:Gt,y:Ft},{x:0,y:0},{width:Qe,height:gt}),We[Te]={data:Dn,pixelRatio:cr,sdf:Xt,stretchX:Rr,stretchY:Or,content:Qr}}C(null,We)}}return{cancel:function(){he&&(he.cancel(),he=null),pe&&(pe.cancel(),pe=null)}}}(c,this.map._requestManager,function(b,w){if(p._spriteRequest=null,b)p.fire(new m.ErrorEvent(b));else if(w)for(var C in w)p.imageManager.addImage(C,w[C]);p.imageManager.setLoaded(!0),p._availableImages=p.imageManager.listImages(),p.dispatcher.broadcast("setImages",p._availableImages),p.fire(new m.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var p=this.sourceCaches[c.source];if(p){var b=c.sourceLayer;if(b){var w=p.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(b)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+b+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var p=[],b=0,w=c;b<w.length;b+=1){var C=this._layers[w[b]];C.type!=="custom"&&p.push(C.serialize())}return p},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var p in this._layers)if(this._layers[p].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var p=this._changed;if(this._changed){var b=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var C in(b.length||w.length)&&this._updateWorkerLayers(b,w),this._updatedSources){var R=this._updatedSources[C];R==="reload"?this._reloadSource(C):R==="clear"&&this._clearSource(C)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var Y={};for(var ce in this.sourceCaches){var he=this.sourceCaches[ce];Y[ce]=he.used,he.used=!1}for(var pe=0,Ae=this._order;pe<Ae.length;pe+=1){var Re=this._layers[Ae[pe]];Re.recalculate(c,this._availableImages),!Re.isHidden(c.zoom)&&Re.source&&(this.sourceCaches[Re.source].used=!0)}for(var We in Y){var Te=this.sourceCaches[We];Y[We]!==Te.used&&Te.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:We}))}this.light.recalculate(c),this.z=c.zoom,p&&this.fire(new m.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var p in this.sourceCaches)this.sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:p})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var p=this;if(this._checkLoaded(),ms(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=Fr(c.layers);var b=function(C,R){if(!C)return[{command:Gr.setStyle,args:[R]}];var U=[];try{if(!m.deepEqual(C.version,R.version))return[{command:Gr.setStyle,args:[R]}];m.deepEqual(C.center,R.center)||U.push({command:Gr.setCenter,args:[R.center]}),m.deepEqual(C.zoom,R.zoom)||U.push({command:Gr.setZoom,args:[R.zoom]}),m.deepEqual(C.bearing,R.bearing)||U.push({command:Gr.setBearing,args:[R.bearing]}),m.deepEqual(C.pitch,R.pitch)||U.push({command:Gr.setPitch,args:[R.pitch]}),m.deepEqual(C.sprite,R.sprite)||U.push({command:Gr.setSprite,args:[R.sprite]}),m.deepEqual(C.glyphs,R.glyphs)||U.push({command:Gr.setGlyphs,args:[R.glyphs]}),m.deepEqual(C.transition,R.transition)||U.push({command:Gr.setTransition,args:[R.transition]}),m.deepEqual(C.light,R.light)||U.push({command:Gr.setLight,args:[R.light]});var Y={},ce=[];(function(pe,Ae,Re,We){var Te;for(Te in Ae=Ae||{},pe=pe||{})pe.hasOwnProperty(Te)&&(Ae.hasOwnProperty(Te)||Jr(Te,Re,We));for(Te in Ae)Ae.hasOwnProperty(Te)&&(pe.hasOwnProperty(Te)?m.deepEqual(pe[Te],Ae[Te])||(pe[Te].type==="geojson"&&Ae[Te].type==="geojson"&&Wi(pe,Ae,Te)?Re.push({command:Gr.setGeoJSONSourceData,args:[Te,Ae[Te].data]}):Pn(Te,Ae,Re,We)):vi(Te,Ae,Re))})(C.sources,R.sources,ce,Y);var he=[];C.layers&&C.layers.forEach(function(pe){Y[pe.source]?U.push({command:Gr.removeLayer,args:[pe.id]}):he.push(pe)}),U=U.concat(ce),function(pe,Ae,Re){Ae=Ae||[];var We,Te,Ve,Qe,gt,Gt,Ft,Xt=(pe=pe||[]).map(Ci),cr=Ae.map(Ci),Rr=pe.reduce(_i,{}),Or=Ae.reduce(_i,{}),Qr=Xt.slice(),Dn=Object.create(null);for(We=0,Te=0;We<Xt.length;We++)Or.hasOwnProperty(Ve=Xt[We])?Te++:(Re.push({command:Gr.removeLayer,args:[Ve]}),Qr.splice(Qr.indexOf(Ve,Te),1));for(We=0,Te=0;We<cr.length;We++)Qr[Qr.length-1-We]!==(Ve=cr[cr.length-1-We])&&(Rr.hasOwnProperty(Ve)?(Re.push({command:Gr.removeLayer,args:[Ve]}),Qr.splice(Qr.lastIndexOf(Ve,Qr.length-Te),1)):Te++,Re.push({command:Gr.addLayer,args:[Or[Ve],Gt=Qr[Qr.length-We]]}),Qr.splice(Qr.length-We,0,Ve),Dn[Ve]=!0);for(We=0;We<cr.length;We++)if(Qe=Rr[Ve=cr[We]],gt=Or[Ve],!Dn[Ve]&&!m.deepEqual(Qe,gt))if(m.deepEqual(Qe.source,gt.source)&&m.deepEqual(Qe["source-layer"],gt["source-layer"])&&m.deepEqual(Qe.type,gt.type)){for(Ft in pi(Qe.layout,gt.layout,Re,Ve,null,Gr.setLayoutProperty),pi(Qe.paint,gt.paint,Re,Ve,null,Gr.setPaintProperty),m.deepEqual(Qe.filter,gt.filter)||Re.push({command:Gr.setFilter,args:[Ve,gt.filter]}),m.deepEqual(Qe.minzoom,gt.minzoom)&&m.deepEqual(Qe.maxzoom,gt.maxzoom)||Re.push({command:Gr.setLayerZoomRange,args:[Ve,gt.minzoom,gt.maxzoom]}),Qe)Qe.hasOwnProperty(Ft)&&Ft!=="layout"&&Ft!=="paint"&&Ft!=="filter"&&Ft!=="metadata"&&Ft!=="minzoom"&&Ft!=="maxzoom"&&(Ft.indexOf("paint.")===0?pi(Qe[Ft],gt[Ft],Re,Ve,Ft.slice(6),Gr.setPaintProperty):m.deepEqual(Qe[Ft],gt[Ft])||Re.push({command:Gr.setLayerProperty,args:[Ve,Ft,gt[Ft]]}));for(Ft in gt)gt.hasOwnProperty(Ft)&&!Qe.hasOwnProperty(Ft)&&Ft!=="layout"&&Ft!=="paint"&&Ft!=="filter"&&Ft!=="metadata"&&Ft!=="minzoom"&&Ft!=="maxzoom"&&(Ft.indexOf("paint.")===0?pi(Qe[Ft],gt[Ft],Re,Ve,Ft.slice(6),Gr.setPaintProperty):m.deepEqual(Qe[Ft],gt[Ft])||Re.push({command:Gr.setLayerProperty,args:[Ve,Ft,gt[Ft]]}))}else Re.push({command:Gr.removeLayer,args:[Ve]}),Gt=Qr[Qr.lastIndexOf(Ve)+1],Re.push({command:Gr.addLayer,args:[gt,Gt]})}(he,R.layers,U)}catch(pe){console.warn("Unable to compute style diff:",pe),U=[{command:Gr.setStyle,args:[R]}]}return U}(this.serialize(),c).filter(function(C){return!(C.command in Fs)});if(b.length===0)return!1;var w=b.filter(function(C){return!(C.command in Ms)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(C){return C.command}).join(", ")+".");return b.forEach(function(C){C.command!=="setTransition"&&p[C.command].apply(p,C.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,p){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,p),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,p){this.imageManager.updateImage(c,p)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,p,b){var w=this;if(b===void 0&&(b={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!p.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(p).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,p,null,b))){this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);var C=this.sourceCaches[c]=new ke(c,p,this.dispatcher);C.style=this,C.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:C.serialize(),sourceId:c}}),C.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var p in this._layers)if(this._layers[p].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+p+'" is using it.')));var b=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],b.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),b.setEventedParent(null),b.clearTiles(),b.onRemove&&b.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,p){this._checkLoaded(),this.sourceCaches[c].getSource().setData(p),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,p,b){b===void 0&&(b={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new m.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var C;if(c.type==="custom"){if(ms(this,m.validateCustomStyleLayer(c)))return;C=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=m.clone$1(c),c=m.extend(c,{source:w})),this._validate(m.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},b))return;C=m.createStyleLayer(c),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[C.id]=C.serialize()}var R=p?this._order.indexOf(p):this._order.length;if(p&&R===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+p+'" does not exist on this map.')));else{if(this._order.splice(R,0,w),this._layerOrderChanged=!0,this._layers[w]=C,this._removedLayers[w]&&C.source&&C.type!=="custom"){var U=this._removedLayers[w];delete this._removedLayers[w],U.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",this.sourceCaches[C.source].pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map)}}},f.prototype.moveLayer=function(c,p){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==p){var b=this._order.indexOf(c);this._order.splice(b,1);var w=p?this._order.indexOf(p):this._order.length;p&&w===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+p+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var p=this._layers[c];if(p){p.setEventedParent(null);var b=this._order.indexOf(c);this._order.splice(b,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=p,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],p.onRemove&&p.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,p,b){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===p&&w.maxzoom===b||(p!=null&&(w.minzoom=p),b!=null&&(w.maxzoom=b),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,p,b){b===void 0&&(b={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!m.deepEqual(w.filter,p))return p==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateStyle.filter,"layers."+w.id+".filter",p,null,b)||(w.filter=m.clone$1(p),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,p,b,w){w===void 0&&(w={}),this._checkLoaded();var C=this.getLayer(c);C?m.deepEqual(C.getLayoutProperty(p),b)||(C.setLayoutProperty(p,b,w),this._updateLayer(C)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,p){var b=this.getLayer(c);if(b)return b.getLayoutProperty(p);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,p,b,w){w===void 0&&(w={}),this._checkLoaded();var C=this.getLayer(c);C?m.deepEqual(C.getPaintProperty(p),b)||(C.setPaintProperty(p,b,w)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,p){return this.getLayer(c).getPaintProperty(p)},f.prototype.setFeatureState=function(c,p){this._checkLoaded();var b=c.source,w=c.sourceLayer,C=this.sourceCaches[b];if(C!==void 0){var R=C.getSource().type;R==="geojson"&&w?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||w?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),C.setFeatureState(w,c.id,p)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,p){this._checkLoaded();var b=c.source,w=this.sourceCaches[b];if(w!==void 0){var C=w.getSource().type,R=C==="vector"?c.sourceLayer:void 0;C!=="vector"||R?p&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(R,c.id,p):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var p=c.source,b=c.sourceLayer,w=this.sourceCaches[p];if(w!==void 0){if(w.getSource().type!=="vector"||b)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(b,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+p+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var p=this,b=function(Rr){return p._layers[Rr].type==="fill-extrusion"},w={},C=[],R=this._order.length-1;R>=0;R--){var U=this._order[R];if(b(U)){w[U]=R;for(var Y=0,ce=c;Y<ce.length;Y+=1){var he=ce[Y][U];if(he)for(var pe=0,Ae=he;pe<Ae.length;pe+=1)C.push(Ae[pe])}}}C.sort(function(Rr,Or){return Or.intersectionZ-Rr.intersectionZ});for(var Re=[],We=this._order.length-1;We>=0;We--){var Te=this._order[We];if(b(Te))for(var Ve=C.length-1;Ve>=0;Ve--){var Qe=C[Ve].feature;if(w[Qe.layer.id]<We)break;Re.push(Qe),C.pop()}else for(var gt=0,Gt=c;gt<Gt.length;gt+=1){var Ft=Gt[gt][Te];if(Ft)for(var Xt=0,cr=Ft;Xt<cr.length;Xt+=1)Re.push(cr[Xt].feature)}}return Re},f.prototype.queryRenderedFeatures=function(c,p,b){p&&p.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",p.filter,null,p);var w={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var C=0,R=p.layers;C<R.length;C+=1){var U=R[C],Y=this._layers[U];if(!Y)return this.fire(new m.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];w[Y.source]=!0}}var ce=[];for(var he in p.availableImages=this._availableImages,this.sourceCaches)p.layers&&!w[he]||ce.push(cn(this.sourceCaches[he],this._layers,this._serializedLayers,c,p,b));return this.placement&&ce.push(function(pe,Ae,Re,We,Te,Ve,Qe){for(var gt={},Gt=Ve.queryRenderedSymbols(We),Ft=[],Xt=0,cr=Object.keys(Gt).map(Number);Xt<cr.length;Xt+=1)Ft.push(Qe[cr[Xt]]);Ft.sort(li);for(var Rr=function(){var Un=Qr[Or],di=Un.featureIndex.lookupSymbolFeatures(Gt[Un.bucketInstanceId],Ae,Un.bucketIndex,Un.sourceLayerIndex,Te.filter,Te.layers,Te.availableImages,pe);for(var nn in di){var ai=gt[nn]=gt[nn]||[],si=di[nn];si.sort(function(mi,$n){var jn=Un.featureSortOrder;if(jn){var Ea=jn.indexOf(mi.featureIndex);return jn.indexOf($n.featureIndex)-Ea}return $n.featureIndex-mi.featureIndex});for(var ei=0,Wn=si;ei<Wn.length;ei+=1)ai.push(Wn[ei])}},Or=0,Qr=Ft;Or<Qr.length;Or+=1)Rr();var Dn=function(Un){gt[Un].forEach(function(di){var nn=di.feature,ai=Re[pe[Un].source].getFeatureState(nn.layer["source-layer"],nn.id);nn.source=nn.layer.source,nn.layer["source-layer"]&&(nn.sourceLayer=nn.layer["source-layer"]),nn.state=ai})};for(var Bn in gt)Dn(Bn);return gt}(this._layers,this._serializedLayers,this.sourceCaches,c,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ce)},f.prototype.querySourceFeatures=function(c,p){p&&p.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",p.filter,null,p);var b=this.sourceCaches[c];return b?function(w,C){for(var R=w.getRenderableIds().map(function(Ae){return w.getTileByID(Ae)}),U=[],Y={},ce=0;ce<R.length;ce++){var he=R[ce],pe=he.tileID.canonical.key;Y[pe]||(Y[pe]=!0,he.querySourceFeatures(U,C))}return U}(b,p):[]},f.prototype.addSourceType=function(c,p,b){return f.getSourceType(c)?b(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:p.workerSourceURL},b):b(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,p){p===void 0&&(p={}),this._checkLoaded();var b=this.light.getLight(),w=!1;for(var C in c)if(!m.deepEqual(c[C],b[C])){w=!0;break}if(w){var R={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,p),this.light.updateTransitions(R)}},f.prototype._validate=function(c,p,b,w,C){return C===void 0&&(C={}),(!C||C.validate!==!1)&&ms(this,c.call(m.validateStyle,m.extend({key:p,style:this.serialize(),value:b,styleSpec:m.styleSpec},w)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var p in this.sourceCaches)this.sourceCaches[p].clearTiles(),this.sourceCaches[p].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var p in this.sourceCaches)this.sourceCaches[p].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,p,b,w,C){C===void 0&&(C=!1);for(var R=!1,U=!1,Y={},ce=0,he=this._order;ce<he.length;ce+=1){var pe=this._layers[he[ce]];if(pe.type==="symbol"){if(!Y[pe.source]){var Ae=this.sourceCaches[pe.source];Y[pe.source]=Ae.getRenderableIds(!0).map(function(Qe){return Ae.getTileByID(Qe)}).sort(function(Qe,gt){return gt.tileID.overscaledZ-Qe.tileID.overscaledZ||(Qe.tileID.isLessThan(gt.tileID)?-1:1)})}var Re=this.crossTileSymbolIndex.addLayer(pe,Y[pe.source],c.center.lng);R=R||Re}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((C=C||this._layerOrderChanged||b===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new ka(c,this._order,C,p,b,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),U=!0),R&&this.pauseablePlacement.placement.setStale()),U||R)for(var We=0,Te=this._order;We<Te.length;We+=1){var Ve=this._layers[Te[We]];Ve.type==="symbol"&&this.placement.updateLayerOpacities(Ve,Y[Ve.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,p,b){this.imageManager.getImages(p.icons,b),this._updateTilesForChangedImages();var w=this.sourceCaches[p.source];w&&w.setDependencies(p.tileID.key,p.type,p.icons)},f.prototype.getGlyphs=function(c,p,b){this.glyphManager.getGlyphs(p.stacks,b)},f.prototype.getResource=function(c,p,b){return m.makeRequest(p,b)},f}(m.Evented);gs.getSourceType=function(l){return br[l]},gs.setSourceType=function(l,f){br[l]=f},gs.registerForPluginStateChange=m.registerForPluginStateChange;var ga=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),_a=ji(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ns=ji(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ef=ji(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),wl=ji(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Hs=ji("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Jl=ji(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),zu=ji(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ws=ji("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),il=ji("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),g=ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),A=ji(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),N=ji(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=ji(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),q=ji(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),_e=ji(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Xe=ji(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ft=ji(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),pt=ji(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ir=ji(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),sr=ji(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),wn=ji(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ri=ji(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),On=ji(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Xi=ji(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),da=ji(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),wa=ji(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ji(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=f.match(/attribute ([\w]+) ([\w]+)/g),b=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=w?w.concat(b):b,R={};return{fragmentSource:l=l.replace(c,function(U,Y,ce,he,pe){return R[pe]=!0,Y==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
varying `+ce+" "+he+" "+pe+`;
#else
uniform `+ce+" "+he+" u_"+pe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+pe+`
    `+ce+" "+he+" "+pe+" = u_"+pe+`;
#endif
`}),vertexSource:f=f.replace(c,function(U,Y,ce,he,pe){var Ae=he==="float"?"vec2":"vec4",Re=pe.match(/color/)?"color":Ae;return R[pe]?Y==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
uniform lowp float u_`+pe+`_t;
attribute `+ce+" "+Ae+" a_"+pe+`;
varying `+ce+" "+he+" "+pe+`;
#else
uniform `+ce+" "+he+" u_"+pe+`;
#endif
`:Re==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+pe+" = a_"+pe+`;
#else
    `+ce+" "+he+" "+pe+" = u_"+pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+pe+" = unpack_mix_"+Re+"(a_"+pe+", u_"+pe+`_t);
#else
    `+ce+" "+he+" "+pe+" = u_"+pe+`;
#endif
`:Y==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
uniform lowp float u_`+pe+`_t;
attribute `+ce+" "+Ae+" a_"+pe+`;
#else
uniform `+ce+" "+he+" u_"+pe+`;
#endif
`:Re==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+ce+" "+he+" "+pe+" = a_"+pe+`;
#else
    `+ce+" "+he+" "+pe+" = u_"+pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+ce+" "+he+" "+pe+" = unpack_mix_"+Re+"(a_"+pe+", u_"+pe+`_t);
#else
    `+ce+" "+he+" "+pe+" = u_"+pe+`;
#endif
`}),staticAttributes:p,staticUniforms:C}}var ys=Object.freeze({__proto__:null,prelude:_a,background:ns,backgroundPattern:ef,circle:wl,clippingMask:Hs,heatmap:Jl,heatmapTexture:zu,collisionBox:Ws,collisionCircle:il,debug:g,fill:A,fillOutline:N,fillOutlinePattern:O,fillPattern:q,fillExtrusion:_e,fillExtrusionPattern:Xe,hillshadePrepare:ft,hillshade:pt,line:ir,lineGradient:sr,linePattern:wn,lineSDF:ri,raster:On,symbolIcon:Xi,symbolSDF:da,symbolTextAndIcon:wa}),tu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Uu(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var p=l[c].split(" ");f.push(p.pop())}return f}tu.prototype.bind=function(l,f,c,p,b,w,C,R){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==p.length,Y=0;!U&&Y<p.length;Y++)this.boundPaintVertexBuffers[Y]!==p[Y]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===b&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===C&&this.boundDynamicVertexBuffer2===R?(l.bindVertexArrayOES.set(this.vao),C&&C.bind(),b&&b.dynamicDraw&&b.bind(),R&&R.bind()):this.freshBind(f,c,p,b,w,C,R)},tu.prototype.freshBind=function(l,f,c,p,b,w,C){var R,U=l.numAttributes,Y=this.context,ce=Y.gl;if(Y.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Y.extVertexArrayObject.createVertexArrayOES(),Y.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=C;else{R=Y.currentNumAttributes||0;for(var he=U;he<R;he++)ce.disableVertexAttribArray(he)}f.enableAttributes(ce,l);for(var pe=0,Ae=c;pe<Ae.length;pe+=1)Ae[pe].enableAttributes(ce,l);w&&w.enableAttributes(ce,l),C&&C.enableAttributes(ce,l),f.bind(),f.setVertexAttribPointers(ce,l,b);for(var Re=0,We=c;Re<We.length;Re+=1){var Te=We[Re];Te.bind(),Te.setVertexAttribPointers(ce,l,b)}w&&(w.bind(),w.setVertexAttribPointers(ce,l,b)),p&&p.bind(),C&&(C.bind(),C.setVertexAttribPointers(ce,l,b)),Y.currentNumAttributes=U},tu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var tf=function(l,f,c,p,b,w){var C=l.gl;this.program=C.createProgram();for(var R=Uu(c.staticAttributes),U=p?p.getBinderAttributes():[],Y=R.concat(U),ce=c.staticUniforms?Uu(c.staticUniforms):[],he=p?p.getBinderUniforms():[],pe=[],Ae=0,Re=ce.concat(he);Ae<Re.length;Ae+=1){var We=Re[Ae];pe.indexOf(We)<0&&pe.push(We)}var Te=p?p.defines():[];w&&Te.push("#define OVERDRAW_INSPECTOR;");var Ve=Te.concat(_a.fragmentSource,c.fragmentSource).join(`
`),Qe=Te.concat(_a.vertexSource,c.vertexSource).join(`
`),gt=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(gt,Ve),C.compileShader(gt),C.attachShader(this.program,gt);var Gt=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(Gt,Qe),C.compileShader(Gt),C.attachShader(this.program,Gt),this.attributes={};var Ft={};this.numAttributes=Y.length;for(var Xt=0;Xt<this.numAttributes;Xt++)Y[Xt]&&(C.bindAttribLocation(this.program,Xt,Y[Xt]),this.attributes[Y[Xt]]=Xt);C.linkProgram(this.program),C.deleteShader(Gt),C.deleteShader(gt);for(var cr=0;cr<pe.length;cr++){var Rr=pe[cr];if(Rr&&!Ft[Rr]){var Or=C.getUniformLocation(this.program,Rr);Or&&(Ft[Rr]=Or)}}this.fixedUniforms=b(l,Ft),this.binderUniforms=p?p.getUniforms(l,Ft):[]}}};function al(l,f,c){var p=1/ia(c,1,f.transform.tileZoom),b=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,f.transform.tileZoom)/b,C=w*(c.tileID.canonical.x+c.tileID.wrap*b),R=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[p,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[C>>16,R>>16],u_pixel_coord_lower:[65535&C,65535&R]}}tf.prototype.draw=function(l,f,c,p,b,w,C,R,U,Y,ce,he,pe,Ae,Re,We){var Te,Ve=l.gl;if(!this.failedToCreate){for(var Qe in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(p),l.setColorMode(b),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[Qe].set(C[Qe]);Ae&&Ae.setUniforms(l,this.binderUniforms,he,{zoom:pe});for(var gt=(Te={},Te[Ve.LINES]=2,Te[Ve.TRIANGLES]=3,Te[Ve.LINE_STRIP]=1,Te)[f],Gt=0,Ft=ce.get();Gt<Ft.length;Gt+=1){var Xt=Ft[Gt],cr=Xt.vaos||(Xt.vaos={});(cr[R]||(cr[R]=new tu)).bind(l,this,U,Ae?Ae.getPaintVertexBuffers():[],Y,Xt.vertexOffset,Re,We),Ve.drawElements(f,Xt.primitiveLength*gt,Ve.UNSIGNED_SHORT,Xt.primitiveOffset*gt*2)}}};var Cc=function(l,f,c,p){var b=f.style.light,w=b.properties.get("position"),C=[w.x,w.y,w.z],R=m.create$1();b.properties.get("anchor")==="viewport"&&m.fromRotation(R,-f.transform.angle),m.transformMat3(C,C,R);var U=b.properties.get("color");return{u_matrix:l,u_lightpos:C,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:p}},Tu=function(l,f,c,p,b,w,C){return m.extend(Cc(l,f,c,p),al(w,f,C),{u_height_factor:-Math.pow(2,b.overscaledZ)/C.tileSize/8})},Au=function(l){return{u_matrix:l}},Cu=function(l,f,c,p){return m.extend(Au(l),al(c,f,p))},so=function(l,f){return{u_matrix:l,u_world:f}},kf=function(l,f,c,p,b){return m.extend(Cu(l,f,c,p),{u_world:b})},Df=function(l,f,c,p){var b,w,C=l.transform;if(p.paint.get("circle-pitch-alignment")==="map"){var R=ia(c,1,C.zoom);b=!0,w=[R,R]}else b=!1,w=C.pixelsToGLUnits;return{u_camera_to_center_distance:C.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:w}},qo=function(l,f,c){var p=ia(c,1,f.zoom),b=Math.pow(2,f.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[f.pixelsToGLUnits[0]/(p*b),f.pixelsToGLUnits[1]/(p*b)],u_overscale_factor:w}},Mc=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},Mu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},ru=function(l){return{u_matrix:l}},rf=function(l,f,c,p){return{u_matrix:l,u_extrude_scale:ia(f,1,c),u_intensity:p}},Tl=function(l,f,c){var p=l.transform;return{u_matrix:Pc(l,f,c),u_ratio:1/ia(f,1,p.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Fi=function(l,f,c,p){return m.extend(Tl(l,f,c),{u_image:0,u_image_height:p})},Al=function(l,f,c,p){var b=l.transform,w=ol(f,b);return{u_matrix:Pc(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/ia(f,1,b.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[w,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},yh=function(l,f,c,p,b){var w=l.lineAtlas,C=ol(f,l.transform),R=c.layout.get("line-cap")==="round",U=w.getDash(p.from,R),Y=w.getDash(p.to,R),ce=U.width*b.fromScale,he=Y.width*b.toScale;return m.extend(Tl(l,f,c),{u_patternscale_a:[C/ce,-U.height/2],u_patternscale_b:[C/he,-Y.height/2],u_sdfgamma:w.width/(256*Math.min(ce,he)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:Y.y,u_mix:b.t})};function ol(l,f){return 1/ia(l,1,f.tileZoom)}function Pc(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Ff=function(l,f,c,p,b){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(C=b.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(w=b.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:_h(b.paint.get("raster-hue-rotate"))};var w,C};function _h(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Nf,Ic=function(l,f,c,p,b,w,C,R,U,Y){var ce=b.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_pitch:ce.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ce.width/ce.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:C,u_coord_matrix:R,u_is_text:+U,u_pitch_with_map:+p,u_texsize:Y,u_texture:0}},Ql=function(l,f,c,p,b,w,C,R,U,Y,ce){var he=b.transform;return m.extend(Ic(l,f,c,p,b,w,C,R,U,Y),{u_gamma_scale:p?Math.cos(he._pitch)*he.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+ce})},ec=function(l,f,c,p,b,w,C,R,U,Y){return m.extend(Ql(l,f,c,p,b,w,C,R,!0,U,!0),{u_texsize_icon:Y,u_texture_icon:1})},Cl=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},sl=function(l,f,c,p,b,w){return m.extend(function(C,R,U,Y){var ce=U.imageManager.getPattern(C.from.toString()),he=U.imageManager.getPattern(C.to.toString()),pe=U.imageManager.getPixelSize(),Ae=pe.width,Re=pe.height,We=Math.pow(2,Y.tileID.overscaledZ),Te=Y.tileSize*Math.pow(2,U.transform.tileZoom)/We,Ve=Te*(Y.tileID.canonical.x+Y.tileID.wrap*We),Qe=Te*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ce.tl,u_pattern_br_a:ce.br,u_pattern_tl_b:he.tl,u_pattern_br_b:he.br,u_texsize:[Ae,Re],u_mix:R.t,u_pattern_size_a:ce.displaySize,u_pattern_size_b:he.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/ia(Y,1,U.transform.tileZoom),u_pixel_coord_upper:[Ve>>16,Qe>>16],u_pixel_coord_lower:[65535&Ve,65535&Qe]}}(p,w,c,b),{u_matrix:l,u_opacity:f})},Ml={fillExtrusion:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new m.Uniform1f(l,f.u_height_factor),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new m.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new m.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new m.UniformColor(l,f.u_color),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_overlay:new m.Uniform1i(l,f.u_overlay),u_overlay_scale:new m.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new m.Uniform1f(l,f.u_extrude_scale),u_intensity:new m.Uniform1f(l,f.u_intensity),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_color_ramp:new m.Uniform1i(l,f.u_color_ramp),u_opacity:new m.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_latrange:new m.Uniform2f(l,f.u_latrange),u_light:new m.Uniform2f(l,f.u_light),u_shadow:new m.UniformColor(l,f.u_shadow),u_highlight:new m.UniformColor(l,f.u_highlight),u_accent:new m.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_dimension:new m.Uniform2f(l,f.u_dimension),u_zoom:new m.Uniform1f(l,f.u_zoom),u_unpack:new m.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_image:new m.Uniform1i(l,f.u_image),u_image_height:new m.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_texsize:new m.Uniform2f(l,f.u_texsize),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_image:new m.Uniform1i(l,f.u_image),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new m.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new m.Uniform1f(l,f.u_sdfgamma),u_image:new m.Uniform1i(l,f.u_image),u_tex_y_a:new m.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new m.Uniform1f(l,f.u_tex_y_b),u_mix:new m.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new m.Uniform2f(l,f.u_tl_parent),u_scale_parent:new m.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new m.Uniform1f(l,f.u_buffer_scale),u_fade_t:new m.Uniform1f(l,f.u_fade_t),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image0:new m.Uniform1i(l,f.u_image0),u_image1:new m.Uniform1i(l,f.u_image1),u_brightness_low:new m.Uniform1f(l,f.u_brightness_low),u_brightness_high:new m.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new m.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new m.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new m.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texsize_icon:new m.Uniform2f(l,f.u_texsize_icon),u_texture:new m.Uniform1i(l,f.u_texture),u_texture_icon:new m.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_color:new m.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image:new m.Uniform1i(l,f.u_image),u_pattern_tl_a:new m.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(l,f.u_pattern_br_b),u_texsize:new m.Uniform2f(l,f.u_texsize),u_mix:new m.Uniform1f(l,f.u_mix),u_pattern_size_a:new m.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new m.Uniform1f(l,f.u_scale_a),u_scale_b:new m.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(l,f.u_tile_units_to_pixels)}}};function Zu(l,f,c,p,b,w,C){for(var R=l.context,U=R.gl,Y=l.useProgram("collisionBox"),ce=[],he=0,pe=0,Ae=0;Ae<p.length;Ae++){var Re=p[Ae],We=f.getTile(Re),Te=We.getBucket(c);if(Te){var Ve=Re.posMatrix;b[0]===0&&b[1]===0||(Ve=l.translatePosMatrix(Re.posMatrix,We,b,w));var Qe=C?Te.textCollisionBox:Te.iconCollisionBox,gt=Te.collisionCircleArray;if(gt.length>0){var Gt=m.create(),Ft=Ve;m.mul(Gt,Te.placementInvProjMatrix,l.transform.glCoordMatrix),m.mul(Gt,Gt,Te.placementViewportMatrix),ce.push({circleArray:gt,circleOffset:pe,transform:Ft,invTransform:Gt}),pe=he+=gt.length/4}Qe&&Y.draw(R,U.LINES,ge.disabled,Pe.disabled,l.colorModeForRenderPass(),et.disabled,qo(Ve,l.transform,We),c.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,l.transform.zoom,null,null,Qe.collisionVertexBuffer)}}if(C&&ce.length){var Xt=l.useProgram("collisionCircle"),cr=new m.StructArrayLayout2f1f2i16;cr.resize(4*he),cr._trim();for(var Rr=0,Or=0,Qr=ce;Or<Qr.length;Or+=1)for(var Dn=Qr[Or],Bn=0;Bn<Dn.circleArray.length/4;Bn++){var Un=4*Bn,di=Dn.circleArray[Un+0],nn=Dn.circleArray[Un+1],ai=Dn.circleArray[Un+2],si=Dn.circleArray[Un+3];cr.emplace(Rr++,di,nn,ai,si,0),cr.emplace(Rr++,di,nn,ai,si,1),cr.emplace(Rr++,di,nn,ai,si,2),cr.emplace(Rr++,di,nn,ai,si,3)}(!Nf||Nf.length<2*he)&&(Nf=function(Ka){var Bo=2*Ka,wo=new m.StructArrayLayout3ui6;wo.resize(Bo),wo._trim();for(var Va=0;Va<Bo;Va++){var no=6*Va;wo.uint16[no+0]=4*Va+0,wo.uint16[no+1]=4*Va+1,wo.uint16[no+2]=4*Va+2,wo.uint16[no+3]=4*Va+2,wo.uint16[no+4]=4*Va+3,wo.uint16[no+5]=4*Va+0}return wo}(he));for(var ei=R.createIndexBuffer(Nf,!0),Wn=R.createVertexBuffer(cr,m.collisionCircleLayout.members,!0),mi=0,$n=ce;mi<$n.length;mi+=1){var jn=$n[mi],Ea=Mc(jn.transform,jn.invTransform,l.transform);Xt.draw(R,U.TRIANGLES,ge.disabled,Pe.disabled,l.colorModeForRenderPass(),et.disabled,Ea,c.id,Wn,ei,m.SegmentVector.simpleSegment(0,2*jn.circleOffset,jn.circleArray.length,jn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Wn.destroy(),ei.destroy()}}var Xs=m.identity(new Float32Array(16));function nf(l,f,c,p,b,w){var C=m.getAnchorAlignment(l),R=-(C.horizontalAlign-.5)*f,U=-(C.verticalAlign-.5)*c,Y=m.evaluateVariableOffset(l,p);return new m.Point((R/b+Y[0])*w,(U/b+Y[1])*w)}function af(l,f,c,p,b,w,C,R,U,Y,ce){var he=l.text.placedSymbolArray,pe=l.text.dynamicLayoutVertexArray,Ae=l.icon.dynamicLayoutVertexArray,Re={};pe.clear();for(var We=0;We<he.length;We++){var Te=he.get(We),Ve=Te.hidden||!Te.crossTileID||l.allowVerticalPlacement&&!Te.placedOrientation?null:p[Te.crossTileID];if(Ve){var Qe=new m.Point(Te.anchorX,Te.anchorY),gt=Mi(Qe,c?R:C),Gt=Ui(w.cameraToCenterDistance,gt.signedDistanceFromCamera),Ft=b.evaluateSizeForFeature(l.textSizeData,Y,Te)*Gt/m.ONE_EM;c&&(Ft*=l.tilePixelRatio/U);for(var Xt=nf(Ve.anchor,Ve.width,Ve.height,Ve.textOffset,Ve.textBoxScale,Ft),cr=c?Mi(Qe.add(Xt),C).point:gt.point.add(f?Xt.rotate(-w.angle):Xt),Rr=l.allowVerticalPlacement&&Te.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,Or=0;Or<Te.numGlyphs;Or++)m.addDynamicAttributes(pe,cr,Rr);ce&&Te.associatedIconIndex>=0&&(Re[Te.associatedIconIndex]={shiftedAnchor:cr,angle:Rr})}else Ba(Te.numGlyphs,pe)}if(ce){Ae.clear();for(var Qr=l.icon.placedSymbolArray,Dn=0;Dn<Qr.length;Dn++){var Bn=Qr.get(Dn);if(Bn.hidden)Ba(Bn.numGlyphs,Ae);else{var Un=Re[Dn];if(Un)for(var di=0;di<Bn.numGlyphs;di++)m.addDynamicAttributes(Ae,Un.shiftedAnchor,Un.angle);else Ba(Bn.numGlyphs,Ae)}}l.icon.dynamicLayoutVertexBuffer.updateData(Ae)}l.text.dynamicLayoutVertexBuffer.updateData(pe)}function Bf(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function nu(l,f,c,p,b,w,C,R,U,Y,ce,he){for(var pe=l.context,Ae=pe.gl,Re=l.transform,We=R==="map",Te=U==="map",Ve=We&&c.layout.get("symbol-placement")!=="point",Qe=We&&!Te&&!Ve,gt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Gt=!1,Ft=l.depthModeForSublayer(0,ge.ReadOnly),Xt=c.layout.get("text-variable-anchor"),cr=[],Rr=0,Or=p;Rr<Or.length;Rr+=1){var Qr=Or[Rr],Dn=f.getTile(Qr),Bn=Dn.getBucket(c);if(Bn){var Un=b?Bn.text:Bn.icon;if(Un&&Un.segments.get().length){var di=Un.programConfigurations.get(c.id),nn=b||Bn.sdfIcons,ai=b?Bn.textSizeData:Bn.iconSizeData,si=Te||Re.pitch!==0,ei=l.useProgram(Bf(nn,b,Bn),di),Wn=m.evaluateSizeForZoom(ai,Re.zoom),mi=void 0,$n=[0,0],jn=void 0,Ea=void 0,Ka=null,Bo=void 0;if(b)jn=Dn.glyphAtlasTexture,Ea=Ae.LINEAR,mi=Dn.glyphAtlasTexture.size,Bn.iconsInText&&($n=Dn.imageAtlasTexture.size,Ka=Dn.imageAtlasTexture,Bo=si||l.options.rotating||l.options.zooming||ai.kind==="composite"||ai.kind==="camera"?Ae.LINEAR:Ae.NEAREST);else{var wo=c.layout.get("icon-size").constantOr(0)!==1||Bn.iconsNeedLinear;jn=Dn.imageAtlasTexture,Ea=nn||l.options.rotating||l.options.zooming||wo||si?Ae.LINEAR:Ae.NEAREST,mi=Dn.imageAtlasTexture.size}var Va=ia(Dn,1,l.transform.zoom),no=Ca(Qr.posMatrix,Te,We,l.transform,Va),Es=Ei(Qr.posMatrix,Te,We,l.transform,Va),os=Xt&&Bn.hasTextData(),ku=c.layout.get("icon-text-fit")!=="none"&&os&&Bn.hasIconData();Ve&&Sn(Bn,Qr.posMatrix,l,b,no,Es,Te,Y);var ss=l.translatePosMatrix(Qr.posMatrix,Dn,w,C),qs=Ve||b&&Xt||ku?Xs:no,$s=l.translatePosMatrix(Es,Dn,w,C,!0),fc=nn&&c.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Bl={program:ei,buffers:Un,uniformValues:nn?Bn.iconsInText?ec(ai.kind,Wn,Qe,Te,l,ss,qs,$s,mi,$n):Ql(ai.kind,Wn,Qe,Te,l,ss,qs,$s,b,mi,!0):Ic(ai.kind,Wn,Qe,Te,l,ss,qs,$s,b,mi),atlasTexture:jn,atlasTextureIcon:Ka,atlasInterpolation:Ea,atlasInterpolationIcon:Bo,isSDF:nn,hasHalo:fc};if(gt&&Bn.canOverlap){Gt=!0;for(var mu=0,vl=Un.segments.get();mu<vl.length;mu+=1){var hc=vl[mu];cr.push({segments:new m.SegmentVector([hc]),sortKey:hc.sortKey,state:Bl})}}else cr.push({segments:Un.segments,sortKey:0,state:Bl})}}}Gt&&cr.sort(function(Ku,Du){return Ku.sortKey-Du.sortKey});for(var ou=0,zl=cr;ou<zl.length;ou+=1){var gu=zl[ou],yo=gu.state;if(pe.activeTexture.set(Ae.TEXTURE0),yo.atlasTexture.bind(yo.atlasInterpolation,Ae.CLAMP_TO_EDGE),yo.atlasTextureIcon&&(pe.activeTexture.set(Ae.TEXTURE1),yo.atlasTextureIcon&&yo.atlasTextureIcon.bind(yo.atlasInterpolationIcon,Ae.CLAMP_TO_EDGE)),yo.isSDF){var yu=yo.uniformValues;yo.hasHalo&&(yu.u_is_halo=1,tc(yo.buffers,gu.segments,c,l,yo.program,Ft,ce,he,yu)),yu.u_is_halo=0}tc(yo.buffers,gu.segments,c,l,yo.program,Ft,ce,he,yo.uniformValues)}}function tc(l,f,c,p,b,w,C,R,U){var Y=p.context;b.draw(Y,Y.gl.TRIANGLES,w,C,R,et.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,p.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Oc(l,f,c,p,b,w,C){var R,U,Y,ce,he,pe=l.context.gl,Ae=c.paint.get("fill-pattern"),Re=Ae&&Ae.constantOr(1),We=c.getCrossfadeParameters();C?(U=Re&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=pe.LINES):(U=Re?"fillPattern":"fill",R=pe.TRIANGLES);for(var Te=0,Ve=p;Te<Ve.length;Te+=1){var Qe=Ve[Te],gt=f.getTile(Qe);if(!Re||gt.patternsLoaded()){var Gt=gt.getBucket(c);if(Gt){var Ft=Gt.programConfigurations.get(c.id),Xt=l.useProgram(U,Ft);Re&&(l.context.activeTexture.set(pe.TEXTURE0),gt.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),Ft.updatePaintBuffers(We));var cr=Ae.constantOr(null);if(cr&&gt.imageAtlas){var Rr=gt.imageAtlas,Or=Rr.patternPositions[cr.to.toString()],Qr=Rr.patternPositions[cr.from.toString()];Or&&Qr&&Ft.setConstantPatternPositions(Or,Qr)}var Dn=l.translatePosMatrix(Qe.posMatrix,gt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(C){ce=Gt.indexBuffer2,he=Gt.segments2;var Bn=[pe.drawingBufferWidth,pe.drawingBufferHeight];Y=U==="fillOutlinePattern"&&Re?kf(Dn,l,We,gt,Bn):so(Dn,Bn)}else ce=Gt.indexBuffer,he=Gt.segments,Y=Re?Cu(Dn,l,We,gt):Au(Dn);Xt.draw(l.context,R,b,l.stencilModeForClipping(Qe),w,et.disabled,Y,c.id,Gt.layoutVertexBuffer,ce,he,c.paint,l.transform.zoom,Ft)}}}}function of(l,f,c,p,b,w,C){for(var R=l.context,U=R.gl,Y=c.paint.get("fill-extrusion-pattern"),ce=Y.constantOr(1),he=c.getCrossfadeParameters(),pe=c.paint.get("fill-extrusion-opacity"),Ae=0,Re=p;Ae<Re.length;Ae+=1){var We=Re[Ae],Te=f.getTile(We),Ve=Te.getBucket(c);if(Ve){var Qe=Ve.programConfigurations.get(c.id),gt=l.useProgram(ce?"fillExtrusionPattern":"fillExtrusion",Qe);ce&&(l.context.activeTexture.set(U.TEXTURE0),Te.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Qe.updatePaintBuffers(he));var Gt=Y.constantOr(null);if(Gt&&Te.imageAtlas){var Ft=Te.imageAtlas,Xt=Ft.patternPositions[Gt.to.toString()],cr=Ft.patternPositions[Gt.from.toString()];Xt&&cr&&Qe.setConstantPatternPositions(Xt,cr)}var Rr=l.translatePosMatrix(We.posMatrix,Te,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Or=c.paint.get("fill-extrusion-vertical-gradient"),Qr=ce?Tu(Rr,l,Or,pe,We,he,Te):Cc(Rr,l,Or,pe);gt.draw(R,R.gl.TRIANGLES,b,w,C,et.backCCW,Qr,c.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,c.paint,l.transform.zoom,Qe)}}}function Pl(l,f,c,p,b,w){var C=l.context,R=C.gl,U=f.fbo;if(U){var Y=l.useProgram("hillshade");C.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,U.colorAttachment.get());var ce=function(he,pe,Ae){var Re=Ae.paint.get("hillshade-shadow-color"),We=Ae.paint.get("hillshade-highlight-color"),Te=Ae.paint.get("hillshade-accent-color"),Ve=Ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ae.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ve-=he.transform.angle);var Qe,gt,Gt,Ft=!he.options.moving;return{u_matrix:he.transform.calculatePosMatrix(pe.tileID.toUnwrapped(),Ft),u_image:0,u_latrange:(Qe=pe.tileID,gt=Math.pow(2,Qe.canonical.z),Gt=Qe.canonical.y,[new m.MercatorCoordinate(0,Gt/gt).toLngLat().lat,new m.MercatorCoordinate(0,(Gt+1)/gt).toLngLat().lat]),u_light:[Ae.paint.get("hillshade-exaggeration"),Ve],u_shadow:Re,u_highlight:We,u_accent:Te}}(l,f,c);Y.draw(C,R.TRIANGLES,p,b,w,et.disabled,ce,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function Xh(l,f,c,p,b,w){var C=l.context,R=C.gl,U=f.dem;if(U&&U.data){var Y=U.dim,ce=U.stride,he=U.getPixels();if(C.activeTexture.set(R.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(ce),f.demTexture){var pe=f.demTexture;pe.update(he,{premultiply:!1}),pe.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else f.demTexture=new m.Texture(C,he,R.RGBA,{premultiply:!1}),f.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);C.activeTexture.set(R.TEXTURE0);var Ae=f.fbo;if(!Ae){var Re=new m.Texture(C,{width:Y,height:Y,data:null},R.RGBA);Re.bind(R.LINEAR,R.CLAMP_TO_EDGE),(Ae=f.fbo=C.createFramebuffer(Y,Y,!0)).colorAttachment.set(Re.texture)}C.bindFramebuffer.set(Ae.framebuffer),C.viewport.set([0,0,Y,Y]),l.useProgram("hillshadePrepare").draw(C,R.TRIANGLES,p,b,w,et.disabled,function(We,Te){var Ve=Te.stride,Qe=m.create();return m.ortho(Qe,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(Qe,Qe,[0,-m.EXTENT,0]),{u_matrix:Qe,u_image:1,u_dimension:[Ve,Ve],u_zoom:We.overscaledZ,u_unpack:Te.getUnpackVector()}}(f.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function sf(l,f,c,p,b){var w=p.paint.get("raster-fade-duration");if(w>0){var C=m.browser.now(),R=(C-l.timeAdded)/w,U=f?(C-f.timeAdded)/w:-1,Y=c.getSource(),ce=b.coveringZoomLevel({tileSize:Y.tileSize,roundZoom:Y.roundZoom}),he=!f||Math.abs(f.tileID.overscaledZ-ce)>Math.abs(l.tileID.overscaledZ-ce),pe=he&&l.refreshedUponExpiration?1:m.clamp(he?R:1-U,0,1);return l.refreshedUponExpiration&&R>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}var Il=new m.Color(1,0,0,1),uf=new m.Color(0,1,0,1),lf=new m.Color(0,0,1,1),Ol=new m.Color(1,0,1,1),Rc=new m.Color(0,1,1,1);function xh(l,f,c,p){rc(l,0,f+c/2,l.transform.width,c,p)}function bh(l,f,c,p){rc(l,f-c/2,0,c,l.transform.height,p)}function rc(l,f,c,p,b,w){var C=l.context,R=C.gl;R.enable(R.SCISSOR_TEST),R.scissor(f*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,p*m.browser.devicePixelRatio,b*m.browser.devicePixelRatio),C.clear({color:w}),R.disable(R.SCISSOR_TEST)}function Eh(l,f,c){var p=l.context,b=p.gl,w=c.posMatrix,C=l.useProgram("debug"),R=ge.disabled,U=Pe.disabled,Y=l.colorModeForRenderPass();p.activeTexture.set(b.TEXTURE0),l.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),C.draw(p,b.LINE_STRIP,R,U,Y,et.disabled,Mu(w,m.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var ce=f.getTileByID(c.key).latestRawTileData,he=Math.floor((ce&&ce.byteLength||0)/1024),pe=f.getTile(c).tileSize,Ae=512/Math.min(pe,512)*(c.overscaledZ/l.transform.zoom)*.5,Re=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Re+=" => "+c.overscaledZ),function(We,Te){We.initDebugOverlayCanvas();var Ve=We.debugOverlayCanvas,Qe=We.context.gl,gt=We.debugOverlayCanvas.getContext("2d");gt.clearRect(0,0,Ve.width,Ve.height),gt.shadowColor="white",gt.shadowBlur=2,gt.lineWidth=1.5,gt.strokeStyle="white",gt.textBaseline="top",gt.font="bold 36px Open Sans, sans-serif",gt.fillText(Te,5,5),gt.strokeText(Te,5,5),We.debugOverlayTexture.update(Ve),We.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(l,Re+" "+he+"kb"),C.draw(p,b.TRIANGLES,R,U,Ge.alphaBlended,et.disabled,Mu(w,m.Color.transparent,Ae),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Rl={symbol:function(l,f,c,p,b){if(l.renderPass==="translucent"){var w=Pe.disabled,C=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(R,U,Y,ce,he,pe,Ae){for(var Re=U.transform,We=he==="map",Te=pe==="map",Ve=0,Qe=R;Ve<Qe.length;Ve+=1){var gt=Qe[Ve],Gt=ce.getTile(gt),Ft=Gt.getBucket(Y);if(Ft&&Ft.text&&Ft.text.segments.get().length){var Xt=m.evaluateSizeForZoom(Ft.textSizeData,Re.zoom),cr=ia(Gt,1,U.transform.zoom),Rr=Ca(gt.posMatrix,Te,We,U.transform,cr),Or=Y.layout.get("icon-text-fit")!=="none"&&Ft.hasIconData();if(Xt){var Qr=Math.pow(2,Re.zoom-Gt.tileID.overscaledZ);af(Ft,We,Te,Ae,m.symbolSize,Re,Rr,gt.posMatrix,Qr,Xt,Or)}}}}(p,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),b),c.paint.get("icon-opacity").constantOr(1)!==0&&nu(l,f,c,p,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,C),c.paint.get("text-opacity").constantOr(1)!==0&&nu(l,f,c,p,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,C),f.map.showCollisionBoxes&&(Zu(l,f,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Zu(l,f,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,p){if(l.renderPass==="translucent"){var b=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),C=c.paint.get("circle-stroke-opacity"),R=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(b.constantOr(1)!==0||w.constantOr(1)!==0&&C.constantOr(1)!==0){for(var U=l.context,Y=U.gl,ce=l.depthModeForSublayer(0,ge.ReadOnly),he=Pe.disabled,pe=l.colorModeForRenderPass(),Ae=[],Re=0;Re<p.length;Re++){var We=p[Re],Te=f.getTile(We),Ve=Te.getBucket(c);if(Ve){var Qe=Ve.programConfigurations.get(c.id),gt={programConfiguration:Qe,program:l.useProgram("circle",Qe),layoutVertexBuffer:Ve.layoutVertexBuffer,indexBuffer:Ve.indexBuffer,uniformValues:Df(l,We,Te,c)};if(R)for(var Gt=0,Ft=Ve.segments.get();Gt<Ft.length;Gt+=1){var Xt=Ft[Gt];Ae.push({segments:new m.SegmentVector([Xt]),sortKey:Xt.sortKey,state:gt})}else Ae.push({segments:Ve.segments,sortKey:0,state:gt})}}R&&Ae.sort(function(Dn,Bn){return Dn.sortKey-Bn.sortKey});for(var cr=0,Rr=Ae;cr<Rr.length;cr+=1){var Or=Rr[cr],Qr=Or.state;Qr.program.draw(U,Y.TRIANGLES,ce,he,pe,et.disabled,Qr.uniformValues,c.id,Qr.layoutVertexBuffer,Qr.indexBuffer,Or.segments,c.paint,l.transform.zoom,Qr.programConfiguration)}}}},heatmap:function(l,f,c,p){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var b=l.context,w=b.gl,C=Pe.disabled,R=new Ge([w.ONE,w.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Ae,Re,We){var Te=Ae.gl;Ae.activeTexture.set(Te.TEXTURE1),Ae.viewport.set([0,0,Re.width/4,Re.height/4]);var Ve=We.heatmapFbo;if(Ve)Te.bindTexture(Te.TEXTURE_2D,Ve.colorAttachment.get()),Ae.bindFramebuffer.set(Ve.framebuffer);else{var Qe=Te.createTexture();Te.bindTexture(Te.TEXTURE_2D,Qe),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_WRAP_S,Te.CLAMP_TO_EDGE),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_WRAP_T,Te.CLAMP_TO_EDGE),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_MIN_FILTER,Te.LINEAR),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_MAG_FILTER,Te.LINEAR),Ve=We.heatmapFbo=Ae.createFramebuffer(Re.width/4,Re.height/4,!1),function(gt,Gt,Ft,Xt){var cr=gt.gl;cr.texImage2D(cr.TEXTURE_2D,0,cr.RGBA,Gt.width/4,Gt.height/4,0,cr.RGBA,gt.extRenderToTextureHalfFloat?gt.extTextureHalfFloat.HALF_FLOAT_OES:cr.UNSIGNED_BYTE,null),Xt.colorAttachment.set(Ft)}(Ae,Re,Qe,Ve)}})(b,l,c),b.clear({color:m.Color.transparent});for(var U=0;U<p.length;U++){var Y=p[U];if(!f.hasRenderableParent(Y)){var ce=f.getTile(Y),he=ce.getBucket(c);if(he){var pe=he.programConfigurations.get(c.id);l.useProgram("heatmap",pe).draw(b,w.TRIANGLES,ge.disabled,C,R,et.disabled,rf(Y.posMatrix,ce,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,c.paint,l.transform.zoom,pe)}}}b.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Ae,Re){var We=Ae.context,Te=We.gl,Ve=Re.heatmapFbo;if(Ve){We.activeTexture.set(Te.TEXTURE0),Te.bindTexture(Te.TEXTURE_2D,Ve.colorAttachment.get()),We.activeTexture.set(Te.TEXTURE1);var Qe=Re.colorRampTexture;Qe||(Qe=Re.colorRampTexture=new m.Texture(We,Re.colorRamp,Te.RGBA)),Qe.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Ae.useProgram("heatmapTexture").draw(We,Te.TRIANGLES,ge.disabled,Pe.disabled,Ae.colorModeForRenderPass(),et.disabled,function(gt,Gt,Ft,Xt){var cr=m.create();m.ortho(cr,0,gt.width,gt.height,0,0,1);var Rr=gt.context.gl;return{u_matrix:cr,u_world:[Rr.drawingBufferWidth,Rr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Gt.paint.get("heatmap-opacity")}}(Ae,Re),Re.id,Ae.viewportBuffer,Ae.quadTriangleIndexBuffer,Ae.viewportSegments,Re.paint,Ae.transform.zoom)}}(l,c))},line:function(l,f,c,p){if(l.renderPass==="translucent"){var b=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(b.constantOr(1)!==0&&w.constantOr(1)!==0)for(var C=l.depthModeForSublayer(0,ge.ReadOnly),R=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),Y=c.paint.get("line-pattern"),ce=Y.constantOr(1),he=c.paint.get("line-gradient"),pe=c.getCrossfadeParameters(),Ae=ce?"linePattern":U?"lineSDF":he?"lineGradient":"line",Re=l.context,We=Re.gl,Te=!0,Ve=0,Qe=p;Ve<Qe.length;Ve+=1){var gt=Qe[Ve],Gt=f.getTile(gt);if(!ce||Gt.patternsLoaded()){var Ft=Gt.getBucket(c);if(Ft){var Xt=Ft.programConfigurations.get(c.id),cr=l.context.program.get(),Rr=l.useProgram(Ae,Xt),Or=Te||Rr.program!==cr,Qr=Y.constantOr(null);if(Qr&&Gt.imageAtlas){var Dn=Gt.imageAtlas,Bn=Dn.patternPositions[Qr.to.toString()],Un=Dn.patternPositions[Qr.from.toString()];Bn&&Un&&Xt.setConstantPatternPositions(Bn,Un)}var di=ce?Al(l,Gt,c,pe):U?yh(l,Gt,c,U,pe):he?Fi(l,Gt,c,Ft.lineClipsArray.length):Tl(l,Gt,c);if(ce)Re.activeTexture.set(We.TEXTURE0),Gt.imageAtlasTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE),Xt.updatePaintBuffers(pe);else if(U&&(Or||l.lineAtlas.dirty))Re.activeTexture.set(We.TEXTURE0),l.lineAtlas.bind(Re);else if(he){var nn=Ft.gradients[c.id],ai=nn.texture;if(c.gradientVersion!==nn.version){var si=256;if(c.stepInterpolant){var ei=f.getSource().maxzoom,Wn=gt.canonical.z===ei?Math.ceil(1<<l.transform.maxZoom-gt.canonical.z):1;si=m.clamp(m.nextPowerOfTwo(Ft.maxLineLength/m.EXTENT*1024*Wn),256,Re.maxTextureSize)}nn.gradient=m.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:si,image:nn.gradient||void 0,clips:Ft.lineClipsArray}),nn.texture?nn.texture.update(nn.gradient):nn.texture=new m.Texture(Re,nn.gradient,We.RGBA),nn.version=c.gradientVersion,ai=nn.texture}Re.activeTexture.set(We.TEXTURE0),ai.bind(c.stepInterpolant?We.NEAREST:We.LINEAR,We.CLAMP_TO_EDGE)}Rr.draw(Re,We.TRIANGLES,C,l.stencilModeForClipping(gt),R,et.disabled,di,c.id,Ft.layoutVertexBuffer,Ft.indexBuffer,Ft.segments,c.paint,l.transform.zoom,Xt,Ft.layoutVertexBuffer2),Te=!1}}}}},fill:function(l,f,c,p){var b=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var C=l.colorModeForRenderPass(),R=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!R.constantOr(1)&&b.constantOr(m.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var Y=l.depthModeForSublayer(1,l.renderPass==="opaque"?ge.ReadWrite:ge.ReadOnly);Oc(l,f,c,p,Y,C,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var ce=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ge.ReadOnly);Oc(l,f,c,p,ce,C,!0)}}},"fill-extrusion":function(l,f,c,p){var b=c.paint.get("fill-extrusion-opacity");if(b!==0&&l.renderPass==="translucent"){var w=new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D);if(b!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))of(l,f,c,p,w,Pe.disabled,Ge.disabled),of(l,f,c,p,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var C=l.colorModeForRenderPass();of(l,f,c,p,w,Pe.disabled,C)}}},hillshade:function(l,f,c,p){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var b=l.context,w=l.depthModeForSublayer(0,ge.ReadOnly),C=l.colorModeForRenderPass(),R=l.renderPass==="translucent"?l.stencilConfigForOverlap(p):[{},p],U=R[0],Y=0,ce=R[1];Y<ce.length;Y+=1){var he=ce[Y],pe=f.getTile(he);pe.needsHillshadePrepare&&l.renderPass==="offscreen"?Xh(l,pe,c,w,Pe.disabled,C):l.renderPass==="translucent"&&Pl(l,pe,c,w,U[he.overscaledZ],C)}b.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,p){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&p.length)for(var b=l.context,w=b.gl,C=f.getSource(),R=l.useProgram("raster"),U=l.colorModeForRenderPass(),Y=C instanceof mt?[{},p]:l.stencilConfigForOverlap(p),ce=Y[0],he=Y[1],pe=he[he.length-1].overscaledZ,Ae=!l.options.moving,Re=0,We=he;Re<We.length;Re+=1){var Te=We[Re],Ve=l.depthModeForSublayer(Te.overscaledZ-pe,c.paint.get("raster-opacity")===1?ge.ReadWrite:ge.ReadOnly,w.LESS),Qe=f.getTile(Te),gt=l.transform.calculatePosMatrix(Te.toUnwrapped(),Ae);Qe.registerFadeDuration(c.paint.get("raster-fade-duration"));var Gt=f.findLoadedParent(Te,0),Ft=sf(Qe,Gt,f,c,l.transform),Xt=void 0,cr=void 0,Rr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;b.activeTexture.set(w.TEXTURE0),Qe.texture.bind(Rr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(w.TEXTURE1),Gt?(Gt.texture.bind(Rr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Xt=Math.pow(2,Gt.tileID.overscaledZ-Qe.tileID.overscaledZ),cr=[Qe.tileID.canonical.x*Xt%1,Qe.tileID.canonical.y*Xt%1]):Qe.texture.bind(Rr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Or=Ff(gt,cr||[0,0],Xt||1,Ft,c);C instanceof mt?R.draw(b,w.TRIANGLES,Ve,Pe.disabled,U,et.disabled,Or,c.id,C.boundsBuffer,l.quadTriangleIndexBuffer,C.boundsSegments):R.draw(b,w.TRIANGLES,Ve,ce[Te.overscaledZ],U,et.disabled,Or,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var p=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(b!==0){var w=l.context,C=w.gl,R=l.transform,U=R.tileSize,Y=c.paint.get("background-pattern");if(!l.isPatternMissing(Y)){var ce=!Y&&p.a===1&&b===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===ce){var he=Pe.disabled,pe=l.depthModeForSublayer(0,ce==="opaque"?ge.ReadWrite:ge.ReadOnly),Ae=l.colorModeForRenderPass(),Re=l.useProgram(Y?"backgroundPattern":"background"),We=R.coveringTiles({tileSize:U});Y&&(w.activeTexture.set(C.TEXTURE0),l.imageManager.bind(l.context));for(var Te=c.getCrossfadeParameters(),Ve=0,Qe=We;Ve<Qe.length;Ve+=1){var gt=Qe[Ve],Gt=l.transform.calculatePosMatrix(gt.toUnwrapped()),Ft=Y?sl(Gt,b,l,Y,{tileID:gt,tileSize:U},Te):Cl(Gt,b,p);Re.draw(w,C.TRIANGLES,pe,he,Ae,et.disabled,Ft,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var p=0;p<c.length;p++)Eh(l,f,c[p])},custom:function(l,f,c){var p=l.context,b=c.implementation;if(l.renderPass==="offscreen"){var w=b.prerender;w&&(l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),w.call(b,p.gl,l.transform.customLayerMatrix()),p.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),p.setStencilMode(Pe.disabled);var C=b.renderingMode==="3d"?new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ge.ReadOnly);p.setDepthMode(C),b.render(p.gl,l.transform.customLayerMatrix()),p.setDirty(),l.setBaseState(),p.bindFramebuffer.set(null)}}},$i=function(l,f){this.context=new fe(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=ke.maxUnderzooming+ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Eo,this.gpuTimers={}};$i.prototype.resize=function(l,f){if(this.width=l*m.browser.devicePixelRatio,this.height=f*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,p=this.style._order;c<p.length;c+=1)this.style._layers[p[c]].resize()},$i.prototype.setup=function(){var l=this.context,f=new m.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(m.EXTENT,0),f.emplaceBack(0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,ga.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ga.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var p=new m.StructArrayLayout4i8;p.emplaceBack(0,0,0,0),p.emplaceBack(m.EXTENT,0,m.EXTENT,0),p.emplaceBack(0,m.EXTENT,0,m.EXTENT),p.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(p,bt.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var b=new m.StructArrayLayout2i4;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,ga.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var w=new m.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var C=new m.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(C),this.emptyTexture=new m.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new Pe({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},$i.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,ge.disabled,this.stencilClearMode,Ge.disabled,et.disabled,ru(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},$i.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,p=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ge.disabled),c.setDepthMode(ge.disabled);var b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,C=f;w<C.length;w+=1){var R=C[w],U=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;b.draw(c,p.TRIANGLES,ge.disabled,new Pe({func:p.ALWAYS,mask:0},U,255,p.KEEP,p.KEEP,p.REPLACE),Ge.disabled,et.disabled,ru(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},$i.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Pe({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},$i.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Pe({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},$i.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,p=l.sort(function(U,Y){return Y.overscaledZ-U.overscaledZ}),b=p[p.length-1].overscaledZ,w=p[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var C={},R=0;R<w;R++)C[R+b]=new Pe({func:c.GEQUAL,mask:255},R+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[C,p]}return[(f={},f[b]=Pe.disabled,f),p]},$i.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ge([l.CONSTANT_COLOR,l.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ge.unblended:Ge.alphaBlended},$i.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return ge.disabled;var p=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ge(c||this.context.gl.LEQUAL,f,[p,p])},$i.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},$i.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var p=this.style._order,b=this.style.sourceCaches;for(var w in b){var C=b[w];C.used&&C.prepare(this.context)}var R,U,Y={},ce={},he={};for(var pe in b){var Ae=b[pe];Y[pe]=Ae.getVisibleCoordinates(),ce[pe]=Y[pe].slice().reverse(),he[pe]=Ae.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Re=0;Re<p.length;Re++)if(this.style._layers[p[Re]].is3D()){this.opaquePassCutoff=Re;break}this.renderPass="offscreen";for(var We=0,Te=p;We<Te.length;We+=1){var Ve=this.style._layers[Te[We]];if(Ve.hasOffscreenPass()&&!Ve.isHidden(this.transform.zoom)){var Qe=ce[Ve.source];(Ve.type==="custom"||Qe.length)&&this.renderLayer(this,b[Ve.source],Ve,Qe)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){var gt=this.style._layers[p[this.currentLayer]],Gt=b[gt.source],Ft=Y[gt.source];this._renderTileClippingMasks(gt,Ft),this.renderLayer(this,Gt,gt,Ft)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){var Xt=this.style._layers[p[this.currentLayer]],cr=b[Xt.source],Rr=(Xt.type==="symbol"?he:ce)[Xt.source];this._renderTileClippingMasks(Xt,Y[Xt.source]),this.renderLayer(this,cr,Xt,Rr)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(Or){Or.source&&!Or.isHidden(c.transform.zoom)&&(Or.source!==(U&&U.id)&&(U=c.style.sourceCaches[Or.source]),(!R||R.getSource().maxzoom<U.getSource().maxzoom)&&(R=U))}),R&&Rl.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(Or){var Qr=Or.transform.padding;xh(Or,Or.transform.height-(Qr.top||0),3,Il),xh(Or,Qr.bottom||0,3,uf),bh(Or,Qr.left||0,3,lf),bh(Or,Or.transform.width-(Qr.right||0),3,Ol);var Dn=Or.transform.centerPoint;(function(Bn,Un,di,nn){rc(Bn,Un-1,di-10,2,20,nn),rc(Bn,Un-10,di-1,20,2,nn)})(Or,Dn.x,Or.transform.height-Dn.y,Rc)}(this),this.context.setDefault()},$i.prototype.renderLayer=function(l,f,c,p){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||p.length)&&(this.id=c.id,this.gpuTimingStart(c),Rl[c.type](l,f,c,p,this.style.placement.variableOffsets),this.gpuTimingEnd())},$i.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},$i.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},$i.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},$i.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var p=l[c],b=this.context.extTimerQuery,w=b.getQueryObjectEXT(p.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(p.query),f[c]=w}return f},$i.prototype.translatePosMatrix=function(l,f,c,p,b){if(!c[0]&&!c[1])return l;var w=b?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(w){var C=Math.sin(w),R=Math.cos(w);c=[c[0]*R-c[1]*C,c[0]*C+c[1]*R]}var U=[b?c[0]:ia(f,c[0],this.transform.zoom),b?c[1]:ia(f,c[1],this.transform.zoom),0],Y=new Float32Array(16);return m.translate(Y,l,U),Y},$i.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},$i.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},$i.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},$i.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new tf(this.context,l,ys[l],f,Ml[l],this._showOverdrawInspector)),this.cache[c]},$i.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},$i.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},$i.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},$i.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var nc=function(l,f){this.points=l,this.planes=f};nc.fromInvProjectionMatrix=function(l,f,c){var p=Math.pow(2,c),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(C){return m.transformMat4([],C,l)}).map(function(C){return m.scale$1([],C,1/C[3]/f*p)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(C){var R=m.sub([],b[C[0]],b[C[1]]),U=m.sub([],b[C[2]],b[C[1]]),Y=m.normalize([],m.cross([],R,U)),ce=-m.dot(Y,b[C[1]]);return Y.concat(ce)});return new nc(b,w)};var ca=function(l,f){this.min=l,this.max=f,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};ca.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=m.clone$2(this.min),p=m.clone$2(this.max),b=0;b<f.length;b++)c[b]=f[b]?this.min[b]:this.center[b],p[b]=f[b]?this.center[b]:this.max[b];return p[2]=this.max[2],new ca(c,p)},ca.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},ca.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},ca.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,p=0;p<l.planes.length;p++){for(var b=l.planes[p],w=0,C=0;C<f.length;C++)w+=m.dot$1(b,f[C])>=0;if(w===0)return 0;w!==f.length&&(c=!1)}if(c)return 2;for(var R=0;R<3;R++){for(var U=Number.MAX_VALUE,Y=-Number.MAX_VALUE,ce=0;ce<l.points.length;ce++){var he=l.points[ce][R]-this.min[R];U=Math.min(U,he),Y=Math.max(Y,he)}if(Y<0||U>this.max[R]-this.min[R])return 0}return 1};var Pu=function(l,f,c,p){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),p===void 0&&(p=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=p};Pu.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=m.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=m.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=m.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=m.number(l.right,f.right,c)),this},Pu.prototype.getCenter=function(l,f){var c=m.clamp((this.left+l-this.right)/2,0,l),p=m.clamp((this.top+f-this.bottom)/2,0,f);return new m.Point(c,p)},Pu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Pu.prototype.clone=function(){return new Pu(this.top,this.bottom,this.left,this.right)},Pu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Yi=function(l,f,c,p,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=b===void 0||b,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=p==null?60:p,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Pu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Pa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Yi.prototype.clone=function(){var l=new Yi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Pa.minZoom.get=function(){return this._minZoom},Pa.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Pa.maxZoom.get=function(){return this._maxZoom},Pa.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Pa.minPitch.get=function(){return this._minPitch},Pa.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Pa.maxPitch.get=function(){return this._maxPitch},Pa.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Pa.renderWorldCopies.get=function(){return this._renderWorldCopies},Pa.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Pa.worldSize.get=function(){return this.tileSize*this.scale},Pa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Pa.size.get=function(){return new m.Point(this.width,this.height)},Pa.bearing.get=function(){return-this.angle/Math.PI*180},Pa.bearing.set=function(l){var f=-m.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Pa.pitch.get=function(){return this._pitch/Math.PI*180},Pa.pitch.set=function(l){var f=m.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Pa.fov.get=function(){return this._fov/Math.PI*180},Pa.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Pa.zoom.get=function(){return this._zoom},Pa.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Pa.center.get=function(){return this._center},Pa.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Pa.padding.get=function(){return this._edgeInsets.toJSON()},Pa.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Pa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Yi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Yi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Yi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Yi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new m.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),p=this.pointCoordinate(new m.Point(this.width,0)),b=this.pointCoordinate(new m.Point(this.width,this.height)),w=this.pointCoordinate(new m.Point(0,this.height)),C=Math.floor(Math.min(c.x,p.x,b.x,w.x)),R=Math.floor(Math.max(c.x,p.x,b.x,w.x)),U=C-1;U<=R+1;U++)U!==0&&f.push(new m.UnwrappedTileID(U,l));return f},Yi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var p=m.MercatorCoordinate.fromLngLat(this.center),b=Math.pow(2,f),w=[b*p.x,b*p.y,0],C=nc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),R=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=f);var U=function(Or){return{aabb:new ca([Or*b,0,0],[(Or+1)*b,b,0]),zoom:0,x:0,y:0,wrap:Or,fullyVisible:!1}},Y=[],ce=[],he=f,pe=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Ae=1;Ae<=3;Ae++)Y.push(U(-Ae)),Y.push(U(Ae));for(Y.push(U(0));Y.length>0;){var Re=Y.pop(),We=Re.x,Te=Re.y,Ve=Re.fullyVisible;if(!Ve){var Qe=Re.aabb.intersects(C);if(Qe===0)continue;Ve=Qe===2}var gt=Re.aabb.distanceX(w),Gt=Re.aabb.distanceY(w),Ft=Math.max(Math.abs(gt),Math.abs(Gt));if(Re.zoom===he||Ft>3+(1<<he-Re.zoom)-2&&Re.zoom>=R)ce.push({tileID:new m.OverscaledTileID(Re.zoom===he?pe:Re.zoom,Re.wrap,Re.zoom,We,Te),distanceSq:m.sqrLen([w[0]-.5-We,w[1]-.5-Te])});else for(var Xt=0;Xt<4;Xt++){var cr=(We<<1)+Xt%2,Rr=(Te<<1)+(Xt>>1);Y.push({aabb:Re.aabb.quadrant(Xt),zoom:Re.zoom+1,x:cr,y:Rr,wrap:Re.wrap,fullyVisible:Ve})}}return ce.sort(function(Or,Qr){return Or.distanceSq-Qr.distanceSq}).map(function(Or){return Or.tileID})},Yi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Pa.unmodified.get=function(){return this._unmodified},Yi.prototype.zoomScale=function(l){return Math.pow(2,l)},Yi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Yi.prototype.project=function(l){var f=m.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(l.lng)*this.worldSize,m.mercatorYfromLat(f)*this.worldSize)},Yi.prototype.unproject=function(l){return new m.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Pa.point.get=function(){return this.project(this.center)},Yi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),p=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(l),w=new m.MercatorCoordinate(b.x-(c.x-p.x),b.y-(c.y-p.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Yi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Yi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Yi.prototype.locationCoordinate=function(l){return m.MercatorCoordinate.fromLngLat(l)},Yi.prototype.coordinateLocation=function(l){return l.toLngLat()},Yi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];m.transformMat4(f,f,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var p=f[3],b=c[3],w=f[1]/p,C=c[1]/b,R=f[2]/p,U=c[2]/b,Y=R===U?0:(0-R)/(U-R);return new m.MercatorCoordinate(m.number(f[0]/p,c[0]/b,Y)/this.worldSize,m.number(w,C,Y)/this.worldSize)},Yi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix),new m.Point(f[0]/f[3],f[1]/f[3])},Yi.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},Yi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Yi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Yi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,p=f?this._alignedPosMatrixCache:this._posMatrixCache;if(p[c])return p[c];var b=l.canonical,w=this.worldSize/this.zoomScale(b.z),C=b.x+Math.pow(2,b.z)*l.wrap,R=m.identity(new Float64Array(16));return m.translate(R,R,[C*w,b.y*w,0]),m.scale(R,R,[w/m.EXTENT,w/m.EXTENT,1]),m.multiply(R,f?this.alignedProjMatrix:this.projMatrix,R),p[c]=new Float32Array(R),p[c]},Yi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Yi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,p,b=-90,w=90,C=-180,R=180,U=this.size,Y=this._unmodified;if(this.latRange){var ce=this.latRange;b=m.mercatorYfromLat(ce[1])*this.worldSize,l=(w=m.mercatorYfromLat(ce[0])*this.worldSize)-b<U.y?U.y/(w-b):0}if(this.lngRange){var he=this.lngRange;C=m.mercatorXfromLng(he[0])*this.worldSize,f=(R=m.mercatorXfromLng(he[1])*this.worldSize)-C<U.x?U.x/(R-C):0}var pe=this.point,Ae=Math.max(f||0,l||0);if(Ae)return this.center=this.unproject(new m.Point(f?(R+C)/2:pe.x,l?(w+b)/2:pe.y)),this.zoom+=this.scaleZoom(Ae),this._unmodified=Y,void(this._constraining=!1);if(this.latRange){var Re=pe.y,We=U.y/2;Re-We<b&&(p=b+We),Re+We>w&&(p=w-We)}if(this.lngRange){var Te=pe.x,Ve=U.x/2;Te-Ve<C&&(c=C+Ve),Te+Ve>R&&(c=R-Ve)}c===void 0&&p===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:pe.x,p!==void 0?p:pe.y))),this._unmodified=Y,this._constraining=!1}},Yi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),p=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-f-c,.01,Math.PI-.01)),b=this.point,w=b.x,C=b.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*p+this.cameraToCenterDistance),U=this.height/50,Y=new Float64Array(16);m.perspective(Y,this._fov,this.width/this.height,U,R),Y[8]=2*-l.x/this.width,Y[9]=2*l.y/this.height,m.scale(Y,Y,[1,-1,1]),m.translate(Y,Y,[0,0,-this.cameraToCenterDistance]),m.rotateX(Y,Y,this._pitch),m.rotateZ(Y,Y,this.angle),m.translate(Y,Y,[-w,-C,0]),this.mercatorMatrix=m.scale([],Y,[this.worldSize,this.worldSize,this.worldSize]),m.scale(Y,Y,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=Y,this.invProjMatrix=m.invert([],this.projMatrix);var ce=this.width%2/2,he=this.height%2/2,pe=Math.cos(this.angle),Ae=Math.sin(this.angle),Re=w-Math.round(w)+pe*ce+Ae*he,We=C-Math.round(C)+pe*he+Ae*ce,Te=new Float64Array(Y);if(m.translate(Te,Te,[Re>.5?Re-1:Re,We>.5?We-1:We,0]),this.alignedProjMatrix=Te,Y=m.create(),m.scale(Y,Y,[this.width/2,-this.height/2,1]),m.translate(Y,Y,[1,-1,0]),this.labelPlaneMatrix=Y,Y=m.create(),m.scale(Y,Y,[1,-1,1]),m.translate(Y,Y,[-1,-1,0]),m.scale(Y,Y,[2/this.width,2/this.height,1]),this.glCoordMatrix=Y,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(Y=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=Y,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Yi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new m.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Yi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,l))},Yi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,p=f.y,b=f.x,w=f.y,C=0,R=l;C<R.length;C+=1){var U=R[C];c=Math.min(c,U.x),p=Math.min(p,U.y),b=Math.max(b,U.x),w=Math.max(w,U.y)}return[new m.Point(c,p),new m.Point(b,p),new m.Point(b,w),new m.Point(c,w),new m.Point(c,p)]},Object.defineProperties(Yi.prototype,Pa);var _s=function(l){var f,c,p,b;this._hashName=l&&encodeURIComponent(l),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,p=null,b=function(){p=null,c&&(f(),p=setTimeout(b,300),c=!1)},function(){return c=!0,p||b(),p})};_s.prototype.addTo=function(l){return this._map=l,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},_s.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},_s.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,p),w=Math.round(f.lng*b)/b,C=Math.round(f.lat*b)/b,R=this._map.getBearing(),U=this._map.getPitch(),Y="";if(Y+=l?"/"+w+"/"+C+"/"+c:c+"/"+C+"/"+w,(R||U)&&(Y+="/"+Math.round(10*R)/10),U&&(Y+="/"+Math.round(U)),this._hashName){var ce=this._hashName,he=!1,pe=m.window.location.hash.slice(1).split("&").map(function(Ae){var Re=Ae.split("=")[0];return Re===ce?(he=!0,Re+"="+Y):Ae}).filter(function(Ae){return Ae});return he||pe.push(ce+"="+Y),"#"+pe.join("&")}return"#"+Y},_s.prototype._getCurrentHash=function(){var l,f=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(p){return p.split("=")}).forEach(function(p){p[0]===f._hashName&&(l=p)}),(l&&l[1]||"").split("/")):c.split("/")},_s.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},_s.prototype._updateHashUnthrottled=function(){var l=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,l)}catch(f){}};var Lc={linearity:.3,easing:m.bezier(0,0,.3,1)},Vu=m.extend({deceleration:2500,maxSpeed:1400},Lc),Ua=m.extend({deceleration:20,maxSpeed:1400},Lc),ic=m.extend({deceleration:1e3,maxSpeed:360},Lc),Ll=m.extend({deceleration:1e3,maxSpeed:90},Lc),ju=function(l){this._map=l,this.clear()};function kc(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Iu(l,f,c){var p=c.maxSpeed,b=c.linearity,w=c.deceleration,C=m.clamp(l*b/(f/1e3),-p,p),R=Math.abs(C)/(w*b);return{easing:c.easing,duration:1e3*R,amount:C*(R/2)}}ju.prototype.clear=function(){this._inertiaBuffer=[]},ju.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:l})},ju.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=m.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},ju.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,p=this._inertiaBuffer;c<p.length;c+=1){var b=p[c].settings;f.zoom+=b.zoomDelta||0,f.bearing+=b.bearingDelta||0,f.pitch+=b.pitchDelta||0,b.panDelta&&f.pan._add(b.panDelta),b.around&&(f.around=b.around),b.pinchAround&&(f.pinchAround=b.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,C={};if(f.pan.mag()){var R=Iu(f.pan.mag(),w,m.extend({},Vu,l||{}));C.offset=f.pan.mult(R.amount/f.pan.mag()),C.center=this._map.transform.center,kc(C,R)}if(f.zoom){var U=Iu(f.zoom,w,Ua);C.zoom=this._map.transform.zoom+U.amount,kc(C,U)}if(f.bearing){var Y=Iu(f.bearing,w,ic);C.bearing=this._map.transform.bearing+m.clamp(Y.amount,-179,179),kc(C,Y)}if(f.pitch){var ce=Iu(f.pitch,w,Ll);C.pitch=this._map.transform.pitch+ce.amount,kc(C,ce)}if(C.zoom||C.bearing){var he=f.pinchAround===void 0?f.around:f.pinchAround;C.around=he?this._map.unproject(he):this._map.getCenter()}return this.clear(),m.extend(C,{noMoveStart:!0})}};var ho=function(l){function f(p,b,w,C){C===void 0&&(C={});var R=F.mousePos(b.getCanvasContainer(),w),U=b.unproject(R);l.call(this,p,m.extend({point:R,lngLat:U,originalEvent:w},C)),this._defaultPrevented=!1,this.target=b}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),kl=function(l){function f(p,b,w){var C=p==="touchend"?w.changedTouches:w.touches,R=F.touchPos(b.getCanvasContainer(),C),U=R.map(function(he){return b.unproject(he)}),Y=R.reduce(function(he,pe,Ae,Re){return he.add(pe.div(Re.length))},new m.Point(0,0)),ce=b.unproject(Y);l.call(this,p,{points:R,point:Y,lngLats:U,lngLat:ce,originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),ac=function(l){function f(p,b,w){l.call(this,p,{originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),po=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};po.prototype.reset=function(){delete this._mousedownPos},po.prototype.wheel=function(l){return this._firePreventable(new ac(l.type,this._map,l))},po.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new ho(l.type,this._map,l))},po.prototype.mouseup=function(l){this._map.fire(new ho(l.type,this._map,l))},po.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new ho(l.type,this._map,l))},po.prototype.dblclick=function(l){return this._firePreventable(new ho(l.type,this._map,l))},po.prototype.mouseover=function(l){this._map.fire(new ho(l.type,this._map,l))},po.prototype.mouseout=function(l){this._map.fire(new ho(l.type,this._map,l))},po.prototype.touchstart=function(l){return this._firePreventable(new kl(l.type,this._map,l))},po.prototype.touchmove=function(l){this._map.fire(new kl(l.type,this._map,l))},po.prototype.touchend=function(l){this._map.fire(new kl(l.type,this._map,l))},po.prototype.touchcancel=function(l){this._map.fire(new kl(l.type,this._map,l))},po.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},po.prototype.isEnabled=function(){return!0},po.prototype.isActive=function(){return!1},po.prototype.enable=function(){},po.prototype.disable=function(){};var fn=function(l){this._map=l};fn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},fn.prototype.mousemove=function(l){this._map.fire(new ho(l.type,this._map,l))},fn.prototype.mousedown=function(){this._delayContextMenu=!0},fn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ho("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},fn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new ho(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},fn.prototype.isEnabled=function(){return!0},fn.prototype.isActive=function(){return!1},fn.prototype.enable=function(){},fn.prototype.disable=function(){};var uo=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function Gu(l,f){for(var c={},p=0;p<l.length;p++)c[l[p].identifier]=f[p];return c}uo.prototype.isEnabled=function(){return!!this._enabled},uo.prototype.isActive=function(){return!!this._active},uo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},uo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},uo.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(F.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},uo.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var p=this._startPos;this._lastPos=c,this._box||(this._box=F.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var b=Math.min(p.x,c.x),w=Math.max(p.x,c.x),C=Math.min(p.y,c.y),R=Math.max(p.y,c.y);F.setTransform(this._box,"translate("+b+"px,"+C+"px)"),this._box.style.width=w-b+"px",this._box.style.height=R-C+"px"}}},uo.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var p=this._startPos,b=f;if(this.reset(),F.suppressClick(),p.x!==b.x||p.y!==b.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(p,b,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},uo.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},uo.prototype.blur=function(){this.reset()},uo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(F.remove(this._box),this._box=null),F.enableDrag(),delete this._startPos,delete this._lastPos},uo.prototype._fireEvent=function(l,f){return this._map.fire(new m.Event(l,{originalEvent:f}))};var Da=function(l){this.reset(),this.numTouches=l.numTouches};Da.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Da.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){for(var b=new m.Point(0,0),w=0,C=p;w<C.length;w+=1)b._add(C[w]);return b.div(p.length)}(f),this.touches=Gu(c,f)))},Da.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var p=Gu(c,f);for(var b in this.touches){var w=p[b];(!w||w.dist(this.touches[b])>30)&&(this.aborted=!0)}}},Da.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var p=!this.aborted&&this.centroid;if(this.reset(),p)return p}};var Ys=function(l){this.singleTap=new Da(l),this.numTaps=l.numTaps,this.reset()};Ys.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ys.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},Ys.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},Ys.prototype.touchend=function(l,f,c){var p=this.singleTap.touchend(l,f,c);if(p){var b=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(p)<30;if(b&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}};var Ps=function(){this._zoomIn=new Ys({numTouches:1,numTaps:2}),this._zoomOut=new Ys({numTouches:2,numTaps:1}),this.reset()};Ps.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ps.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},Ps.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},Ps.prototype.touchend=function(l,f,c){var p=this,b=this._zoomIn.touchend(l,f,c),w=this._zoomOut.touchend(l,f,c);return b?(this._active=!0,l.preventDefault(),setTimeout(function(){return p.reset()},0),{cameraAnimation:function(C){return C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(b)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return p.reset()},0),{cameraAnimation:function(C){return C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(w)},{originalEvent:l})}}):void 0},Ps.prototype.touchcancel=function(){this.reset()},Ps.prototype.enable=function(){this._enabled=!0},Ps.prototype.disable=function(){this._enabled=!1,this.reset()},Ps.prototype.isEnabled=function(){return this._enabled},Ps.prototype.isActive=function(){return this._active};var cf={0:1,2:2},zr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};zr.prototype.blur=function(){this.reset()},zr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},zr.prototype._correctButton=function(l,f){return!1},zr.prototype._move=function(l,f){return{}},zr.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=F.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},zr.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(p,b){var w=cf[b];return p.buttons===void 0||(p.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},zr.prototype.mouseupWindow=function(l){this._lastPoint&&F.mouseButton(l)===this._eventButton&&(this._moved&&F.suppressClick(),this.reset())},zr.prototype.enable=function(){this._enabled=!0},zr.prototype.disable=function(){this._enabled=!1,this.reset()},zr.prototype.isEnabled=function(){return this._enabled},zr.prototype.isActive=function(){return this._active};var oc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,p){l.prototype.mousedown.call(this,c,p),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,p){return p===0&&!c.ctrlKey},f.prototype._move=function(c,p){return{around:p,panDelta:p.sub(c)}},f}(zr),ff=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,p){return p===0&&c.ctrlKey||p===2},f.prototype._move=function(c,p){var b=.8*(p.x-c.x);if(b)return this._active=!0,{bearingDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(zr),ul=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,p){return p===0&&c.ctrlKey||p===2},f.prototype._move=function(c,p){var b=-.5*(p.y-c.y);if(b)return this._active=!0,{pitchDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(zr),Ta=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ta.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Ta.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Ta.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Ta.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Ta.prototype.touchcancel=function(){this.reset()},Ta.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var p=Gu(c,f),b=new m.Point(0,0),w=new m.Point(0,0),C=0;for(var R in p){var U=p[R],Y=this._touches[R];Y&&(b._add(U),w._add(U.sub(Y)),C++,p[R]=U)}if(this._touches=p,!(C<this._minTouches)&&w.mag()){var ce=w.div(C);if(this._sum._add(ce),!(this._sum.mag()<this._clickTolerance))return{around:b.div(C),panDelta:ce}}},Ta.prototype.enable=function(){this._enabled=!0},Ta.prototype.disable=function(){this._enabled=!1,this.reset()},Ta.prototype.isEnabled=function(){return this._enabled},Ta.prototype.isActive=function(){return this._active};var xs=function(){this.reset()};function hf(l,f,c){for(var p=0;p<l.length;p++)if(l[p].identifier===c)return f[p]}function Ou(l,f){return Math.log(l/f)/Math.LN2}xs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},xs.prototype._start=function(l){},xs.prototype._move=function(l,f,c){return{}},xs.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},xs.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var p=this._firstTwoTouches,b=p[1],w=hf(c,f,p[0]),C=hf(c,f,b);if(w&&C){var R=this._aroundCenter?null:w.add(C).div(2);return this._move([w,C],R,l)}}},xs.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var p=this._firstTwoTouches,b=p[1],w=hf(c,f,p[0]),C=hf(c,f,b);w&&C||(this._active&&F.suppressClick(),this.reset())}},xs.prototype.touchcancel=function(){this.reset()},xs.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},xs.prototype.disable=function(){this._enabled=!1,this.reset()},xs.prototype.isEnabled=function(){return this._enabled},xs.prototype.isActive=function(){return this._active};var Ns=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,p){var b=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Ou(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ou(this._distance,b),pinchAround:p}},f}(xs);function Ru(l,f){return 180*l.angleWith(f)/Math.PI}var zf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,p){var b=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ru(this._vector,b),pinchAround:p}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var p=25/(Math.PI*this._minDiameter)*360,b=Ru(c,this._startVector);return Math.abs(b)<p},f}(xs);function ll(l){return Math.abs(l.y)>Math.abs(l.x)}var Uf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,ll(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,p,b){var w=c[0].sub(this._lastPoints[0]),C=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,C,b.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+C.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,p,b){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,C=p.mag()>=2;if(w||C){if(!w||!C)return this._firstMove===void 0&&(this._firstMove=b),b-this._firstMove<100&&void 0;var R=c.y>0==p.y>0;return ll(c)&&ll(p)&&R}},f}(xs),pf={panStep:100,bearingStep:15,pitchStep:10},iu=function(){var l=pf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Is(l){return l*(2-l)}iu.prototype.blur=function(){this.reset()},iu.prototype.reset=function(){this._active=!1},iu.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,p=0,b=0,w=0,C=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?p=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?p=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),C=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(p=0,b=0),{cameraAnimation:function(R){var U=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Is,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:R.getBearing()+p*f._bearingStep,pitch:R.getPitch()+b*f._pitchStep,offset:[-w*f._panStep,-C*f._panStep],center:R.getCenter()},{originalEvent:l})}}}},iu.prototype.enable=function(){this._enabled=!0},iu.prototype.disable=function(){this._enabled=!1,this.reset()},iu.prototype.isEnabled=function(){return this._enabled},iu.prototype.isActive=function(){return this._active},iu.prototype.disableRotation=function(){this._rotationDisabled=!0},iu.prototype.enableRotation=function(){this._rotationDisabled=!1};var wi=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};wi.prototype.setZoomRate=function(l){this._defaultZoomRate=l},wi.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},wi.prototype.isEnabled=function(){return!!this._enabled},wi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},wi.prototype.isZooming=function(){return!!this._zooming},wi.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},wi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},wi.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=m.browser.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(p*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},wi.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},wi.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=F.mousePos(this._el,l);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},wi.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,p=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&p!==0&&(p=1/p);var b=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(b*p))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,C=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,R=this._startZoom,U=this._easing,Y=!1;if(this._type==="wheel"&&R&&U){var ce=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),he=U(ce);w=m.number(R,C,he),ce<1?this._frameId||(this._frameId=!0):Y=!0}else w=C,Y=!0;return this._active=!0,Y&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Y,zoomDelta:w-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},wi.prototype._smoothOutEasing=function(l){var f=m.ease;if(this._prevEase){var c=this._prevEase,p=(m.browser.now()-c.start)/c.duration,b=c.easing(p+.01)-c.easing(p),w=.27/Math.sqrt(b*b+1e-4)*.01,C=Math.sqrt(.0729-w*w);f=m.bezier(w,C,.25,1)}return this._prevEase={start:m.browser.now(),duration:l,easing:f},f},wi.prototype.blur=function(){this.reset()},wi.prototype.reset=function(){this._active=!1};var Lu=function(l,f){this._clickZoom=l,this._tapZoom=f};Lu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Lu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Lu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Lu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var au=function(){this.reset()};au.prototype.reset=function(){this._active=!1},au.prototype.blur=function(){this.reset()},au.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},au.prototype.enable=function(){this._enabled=!0},au.prototype.disable=function(){this._enabled=!1,this.reset()},au.prototype.isEnabled=function(){return this._enabled},au.prototype.isActive=function(){return this._active};var Go=function(){this._tap=new Ys({numTouches:1,numTaps:1}),this.reset()};Go.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Go.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},Go.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var p=f[0],b=p.y-this._swipePoint.y;return this._swipePoint=p,l.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(l,f,c)},Go.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},Go.prototype.touchcancel=function(){this.reset()},Go.prototype.enable=function(){this._enabled=!0},Go.prototype.disable=function(){this._enabled=!1,this.reset()},Go.prototype.isEnabled=function(){return this._enabled},Go.prototype.isActive=function(){return this._active};var cl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};cl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},cl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},cl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},cl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Bs=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};Bs.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Bs.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Bs.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Bs.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Ks=function(l,f,c,p){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0};Ks.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Ks.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Ks.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Ks.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Ks.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Ks.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var bs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},hu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(m.Event);function Cn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var bn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ju(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),m.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[m.window,"blur",void 0]];for(var p=0,b=this._listeners;p<b.length;p+=1){var w=b[p],C=w[0];F.addEventListener(C,w[1],C===m.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};bn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],p=c[0];F.removeEventListener(p,c[1],p===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},bn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new po(f,l));var p=f.boxZoom=new uo(f,l);this._add("boxZoom",p);var b=new Ps,w=new au;f.doubleClickZoom=new Lu(w,b),this._add("tapZoom",b),this._add("clickZoom",w);var C=new Go;this._add("tapDragZoom",C);var R=f.touchPitch=new Uf;this._add("touchPitch",R);var U=new ff(l),Y=new ul(l);f.dragRotate=new Bs(l,U,Y),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]);var ce=new oc(l),he=new Ta(l);f.dragPan=new cl(c,ce,he),this._add("mousePan",ce),this._add("touchPan",he,["touchZoom","touchRotate"]);var pe=new zf,Ae=new Ns;f.touchZoomRotate=new Ks(c,Ae,pe,C),this._add("touchRotate",pe,["touchPan","touchZoom"]),this._add("touchZoom",Ae,["touchPan","touchRotate"]);var Re=f.scrollZoom=new wi(f,this);this._add("scrollZoom",Re,["mousePan"]);var We=f.keyboard=new iu;this._add("keyboard",We),this._add("blockableMapEvent",new fn(f));for(var Te=0,Ve=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Te<Ve.length;Te+=1){var Qe=Ve[Te];l.interactive&&l[Qe]&&f[Qe].enable(l[Qe])}},bn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},bn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},bn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},bn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},bn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},bn.prototype.isMoving=function(){return Boolean(bs(this._eventsInProgress))||this.isZooming()},bn.prototype._blockedByActive=function(l,f,c){for(var p in l)if(p!==c&&(!f||f.indexOf(p)<0))return!0;return!1},bn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},bn.prototype._getMapTouches=function(l){for(var f=[],c=0,p=l;c<p.length;c+=1){var b=p[c];this._el.contains(b.target)&&f.push(b)}return f},bn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,p={needsRenderFrame:!1},b={},w={},C=l.touches?this._getMapTouches(l.touches):void 0,R=C?F.touchPos(this._el,C):F.mousePos(this._el,l),U=0,Y=this._handlers;U<Y.length;U+=1){var ce=Y[U],he=ce.handlerName,pe=ce.handler,Ae=ce.allowed;if(pe.isEnabled()){var Re=void 0;this._blockedByActive(w,Ae,he)?pe.reset():pe[f||l.type]&&(Re=pe[f||l.type](l,R,C),this.mergeHandlerResult(p,b,Re,he,c),Re&&Re.needsRenderFrame&&this._triggerRenderFrame()),(Re||pe.isActive())&&(w[he]=pe)}}var We={};for(var Te in this._previousActiveHandlers)w[Te]||(We[Te]=c);this._previousActiveHandlers=w,(Object.keys(We).length||Cn(p))&&(this._changes.push([p,b,We]),this._triggerRenderFrame()),(Object.keys(w).length||Cn(p))&&this._map._stop(!0),this._updatingCamera=!1;var Ve=p.cameraAnimation;Ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ve(this._map))},bn.prototype.mergeHandlerResult=function(l,f,c,p,b){if(c){m.extend(l,c);var w={handlerName:p,originalEvent:c.originalEvent||b};c.zoomDelta!==void 0&&(f.zoom=w),c.panDelta!==void 0&&(f.drag=w),c.pitchDelta!==void 0&&(f.pitch=w),c.bearingDelta!==void 0&&(f.rotate=w)}},bn.prototype._applyChanges=function(){for(var l={},f={},c={},p=0,b=this._changes;p<b.length;p+=1){var w=b[p],C=w[0],R=w[1],U=w[2];C.panDelta&&(l.panDelta=(l.panDelta||new m.Point(0,0))._add(C.panDelta)),C.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+C.zoomDelta),C.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+C.bearingDelta),C.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+C.pitchDelta),C.around!==void 0&&(l.around=C.around),C.pinchAround!==void 0&&(l.pinchAround=C.pinchAround),C.noInertia&&(l.noInertia=C.noInertia),m.extend(f,R),m.extend(c,U)}this._updateMapTransform(l,f,c),this._changes=[]},bn.prototype._updateMapTransform=function(l,f,c){var p=this._map,b=p.transform;if(!Cn(l))return this._fireEvents(f,c,!0);var w=l.panDelta,C=l.zoomDelta,R=l.bearingDelta,U=l.pitchDelta,Y=l.around,ce=l.pinchAround;ce!==void 0&&(Y=ce),p._stop(!0),Y=Y||p.transform.centerPoint;var he=b.pointLocation(w?Y.sub(w):Y);R&&(b.bearing+=R),U&&(b.pitch+=U),C&&(b.zoom+=C),b.setLocationAtPoint(he,Y),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},bn.prototype._fireEvents=function(l,f,c){var p=this,b=bs(this._eventsInProgress),w=bs(l),C={};for(var R in l)this._eventsInProgress[R]||(C[R+"start"]=l[R].originalEvent),this._eventsInProgress[R]=l[R];for(var U in!b&&w&&this._fireEvent("movestart",w.originalEvent),C)this._fireEvent(U,C[U]);for(var Y in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(Y,l[Y].originalEvent);var ce,he={};for(var pe in this._eventsInProgress){var Ae=this._eventsInProgress[pe],Re=Ae.handlerName,We=Ae.originalEvent;this._handlersById[Re].isActive()||(delete this._eventsInProgress[pe],he[pe+"end"]=ce=f[Re]||We)}for(var Te in he)this._fireEvent(Te,he[Te]);var Ve=bs(this._eventsInProgress);if(c&&(b||w)&&!Ve){this._updatingCamera=!0;var Qe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),gt=function(Gt){return Gt!==0&&-p._bearingSnap<Gt&&Gt<p._bearingSnap};Qe?(gt(Qe.bearing||this._map.getBearing())&&(Qe.bearing=0),this._map.easeTo(Qe,{originalEvent:ce})):(this._map.fire(new m.Event("moveend",{originalEvent:ce})),gt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},bn.prototype._fireEvent=function(l,f){this._map.fire(new m.Event(l,f?{originalEvent:f}:{}))},bn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new hu("renderFrame",{timeStamp:f})),l._applyChanges()})},bn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Dc=function(l){function f(c,p){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=p.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,p){return this.jumpTo({center:c},p)},f.prototype.panBy=function(c,p,b){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},p),b)},f.prototype.panTo=function(c,p,b){return this.easeTo(m.extend({center:c},p),b)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,p){return this.jumpTo({zoom:c},p),this},f.prototype.zoomTo=function(c,p,b){return this.easeTo(m.extend({zoom:c},p),b)},f.prototype.zoomIn=function(c,p){return this.zoomTo(this.getZoom()+1,c,p),this},f.prototype.zoomOut=function(c,p){return this.zoomTo(this.getZoom()-1,c,p),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,p){return this.jumpTo({bearing:c},p),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,p){return this.jumpTo({padding:c},p),this},f.prototype.rotateTo=function(c,p,b){return this.easeTo(m.extend({bearing:c},p),b)},f.prototype.resetNorth=function(c,p){return this.rotateTo(0,m.extend({duration:1e3},c),p),this},f.prototype.resetNorthPitch=function(c,p){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),p),this},f.prototype.snapToNorth=function(c,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,p):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,p){return this.jumpTo({pitch:c},p),this},f.prototype.cameraForBounds=function(c,p){c=m.LngLatBounds.convert(c);var b=p&&p.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),b,p)},f.prototype._cameraForBoxAndBearing=function(c,p,b,w){var C={top:0,bottom:0,right:0,left:0};if(typeof(w=m.extend({padding:C,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var R=w.padding;w.padding={top:R,bottom:R,right:R,left:R}}w.padding=m.extend(C,w.padding);var U=this.transform,Y=U.padding,ce=U.project(m.LngLat.convert(c)),he=U.project(m.LngLat.convert(p)),pe=ce.rotate(-b*Math.PI/180),Ae=he.rotate(-b*Math.PI/180),Re=new m.Point(Math.max(pe.x,Ae.x),Math.max(pe.y,Ae.y)),We=new m.Point(Math.min(pe.x,Ae.x),Math.min(pe.y,Ae.y)),Te=Re.sub(We),Ve=(U.width-(Y.left+Y.right+w.padding.left+w.padding.right))/Te.x,Qe=(U.height-(Y.top+Y.bottom+w.padding.top+w.padding.bottom))/Te.y;if(!(Qe<0||Ve<0)){var gt=Math.min(U.scaleZoom(U.scale*Math.min(Ve,Qe)),w.maxZoom),Gt=typeof w.offset.x=="number"?new m.Point(w.offset.x,w.offset.y):m.Point.convert(w.offset),Ft=new m.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(b*Math.PI/180),Xt=Gt.add(Ft).mult(U.scale/U.zoomScale(gt));return{center:U.unproject(ce.add(he).div(2).sub(Xt)),zoom:gt,bearing:b}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,p,b){return this._fitInternal(this.cameraForBounds(c,p),p,b)},f.prototype.fitScreenCoordinates=function(c,p,b,w,C){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(p)),b,w),w,C)},f.prototype._fitInternal=function(c,p,b){return c?(delete(p=m.extend(c,p)).padding,p.linear?this.easeTo(p,b):this.flyTo(p,b)):this},f.prototype.jumpTo=function(c,p){this.stop();var b=this.transform,w=!1,C=!1,R=!1;return"zoom"in c&&b.zoom!==+c.zoom&&(w=!0,b.zoom=+c.zoom),c.center!==void 0&&(b.center=m.LngLat.convert(c.center)),"bearing"in c&&b.bearing!==+c.bearing&&(C=!0,b.bearing=+c.bearing),"pitch"in c&&b.pitch!==+c.pitch&&(R=!0,b.pitch=+c.pitch),c.padding==null||b.isPaddingEqual(c.padding)||(b.padding=c.padding),this.fire(new m.Event("movestart",p)).fire(new m.Event("move",p)),w&&this.fire(new m.Event("zoomstart",p)).fire(new m.Event("zoom",p)).fire(new m.Event("zoomend",p)),C&&this.fire(new m.Event("rotatestart",p)).fire(new m.Event("rotate",p)).fire(new m.Event("rotateend",p)),R&&this.fire(new m.Event("pitchstart",p)).fire(new m.Event("pitch",p)).fire(new m.Event("pitchend",p)),this.fire(new m.Event("moveend",p))},f.prototype.easeTo=function(c,p){var b=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,C=this.getZoom(),R=this.getBearing(),U=this.getPitch(),Y=this.getPadding(),ce="zoom"in c?+c.zoom:C,he="bearing"in c?this._normalizeBearing(c.bearing,R):R,pe="pitch"in c?+c.pitch:U,Ae="padding"in c?c.padding:w.padding,Re=m.Point.convert(c.offset),We=w.centerPoint.add(Re),Te=w.pointLocation(We),Ve=m.LngLat.convert(c.center||Te);this._normalizeCenter(Ve);var Qe,gt,Gt=w.project(Te),Ft=w.project(Ve).sub(Gt),Xt=w.zoomScale(ce-C);c.around&&(Qe=m.LngLat.convert(c.around),gt=w.locationPoint(Qe));var cr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ce!==C,this._rotating=this._rotating||R!==he,this._pitching=this._pitching||pe!==U,this._padding=!w.isPaddingEqual(Ae),this._easeId=c.easeId,this._prepareEase(p,c.noMoveStart,cr),this._ease(function(Rr){if(b._zooming&&(w.zoom=m.number(C,ce,Rr)),b._rotating&&(w.bearing=m.number(R,he,Rr)),b._pitching&&(w.pitch=m.number(U,pe,Rr)),b._padding&&(w.interpolatePadding(Y,Ae,Rr),We=w.centerPoint.add(Re)),Qe)w.setLocationAtPoint(Qe,gt);else{var Or=w.zoomScale(w.zoom-C),Qr=ce>C?Math.min(2,Xt):Math.max(.5,Xt),Dn=Math.pow(Qr,1-Rr),Bn=w.unproject(Gt.add(Ft.mult(Rr*Dn)).mult(Or));w.setLocationAtPoint(w.renderWorldCopies?Bn.wrap():Bn,We)}b._fireMoveEvents(p)},function(Rr){b._afterEase(p,Rr)},c),this},f.prototype._prepareEase=function(c,p,b){b===void 0&&(b={}),this._moving=!0,p||b.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!b.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!b.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!b.pitching&&this.fire(new m.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},f.prototype._afterEase=function(c,p){if(!this._easeId||!p||this._easeId!==p){delete this._easeId;var b=this._zooming,w=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new m.Event("zoomend",c)),w&&this.fire(new m.Event("rotateend",c)),C&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},f.prototype.flyTo=function(c,p){var b=this;if(!c.essential&&m.browser.prefersReducedMotion){var w=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,p)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var C=this.transform,R=this.getZoom(),U=this.getBearing(),Y=this.getPitch(),ce=this.getPadding(),he="zoom"in c?m.clamp(+c.zoom,C.minZoom,C.maxZoom):R,pe="bearing"in c?this._normalizeBearing(c.bearing,U):U,Ae="pitch"in c?+c.pitch:Y,Re="padding"in c?c.padding:C.padding,We=C.zoomScale(he-R),Te=m.Point.convert(c.offset),Ve=C.centerPoint.add(Te),Qe=C.pointLocation(Ve),gt=m.LngLat.convert(c.center||Qe);this._normalizeCenter(gt);var Gt=C.project(Qe),Ft=C.project(gt).sub(Gt),Xt=c.curve,cr=Math.max(C.width,C.height),Rr=cr/We,Or=Ft.mag();if("minZoom"in c){var Qr=m.clamp(Math.min(c.minZoom,R,he),C.minZoom,C.maxZoom),Dn=cr/C.zoomScale(Qr-R);Xt=Math.sqrt(Dn/Or*2)}var Bn=Xt*Xt;function Un($n){var jn=(Rr*Rr-cr*cr+($n?-1:1)*Bn*Bn*Or*Or)/(2*($n?Rr:cr)*Bn*Or);return Math.log(Math.sqrt(jn*jn+1)-jn)}function di($n){return(Math.exp($n)-Math.exp(-$n))/2}function nn($n){return(Math.exp($n)+Math.exp(-$n))/2}var ai=Un(0),si=function($n){return nn(ai)/nn(ai+Xt*$n)},ei=function($n){return cr*((nn(ai)*(di(jn=ai+Xt*$n)/nn(jn))-di(ai))/Bn)/Or;var jn},Wn=(Un(1)-ai)/Xt;if(Math.abs(Or)<1e-6||!isFinite(Wn)){if(Math.abs(cr-Rr)<1e-6)return this.easeTo(c,p);var mi=Rr<cr?-1:1;Wn=Math.abs(Math.log(Rr/cr))/Xt,ei=function(){return 0},si=function($n){return Math.exp(mi*Xt*$n)}}return c.duration="duration"in c?+c.duration:1e3*Wn/("screenSpeed"in c?+c.screenSpeed/Xt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==pe,this._pitching=Ae!==Y,this._padding=!C.isPaddingEqual(Re),this._prepareEase(p,!1),this._ease(function($n){var jn=$n*Wn,Ea=1/si(jn);C.zoom=$n===1?he:R+C.scaleZoom(Ea),b._rotating&&(C.bearing=m.number(U,pe,$n)),b._pitching&&(C.pitch=m.number(Y,Ae,$n)),b._padding&&(C.interpolatePadding(ce,Re,$n),Ve=C.centerPoint.add(Te));var Ka=$n===1?gt:C.unproject(Gt.add(Ft.mult(ei(jn))).mult(Ea));C.setLocationAtPoint(C.renderWorldCopies?Ka.wrap():Ka,Ve),b._fireMoveEvents(p)},function(){return b._afterEase(p)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,p)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},f.prototype._ease=function(c,p,b){b.animate===!1||b.duration===0?(c(1),p()):(this._easeStart=m.browser.now(),this._easeOptions=b,this._onEaseFrame=c,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,p){c=m.wrap(c,-180,180);var b=Math.abs(c-p);return Math.abs(c-360-p)<b&&(c-=360),Math.abs(c+360-p)<b&&(c+=360),c},f.prototype._normalizeCenter=function(c){var p=this.transform;if(p.renderWorldCopies&&!p.lngRange){var b=c.lng-p.center.lng;c.lng+=b>180?-360:b<-180?360:0}},f}(m.Evented),is=function(l){l===void 0&&(l={}),this.options=l,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};is.prototype.getDefaultPosition=function(){return"bottom-right"},is.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},is.prototype.onRemove=function(){F.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},is.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},is.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},is.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(p,b,w){return b.value&&(p+=b.key+"="+b.value+(w<f.length-1?"&":"")),p},"?");l.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},is.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},is.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var p in c){var b=c[p];if(b.used){var w=b.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(R,U){return R.length-U.length});var C=(l=l.filter(function(R,U){for(var Y=U+1;Y<l.length;Y++)if(l[Y].indexOf(R)>=0)return!1;return!0})).join(" | ");C!==this._attribHTML&&(this._attribHTML=C,l.length?(this._innerContainer.innerHTML=C,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},is.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var as=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};as.prototype.onAdd=function(l){this._map=l,this._container=F.create("div","mapboxgl-ctrl");var f=F.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},as.prototype.onRemove=function(){F.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},as.prototype.getDefaultPosition=function(){return"bottom-left"},as.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},as.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},as.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var No=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};No.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},No.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,p=f?this._queue.concat(f):this._queue;c<p.length;c+=1){var b=p[c];if(b.id===l)return void(b.cancelled=!0)}},No.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,p=f;c<p.length;c+=1){var b=p[c];if(!b.cancelled&&(b.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},No.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Fa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Hu=m.window.HTMLImageElement,Wu=m.window.HTMLElement,oa=m.window.ImageBitmap,ba={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},sc=function(l){function f(p){var b=this;if((p=m.extend({},ba,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Yi(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies);if(l.call(this,w,p),this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new No,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},Fa,p.locale),this._clickTolerance=p.clickTolerance,this._requestManager=new m.RequestManager(p.transformRequest,p.accessToken),typeof p.container=="string"){if(this._container=m.window.document.getElementById(p.container),!this._container)throw new Error("Container '"+p.container+"' not found.")}else{if(!(p.container instanceof Wu))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return b._update(!1)}),this.on("moveend",function(){return b._update(!1)}),this.on("zoom",function(){return b._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new bn(this,p),this._hash=p.hash&&new _s(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,m.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new is({customAttribution:p.customAttribution})),this.addControl(new as,p.logoPosition),this.on("style.load",function(){b.transform.unmodified&&b.jumpTo(b.style.stylesheet)}),this.on("data",function(C){b._update(C.dataType==="style"),b.fire(new m.Event(C.dataType+"data",C))}),this.on("dataloading",function(C){b.fire(new m.Event(C.dataType+"dataloading",C))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(p,b){if(b===void 0&&(b=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=p.onAdd(this);this._controls.push(p);var C=this._controlPositions[b];return b.indexOf("bottom")!==-1?C.insertBefore(w,C.firstChild):C.appendChild(w),this},f.prototype.removeControl=function(p){if(!p||!p.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var b=this._controls.indexOf(p);return b>-1&&this._controls.splice(b,1),p.onRemove(this),this},f.prototype.hasControl=function(p){return this._controls.indexOf(p)>-1},f.prototype.resize=function(p){var b=this._containerDimensions(),w=b[0],C=b[1];if(w===this.transform.width&&C===this.transform.height)return this;this._resizeCanvas(w,C),this.transform.resize(w,C),this.painter.resize(w,C);var R=!this._moving;return R&&this.fire(new m.Event("movestart",p)).fire(new m.Event("move",p)),this.fire(new m.Event("resize",p)),R&&this.fire(new m.Event("moveend",p)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(p){return this.transform.setMaxBounds(m.LngLatBounds.convert(p)),this._update()},f.prototype.setMinZoom=function(p){if((p=p==null?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(p){if((p=p==null?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(p){if((p=p==null?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(p){if((p=p==null?60:p)>60)throw new Error("maxPitch must be less than or equal to 60");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(p){return this.transform.renderWorldCopies=p,this._update()},f.prototype.project=function(p){return this.transform.locationPoint(m.LngLat.convert(p))},f.prototype.unproject=function(p){return this.transform.pointLocation(m.Point.convert(p))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(p,b,w){var C,R=this;if(p==="mouseenter"||p==="mouseover"){var U=!1;return{layer:b,listener:w,delegates:{mousemove:function(ce){var he=R.getLayer(b)?R.queryRenderedFeatures(ce.point,{layers:[b]}):[];he.length?U||(U=!0,w.call(R,new ho(p,R,ce.originalEvent,{features:he}))):U=!1},mouseout:function(){U=!1}}}}if(p==="mouseleave"||p==="mouseout"){var Y=!1;return{layer:b,listener:w,delegates:{mousemove:function(ce){(R.getLayer(b)?R.queryRenderedFeatures(ce.point,{layers:[b]}):[]).length?Y=!0:Y&&(Y=!1,w.call(R,new ho(p,R,ce.originalEvent)))},mouseout:function(ce){Y&&(Y=!1,w.call(R,new ho(p,R,ce.originalEvent)))}}}}return{layer:b,listener:w,delegates:(C={},C[p]=function(ce){var he=R.getLayer(b)?R.queryRenderedFeatures(ce.point,{layers:[b]}):[];he.length&&(ce.features=he,w.call(R,ce),delete ce.features)},C)}},f.prototype.on=function(p,b,w){if(w===void 0)return l.prototype.on.call(this,p,b);var C=this._createDelegatedListener(p,b,w);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(C),C.delegates)this.on(R,C.delegates[R]);return this},f.prototype.once=function(p,b,w){if(w===void 0)return l.prototype.once.call(this,p,b);var C=this._createDelegatedListener(p,b,w);for(var R in C.delegates)this.once(R,C.delegates[R]);return this},f.prototype.off=function(p,b,w){var C=this;return w===void 0?l.prototype.off.call(this,p,b):(this._delegatedListeners&&this._delegatedListeners[p]&&function(R){for(var U=R[p],Y=0;Y<U.length;Y++){var ce=U[Y];if(ce.layer===b&&ce.listener===w){for(var he in ce.delegates)C.off(he,ce.delegates[he]);return U.splice(Y,1),C}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(p,b){if(!this.style)return[];var w;if(b!==void 0||p===void 0||p instanceof m.Point||Array.isArray(p)||(b=p,p=void 0),b=b||{},(p=p||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof p[0]=="number")w=[m.Point.convert(p)];else{var C=m.Point.convert(p[0]),R=m.Point.convert(p[1]);w=[C,new m.Point(R.x,C.y),R,new m.Point(C.x,R.y),C]}return this.style.queryRenderedFeatures(w,b,this.transform)},f.prototype.querySourceFeatures=function(p,b){return this.style.querySourceFeatures(p,b)},f.prototype.setStyle=function(p,b){return(b=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},b)).diff!==!1&&b.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,b),this):(this._localIdeographFontFamily=b.localIdeographFontFamily,this._updateStyle(p,b))},f.prototype._getUIString=function(p){var b=this._locale[p];if(b==null)throw new Error("Missing UI string '"+p+"'");return b},f.prototype._updateStyle=function(p,b){return this.style&&(this.style.setEventedParent(null),this.style._remove()),p?(this.style=new gs(this,b||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(p,b){var w=this;if(typeof p=="string"){var C=this._requestManager.normalizeStyleURL(p),R=this._requestManager.transformRequest(C,m.ResourceType.Style);m.getJSON(R,function(U,Y){U?w.fire(new m.ErrorEvent(U)):Y&&w._updateDiff(Y,b)})}else typeof p=="object"&&this._updateDiff(p,b)},f.prototype._updateDiff=function(p,b){try{this.style.setState(p)&&this._update(!0)}catch(w){m.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(p,b)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(p,b){return this._lazyInitEmptyStyle(),this.style.addSource(p,b),this._update(!0)},f.prototype.isSourceLoaded=function(p){var b=this.style&&this.style.sourceCaches[p];if(b!==void 0)return b.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+p+"'")))},f.prototype.areTilesLoaded=function(){var p=this.style&&this.style.sourceCaches;for(var b in p){var w=p[b]._tiles;for(var C in w){var R=w[C];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(p,b,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,b,w)},f.prototype.removeSource=function(p){return this.style.removeSource(p),this._update(!0)},f.prototype.getSource=function(p){return this.style.getSource(p)},f.prototype.addImage=function(p,b,w){w===void 0&&(w={});var C=w.pixelRatio;C===void 0&&(C=1);var R=w.sdf;R===void 0&&(R=!1);var U=w.stretchX,Y=w.stretchY,ce=w.content;if(this._lazyInitEmptyStyle(),b instanceof Hu||oa&&b instanceof oa){var he=m.browser.getImageData(b);this.style.addImage(p,{data:new m.RGBAImage({width:he.width,height:he.height},he.data),pixelRatio:C,stretchX:U,stretchY:Y,content:ce,sdf:R,version:0})}else{if(b.width===void 0||b.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var pe=b;this.style.addImage(p,{data:new m.RGBAImage({width:b.width,height:b.height},new Uint8Array(b.data)),pixelRatio:C,stretchX:U,stretchY:Y,content:ce,sdf:R,version:0,userImage:pe}),pe.onAdd&&pe.onAdd(this,p)}},f.prototype.updateImage=function(p,b){var w=this.style.getImage(p);if(!w)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var C=b instanceof Hu||oa&&b instanceof oa?m.browser.getImageData(b):b,R=C.width,U=C.height,Y=C.data;return R===void 0||U===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==w.data.width||U!==w.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(Y,!(b instanceof Hu||oa&&b instanceof oa)),void this.style.updateImage(p,w))},f.prototype.hasImage=function(p){return p?!!this.style.getImage(p):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(p){this.style.removeImage(p)},f.prototype.loadImage=function(p,b){m.getImage(this._requestManager.transformRequest(p,m.ResourceType.Image),b)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(p,b){return this._lazyInitEmptyStyle(),this.style.addLayer(p,b),this._update(!0)},f.prototype.moveLayer=function(p,b){return this.style.moveLayer(p,b),this._update(!0)},f.prototype.removeLayer=function(p){return this.style.removeLayer(p),this._update(!0)},f.prototype.getLayer=function(p){return this.style.getLayer(p)},f.prototype.setLayerZoomRange=function(p,b,w){return this.style.setLayerZoomRange(p,b,w),this._update(!0)},f.prototype.setFilter=function(p,b,w){return w===void 0&&(w={}),this.style.setFilter(p,b,w),this._update(!0)},f.prototype.getFilter=function(p){return this.style.getFilter(p)},f.prototype.setPaintProperty=function(p,b,w,C){return C===void 0&&(C={}),this.style.setPaintProperty(p,b,w,C),this._update(!0)},f.prototype.getPaintProperty=function(p,b){return this.style.getPaintProperty(p,b)},f.prototype.setLayoutProperty=function(p,b,w,C){return C===void 0&&(C={}),this.style.setLayoutProperty(p,b,w,C),this._update(!0)},f.prototype.getLayoutProperty=function(p,b){return this.style.getLayoutProperty(p,b)},f.prototype.setLight=function(p,b){return b===void 0&&(b={}),this._lazyInitEmptyStyle(),this.style.setLight(p,b),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(p,b){return this.style.setFeatureState(p,b),this._update()},f.prototype.removeFeatureState=function(p,b){return this.style.removeFeatureState(p,b),this._update()},f.prototype.getFeatureState=function(p){return this.style.getFeatureState(p)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var p=0,b=0;return this._container&&(p=this._container.clientWidth||400,b=this._container.clientHeight||300),[p,b]},f.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=F.create("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();var b=this._canvasContainer=F.create("div","mapboxgl-canvas-container",p);this._interactive&&b.classList.add("mapboxgl-interactive"),this._canvas=F.create("canvas","mapboxgl-canvas",b),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var C=this._controlContainer=F.create("div","mapboxgl-control-container",p),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){R[U]=F.create("div","mapboxgl-ctrl-"+U,C)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(p,b){var w=m.browser.devicePixelRatio||1;this._canvas.width=w*p,this._canvas.height=w*b,this._canvas.style.width=p+"px",this._canvas.style.height=b+"px"},f.prototype._setupPainter=function(){var p=m.extend({},J.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),b=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);b?(this.painter=new $i(b,this.transform),m.webpSupported.testSupport(b)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:p}))},f.prototype._contextRestored=function(p){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:p}))},f.prototype._onMapScroll=function(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(p){return this._update(),this._renderTaskQueue.add(p)},f.prototype._cancelRenderFrame=function(p){this._renderTaskQueue.remove(p)},f.prototype._render=function(p){var b,w=this,C=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(b=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,b),C=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var Y=this.transform.zoom,ce=m.browser.now();this.style.zoomHistory.update(Y,ce);var he=new m.EvaluationParameters(Y,{now:ce,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pe=he.crossFadingFactor();pe===1&&pe===this._crossFadingFactor||(U=!0,this._crossFadingFactor=pe),this.style.update(he)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ae=m.browser.now()-C;R.endQueryEXT(R.TIME_ELAPSED_EXT,b),setTimeout(function(){var Te=R.getQueryObjectEXT(b,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(b),w.fire(new m.Event("gpu-timing-frame",{cpuTime:Ae,gpuTime:Te}))},50)}if(this.listens("gpu-timing-layer")){var Re=this.painter.collectGpuTimers();setTimeout(function(){var Te=w.painter.queryGpuTimers(Re);w.fire(new m.Event("gpu-timing-layer",{layerTimes:Te}))},50)}var We=this._sourcesDirty||this._styleDirty||this._placementDirty;return We||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||We||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var p=0,b=this._controls;p<b.length;p+=1)b[p].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),fl(this._canvasContainer),fl(this._controlContainer),fl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},f.prototype.triggerRepaint=function(){var p=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(b){p._frame=null,p._render(b)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(p){this._trackResize&&this.resize({originalEvent:p})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(p){this._showPadding!==p&&(this._showPadding=p,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(p){this._vertices=p,this._update()},f.prototype._setCacheLimits=function(p,b){m.setCacheLimits(p,b)},c.version.get=function(){return m.version},Object.defineProperties(f.prototype,c),f}(Dc);function fl(l){l.parentNode&&l.parentNode.removeChild(l)}var pu={showCompass:!0,showZoom:!0,visualizePitch:!1},du=function(l){var f=this;this.options=m.extend({},pu,l),this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),F.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),F.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=F.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};du.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},du.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},du.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new So(this._map,this._compass,this.options.visualizePitch)),this._container},du.prototype.onRemove=function(){F.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},du.prototype._createButton=function(l,f){var c=F.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},du.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var So=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new ff({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new ul({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),F.addEventListener(f,"mousedown",this.mousedown),F.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),F.addEventListener(f,"touchmove",this.touchmove),F.addEventListener(f,"touchend",this.touchend),F.addEventListener(f,"touchcancel",this.reset)};function Xu(l,f,c){if(l=new m.LngLat(l.lng,l.lat),f){var p=new m.LngLat(l.lng-360,l.lat),b=new m.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(f);c.locationPoint(p).distSqr(f)<w?l=p:c.locationPoint(b).distSqr(f)<w&&(l=b)}for(;Math.abs(l.lng-c.center.lng)>180;){var C=c.locationPoint(l);if(C.x>=0&&C.y>=0&&C.x<=c.width&&C.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}So.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),F.disableDrag()},So.prototype.move=function(l,f){var c=this.map,p=this.mouseRotate.mousemoveWindow(l,f);if(p&&p.bearingDelta&&c.setBearing(c.getBearing()+p.bearingDelta),this.mousePitch){var b=this.mousePitch.mousemoveWindow(l,f);b&&b.pitchDelta&&c.setPitch(c.getPitch()+b.pitchDelta)}},So.prototype.off=function(){var l=this.element;F.removeEventListener(l,"mousedown",this.mousedown),F.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),F.removeEventListener(l,"touchmove",this.touchmove),F.removeEventListener(l,"touchend",this.touchend),F.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},So.prototype.offTemp=function(){F.enableDrag(),F.removeEventListener(m.window,"mousemove",this.mousemove),F.removeEventListener(m.window,"mouseup",this.mouseup)},So.prototype.mousedown=function(l){this.down(m.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),F.mousePos(this.element,l)),F.addEventListener(m.window,"mousemove",this.mousemove),F.addEventListener(m.window,"mouseup",this.mouseup)},So.prototype.mousemove=function(l){this.move(l,F.mousePos(this.element,l))},So.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},So.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=F.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},So.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=F.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},So.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},So.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var vu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Dl(l,f,c){var p=l.classList;for(var b in vu)p.remove("mapboxgl-"+c+"-anchor-"+b);p.add("mapboxgl-"+c+"-anchor-"+f)}var Yu,uc=function(l){function f(c,p){if(l.call(this),(c instanceof m.window.HTMLElement||p)&&(c=m.extend({element:c},p)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=F.create("div"),this._element.setAttribute("aria-label","Map marker");var b=F.createNS("http://www.w3.org/2000/svg","svg");b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height","41px"),b.setAttributeNS(null,"width","27px"),b.setAttributeNS(null,"viewBox","0 0 27 41");var w=F.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var C=F.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");var R=F.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var U=0,Y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<Y.length;U+=1){var ce=Y[U],he=F.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",ce.rx),he.setAttributeNS(null,"ry",ce.ry),R.appendChild(he)}var pe=F.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"fill",this._color);var Ae=F.createNS("http://www.w3.org/2000/svg","path");Ae.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),pe.appendChild(Ae);var Re=F.createNS("http://www.w3.org/2000/svg","g");Re.setAttributeNS(null,"opacity","0.25"),Re.setAttributeNS(null,"fill","#000000");var We=F.createNS("http://www.w3.org/2000/svg","path");We.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Re.appendChild(We);var Te=F.createNS("http://www.w3.org/2000/svg","g");Te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Te.setAttributeNS(null,"fill","#FFFFFF");var Ve=F.createNS("http://www.w3.org/2000/svg","g");Ve.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Qe=F.createNS("http://www.w3.org/2000/svg","circle");Qe.setAttributeNS(null,"fill","#000000"),Qe.setAttributeNS(null,"opacity","0.25"),Qe.setAttributeNS(null,"cx","5.5"),Qe.setAttributeNS(null,"cy","5.5"),Qe.setAttributeNS(null,"r","5.4999962");var gt=F.createNS("http://www.w3.org/2000/svg","circle");gt.setAttributeNS(null,"fill","#FFFFFF"),gt.setAttributeNS(null,"cx","5.5"),gt.setAttributeNS(null,"cy","5.5"),gt.setAttributeNS(null,"r","5.4999962"),Ve.appendChild(Qe),Ve.appendChild(gt),C.appendChild(R),C.appendChild(pe),C.appendChild(Re),C.appendChild(Te),C.appendChild(Ve),b.appendChild(C),b.setAttributeNS(null,"height",41*this._scale+"px"),b.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(b),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Gt){Gt.preventDefault()}),this._element.addEventListener("mousedown",function(Gt){Gt.preventDefault()}),Dl(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),F.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var p=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(24.6+p)],"bottom-right":[-p,-1*(24.6+p)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var p=c.code,b=c.charCode||c.keyCode;p!=="Space"&&p!=="Enter"&&b!==32&&b!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var p=c.originalEvent.target,b=this._element;this._popup&&(p===b||b.contains(p))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Xu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(p="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),F.setTransform(this._element,vu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+b+" "+p)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var p=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(m.Evented),Fc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},lc=0,Fl=!1,Zf=function(l){function f(c){l.call(this),this.options=m.extend({},Fc,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var p;return this._map=c,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),p=this._setupUI,Yu!==void 0?p(Yu):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(b){p(Yu=b.state!=="denied")}):p(Yu=!!m.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),F.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,lc=0,Fl=!1},f.prototype._isOutOfMapMaxBounds=function(c){var p=this._map.getMaxBounds(),b=c.coords;return p&&(b.longitude<p.getWest()||b.longitude>p.getEast()||b.latitude<p.getSouth()||b.latitude>p.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var p=new m.LngLat(c.coords.longitude,c.coords.latitude),b=c.coords.accuracy,w=this._map.getBearing(),C=m.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(p.toBounds(b),C,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var p=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(p).addTo(this._map),this._userLocationDotMarker.setLngLat(p).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,p=this._map.unproject([0,c]),b=this._map.unproject([1,c]),w=p.distanceTo(b),C=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=C+"px",this._circleElement.style.height=C+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Fl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var p=this;if(this._container.addEventListener("contextmenu",function(C){return C.preventDefault()}),this._geolocateButton=F.create("button","mapboxgl-ctrl-geolocate",this._container),F.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new uc(this._dotElement),this._circleElement=F.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new uc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(C){C.geolocateSource||p._watchState!=="ACTIVE_LOCK"||C.originalEvent&&C.originalEvent.type==="resize"||(p._watchState="BACKGROUND",p._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),p._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),p.fire(new m.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":lc--,Fl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++lc>1?(c={maximumAge:6e5,timeout:0},Fl=!0):(c=this.options.positionOptions,Fl=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(m.Evented),hl={maxWidth:100,unit:"metric"},pl=function(l){this.options=m.extend({},hl,l),m.bindAll(["_onMove","setUnit"],this)};function zs(l,f,c){var p=c&&c.maxWidth||100,b=l._container.clientHeight/2,w=l.unproject([0,b]),C=l.unproject([p,b]),R=w.distanceTo(C);if(c&&c.unit==="imperial"){var U=3.2808*R;U>5280?dl(f,p,U/5280,l._getUIString("ScaleControl.Miles")):dl(f,p,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?dl(f,p,R/1852,l._getUIString("ScaleControl.NauticalMiles")):R>=1e3?dl(f,p,R/1e3,l._getUIString("ScaleControl.Kilometers")):dl(f,p,R,l._getUIString("ScaleControl.Meters"))}function dl(l,f,c,p){var b,w,C,R=(b=c,(w=Math.pow(10,(""+Math.floor(b)).length-1))*(C=(C=b/w)>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(U){var Y=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*Y)/Y}(C)));l.style.width=f*(R/c)+"px",l.innerHTML=R+"&nbsp;"+p}pl.prototype.getDefaultPosition=function(){return"bottom-left"},pl.prototype._onMove=function(){zs(this._map,this._container,this.options)},pl.prototype.onAdd=function(l){return this._map=l,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},pl.prototype.onRemove=function(){F.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},pl.prototype.setUnit=function(l){this.options.unit=l,zs(this._map,this._container,this.options)};var Ho=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof m.window.HTMLElement?this._container=l.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};Ho.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Ho.prototype.onRemove=function(){F.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Ho.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},Ho.prototype._setupUI=function(){var l=this._fullscreenButton=F.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Ho.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Ho.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Ho.prototype._isFullscreen=function(){return this._fullscreen},Ho.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Ho.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var df={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Nl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Nc=function(l){function f(c){l.call(this),this.options=m.extend(Object.create(df),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&F.remove(this._content),this._container&&(F.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var p,b=m.window.document.createDocumentFragment(),w=m.window.document.createElement("body");for(w.innerHTML=c;p=w.firstChild;)b.appendChild(p);return this.setDOMContent(b)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=F.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=F.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var p=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=F.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=F.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(he){return p._container.classList.add(he)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xu(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var b=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,C=function he(pe){if(pe){if(typeof pe=="number"){var Ae=Math.round(Math.sqrt(.5*Math.pow(pe,2)));return{center:new m.Point(0,0),top:new m.Point(0,pe),"top-left":new m.Point(Ae,Ae),"top-right":new m.Point(-Ae,Ae),bottom:new m.Point(0,-pe),"bottom-left":new m.Point(Ae,-Ae),"bottom-right":new m.Point(-Ae,-Ae),left:new m.Point(pe,0),right:new m.Point(-pe,0)}}if(pe instanceof m.Point||Array.isArray(pe)){var Re=m.Point.convert(pe);return{center:Re,top:Re,"top-left":Re,"top-right":Re,bottom:Re,"bottom-left":Re,"bottom-right":Re,left:Re,right:Re}}return{center:m.Point.convert(pe.center||[0,0]),top:m.Point.convert(pe.top||[0,0]),"top-left":m.Point.convert(pe["top-left"]||[0,0]),"top-right":m.Point.convert(pe["top-right"]||[0,0]),bottom:m.Point.convert(pe.bottom||[0,0]),"bottom-left":m.Point.convert(pe["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(pe["bottom-right"]||[0,0]),left:m.Point.convert(pe.left||[0,0]),right:m.Point.convert(pe.right||[0,0])}}return he(new m.Point(0,0))}(this.options.offset);if(!w){var R,U=this._container.offsetWidth,Y=this._container.offsetHeight;R=b.y+C.bottom.y<Y?["top"]:b.y>this._map.transform.height-Y?["bottom"]:[],b.x<U/2?R.push("left"):b.x>this._map.transform.width-U/2&&R.push("right"),w=R.length===0?"bottom":R.join("-")}var ce=b.add(C[w]).round();F.setTransform(this._container,vu[w]+" translate("+ce.x+"px,"+ce.y+"px)"),Dl(this._container,w,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Nl);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(m.Evented),cc={version:m.version,supported:J,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:sc,NavigationControl:du,GeolocateControl:Zf,AttributionControl:is,ScaleControl:pl,FullscreenControl:Ho,Popup:Nc,Marker:uc,Style:gs,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){Tt().acquire(Dt)},clearPrewarmedResources:function(){var l=mn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Dt),mn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(l){m.config.ACCESS_TOKEN=l},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(l){m.config.API_URL=l},get workerCount(){return pr.workerCount},set workerCount(l){pr.workerCount=l},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){m.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){m.clearTileCache(l)},workerUrl:""};return cc}),X})},28660:function(Ue,W,L){var X=L(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var j;(function(m){(function(J){var F=typeof L.g=="object"?L.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),$=re(m);typeof F.Reflect=="undefined"?F.Reflect=m:$=re(F.Reflect,$),J($);function re(ie,ne){return function(Le,Ie){typeof ie[Le]!="function"&&Object.defineProperty(ie,Le,{configurable:!0,writable:!0,value:Ie}),ne&&ne(Le,Ie)}}})(function(J){var F=Object.prototype.hasOwnProperty,$=typeof Symbol=="function",re=$&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ie=$&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ne=typeof Object.create=="function",Le={__proto__:[]}instanceof Array,Ie=!ne&&!Le,He={create:ne?function(){return rs(Object.create(null))}:Le?function(){return rs({__proto__:null})}:function(){return rs({})},has:Ie?function(kt,tr){return F.call(kt,tr)}:function(kt,tr){return tr in kt},get:Ie?function(kt,tr){return F.call(kt,tr)?kt[tr]:void 0}:function(kt,tr){return kt[tr]}},Rt=Object.getPrototypeOf(Function),$t=typeof X=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",ht=!$t&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:de(),Ut=!$t&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ln(),dt=!$t&&typeof WeakMap=="function"?WeakMap:Za(),nt=new dt;function rt(kt,tr,Sr,qr){if(cn(Sr)){if(!ki(kt))throw new TypeError;if(!la(tr))throw new TypeError;return Cr(kt,tr)}else{if(!ki(kt))throw new TypeError;if(!ti(tr))throw new TypeError;if(!ti(qr)&&!cn(qr)&&!li(qr))throw new TypeError;return li(qr)&&(qr=void 0),Sr=Vi(Sr),jr(kt,tr,Sr,qr)}}J("decorate",rt);function er(kt,tr){function Sr(qr,xn){if(!ti(qr))throw new TypeError;if(!cn(xn)&&!Ai(xn))throw new TypeError;Lt(kt,tr,qr,xn)}return Sr}J("metadata",er);function K(kt,tr,Sr,qr){if(!ti(Sr))throw new TypeError;return cn(qr)||(qr=Vi(qr)),Lt(kt,tr,Sr,qr)}J("defineMetadata",K);function Ht(kt,tr,Sr){if(!ti(tr))throw new TypeError;return cn(Sr)||(Sr=Vi(Sr)),we(kt,tr,Sr)}J("hasMetadata",Ht);function at(kt,tr,Sr){if(!ti(tr))throw new TypeError;return cn(Sr)||(Sr=Vi(Sr)),De(kt,tr,Sr)}J("hasOwnMetadata",at);function Ye(kt,tr,Sr){if(!ti(tr))throw new TypeError;return cn(Sr)||(Sr=Vi(Sr)),bt(kt,tr,Sr)}J("getMetadata",Ye);function ut(kt,tr,Sr){if(!ti(tr))throw new TypeError;return cn(Sr)||(Sr=Vi(Sr)),mt(kt,tr,Sr)}J("getOwnMetadata",ut);function Je(kt,tr){if(!ti(kt))throw new TypeError;return cn(tr)||(tr=Vi(tr)),Yt(kt,tr)}J("getMetadataKeys",Je);function Ot(kt,tr){if(!ti(kt))throw new TypeError;return cn(tr)||(tr=Vi(tr)),br(kt,tr)}J("getOwnMetadataKeys",Ot);function dr(kt,tr,Sr){if(!ti(tr))throw new TypeError;cn(Sr)||(Sr=Vi(Sr));var qr=T(tr,Sr,!1);if(cn(qr)||!qr.delete(kt))return!1;if(qr.size>0)return!0;var xn=nt.get(tr);return xn.delete(Sr),xn.size>0||nt.delete(tr),!0}J("deleteMetadata",dr);function Cr(kt,tr){for(var Sr=kt.length-1;Sr>=0;--Sr){var qr=kt[Sr],xn=qr(tr);if(!cn(xn)&&!li(xn)){if(!la(xn))throw new TypeError;tr=xn}}return tr}function jr(kt,tr,Sr,qr){for(var xn=kt.length-1;xn>=0;--xn){var kn=kt[xn],hi=kn(tr,Sr,qr);if(!cn(hi)&&!li(hi)){if(!ti(hi))throw new TypeError;qr=hi}}return qr}function T(kt,tr,Sr){var qr=nt.get(kt);if(cn(qr)){if(!Sr)return;qr=new ht,nt.set(kt,qr)}var xn=qr.get(tr);if(cn(xn)){if(!Sr)return;xn=new ht,qr.set(tr,xn)}return xn}function we(kt,tr,Sr){var qr=De(kt,tr,Sr);if(qr)return!0;var xn=ko(tr);return li(xn)?!1:we(kt,xn,Sr)}function De(kt,tr,Sr){var qr=T(tr,Sr,!1);return cn(qr)?!1:fi(qr.has(kt))}function bt(kt,tr,Sr){var qr=De(kt,tr,Sr);if(qr)return mt(kt,tr,Sr);var xn=ko(tr);if(!li(xn))return bt(kt,xn,Sr)}function mt(kt,tr,Sr){var qr=T(tr,Sr,!1);if(!cn(qr))return qr.get(kt)}function Lt(kt,tr,Sr,qr){var xn=T(Sr,qr,!0);xn.set(kt,tr)}function Yt(kt,tr){var Sr=br(kt,tr),qr=ko(kt);if(qr===null)return Sr;var xn=Yt(qr,tr);if(xn.length<=0)return Sr;if(Sr.length<=0)return xn;for(var kn=new Ut,hi=[],qn=0,an=Sr;qn<an.length;qn++){var Di=an[qn],Oi=kn.has(Di);Oi||(kn.add(Di),hi.push(Di))}for(var to=0,ps=xn;to<ps.length;to++){var Di=ps[to],Oi=kn.has(Di);Oi||(kn.add(Di),hi.push(Di))}return hi}function br(kt,tr){var Sr=[],qr=T(kt,tr,!1);if(cn(qr))return Sr;for(var xn=qr.keys(),kn=Xn(xn),hi=0;;){var qn=zi(kn);if(!qn)return Sr.length=hi,Sr;var an=bi(qn);try{Sr[hi]=an}catch(Di){try{qi(kn)}finally{throw Di}}hi++}}function Kn(kt){if(kt===null)return 1;switch(typeof kt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return kt===null?1:6;default:return 6}}function cn(kt){return kt===void 0}function li(kt){return kt===null}function Vn(kt){return typeof kt=="symbol"}function ti(kt){return typeof kt=="object"?kt!==null:typeof kt=="function"}function ci(kt,tr){switch(Kn(kt)){case 0:return kt;case 1:return kt;case 2:return kt;case 3:return kt;case 4:return kt;case 5:return kt}var Sr=tr===3?"string":tr===5?"number":"default",qr=ma(kt,re);if(qr!==void 0){var xn=qr.call(kt,Sr);if(ti(xn))throw new TypeError;return xn}return Hn(kt,Sr==="default"?"number":Sr)}function Hn(kt,tr){if(tr==="string"){var Sr=kt.toString;if(Ki(Sr)){var qr=Sr.call(kt);if(!ti(qr))return qr}var xn=kt.valueOf;if(Ki(xn)){var qr=xn.call(kt);if(!ti(qr))return qr}}else{var xn=kt.valueOf;if(Ki(xn)){var qr=xn.call(kt);if(!ti(qr))return qr}var kn=kt.toString;if(Ki(kn)){var qr=kn.call(kt);if(!ti(qr))return qr}}throw new TypeError}function fi(kt){return!!kt}function ua(kt){return""+kt}function Vi(kt){var tr=ci(kt,3);return Vn(tr)?tr:ua(tr)}function ki(kt){return Array.isArray?Array.isArray(kt):kt instanceof Object?kt instanceof Array:Object.prototype.toString.call(kt)==="[object Array]"}function Ki(kt){return typeof kt=="function"}function la(kt){return typeof kt=="function"}function Ai(kt){switch(Kn(kt)){case 3:return!0;case 4:return!0;default:return!1}}function ma(kt,tr){var Sr=kt[tr];if(Sr!=null){if(!Ki(Sr))throw new TypeError;return Sr}}function Xn(kt){var tr=ma(kt,ie);if(!Ki(tr))throw new TypeError;var Sr=tr.call(kt);if(!ti(Sr))throw new TypeError;return Sr}function bi(kt){return kt.value}function zi(kt){var tr=kt.next();return tr.done?!1:tr}function qi(kt){var tr=kt.return;tr&&tr.call(kt)}function ko(kt){var tr=Object.getPrototypeOf(kt);if(typeof kt!="function"||kt===Rt||tr!==Rt)return tr;var Sr=kt.prototype,qr=Sr&&Object.getPrototypeOf(Sr);if(qr==null||qr===Object.prototype)return tr;var xn=qr.constructor;return typeof xn!="function"||xn===kt?tr:xn}function de(){var kt={},tr=[],Sr=function(){function hi(qn,an,Di){this._index=0,this._keys=qn,this._values=an,this._selector=Di}return hi.prototype["@@iterator"]=function(){return this},hi.prototype[ie]=function(){return this},hi.prototype.next=function(){var qn=this._index;if(qn>=0&&qn<this._keys.length){var an=this._selector(this._keys[qn],this._values[qn]);return qn+1>=this._keys.length?(this._index=-1,this._keys=tr,this._values=tr):this._index++,{value:an,done:!1}}return{value:void 0,done:!0}},hi.prototype.throw=function(qn){throw this._index>=0&&(this._index=-1,this._keys=tr,this._values=tr),qn},hi.prototype.return=function(qn){return this._index>=0&&(this._index=-1,this._keys=tr,this._values=tr),{value:qn,done:!0}},hi}();return function(){function hi(){this._keys=[],this._values=[],this._cacheKey=kt,this._cacheIndex=-2}return Object.defineProperty(hi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),hi.prototype.has=function(qn){return this._find(qn,!1)>=0},hi.prototype.get=function(qn){var an=this._find(qn,!1);return an>=0?this._values[an]:void 0},hi.prototype.set=function(qn,an){var Di=this._find(qn,!0);return this._values[Di]=an,this},hi.prototype.delete=function(qn){var an=this._find(qn,!1);if(an>=0){for(var Di=this._keys.length,Oi=an+1;Oi<Di;Oi++)this._keys[Oi-1]=this._keys[Oi],this._values[Oi-1]=this._values[Oi];return this._keys.length--,this._values.length--,qn===this._cacheKey&&(this._cacheKey=kt,this._cacheIndex=-2),!0}return!1},hi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=kt,this._cacheIndex=-2},hi.prototype.keys=function(){return new Sr(this._keys,this._values,qr)},hi.prototype.values=function(){return new Sr(this._keys,this._values,xn)},hi.prototype.entries=function(){return new Sr(this._keys,this._values,kn)},hi.prototype["@@iterator"]=function(){return this.entries()},hi.prototype[ie]=function(){return this.entries()},hi.prototype._find=function(qn,an){return this._cacheKey!==qn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=qn)),this._cacheIndex<0&&an&&(this._cacheIndex=this._keys.length,this._keys.push(qn),this._values.push(void 0)),this._cacheIndex},hi}();function qr(hi,qn){return hi}function xn(hi,qn){return qn}function kn(hi,qn){return[hi,qn]}}function Ln(){return function(){function kt(){this._map=new ht}return Object.defineProperty(kt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),kt.prototype.has=function(tr){return this._map.has(tr)},kt.prototype.add=function(tr){return this._map.set(tr,tr),this},kt.prototype.delete=function(tr){return this._map.delete(tr)},kt.prototype.clear=function(){this._map.clear()},kt.prototype.keys=function(){return this._map.keys()},kt.prototype.values=function(){return this._map.values()},kt.prototype.entries=function(){return this._map.entries()},kt.prototype["@@iterator"]=function(){return this.keys()},kt.prototype[ie]=function(){return this.keys()},kt}()}function Za(){var kt=16,tr=He.create(),Sr=qr();return function(){function an(){this._key=qr()}return an.prototype.has=function(Di){var Oi=xn(Di,!1);return Oi!==void 0?He.has(Oi,this._key):!1},an.prototype.get=function(Di){var Oi=xn(Di,!1);return Oi!==void 0?He.get(Oi,this._key):void 0},an.prototype.set=function(Di,Oi){var to=xn(Di,!0);return to[this._key]=Oi,this},an.prototype.delete=function(Di){var Oi=xn(Di,!1);return Oi!==void 0?delete Oi[this._key]:!1},an.prototype.clear=function(){this._key=qr()},an}();function qr(){var an;do an="@@WeakMap@@"+qn();while(He.has(tr,an));return tr[an]=!0,an}function xn(an,Di){if(!F.call(an,Sr)){if(!Di)return;Object.defineProperty(an,Sr,{value:He.create()})}return an[Sr]}function kn(an,Di){for(var Oi=0;Oi<Di;++Oi)an[Oi]=Math.random()*255|0;return an}function hi(an){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(an)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(an)):kn(new Uint8Array(an),an):kn(new Array(an),an)}function qn(){var an=hi(kt);an[6]=an[6]&79|64,an[8]=an[8]&191|128;for(var Di="",Oi=0;Oi<kt;++Oi){var to=an[Oi];(Oi===4||Oi===6||Oi===8)&&(Di+="-"),to<16&&(Di+="0"),Di+=to.toString(16).toLowerCase()}return Di}}function rs(kt){return kt.__=void 0,delete kt.__,kt}})})(j||(j={}))},69848:function(Ue){(function(W,L){Ue.exports=L()})(this,function(){"use strict";function W(at,Ye,ut,Je,Ot,dr){if(!(Ot-Je<=ut)){var Cr=Je+Ot>>1;L(at,Ye,Cr,Je,Ot,dr%2),W(at,Ye,ut,Je,Cr-1,dr+1),W(at,Ye,ut,Cr+1,Ot,dr+1)}}function L(at,Ye,ut,Je,Ot,dr){for(;Ot>Je;){if(Ot-Je>600){var Cr=Ot-Je+1,jr=ut-Je+1,T=Math.log(Cr),we=.5*Math.exp(2*T/3),De=.5*Math.sqrt(T*we*(Cr-we)/Cr)*(jr-Cr/2<0?-1:1),bt=Math.max(Je,Math.floor(ut-jr*we/Cr+De)),mt=Math.min(Ot,Math.floor(ut+(Cr-jr)*we/Cr+De));L(at,Ye,ut,bt,mt,dr)}var Lt=Ye[2*ut+dr],Yt=Je,br=Ot;for(X(at,Ye,Je,ut),Ye[2*Ot+dr]>Lt&&X(at,Ye,Je,Ot);Yt<br;){for(X(at,Ye,Yt,br),Yt++,br--;Ye[2*Yt+dr]<Lt;)Yt++;for(;Ye[2*br+dr]>Lt;)br--}Ye[2*Je+dr]===Lt?X(at,Ye,Je,br):(br++,X(at,Ye,br,Ot)),br<=ut&&(Je=br+1),ut<=br&&(Ot=br-1)}}function X(at,Ye,ut,Je){j(at,ut,Je),j(Ye,2*ut,2*Je),j(Ye,2*ut+1,2*Je+1)}function j(at,Ye,ut){var Je=at[Ye];at[Ye]=at[ut],at[ut]=Je}function m(at,Ye,ut,Je,Ot,dr,Cr){for(var jr=[0,at.length-1,0],T=[],we,De;jr.length;){var bt=jr.pop(),mt=jr.pop(),Lt=jr.pop();if(mt-Lt<=Cr){for(var Yt=Lt;Yt<=mt;Yt++)we=Ye[2*Yt],De=Ye[2*Yt+1],we>=ut&&we<=Ot&&De>=Je&&De<=dr&&T.push(at[Yt]);continue}var br=Math.floor((Lt+mt)/2);we=Ye[2*br],De=Ye[2*br+1],we>=ut&&we<=Ot&&De>=Je&&De<=dr&&T.push(at[br]);var Kn=(bt+1)%2;(bt===0?ut<=we:Je<=De)&&(jr.push(Lt),jr.push(br-1),jr.push(Kn)),(bt===0?Ot>=we:dr>=De)&&(jr.push(br+1),jr.push(mt),jr.push(Kn))}return T}function J(at,Ye,ut,Je,Ot,dr){for(var Cr=[0,at.length-1,0],jr=[],T=Ot*Ot;Cr.length;){var we=Cr.pop(),De=Cr.pop(),bt=Cr.pop();if(De-bt<=dr){for(var mt=bt;mt<=De;mt++)F(Ye[2*mt],Ye[2*mt+1],ut,Je)<=T&&jr.push(at[mt]);continue}var Lt=Math.floor((bt+De)/2),Yt=Ye[2*Lt],br=Ye[2*Lt+1];F(Yt,br,ut,Je)<=T&&jr.push(at[Lt]);var Kn=(we+1)%2;(we===0?ut-Ot<=Yt:Je-Ot<=br)&&(Cr.push(bt),Cr.push(Lt-1),Cr.push(Kn)),(we===0?ut+Ot>=Yt:Je+Ot>=br)&&(Cr.push(Lt+1),Cr.push(De),Cr.push(Kn))}return jr}function F(at,Ye,ut,Je){var Ot=at-ut,dr=Ye-Je;return Ot*Ot+dr*dr}var $=function(at){return at[0]},re=function(at){return at[1]},ie=function(Ye,ut,Je,Ot,dr){ut===void 0&&(ut=$),Je===void 0&&(Je=re),Ot===void 0&&(Ot=64),dr===void 0&&(dr=Float64Array),this.nodeSize=Ot,this.points=Ye;for(var Cr=Ye.length<65536?Uint16Array:Uint32Array,jr=this.ids=new Cr(Ye.length),T=this.coords=new dr(Ye.length*2),we=0;we<Ye.length;we++)jr[we]=we,T[2*we]=ut(Ye[we]),T[2*we+1]=Je(Ye[we]);W(jr,T,Ot,0,jr.length-1,0)};ie.prototype.range=function(Ye,ut,Je,Ot){return m(this.ids,this.coords,Ye,ut,Je,Ot,this.nodeSize)},ie.prototype.within=function(Ye,ut,Je){return J(this.ids,this.coords,Ye,ut,Je,this.nodeSize)};var ne={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(at){return at}},Le=Math.fround||function(at){return function(Ye){return at[0]=+Ye,at[0]}}(new Float32Array(1)),Ie=function(Ye){this.options=er(Object.create(ne),Ye),this.trees=new Array(this.options.maxZoom+1)};Ie.prototype.load=function(Ye){var ut=this.options,Je=ut.log,Ot=ut.minZoom,dr=ut.maxZoom,Cr=ut.nodeSize;Je&&console.time("total time");var jr="prepare "+Ye.length+" points";Je&&console.time(jr),this.points=Ye;for(var T=[],we=0;we<Ye.length;we++)!Ye[we].geometry||T.push(Rt(Ye[we],we));this.trees[dr+1]=new ie(T,K,Ht,Cr,Float32Array),Je&&console.timeEnd(jr);for(var De=dr;De>=Ot;De--){var bt=+Date.now();T=this._cluster(T,De),this.trees[De]=new ie(T,K,Ht,Cr,Float32Array),Je&&console.log("z%d: %d clusters in %dms",De,T.length,+Date.now()-bt)}return Je&&console.timeEnd("total time"),this},Ie.prototype.getClusters=function(Ye,ut){var Je=((Ye[0]+180)%360+360)%360-180,Ot=Math.max(-90,Math.min(90,Ye[1])),dr=Ye[2]===180?180:((Ye[2]+180)%360+360)%360-180,Cr=Math.max(-90,Math.min(90,Ye[3]));if(Ye[2]-Ye[0]>=360)Je=-180,dr=180;else if(Je>dr){var jr=this.getClusters([Je,Ot,180,Cr],ut),T=this.getClusters([-180,Ot,dr,Cr],ut);return jr.concat(T)}for(var we=this.trees[this._limitZoom(ut)],De=we.range(Ut(Je),dt(Cr),Ut(dr),dt(Ot)),bt=[],mt=0,Lt=De;mt<Lt.length;mt+=1){var Yt=Lt[mt],br=we.points[Yt];bt.push(br.numPoints?$t(br):this.points[br.index])}return bt},Ie.prototype.getChildren=function(Ye){var ut=this._getOriginId(Ye),Je=this._getOriginZoom(Ye),Ot="No cluster with the specified id.",dr=this.trees[Je];if(!dr)throw new Error(Ot);var Cr=dr.points[ut];if(!Cr)throw new Error(Ot);for(var jr=this.options.radius/(this.options.extent*Math.pow(2,Je-1)),T=dr.within(Cr.x,Cr.y,jr),we=[],De=0,bt=T;De<bt.length;De+=1){var mt=bt[De],Lt=dr.points[mt];Lt.parentId===Ye&&we.push(Lt.numPoints?$t(Lt):this.points[Lt.index])}if(we.length===0)throw new Error(Ot);return we},Ie.prototype.getLeaves=function(Ye,ut,Je){ut=ut||10,Je=Je||0;var Ot=[];return this._appendLeaves(Ot,Ye,ut,Je,0),Ot},Ie.prototype.getTile=function(Ye,ut,Je){var Ot=this.trees[this._limitZoom(Ye)],dr=Math.pow(2,Ye),Cr=this.options,jr=Cr.extent,T=Cr.radius,we=T/jr,De=(Je-we)/dr,bt=(Je+1+we)/dr,mt={features:[]};return this._addTileFeatures(Ot.range((ut-we)/dr,De,(ut+1+we)/dr,bt),Ot.points,ut,Je,dr,mt),ut===0&&this._addTileFeatures(Ot.range(1-we/dr,De,1,bt),Ot.points,dr,Je,dr,mt),ut===dr-1&&this._addTileFeatures(Ot.range(0,De,we/dr,bt),Ot.points,-1,Je,dr,mt),mt.features.length?mt:null},Ie.prototype.getClusterExpansionZoom=function(Ye){for(var ut=this._getOriginZoom(Ye)-1;ut<=this.options.maxZoom;){var Je=this.getChildren(Ye);if(ut++,Je.length!==1)break;Ye=Je[0].properties.cluster_id}return ut},Ie.prototype._appendLeaves=function(Ye,ut,Je,Ot,dr){for(var Cr=this.getChildren(ut),jr=0,T=Cr;jr<T.length;jr+=1){var we=T[jr],De=we.properties;if(De&&De.cluster?dr+De.point_count<=Ot?dr+=De.point_count:dr=this._appendLeaves(Ye,De.cluster_id,Je,Ot,dr):dr<Ot?dr++:Ye.push(we),Ye.length===Je)break}return dr},Ie.prototype._addTileFeatures=function(Ye,ut,Je,Ot,dr,Cr){for(var jr=0,T=Ye;jr<T.length;jr+=1){var we=T[jr],De=ut[we],bt=De.numPoints,mt=void 0,Lt=void 0,Yt=void 0;if(bt)mt=ht(De),Lt=De.x,Yt=De.y;else{var br=this.points[De.index];mt=br.properties,Lt=Ut(br.geometry.coordinates[0]),Yt=dt(br.geometry.coordinates[1])}var Kn={type:1,geometry:[[Math.round(this.options.extent*(Lt*dr-Je)),Math.round(this.options.extent*(Yt*dr-Ot))]],tags:mt},cn=void 0;bt?cn=De.id:this.options.generateId?cn=De.index:this.points[De.index].id&&(cn=this.points[De.index].id),cn!==void 0&&(Kn.id=cn),Cr.features.push(Kn)}},Ie.prototype._limitZoom=function(Ye){return Math.max(this.options.minZoom,Math.min(+Ye,this.options.maxZoom+1))},Ie.prototype._cluster=function(Ye,ut){for(var Je=[],Ot=this.options,dr=Ot.radius,Cr=Ot.extent,jr=Ot.reduce,T=Ot.minPoints,we=dr/(Cr*Math.pow(2,ut)),De=0;De<Ye.length;De++){var bt=Ye[De];if(!(bt.zoom<=ut)){bt.zoom=ut;for(var mt=this.trees[ut+1],Lt=mt.within(bt.x,bt.y,we),Yt=bt.numPoints||1,br=Yt,Kn=0,cn=Lt;Kn<cn.length;Kn+=1){var li=cn[Kn],Vn=mt.points[li];Vn.zoom>ut&&(br+=Vn.numPoints||1)}if(br>Yt&&br>=T){for(var ti=bt.x*Yt,ci=bt.y*Yt,Hn=jr&&Yt>1?this._map(bt,!0):null,fi=(De<<5)+(ut+1)+this.points.length,ua=0,Vi=Lt;ua<Vi.length;ua+=1){var ki=Vi[ua],Ki=mt.points[ki];if(!(Ki.zoom<=ut)){Ki.zoom=ut;var la=Ki.numPoints||1;ti+=Ki.x*la,ci+=Ki.y*la,Ki.parentId=fi,jr&&(Hn||(Hn=this._map(bt,!0)),jr(Hn,this._map(Ki)))}}bt.parentId=fi,Je.push(He(ti/br,ci/br,fi,br,Hn))}else if(Je.push(bt),br>1)for(var Ai=0,ma=Lt;Ai<ma.length;Ai+=1){var Xn=ma[Ai],bi=mt.points[Xn];bi.zoom<=ut||(bi.zoom=ut,Je.push(bi))}}}return Je},Ie.prototype._getOriginId=function(Ye){return Ye-this.points.length>>5},Ie.prototype._getOriginZoom=function(Ye){return(Ye-this.points.length)%32},Ie.prototype._map=function(Ye,ut){if(Ye.numPoints)return ut?er({},Ye.properties):Ye.properties;var Je=this.points[Ye.index].properties,Ot=this.options.map(Je);return ut&&Ot===Je?er({},Ot):Ot};function He(at,Ye,ut,Je,Ot){return{x:Le(at),y:Le(Ye),zoom:Infinity,id:ut,parentId:-1,numPoints:Je,properties:Ot}}function Rt(at,Ye){var ut=at.geometry.coordinates,Je=ut[0],Ot=ut[1];return{x:Le(Ut(Je)),y:Le(dt(Ot)),zoom:Infinity,index:Ye,parentId:-1}}function $t(at){return{type:"Feature",id:at.id,properties:ht(at),geometry:{type:"Point",coordinates:[nt(at.x),rt(at.y)]}}}function ht(at){var Ye=at.numPoints,ut=Ye>=1e4?Math.round(Ye/1e3)+"k":Ye>=1e3?Math.round(Ye/100)/10+"k":Ye;return er(er({},at.properties),{cluster:!0,cluster_id:at.id,point_count:Ye,point_count_abbreviated:ut})}function Ut(at){return at/360+.5}function dt(at){var Ye=Math.sin(at*Math.PI/180),ut=.5-.25*Math.log((1+Ye)/(1-Ye))/Math.PI;return ut<0?0:ut>1?1:ut}function nt(at){return(at-.5)*360}function rt(at){var Ye=(180-at*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ye))/Math.PI-90}function er(at,Ye){for(var ut in Ye)at[ut]=Ye[ut];return at}function K(at){return at.x}function Ht(at){return at.y}return Ie})},75752:function(Ue){Ue.exports.RADIUS=6378137,Ue.exports.FLATTENING=1/298.257223563,Ue.exports.POLAR_RADIUS=63567523142e-4}}]);
